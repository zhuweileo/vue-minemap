(function(f){if(typeof exports==="object"&&typeof module!=="undefined"){module.exports=f()}else if(typeof define==="function"&&define.amd){define([],f)}else{var g;if(typeof window!=="undefined"){g=window}else if(typeof global!=="undefined"){g=global}else if(typeof self!=="undefined"){g=self}else{g=this}g.minemap = f()}})(function(){var define,module,exports;return (function(){function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s}return e})()({1:[function(_dereq_,module,exports){
"use strict";function normalizeEvent(e){return e.type.match(touchRegExp)?{pageX:e.changedTouches[0].pageX,pageY:e.changedTouches[0].pageY,type:e.type,originalEvent:e}:{pageX:e.pageX,pageY:e.pageY,offsetX:e.offsetX,offsetY:e.offsetY,type:e.type,ctrlKey:e.ctrlKey,shiftKey:e.shiftKey,altKey:e.altKey,originalEvent:e}}Object.defineProperty(exports,"__esModule",{value:!0});var proxy=function(e,t){return function(n){return t(e(n))}},bind=function(e,t,n){return e.addEventListener&&e.addEventListener(t,n)},unbind=function(e,t,n){return e.removeEventListener&&e.removeEventListener(t,n)},noop=function(){},touchRegExp=/touch/,IGNORE_MOUSE_TIMEOUT=2e3,Draggable=function(e){var t=this,n=e.press;void 0===n&&(n=noop);var o=e.drag;void 0===o&&(o=noop);var i=e.release;void 0===i&&(i=noop),this._pressHandler=proxy(normalizeEvent,n),this._dragHandler=proxy(normalizeEvent,o),this._releaseHandler=proxy(normalizeEvent,i),this._ignoreMouse=!1,this._touchAction,this._touchstart=function(e){1===e.touches.length&&t._pressHandler(e)},this._touchmove=function(e){1===e.touches.length&&t._dragHandler(e)},this._touchend=function(e){0===e.touches.length&&1===e.changedTouches.length&&(t._releaseHandler(e),t._ignoreMouse=!0,setTimeout(t._restoreMouse,IGNORE_MOUSE_TIMEOUT))},this._restoreMouse=function(){t._ignoreMouse=!1},this._mousedown=function(e){var n=e.which;n&&n>1||t._ignoreMouse||(bind(document,"mousemove",t._mousemove),bind(document,"mouseup",t._mouseup),t._pressHandler(e))},this._mousemove=function(e){t._dragHandler(e)},this._mouseup=function(e){unbind(document,"mousemove",t._mousemove),unbind(document,"mouseup",t._mouseup),t._releaseHandler(e)},this._pointerdown=function(e){e.isPrimary&&(bind(t._element,"pointermove",t._pointermove),t._touchAction=e.target.style.touchAction,e.target.style.touchAction="none",e.target.setPointerCapture(e.pointerId),t._pressHandler(e))},this._pointermove=function(e){e.isPrimary&&t._dragHandler(e)},this._pointerup=function(e){e.isPrimary&&(unbind(t._element,"pointermove",t._pointermove),e.target.style.touchAction=t._touchAction,e.target.releasePointerCapture(e.pointerId),t._releaseHandler(e))}};Draggable.supportPointerEvent=function(){return window.PointerEvent},Draggable.prototype.bindTo=function(e){e!==this._element&&(this._element&&this._unbindFromCurrent(),this._element=e,Draggable.supportPointerEvent()?(bind(e,"pointerdown",this._pointerdown),bind(e,"pointerup",this._pointerup)):(bind(e,"mousedown",this._mousedown),bind(e,"touchstart",this._touchstart),bind(e,"touchmove",this._touchmove),bind(e,"touchend",this._touchend)))},Draggable.prototype._unbindFromCurrent=function(){Draggable.supportPointerEvent()?(unbind(this._element,"pointerdown",this._pointerdown),unbind(this._element,"pointermove",this._pointermove),unbind(this._element,"pointerup",this._pointerup)):(unbind(this._element,"mousedown",this._mousedown),unbind(this._element,"touchstart",this._touchstart),unbind(this._element,"touchmove",this._touchmove),unbind(this._element,"touchend",this._touchend))},Draggable.prototype.destroy=function(){this._unbindFromCurrent(),this._element=null},Draggable.default=Draggable,exports.Draggable=Draggable,exports.default=Draggable;
},{}],2:[function(_dereq_,module,exports){
function clamp_css_byte(e){return e=Math.round(e),e<0?0:e>255?255:e}function clamp_css_float(e){return e<0?0:e>1?1:e}function parse_css_int(e){return clamp_css_byte("%"===e[e.length-1]?parseFloat(e)/100*255:parseInt(e))}function parse_css_float(e){return clamp_css_float("%"===e[e.length-1]?parseFloat(e)/100:parseFloat(e))}function css_hue_to_rgb(e,r,l){return l<0?l+=1:l>1&&(l-=1),6*l<1?e+(r-e)*l*6:2*l<1?r:3*l<2?e+(r-e)*(2/3-l)*6:e}function parseCSSColor(e){var r=e.replace(/ /g,"").toLowerCase();if(r in kCSSColorTable)return kCSSColorTable[r].slice();if("#"===r[0]){if(4===r.length){var l=parseInt(r.substr(1),16);return l>=0&&l<=4095?[(3840&l)>>4|(3840&l)>>8,240&l|(240&l)>>4,15&l|(15&l)<<4,1]:null}if(7===r.length){var l=parseInt(r.substr(1),16);return l>=0&&l<=16777215?[(16711680&l)>>16,(65280&l)>>8,255&l,1]:null}return null}var a=r.indexOf("("),t=r.indexOf(")");if(-1!==a&&t+1===r.length){var n=r.substr(0,a),s=r.substr(a+1,t-(a+1)).split(","),o=1;switch(n){case"rgba":if(4!==s.length)return null;o=parse_css_float(s.pop());case"rgb":return 3!==s.length?null:[parse_css_int(s[0]),parse_css_int(s[1]),parse_css_int(s[2]),o];case"hsla":if(4!==s.length)return null;o=parse_css_float(s.pop());case"hsl":if(3!==s.length)return null;var i=(parseFloat(s[0])%360+360)%360/360,u=parse_css_float(s[1]),g=parse_css_float(s[2]),d=g<=.5?g*(u+1):g+u-g*u,c=2*g-d;return[clamp_css_byte(255*css_hue_to_rgb(c,d,i+1/3)),clamp_css_byte(255*css_hue_to_rgb(c,d,i)),clamp_css_byte(255*css_hue_to_rgb(c,d,i-1/3)),o];default:return null}}return null}var kCSSColorTable={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};try{exports.parseCSSColor=parseCSSColor}catch(e){}
},{}],3:[function(_dereq_,module,exports){
"use strict";function earcut(e,n,r){r=r||2;var t=n&&n.length,i=t?n[0]*r:e.length,x=linkedList(e,0,i,r,!0),a=[];if(!x)return a;var o,l,u,s,v,f,y;if(t&&(x=eliminateHoles(e,n,x,r)),e.length>80*r){o=u=e[0],l=s=e[1];for(var p=r;p<i;p+=r)v=e[p],f=e[p+1],v<o&&(o=v),f<l&&(l=f),v>u&&(u=v),f>s&&(s=f);y=Math.max(u-o,s-l),y=0!==y?1/y:0}return earcutLinked(x,a,r,o,l,y),a}function linkedList(e,n,r,t,i){var x,a;if(i===signedArea(e,n,r,t)>0)for(x=n;x<r;x+=t)a=insertNode(x,e[x],e[x+1],a);else for(x=r-t;x>=n;x-=t)a=insertNode(x,e[x],e[x+1],a);return a&&equals(a,a.next)&&(removeNode(a),a=a.next),a}function filterPoints(e,n){if(!e)return e;n||(n=e);var r,t=e;do{if(r=!1,t.steiner||!equals(t,t.next)&&0!==area(t.prev,t,t.next))t=t.next;else{if(removeNode(t),(t=n=t.prev)===t.next)break;r=!0}}while(r||t!==n);return n}function earcutLinked(e,n,r,t,i,x,a){if(e){!a&&x&&indexCurve(e,t,i,x);for(var o,l,u=e;e.prev!==e.next;)if(o=e.prev,l=e.next,x?isEarHashed(e,t,i,x):isEar(e))n.push(o.i/r),n.push(e.i/r),n.push(l.i/r),removeNode(e),e=l.next,u=l.next;else if((e=l)===u){a?1===a?(e=cureLocalIntersections(e,n,r),earcutLinked(e,n,r,t,i,x,2)):2===a&&splitEarcut(e,n,r,t,i,x):earcutLinked(filterPoints(e),n,r,t,i,x,1);break}}}function isEar(e){var n=e.prev,r=e,t=e.next;if(area(n,r,t)>=0)return!1;for(var i=e.next.next;i!==e.prev;){if(pointInTriangle(n.x,n.y,r.x,r.y,t.x,t.y,i.x,i.y)&&area(i.prev,i,i.next)>=0)return!1;i=i.next}return!0}function isEarHashed(e,n,r,t){var i=e.prev,x=e,a=e.next;if(area(i,x,a)>=0)return!1;for(var o=i.x<x.x?i.x<a.x?i.x:a.x:x.x<a.x?x.x:a.x,l=i.y<x.y?i.y<a.y?i.y:a.y:x.y<a.y?x.y:a.y,u=i.x>x.x?i.x>a.x?i.x:a.x:x.x>a.x?x.x:a.x,s=i.y>x.y?i.y>a.y?i.y:a.y:x.y>a.y?x.y:a.y,v=zOrder(o,l,n,r,t),f=zOrder(u,s,n,r,t),y=e.prevZ,p=e.nextZ;y&&y.z>=v&&p&&p.z<=f;){if(y!==e.prev&&y!==e.next&&pointInTriangle(i.x,i.y,x.x,x.y,a.x,a.y,y.x,y.y)&&area(y.prev,y,y.next)>=0)return!1;if(y=y.prevZ,p!==e.prev&&p!==e.next&&pointInTriangle(i.x,i.y,x.x,x.y,a.x,a.y,p.x,p.y)&&area(p.prev,p,p.next)>=0)return!1;p=p.nextZ}for(;y&&y.z>=v;){if(y!==e.prev&&y!==e.next&&pointInTriangle(i.x,i.y,x.x,x.y,a.x,a.y,y.x,y.y)&&area(y.prev,y,y.next)>=0)return!1;y=y.prevZ}for(;p&&p.z<=f;){if(p!==e.prev&&p!==e.next&&pointInTriangle(i.x,i.y,x.x,x.y,a.x,a.y,p.x,p.y)&&area(p.prev,p,p.next)>=0)return!1;p=p.nextZ}return!0}function cureLocalIntersections(e,n,r){var t=e;do{var i=t.prev,x=t.next.next;!equals(i,x)&&intersects(i,t,t.next,x)&&locallyInside(i,x)&&locallyInside(x,i)&&(n.push(i.i/r),n.push(t.i/r),n.push(x.i/r),removeNode(t),removeNode(t.next),t=e=x),t=t.next}while(t!==e);return t}function splitEarcut(e,n,r,t,i,x){var a=e;do{for(var o=a.next.next;o!==a.prev;){if(a.i!==o.i&&isValidDiagonal(a,o)){var l=splitPolygon(a,o);return a=filterPoints(a,a.next),l=filterPoints(l,l.next),earcutLinked(a,n,r,t,i,x),void earcutLinked(l,n,r,t,i,x)}o=o.next}a=a.next}while(a!==e)}function eliminateHoles(e,n,r,t){var i,x,a,o,l,u=[];for(i=0,x=n.length;i<x;i++)a=n[i]*t,o=i<x-1?n[i+1]*t:e.length,l=linkedList(e,a,o,t,!1),l===l.next&&(l.steiner=!0),u.push(getLeftmost(l));for(u.sort(compareX),i=0;i<u.length;i++)eliminateHole(u[i],r),r=filterPoints(r,r.next);return r}function compareX(e,n){return e.x-n.x}function eliminateHole(e,n){if(n=findHoleBridge(e,n)){var r=splitPolygon(n,e);filterPoints(r,r.next)}}function findHoleBridge(e,n){var r,t=n,i=e.x,x=e.y,a=-1/0;do{if(x<=t.y&&x>=t.next.y&&t.next.y!==t.y){var o=t.x+(x-t.y)*(t.next.x-t.x)/(t.next.y-t.y);if(o<=i&&o>a){if(a=o,o===i){if(x===t.y)return t;if(x===t.next.y)return t.next}r=t.x<t.next.x?t:t.next}}t=t.next}while(t!==n);if(!r)return null;if(i===a)return r.prev;var l,u=r,s=r.x,v=r.y,f=1/0;for(t=r.next;t!==u;)i>=t.x&&t.x>=s&&i!==t.x&&pointInTriangle(x<v?i:a,x,s,v,x<v?a:i,x,t.x,t.y)&&((l=Math.abs(x-t.y)/(i-t.x))<f||l===f&&t.x>r.x)&&locallyInside(t,e)&&(r=t,f=l),t=t.next;return r}function indexCurve(e,n,r,t){var i=e;do{null===i.z&&(i.z=zOrder(i.x,i.y,n,r,t)),i.prevZ=i.prev,i.nextZ=i.next,i=i.next}while(i!==e);i.prevZ.nextZ=null,i.prevZ=null,sortLinked(i)}function sortLinked(e){var n,r,t,i,x,a,o,l,u=1;do{for(r=e,e=null,x=null,a=0;r;){for(a++,t=r,o=0,n=0;n<u&&(o++,t=t.nextZ);n++);for(l=u;o>0||l>0&&t;)0!==o&&(0===l||!t||r.z<=t.z)?(i=r,r=r.nextZ,o--):(i=t,t=t.nextZ,l--),x?x.nextZ=i:e=i,i.prevZ=x,x=i;r=t}x.nextZ=null,u*=2}while(a>1);return e}function zOrder(e,n,r,t,i){return e=32767*(e-r)*i,n=32767*(n-t)*i,e=16711935&(e|e<<8),e=252645135&(e|e<<4),e=858993459&(e|e<<2),e=1431655765&(e|e<<1),n=16711935&(n|n<<8),n=252645135&(n|n<<4),n=858993459&(n|n<<2),n=1431655765&(n|n<<1),e|n<<1}function getLeftmost(e){var n=e,r=e;do{n.x<r.x&&(r=n),n=n.next}while(n!==e);return r}function pointInTriangle(e,n,r,t,i,x,a,o){return(i-a)*(n-o)-(e-a)*(x-o)>=0&&(e-a)*(t-o)-(r-a)*(n-o)>=0&&(r-a)*(x-o)-(i-a)*(t-o)>=0}function isValidDiagonal(e,n){return e.next.i!==n.i&&e.prev.i!==n.i&&!intersectsPolygon(e,n)&&locallyInside(e,n)&&locallyInside(n,e)&&middleInside(e,n)}function area(e,n,r){return(n.y-e.y)*(r.x-n.x)-(n.x-e.x)*(r.y-n.y)}function equals(e,n){return e.x===n.x&&e.y===n.y}function intersects(e,n,r,t){return!!(equals(e,n)&&equals(r,t)||equals(e,t)&&equals(r,n))||area(e,n,r)>0!=area(e,n,t)>0&&area(r,t,e)>0!=area(r,t,n)>0}function intersectsPolygon(e,n){var r=e;do{if(r.i!==e.i&&r.next.i!==e.i&&r.i!==n.i&&r.next.i!==n.i&&intersects(r,r.next,e,n))return!0;r=r.next}while(r!==e);return!1}function locallyInside(e,n){return area(e.prev,e,e.next)<0?area(e,n,e.next)>=0&&area(e,e.prev,n)>=0:area(e,n,e.prev)<0||area(e,e.next,n)<0}function middleInside(e,n){var r=e,t=!1,i=(e.x+n.x)/2,x=(e.y+n.y)/2;do{r.y>x!=r.next.y>x&&r.next.y!==r.y&&i<(r.next.x-r.x)*(x-r.y)/(r.next.y-r.y)+r.x&&(t=!t),r=r.next}while(r!==e);return t}function splitPolygon(e,n){var r=new Node(e.i,e.x,e.y),t=new Node(n.i,n.x,n.y),i=e.next,x=n.prev;return e.next=n,n.prev=e,r.next=i,i.prev=r,t.next=r,r.prev=t,x.next=t,t.prev=x,t}function insertNode(e,n,r,t){var i=new Node(e,n,r);return t?(i.next=t.next,i.prev=t,t.next.prev=i,t.next=i):(i.prev=i,i.next=i),i}function removeNode(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function Node(e,n,r){this.i=e,this.x=n,this.y=r,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function signedArea(e,n,r,t){for(var i=0,x=n,a=r-t;x<r;x+=t)i+=(e[a]-e[x])*(e[x+1]+e[a+1]),a=x;return i}module.exports=earcut,module.exports.default=earcut,earcut.deviation=function(e,n,r,t){var i=n&&n.length,x=i?n[0]*r:e.length,a=Math.abs(signedArea(e,0,x,r));if(i)for(var o=0,l=n.length;o<l;o++){var u=n[o]*r,s=o<l-1?n[o+1]*r:e.length;a-=Math.abs(signedArea(e,u,s,r))}var v=0;for(o=0;o<t.length;o+=3){var f=t[o]*r,y=t[o+1]*r,p=t[o+2]*r;v+=Math.abs((e[f]-e[p])*(e[y+1]-e[f+1])-(e[f]-e[y])*(e[p+1]-e[f+1]))}return 0===a&&0===v?0:Math.abs((v-a)/a)},earcut.flatten=function(e){for(var n=e[0][0].length,r={vertices:[],holes:[],dimensions:n},t=0,i=0;i<e.length;i++){for(var x=0;x<e[i].length;x++)for(var a=0;a<n;a++)r.vertices.push(e[i][x][a]);i>0&&(t+=e[i-1].length,r.holes.push(t))}return r};
},{}],4:[function(_dereq_,module,exports){
"use strict";function GridIndex(t,r,e){var s=this.cells=[];if(t instanceof ArrayBuffer){this.arrayBuffer=t;var i=new Int32Array(this.arrayBuffer);t=i[0],r=i[1],e=i[2],this.d=r+2*e;for(var h=0;h<this.d*this.d;h++){var n=i[NUM_PARAMS+h],o=i[NUM_PARAMS+h+1];s.push(n===o?null:i.subarray(n,o))}var l=i[NUM_PARAMS+s.length],a=i[NUM_PARAMS+s.length+1];this.keys=i.subarray(l,a),this.bboxes=i.subarray(a),this.insert=this._insertReadonly}else{this.d=r+2*e;for(var d=0;d<this.d*this.d;d++)s.push([]);this.keys=[],this.bboxes=[]}this.n=r,this.extent=t,this.padding=e,this.scale=r/t,this.uid=0;var f=e/r*t;this.min=-f,this.max=t+f}module.exports=GridIndex;var NUM_PARAMS=3;GridIndex.prototype.insert=function(t,r,e,s,i){this._forEachCell(r,e,s,i,this._insertCell,this.uid++),this.keys.push(t),this.bboxes.push(r),this.bboxes.push(e),this.bboxes.push(s),this.bboxes.push(i)},GridIndex.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},GridIndex.prototype._insertCell=function(t,r,e,s,i,h){this.cells[i].push(h)},GridIndex.prototype.query=function(t,r,e,s){var i=this.min,h=this.max;if(t<=i&&r<=i&&h<=e&&h<=s)return Array.prototype.slice.call(this.keys);var n=[],o={};return this._forEachCell(t,r,e,s,this._queryCell,n,o),n},GridIndex.prototype._queryCell=function(t,r,e,s,i,h,n){var o=this.cells[i];if(null!==o)for(var l=this.keys,a=this.bboxes,d=0;d<o.length;d++){var f=o[d];if(void 0===n[f]){var u=4*f;t<=a[u+2]&&r<=a[u+3]&&e>=a[u+0]&&s>=a[u+1]?(n[f]=!0,h.push(l[f])):n[f]=!1}}},GridIndex.prototype._forEachCell=function(t,r,e,s,i,h,n){for(var o=this._convertToCellCoord(t),l=this._convertToCellCoord(r),a=this._convertToCellCoord(e),d=this._convertToCellCoord(s),f=o;f<=a;f++)for(var u=l;u<=d;u++){var y=this.d*u+f;if(i.call(this,t,r,e,s,y,h,n))return}},GridIndex.prototype._convertToCellCoord=function(t){return Math.max(0,Math.min(this.d-1,Math.floor(t*this.scale)+this.padding))},GridIndex.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var t=this.cells,r=NUM_PARAMS+this.cells.length+1+1,e=0,s=0;s<this.cells.length;s++)e+=this.cells[s].length;var i=new Int32Array(r+e+this.keys.length+this.bboxes.length);i[0]=this.extent,i[1]=this.n,i[2]=this.padding;for(var h=r,n=0;n<t.length;n++){var o=t[n];i[NUM_PARAMS+n]=h,i.set(o,h),h+=o.length}return i[NUM_PARAMS+t.length]=h,i.set(this.keys,h),h+=this.keys.length,i[NUM_PARAMS+t.length+1]=h,i.set(this.bboxes,h),h+=this.bboxes.length,i.buffer};
},{}],5:[function(_dereq_,module,exports){
exports.read=function(a,o,t,r,h){var M,p,w=8*h-r-1,f=(1<<w)-1,e=f>>1,i=-7,N=t?h-1:0,n=t?-1:1,s=a[o+N];for(N+=n,M=s&(1<<-i)-1,s>>=-i,i+=w;i>0;M=256*M+a[o+N],N+=n,i-=8);for(p=M&(1<<-i)-1,M>>=-i,i+=r;i>0;p=256*p+a[o+N],N+=n,i-=8);if(0===M)M=1-e;else{if(M===f)return p?NaN:1/0*(s?-1:1);p+=Math.pow(2,r),M-=e}return(s?-1:1)*p*Math.pow(2,M-r)},exports.write=function(a,o,t,r,h,M){var p,w,f,e=8*M-h-1,i=(1<<e)-1,N=i>>1,n=23===h?Math.pow(2,-24)-Math.pow(2,-77):0,s=r?0:M-1,u=r?1:-1,l=o<0||0===o&&1/o<0?1:0;for(o=Math.abs(o),isNaN(o)||o===1/0?(w=isNaN(o)?1:0,p=i):(p=Math.floor(Math.log(o)/Math.LN2),o*(f=Math.pow(2,-p))<1&&(p--,f*=2),o+=p+N>=1?n/f:n*Math.pow(2,1-N),o*f>=2&&(p++,f/=2),p+N>=i?(w=0,p=i):p+N>=1?(w=(o*f-1)*Math.pow(2,h),p+=N):(w=o*Math.pow(2,N-1)*Math.pow(2,h),p=0));h>=8;a[t+s]=255&w,s+=u,w/=256,h-=8);for(p=p<<h|w,e+=h;e>0;a[t+s]=255&p,s+=u,p/=256,e-=8);a[t+s-u]|=128*l};
},{}],6:[function(_dereq_,module,exports){
"use strict";function kdbush(t,i,e,s,n){return new KDBush(t,i,e,s,n)}function KDBush(t,i,e,s,n){i=i||defaultGetX,e=e||defaultGetY,n=n||Array,this.nodeSize=s||64,this.points=t,this.ids=new n(t.length),this.coords=new n(2*t.length);for(var r=0;r<t.length;r++)this.ids[r]=r,this.coords[2*r]=i(t[r]),this.coords[2*r+1]=e(t[r]);sort(this.ids,this.coords,this.nodeSize,0,this.ids.length-1,0)}function defaultGetX(t){return t[0]}function defaultGetY(t){return t[1]}var sort=_dereq_("./sort"),range=_dereq_("./range"),within=_dereq_("./within");module.exports=kdbush,KDBush.prototype={range:function(t,i,e,s){return range(this.ids,this.coords,t,i,e,s,this.nodeSize)},within:function(t,i,e){return within(this.ids,this.coords,t,i,e,this.nodeSize)}};
},{"./range":7,"./sort":8,"./within":9}],7:[function(_dereq_,module,exports){
"use strict";function range(p,r,s,u,h,e,o){for(var a,t,n=[0,p.length-1,0],f=[];n.length;){var l=n.pop(),v=n.pop(),g=n.pop();if(v-g<=o)for(var i=g;i<=v;i++)a=r[2*i],t=r[2*i+1],a>=s&&a<=h&&t>=u&&t<=e&&f.push(p[i]);else{var c=Math.floor((g+v)/2);a=r[2*c],t=r[2*c+1],a>=s&&a<=h&&t>=u&&t<=e&&f.push(p[c]);var d=(l+1)%2;(0===l?s<=a:u<=t)&&(n.push(g),n.push(c-1),n.push(d)),(0===l?h>=a:e>=t)&&(n.push(c+1),n.push(v),n.push(d))}}return f}module.exports=range;
},{}],8:[function(_dereq_,module,exports){
"use strict";function sortKD(t,a,o,s,r,e){if(!(r-s<=o)){var f=Math.floor((s+r)/2);select(t,a,f,s,r,e%2),sortKD(t,a,o,s,f-1,e+1),sortKD(t,a,o,f+1,r,e+1)}}function select(t,a,o,s,r,e){for(;r>s;){if(r-s>600){var f=r-s+1,p=o-s+1,w=Math.log(f),m=.5*Math.exp(2*w/3),n=.5*Math.sqrt(w*m*(f-m)/f)*(p-f/2<0?-1:1);select(t,a,o,Math.max(s,Math.floor(o-p*m/f+n)),Math.min(r,Math.floor(o+(f-p)*m/f+n)),e)}var c=a[2*o+e],h=s,i=r;for(swapItem(t,a,s,o),a[2*r+e]>c&&swapItem(t,a,s,r);h<i;){for(swapItem(t,a,h,i),h++,i--;a[2*h+e]<c;)h++;for(;a[2*i+e]>c;)i--}a[2*s+e]===c?swapItem(t,a,s,i):(i++,swapItem(t,a,i,r)),i<=o&&(s=i+1),o<=i&&(r=i-1)}}function swapItem(t,a,o,s){swap(t,o,s),swap(a,2*o,2*s),swap(a,2*o+1,2*s+1)}function swap(t,a,o){var s=t[a];t[a]=t[o],t[o]=s}module.exports=sortKD;
},{}],9:[function(_dereq_,module,exports){
"use strict";function within(s,p,r,t,u,h){for(var i=[0,s.length-1,0],o=[],n=u*u;i.length;){var e=i.pop(),a=i.pop(),f=i.pop();if(a-f<=h)for(var v=f;v<=a;v++)sqDist(p[2*v],p[2*v+1],r,t)<=n&&o.push(s[v]);else{var l=Math.floor((f+a)/2),c=p[2*l],q=p[2*l+1];sqDist(c,q,r,t)<=n&&o.push(s[l]);var D=(e+1)%2;(0===e?r-u<=c:t-u<=q)&&(i.push(f),i.push(l-1),i.push(D)),(0===e?r+u>=c:t+u>=q)&&(i.push(l+1),i.push(a),i.push(D))}}return o}function sqDist(s,p,r,t){var u=s-r,h=p-t;return u*u+h*h}module.exports=within;
},{}],10:[function(_dereq_,module,exports){
"use strict";function Pbf(t){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(t)?t:new Uint8Array(t||0),this.pos=0,this.type=0,this.length=this.buf.length}function readVarintRemainder(t,i,e){var r,s,n=e.buf;if(s=n[e.pos++],r=(112&s)>>4,s<128)return toNum(t,r,i);if(s=n[e.pos++],r|=(127&s)<<3,s<128)return toNum(t,r,i);if(s=n[e.pos++],r|=(127&s)<<10,s<128)return toNum(t,r,i);if(s=n[e.pos++],r|=(127&s)<<17,s<128)return toNum(t,r,i);if(s=n[e.pos++],r|=(127&s)<<24,s<128)return toNum(t,r,i);if(s=n[e.pos++],r|=(1&s)<<31,s<128)return toNum(t,r,i);throw new Error("Expected varint not more than 10 bytes")}function readPackedEnd(t){return t.type===Pbf.Bytes?t.readVarint()+t.pos:t.pos+1}function toNum(t,i,e){return e?4294967296*i+(t>>>0):4294967296*(i>>>0)+(t>>>0)}function writeBigVarint(t,i){var e,r;if(t>=0?(e=t%4294967296|0,r=t/4294967296|0):(e=~(-t%4294967296),r=~(-t/4294967296),4294967295^e?e=e+1|0:(e=0,r=r+1|0)),t>=0x10000000000000000||t<-0x10000000000000000)throw new Error("Given varint doesn't fit into 10 bytes");i.realloc(10),writeBigVarintLow(e,r,i),writeBigVarintHigh(r,i)}function writeBigVarintLow(t,i,e){e.buf[e.pos++]=127&t|128,t>>>=7,e.buf[e.pos++]=127&t|128,t>>>=7,e.buf[e.pos++]=127&t|128,t>>>=7,e.buf[e.pos++]=127&t|128,t>>>=7,e.buf[e.pos]=127&t}function writeBigVarintHigh(t,i){var e=(7&t)<<4;i.buf[i.pos++]|=e|((t>>>=3)?128:0),t&&(i.buf[i.pos++]=127&t|((t>>>=7)?128:0),t&&(i.buf[i.pos++]=127&t|((t>>>=7)?128:0),t&&(i.buf[i.pos++]=127&t|((t>>>=7)?128:0),t&&(i.buf[i.pos++]=127&t|((t>>>=7)?128:0),t&&(i.buf[i.pos++]=127&t)))))}function makeRoomForExtraLength(t,i,e){var r=i<=16383?1:i<=2097151?2:i<=268435455?3:Math.ceil(Math.log(i)/(7*Math.LN2));e.realloc(r);for(var s=e.pos-1;s>=t;s--)e.buf[s+r]=e.buf[s]}function writePackedVarint(t,i){for(var e=0;e<t.length;e++)i.writeVarint(t[e])}function writePackedSVarint(t,i){for(var e=0;e<t.length;e++)i.writeSVarint(t[e])}function writePackedFloat(t,i){for(var e=0;e<t.length;e++)i.writeFloat(t[e])}function writePackedDouble(t,i){for(var e=0;e<t.length;e++)i.writeDouble(t[e])}function writePackedBoolean(t,i){for(var e=0;e<t.length;e++)i.writeBoolean(t[e])}function writePackedFixed32(t,i){for(var e=0;e<t.length;e++)i.writeFixed32(t[e])}function writePackedSFixed32(t,i){for(var e=0;e<t.length;e++)i.writeSFixed32(t[e])}function writePackedFixed64(t,i){for(var e=0;e<t.length;e++)i.writeFixed64(t[e])}function writePackedSFixed64(t,i){for(var e=0;e<t.length;e++)i.writeSFixed64(t[e])}function readUInt32(t,i){return(t[i]|t[i+1]<<8|t[i+2]<<16)+16777216*t[i+3]}function writeInt32(t,i,e){t[e]=i,t[e+1]=i>>>8,t[e+2]=i>>>16,t[e+3]=i>>>24}function readInt32(t,i){return(t[i]|t[i+1]<<8|t[i+2]<<16)+(t[i+3]<<24)}function readUtf8(t,i,e){for(var r="",s=i;s<e;){var n=t[s],o=null,a=n>239?4:n>223?3:n>191?2:1;if(s+a>e)break;var h,u,f;1===a?n<128&&(o=n):2===a?128==(192&(h=t[s+1]))&&(o=(31&n)<<6|63&h)<=127&&(o=null):3===a?(h=t[s+1],u=t[s+2],128==(192&h)&&128==(192&u)&&((o=(15&n)<<12|(63&h)<<6|63&u)<=2047||o>=55296&&o<=57343)&&(o=null)):4===a&&(h=t[s+1],u=t[s+2],f=t[s+3],128==(192&h)&&128==(192&u)&&128==(192&f)&&((o=(15&n)<<18|(63&h)<<12|(63&u)<<6|63&f)<=65535||o>=1114112)&&(o=null)),null===o?(o=65533,a=1):o>65535&&(o-=65536,r+=String.fromCharCode(o>>>10&1023|55296),o=56320|1023&o),r+=String.fromCharCode(o),s+=a}return r}function writeUtf8(t,i,e){for(var r,s,n=0;n<i.length;n++){if((r=i.charCodeAt(n))>55295&&r<57344){if(!s){r>56319||n+1===i.length?(t[e++]=239,t[e++]=191,t[e++]=189):s=r;continue}if(r<56320){t[e++]=239,t[e++]=191,t[e++]=189,s=r;continue}r=s-55296<<10|r-56320|65536,s=null}else s&&(t[e++]=239,t[e++]=191,t[e++]=189,s=null);r<128?t[e++]=r:(r<2048?t[e++]=r>>6|192:(r<65536?t[e++]=r>>12|224:(t[e++]=r>>18|240,t[e++]=r>>12&63|128),t[e++]=r>>6&63|128),t[e++]=63&r|128)}return e}module.exports=Pbf;var ieee754=_dereq_("ieee754");Pbf.Varint=0,Pbf.Fixed64=1,Pbf.Bytes=2,Pbf.Fixed32=5;var SHIFT_LEFT_32=4294967296,SHIFT_RIGHT_32=1/SHIFT_LEFT_32;Pbf.prototype={destroy:function(){this.buf=null},readFields:function(t,i,e){for(e=e||this.length;this.pos<e;){var r=this.readVarint(),s=r>>3,n=this.pos;this.type=7&r,t(s,i,this),this.pos===n&&this.skip(r)}return i},readMessage:function(t,i){return this.readFields(t,i,this.readVarint()+this.pos)},readFixed32:function(){var t=readUInt32(this.buf,this.pos);return this.pos+=4,t},readSFixed32:function(){var t=readInt32(this.buf,this.pos);return this.pos+=4,t},readFixed64:function(){var t=readUInt32(this.buf,this.pos)+readUInt32(this.buf,this.pos+4)*SHIFT_LEFT_32;return this.pos+=8,t},readSFixed64:function(){var t=readUInt32(this.buf,this.pos)+readInt32(this.buf,this.pos+4)*SHIFT_LEFT_32;return this.pos+=8,t},readFloat:function(){var t=ieee754.read(this.buf,this.pos,!0,23,4);return this.pos+=4,t},readDouble:function(){var t=ieee754.read(this.buf,this.pos,!0,52,8);return this.pos+=8,t},readVarint:function(t){var i,e,r=this.buf;return e=r[this.pos++],i=127&e,e<128?i:(e=r[this.pos++],i|=(127&e)<<7,e<128?i:(e=r[this.pos++],i|=(127&e)<<14,e<128?i:(e=r[this.pos++],i|=(127&e)<<21,e<128?i:(e=r[this.pos],i|=(15&e)<<28,readVarintRemainder(i,t,this)))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var t=this.readVarint();return t%2==1?(t+1)/-2:t/2},readBoolean:function(){return Boolean(this.readVarint())},readString:function(){var t=this.readVarint()+this.pos,i=readUtf8(this.buf,this.pos,t);return this.pos=t,i},readBytes:function(){var t=this.readVarint()+this.pos,i=this.buf.subarray(this.pos,t);return this.pos=t,i},readPackedVarint:function(t,i){var e=readPackedEnd(this);for(t=t||[];this.pos<e;)t.push(this.readVarint(i));return t},readPackedSVarint:function(t){var i=readPackedEnd(this);for(t=t||[];this.pos<i;)t.push(this.readSVarint());return t},readPackedBoolean:function(t){var i=readPackedEnd(this);for(t=t||[];this.pos<i;)t.push(this.readBoolean());return t},readPackedFloat:function(t){var i=readPackedEnd(this);for(t=t||[];this.pos<i;)t.push(this.readFloat());return t},readPackedDouble:function(t){var i=readPackedEnd(this);for(t=t||[];this.pos<i;)t.push(this.readDouble());return t},readPackedFixed32:function(t){var i=readPackedEnd(this);for(t=t||[];this.pos<i;)t.push(this.readFixed32());return t},readPackedSFixed32:function(t){var i=readPackedEnd(this);for(t=t||[];this.pos<i;)t.push(this.readSFixed32());return t},readPackedFixed64:function(t){var i=readPackedEnd(this);for(t=t||[];this.pos<i;)t.push(this.readFixed64());return t},readPackedSFixed64:function(t){var i=readPackedEnd(this);for(t=t||[];this.pos<i;)t.push(this.readSFixed64());return t},skip:function(t){var i=7&t;if(i===Pbf.Varint)for(;this.buf[this.pos++]>127;);else if(i===Pbf.Bytes)this.pos=this.readVarint()+this.pos;else if(i===Pbf.Fixed32)this.pos+=4;else{if(i!==Pbf.Fixed64)throw new Error("Unimplemented type: "+i);this.pos+=8}},writeTag:function(t,i){this.writeVarint(t<<3|i)},realloc:function(t){for(var i=this.length||16;i<this.pos+t;)i*=2;if(i!==this.length){var e=new Uint8Array(i);e.set(this.buf),this.buf=e,this.length=i}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(t){this.realloc(4),writeInt32(this.buf,t,this.pos),this.pos+=4},writeSFixed32:function(t){this.realloc(4),writeInt32(this.buf,t,this.pos),this.pos+=4},writeFixed64:function(t){this.realloc(8),writeInt32(this.buf,-1&t,this.pos),writeInt32(this.buf,Math.floor(t*SHIFT_RIGHT_32),this.pos+4),this.pos+=8},writeSFixed64:function(t){this.realloc(8),writeInt32(this.buf,-1&t,this.pos),writeInt32(this.buf,Math.floor(t*SHIFT_RIGHT_32),this.pos+4),this.pos+=8},writeVarint:function(t){if((t=+t||0)>268435455||t<0)return void writeBigVarint(t,this);this.realloc(4),this.buf[this.pos++]=127&t|(t>127?128:0),t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(t>127?128:0),t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(t>127?128:0),t<=127||(this.buf[this.pos++]=t>>>7&127)))},writeSVarint:function(t){this.writeVarint(t<0?2*-t-1:2*t)},writeBoolean:function(t){this.writeVarint(Boolean(t))},writeString:function(t){t=String(t),this.realloc(4*t.length),this.pos++;var i=this.pos;this.pos=writeUtf8(this.buf,t,this.pos);var e=this.pos-i;e>=128&&makeRoomForExtraLength(i,e,this),this.pos=i-1,this.writeVarint(e),this.pos+=e},writeFloat:function(t){this.realloc(4),ieee754.write(this.buf,t,this.pos,!0,23,4),this.pos+=4},writeDouble:function(t){this.realloc(8),ieee754.write(this.buf,t,this.pos,!0,52,8),this.pos+=8},writeBytes:function(t){var i=t.length;this.writeVarint(i),this.realloc(i);for(var e=0;e<i;e++)this.buf[this.pos++]=t[e]},writeRawMessage:function(t,i){this.pos++;var e=this.pos;t(i,this);var r=this.pos-e;r>=128&&makeRoomForExtraLength(e,r,this),this.pos=e-1,this.writeVarint(r),this.pos+=r},writeMessage:function(t,i,e){this.writeTag(t,Pbf.Bytes),this.writeRawMessage(i,e)},writePackedVarint:function(t,i){this.writeMessage(t,writePackedVarint,i)},writePackedSVarint:function(t,i){this.writeMessage(t,writePackedSVarint,i)},writePackedBoolean:function(t,i){this.writeMessage(t,writePackedBoolean,i)},writePackedFloat:function(t,i){this.writeMessage(t,writePackedFloat,i)},writePackedDouble:function(t,i){this.writeMessage(t,writePackedDouble,i)},writePackedFixed32:function(t,i){this.writeMessage(t,writePackedFixed32,i)},writePackedSFixed32:function(t,i){this.writeMessage(t,writePackedSFixed32,i)},writePackedFixed64:function(t,i){this.writeMessage(t,writePackedFixed64,i)},writePackedSFixed64:function(t,i){this.writeMessage(t,writePackedSFixed64,i)},writeBytesField:function(t,i){this.writeTag(t,Pbf.Bytes),this.writeBytes(i)},writeFixed32Field:function(t,i){this.writeTag(t,Pbf.Fixed32),this.writeFixed32(i)},writeSFixed32Field:function(t,i){this.writeTag(t,Pbf.Fixed32),this.writeSFixed32(i)},writeFixed64Field:function(t,i){this.writeTag(t,Pbf.Fixed64),this.writeFixed64(i)},writeSFixed64Field:function(t,i){this.writeTag(t,Pbf.Fixed64),this.writeSFixed64(i)},writeVarintField:function(t,i){this.writeTag(t,Pbf.Varint),this.writeVarint(i)},writeSVarintField:function(t,i){this.writeTag(t,Pbf.Varint),this.writeSVarint(i)},writeStringField:function(t,i){this.writeTag(t,Pbf.Bytes),this.writeString(i)},writeFloatField:function(t,i){this.writeTag(t,Pbf.Fixed32),this.writeFloat(i)},writeDoubleField:function(t,i){this.writeTag(t,Pbf.Fixed64),this.writeDouble(i)},writeBooleanField:function(t,i){this.writeVarintField(t,Boolean(i))}};
},{"ieee754":5}],11:[function(_dereq_,module,exports){
"use strict";function quickselect(t,e,a,o,c){quickselectStep(t,e,a||0,o||t.length-1,c||defaultCompare)}function quickselectStep(t,e,a,o,c){for(;o>a;){if(o-a>600){var r=o-a+1,s=e-a+1,u=Math.log(r),l=.5*Math.exp(2*u/3),f=.5*Math.sqrt(u*l*(r-l)/r)*(s-r/2<0?-1:1);quickselectStep(t,e,Math.max(a,Math.floor(e-s*l/r+f)),Math.min(o,Math.floor(e+(r-s)*l/r+f)),c)}var p=t[e],i=a,n=o;for(swap(t,a,e),c(t[o],p)>0&&swap(t,a,o);i<n;){for(swap(t,i,n),i++,n--;c(t[i],p)<0;)i++;for(;c(t[n],p)>0;)n--}0===c(t[a],p)?swap(t,a,n):(n++,swap(t,n,o)),n<=e&&(a=n+1),e<=n&&(o=n-1)}}function swap(t,e,a){var o=t[e];t[e]=t[a],t[a]=o}function defaultCompare(t,e){return t<e?-1:t>e?1:0}module.exports=quickselect,module.exports.default=quickselect;
},{}],12:[function(_dereq_,module,exports){
"use strict";function TinyQueue(t,e){if(!(this instanceof TinyQueue))return new TinyQueue(t,e);if(this.data=t||[],this.length=this.data.length,this.compare=e||defaultCompare,this.length>0)for(var i=(this.length>>1)-1;i>=0;i--)this._down(i)}function defaultCompare(t,e){return t<e?-1:t>e?1:0}module.exports=TinyQueue,module.exports.default=TinyQueue,TinyQueue.prototype={push:function(t){this.data.push(t),this.length++,this._up(this.length-1)},pop:function(){if(0!==this.length){var t=this.data[0];return this.length--,this.length>0&&(this.data[0]=this.data[this.length],this._down(0)),this.data.pop(),t}},peek:function(){return this.data[0]},_up:function(t){for(var e=this.data,i=this.compare,h=e[t];t>0;){var n=t-1>>1,a=e[n];if(i(h,a)>=0)break;e[t]=a,t=n}e[t]=h},_down:function(t){for(var e=this.data,i=this.compare,h=this.length>>1,n=e[t];t<h;){var a=1+(t<<1),s=a+1,u=e[a];if(s<this.length&&i(e[s],u)<0&&(a=s,u=e[s]),i(u,n)>=0)break;e[t]=u,t=a}e[t]=n}};
},{}],13:[function(_dereq_,module,exports){
var bundleFn=arguments[3],sources=arguments[4],cache=arguments[5],stringify=JSON.stringify;module.exports=function(r,e){function t(r){d[r]=!0;for(var e in sources[r][1]){var o=sources[r][1][e];d[o]||t(o)}}for(var o,n=Object.keys(cache),a=0,i=n.length;a<i;a++){var s=n[a],u=cache[s].exports;if(u===r||u&&u.default===r){o=s;break}}if(!o){o=Math.floor(Math.pow(16,8)*Math.random()).toString(16);for(var f={},a=0,i=n.length;a<i;a++){var s=n[a];f[s]=s}sources[o]=["function(require,module,exports){"+r+"(self); }",f]}var c=Math.floor(Math.pow(16,8)*Math.random()).toString(16),l={};l[o]=o,sources[c]=["function(require,module,exports){var f = require("+stringify(o)+");(f.default ? f.default : f)(self);}",l];var d={};t(c);var g="("+bundleFn+")({"+Object.keys(d).map(function(r){return stringify(r)+":["+sources[r][0]+","+stringify(sources[r][1])+"]"}).join(",")+"},{},["+stringify(c)+"])",v=window.URL||window.webkitURL||window.mozURL||window.msURL,w=new Blob([g],{type:"text/javascript"});if(e&&e.bare)return w;var h=v.createObjectURL(w),m=new Worker(h);return m.objectURL=h,m};
},{}],14:[function(_dereq_,module,exports){
module.exports.RADIUS=6378137,module.exports.FLATTENING=1/298.257223563,module.exports.POLAR_RADIUS=6356752.3142;
},{}],15:[function(_dereq_,module,exports){
module.exports={"version":"2.0.0"}
},{}],16:[function(_dereq_,module,exports){
"use strict";module.exports=function(t){for(var r=0,o=Object.getOwnPropertyNames(t.constructor.prototype);r<o.length;r+=1){var e=o[r],n=t[e];"constructor"!==e&&"function"==typeof n&&(t[e]=n.bind(t))}return t};
},{}],17:[function(_dereq_,module,exports){
"use strict";function geometry(e){var r,t=0;switch(e.type){case"Polygon":return polygonArea(e.coordinates);case"MultiPolygon":for(r=0;r<e.coordinates.length;r++)t+=polygonArea(e.coordinates[r]);return t;case"Point":case"MultiPoint":case"LineString":case"MultiLineString":return 0;case"GeometryCollection":for(r=0;r<e.geometries.length;r++)t+=geometry(e.geometries[r]);return t}}function polygonArea(e){var r=0;if(e&&e.length>0){r+=Math.abs(ringArea(e[0]));for(var t=1;t<e.length;t++)r-=Math.abs(ringArea(e[t]))}return r}function ringArea(e){var r,t,n,o,a,i,g,s=0,u=e.length;if(u>2){for(g=0;g<u;g++)g===u-2?(o=u-2,a=u-1,i=0):g===u-1?(o=u-1,a=0,i=1):(o=g,a=g+1,i=g+2),r=e[o],t=e[a],n=e[i],s+=(rad(n[0])-rad(r[0]))*Math.sin(rad(t[1]));s=s*wgs84.RADIUS*wgs84.RADIUS/2}return s}function rad(e){return e*Math.PI/180}var wgs84=_dereq_("wgs84");module.exports.geometry=geometry,module.exports.ring=ringArea;
},{"wgs84":14}],18:[function(_dereq_,module,exports){
"use strict";function rewind(r,e){switch(r&&r.type||null){case"FeatureCollection":return r.features=r.features.map(curryOuter(rewind,e)),r;case"Feature":return r.geometry=rewind(r.geometry,e),r;case"Polygon":case"MultiPolygon":return correct(r,e);default:return r}}function curryOuter(r,e){return function(n){return r(n,e)}}function correct(r,e){return"Polygon"===r.type?r.coordinates=correctRings(r.coordinates,e):"MultiPolygon"===r.type&&(r.coordinates=r.coordinates.map(curryOuter(correctRings,e))),r}function correctRings(r,e){e=!!e,r[0]=wind(r[0],e);for(var n=1;n<r.length;n++)r[n]=wind(r[n],!e);return r}function wind(r,e){return cw(r)===e?r:r.reverse()}function cw(r){return geojsonArea.ring(r)>=0}var geojsonArea=_dereq_("../geojson-area");module.exports=rewind;
},{"../geojson-area":17}],19:[function(_dereq_,module,exports){
"use strict";function clip(e,r,t,n,u,i,l,s){if(t/=r,n/=r,l>=t&&s<=n)return e;if(l>n||s<t)return null;for(var h=[],p=0;p<e.length;p++){var a,c,o=e[p],f=o.geometry,g=o.type;if(a=o.min[u],c=o.max[u],a>=t&&c<=n)h.push(o);else if(!(a>n||c<t)){var v=1===g?clipPoints(f,t,n,u):clipGeometry(f,t,n,u,i,3===g);v.length&&h.push(createFeature(o.tags,g,v,o.id))}}return h.length?h:null}function clipPoints(e,r,t,n){for(var u=[],i=0;i<e.length;i++){var l=e[i],s=l[n];s>=r&&s<=t&&u.push(l)}return u}function clipGeometry(e,r,t,n,u,i){for(var l=[],s=0;s<e.length;s++){var h,p,a,c=0,o=0,f=null,g=e[s],v=g.area,m=g.dist,w=g.outer,S=g.length,d=[];for(p=0;p<S-1;p++)h=f||g[p],f=g[p+1],c=o||h[n],o=f[n],c<r?o>t?(d.push(u(h,f,r),u(h,f,t)),i||(d=newSlice(l,d,v,m,w))):o>=r&&d.push(u(h,f,r)):c>t?o<r?(d.push(u(h,f,t),u(h,f,r)),i||(d=newSlice(l,d,v,m,w))):o<=t&&d.push(u(h,f,t)):(d.push(h),o<r?(d.push(u(h,f,r)),i||(d=newSlice(l,d,v,m,w))):o>t&&(d.push(u(h,f,t)),i||(d=newSlice(l,d,v,m,w))));h=g[S-1],c=h[n],c>=r&&c<=t&&d.push(h),a=d[d.length-1],i&&a&&(d[0][0]!==a[0]||d[0][1]!==a[1])&&d.push(d[0]),newSlice(l,d,v,m,w)}return l}function newSlice(e,r,t,n,u){return r.length&&(r.area=t,r.dist=n,void 0!==u&&(r.outer=u),e.push(r)),[]}module.exports=clip;var createFeature=_dereq_("./feature");
},{"./feature":21}],20:[function(_dereq_,module,exports){
"use strict";function convert(e,t){var r=[];if("FeatureCollection"===e.type)for(var o=0;o<e.features.length;o++)convertFeature(r,e.features[o],t);else"Feature"===e.type?convertFeature(r,e,t):convertFeature(r,{geometry:e},t);return r}function convertFeature(e,t,r){if(null!==t.geometry){var o,a,i,n,u=t.geometry,c=u.type,l=u.coordinates,s=t.properties,p=t.id;if("Point"===c)e.push(createFeature(s,1,[projectPoint(l)],p));else if("MultiPoint"===c)e.push(createFeature(s,1,project(l),p));else if("LineString"===c)e.push(createFeature(s,2,[project(l,r)],p));else if("MultiLineString"===c||"Polygon"===c){for(i=[],o=0;o<l.length;o++)n=project(l[o],r),"Polygon"===c&&(n.outer=0===o),i.push(n);e.push(createFeature(s,"Polygon"===c?3:2,i,p))}else if("MultiPolygon"===c){for(i=[],o=0;o<l.length;o++)for(a=0;a<l[o].length;a++)n=project(l[o][a],r),n.outer=0===a,i.push(n);e.push(createFeature(s,3,i,p))}else{if("GeometryCollection"!==c)throw new Error("Input data is not a valid GeoJSON object.");for(o=0;o<u.geometries.length;o++)convertFeature(e,{geometry:u.geometries[o],properties:s},r)}}}function project(e,t){for(var r=[],o=0;o<e.length;o++)r.push(projectPoint(e[o]));return t&&(simplify(r,t),calcSize(r)),r}function projectPoint(e){var t=Math.sin(e[1]*Math.PI/180),r=e[0]/360+.5,o=.5-.25*Math.log((1+t)/(1-t))/Math.PI;return o=o<0?0:o>1?1:o,[r,o,0,e[2]]}function calcSize(e){for(var t,r,o=0,a=0,i=0;i<e.length-1;i++)t=r||e[i],r=e[i+1],o+=t[0]*r[1]-r[0]*t[1],a+=Math.abs(r[0]-t[0])+Math.abs(r[1]-t[1]);e.area=Math.abs(o/2),e.dist=a}module.exports=convert;var simplify=_dereq_("./simplify"),createFeature=_dereq_("./feature");
},{"./feature":21,"./simplify":23}],21:[function(_dereq_,module,exports){
"use strict";function createFeature(e,t,a,n){var r={id:n||null,type:t,geometry:a,tags:e||null,min:[1/0,1/0],max:[-1/0,-1/0]};return calcBBox(r),r}function calcBBox(e){var t=e.geometry,a=e.min,n=e.max;if(1===e.type)calcRingBBox(a,n,t);else for(var r=0;r<t.length;r++)calcRingBBox(a,n,t[r]);return e}function calcRingBBox(e,t,a){for(var n,r=0;r<a.length;r++)n=a[r],e[0]=Math.min(n[0],e[0]),t[0]=Math.max(n[0],t[0]),e[1]=Math.min(n[1],e[1]),t[1]=Math.max(n[1],t[1])}module.exports=createFeature;
},{}],22:[function(_dereq_,module,exports){
"use strict";function geojsonvt(e,t){return new GeoJSONVT(e,t)}function GeoJSONVT(e,t){t=this.options=extend(Object.create(this.options),t);var i=t.debug;i&&console.time("preprocess data");var o=1<<t.maxZoom,n=convert(e,t.tolerance/(o*t.extent));this.tiles={},this.tileCoords=[],i&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",t.indexMaxZoom,t.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),n=wrap(n,t.buffer/t.extent,intersectX),n.length&&this.splitTile(n,0,0,0),i&&(n.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function toID(e,t,i){return 32*((1<<e)*i+t)+e}function intersectX(e,t,i){return[i,(i-e[0])*(t[1]-e[1])/(t[0]-e[0])+e[1],1,(i-e[0])*(t[3]-e[3])/(t[0]-e[0])+e[3]]}function intersectY(e,t,i){return[(i-e[1])*(t[0]-e[0])/(t[1]-e[1])+e[0],i,1,(i-e[1])*(t[3]-e[3])/(t[1]-e[1])+e[3]]}function extend(e,t){for(var i in t)e[i]=t[i];return e}function isClippedSquare(e,t,i){var o=e.source;if(1!==o.length)return!1;var n=o[0];if(3!==n.type||n.geometry.length>1)return!1;var r=n.geometry[0].length;if(5!==r)return!1;for(var s=0;s<r;s++){var l=transform.point(n.geometry[0][s],t,e.z2,e.x,e.y);if(l[0]!==-i&&l[0]!==t+i||l[1]!==-i&&l[1]!==t+i)return!1}return!0}module.exports=geojsonvt;var convert=_dereq_("./convert"),transform=_dereq_("./transform"),clip=_dereq_("./clip"),wrap=_dereq_("./wrap"),createTile=_dereq_("./tile");GeoJSONVT.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,solidChildren:!1,tolerance:3,extent:4096,buffer:64,debug:0},GeoJSONVT.prototype.splitTile=function(e,t,i,o,n,r,s){for(var l=[e,t,i,o],a=this.options,u=a.debug,c=null;l.length;){o=l.pop(),i=l.pop(),t=l.pop(),e=l.pop();var p=1<<t,d=toID(t,i,o),m=this.tiles[d],f=t===a.maxZoom?0:a.tolerance/(p*a.extent);if(!m&&(u>1&&console.time("creation"),m=this.tiles[d]=createTile(e,p,i,o,f,t===a.maxZoom),this.tileCoords.push({z:t,x:i,y:o}),u)){u>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",t,i,o,m.numFeatures,m.numPoints,m.numSimplified),console.timeEnd("creation"));var h="z"+t;this.stats[h]=(this.stats[h]||0)+1,this.total++}if(m.source=e,n){if(t===a.maxZoom||t===n)continue;var x=1<<n-t;if(i!==Math.floor(r/x)||o!==Math.floor(s/x))continue}else if(t===a.indexMaxZoom||m.numPoints<=a.indexMaxPoints)continue;if(a.solidChildren||!isClippedSquare(m,a.extent,a.buffer)){m.source=null,u>1&&console.time("clipping");var g,v,M,T,b,y,S=.5*a.buffer/a.extent,Z=.5-S,q=.5+S,w=1+S;g=v=M=T=null,b=clip(e,p,i-S,i+q,0,intersectX,m.min[0],m.max[0]),y=clip(e,p,i+Z,i+w,0,intersectX,m.min[0],m.max[0]),b&&(g=clip(b,p,o-S,o+q,1,intersectY,m.min[1],m.max[1]),v=clip(b,p,o+Z,o+w,1,intersectY,m.min[1],m.max[1])),y&&(M=clip(y,p,o-S,o+q,1,intersectY,m.min[1],m.max[1]),T=clip(y,p,o+Z,o+w,1,intersectY,m.min[1],m.max[1])),u>1&&console.timeEnd("clipping"),e.length&&(l.push(g||[],t+1,2*i,2*o),l.push(v||[],t+1,2*i,2*o+1),l.push(M||[],t+1,2*i+1,2*o),l.push(T||[],t+1,2*i+1,2*o+1))}else n&&(c=t)}return c},GeoJSONVT.prototype.getTile=function(e,t,i){var o=this.options,n=o.extent,r=o.debug,s=1<<e;t=(t%s+s)%s;var l=toID(e,t,i);if(this.tiles[l])return transform.tile(this.tiles[l],n);r>1&&console.log("drilling down to z%d-%d-%d",e,t,i);for(var a,u=e,c=t,p=i;!a&&u>0;)u--,c=Math.floor(c/2),p=Math.floor(p/2),a=this.tiles[toID(u,c,p)];if(!a||!a.source)return null;if(r>1&&console.log("found parent tile z%d-%d-%d",u,c,p),isClippedSquare(a,n,o.buffer))return transform.tile(a,n);r>1&&console.time("drilling down");var d=this.splitTile(a.source,u,c,p,e,t,i);if(r>1&&console.timeEnd("drilling down"),null!==d){var m=1<<e-d;l=toID(d,Math.floor(t/m),Math.floor(i/m))}return this.tiles[l]?transform.tile(this.tiles[l],n):null};
},{"./clip":19,"./convert":20,"./tile":24,"./transform":25,"./wrap":26}],23:[function(_dereq_,module,exports){
"use strict";function simplify(t,i){var e,p,r,s,o=i*i,f=t.length,u=0,n=f-1,g=[];for(t[u][2]=1,t[n][2]=1;n;){for(p=0,e=u+1;e<n;e++)(r=getSqSegDist(t[e],t[u],t[n]))>p&&(s=e,p=r);p>o?(t[s][2]=p,g.push(u),g.push(s),u=s):(n=g.pop(),u=g.pop())}}function getSqSegDist(t,i,e){var p=i[0],r=i[1],s=e[0],o=e[1],f=t[0],u=t[1],n=s-p,g=o-r;if(0!==n||0!==g){var l=((f-p)*n+(u-r)*g)/(n*n+g*g);l>1?(p=s,r=o):l>0&&(p+=n*l,r+=g*l)}return n=f-p,g=u-r,n*n+g*g}module.exports=simplify;
},{}],24:[function(_dereq_,module,exports){
"use strict";function createTile(e,n,r,i,t,u){for(var a={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:r,y:i,z2:n,transformed:!1,min:[2,1],max:[-1,0]},m=0;m<e.length;m++){a.numFeatures++,addFeature(a,e[m],t,u);var s=e[m].min,l=e[m].max;s[0]<a.min[0]&&(a.min[0]=s[0]),s[1]<a.min[1]&&(a.min[1]=s[1]),l[0]>a.max[0]&&(a.max[0]=l[0]),l[1]>a.max[1]&&(a.max[1]=l[1])}return a}function addFeature(e,n,r,i){var t,u,a,m,s=n.geometry,l=n.type,o=[],f=r*r;if(1===l)for(t=0;t<s.length;t++)o.push(s[t]),e.numPoints++,e.numSimplified++;else for(t=0;t<s.length;t++)if(a=s[t],i||!(2===l&&a.dist<r||3===l&&a.area<f)){var d=[];for(u=0;u<a.length;u++)m=a[u],(i||m[2]>f)&&(d.push(m),e.numSimplified++),e.numPoints++;3===l&&rewind(d,a.outer),o.push(d)}else e.numPoints+=a.length;if(o.length){var g={geometry:o,type:l,tags:n.tags||null};null!==n.id&&(g.id=n.id),e.features.push(g)}}function rewind(e,n){signedArea(e)<0===n&&e.reverse()}function signedArea(e){for(var n,r,i=0,t=0,u=e.length,a=u-1;t<u;a=t++)n=e[t],r=e[a],i+=(r[0]-n[0])*(n[1]+r[1]);return i}module.exports=createTile;
},{}],25:[function(_dereq_,module,exports){
"use strict";function transformTile(r,t){if(r.transformed)return r;var n,e,o,f=r.z2,a=r.x,s=r.y;for(n=0;n<r.features.length;n++){var i=r.features[n],u=i.geometry;if(1===i.type)for(e=0;e<u.length;e++)u[e]=transformPoint(u[e],t,f,a,s);else for(e=0;e<u.length;e++){var l=u[e];for(o=0;o<l.length;o++)l[o]=transformPoint(l[o],t,f,a,s)}}return r.transformed=!0,r}function transformPoint(r,t,n,e,o){return[Math.round(t*(r[0]*n-e)),Math.round(t*(r[1]*n-o))].concat(r.slice(2))}exports.tile=transformTile,exports.point=transformPoint;
},{}],26:[function(_dereq_,module,exports){
"use strict";function wrap(r,e,t){var o=r,a=clip(r,1,-1-e,e,0,t,-1,2),s=clip(r,1,1-e,2+e,0,t,-1,2);return(a||s)&&(o=clip(r,1,-e,1+e,0,t,-1,2)||[],a&&(o=shiftFeatureCoords(a,1).concat(o)),s&&(o=o.concat(shiftFeatureCoords(s,-1)))),o}function shiftFeatureCoords(r,e){for(var t=[],o=0;o<r.length;o++){var a,s=r[o],i=s.type;if(1===i)a=shiftCoords(s.geometry,e);else{a=[];for(var u=0;u<s.geometry.length;u++)a.push(shiftCoords(s.geometry[u],e))}t.push(createFeature(s.tags,i,a,s.id))}return t}function shiftCoords(r,e){var t=[];t.area=r.area,t.dist=r.dist;for(var o=0;o<r.length;o++)t.push([r[o][0]+e,r[o][1],r[o][2],r[o][3]]);return t}var clip=_dereq_("./clip"),createFeature=_dereq_("./feature");module.exports=wrap;
},{"./clip":19,"./feature":21}],27:[function(_dereq_,module,exports){
!function(t,n){"object"==typeof exports&&"undefined"!=typeof module?module.exports=n():"function"==typeof define&&define.amd?define(n):t.glMatrix=n()}(this,function(){"use strict";function t(t,n,r){var e=n[0],a=n[1],o=n[2];return t[0]=e*r[0]+a*r[3]+o*r[6],t[1]=e*r[1]+a*r[4]+o*r[7],t[2]=e*r[2]+a*r[5]+o*r[8],t}function n(t,n,r){var e=n[0],a=n[1],o=n[2],u=n[3];return t[0]=r[0]*e+r[4]*a+r[8]*o+r[12]*u,t[1]=r[1]*e+r[5]*a+r[9]*o+r[13]*u,t[2]=r[2]*e+r[6]*a+r[10]*o+r[14]*u,t[3]=r[3]*e+r[7]*a+r[11]*o+r[15]*u,t}function r(){var t=new Float32Array(4);return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t}function e(t,n,r){var e=n[0],a=n[1],o=n[2],u=n[3],i=Math.sin(r),c=Math.cos(r);return t[0]=e*c+o*i,t[1]=a*c+u*i,t[2]=e*-i+o*c,t[3]=a*-i+u*c,t}function a(t,n,r){var e=n[0],a=n[1],o=n[2],u=n[3],i=r[0],c=r[1];return t[0]=e*i,t[1]=a*i,t[2]=o*c,t[3]=u*c,t}function o(){var t=new Float32Array(9);return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t}function u(t,n){var r=Math.sin(n),e=Math.cos(n);return t[0]=e,t[1]=r,t[2]=0,t[3]=-r,t[4]=e,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t}function i(){var t=new Float32Array(16);return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function c(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function f(t,n){var r=n[0],e=n[1],a=n[2],o=n[3],u=n[4],i=n[5],c=n[6],f=n[7],v=n[8],s=n[9],l=n[10],M=n[11],h=n[12],m=n[13],y=n[14],d=n[15],p=r*i-e*u,w=r*c-a*u,A=r*f-o*u,F=e*c-a*i,x=e*f-o*i,b=a*f-o*c,g=v*m-s*h,j=v*y-l*h,R=v*d-M*h,X=s*y-l*m,Z=s*d-M*m,k=l*d-M*y,q=p*k-w*Z+A*X+F*R-x*j+b*g;return q?(q=1/q,t[0]=(i*k-c*Z+f*X)*q,t[1]=(a*Z-e*k-o*X)*q,t[2]=(m*b-y*x+d*F)*q,t[3]=(l*x-s*b-M*F)*q,t[4]=(c*R-u*k-f*j)*q,t[5]=(r*k-a*R+o*j)*q,t[6]=(y*A-h*b-d*w)*q,t[7]=(v*b-l*A+M*w)*q,t[8]=(u*Z-i*R+f*g)*q,t[9]=(e*R-r*Z-o*g)*q,t[10]=(h*x-m*A+d*p)*q,t[11]=(s*A-v*x-M*p)*q,t[12]=(i*j-u*X-c*g)*q,t[13]=(r*X-e*j+a*g)*q,t[14]=(m*w-h*F-y*p)*q,t[15]=(v*F-s*w+l*p)*q,t):null}function v(t,n,r){var e=n[0],a=n[1],o=n[2],u=n[3],i=n[4],c=n[5],f=n[6],v=n[7],s=n[8],l=n[9],M=n[10],h=n[11],m=n[12],y=n[13],d=n[14],p=n[15],w=r[0],A=r[1],F=r[2],x=r[3];return t[0]=w*e+A*i+F*s+x*m,t[1]=w*a+A*c+F*l+x*y,t[2]=w*o+A*f+F*M+x*d,t[3]=w*u+A*v+F*h+x*p,w=r[4],A=r[5],F=r[6],x=r[7],t[4]=w*e+A*i+F*s+x*m,t[5]=w*a+A*c+F*l+x*y,t[6]=w*o+A*f+F*M+x*d,t[7]=w*u+A*v+F*h+x*p,w=r[8],A=r[9],F=r[10],x=r[11],t[8]=w*e+A*i+F*s+x*m,t[9]=w*a+A*c+F*l+x*y,t[10]=w*o+A*f+F*M+x*d,t[11]=w*u+A*v+F*h+x*p,w=r[12],A=r[13],F=r[14],x=r[15],t[12]=w*e+A*i+F*s+x*m,t[13]=w*a+A*c+F*l+x*y,t[14]=w*o+A*f+F*M+x*d,t[15]=w*u+A*v+F*h+x*p,t}function s(t,n,r){var e,a,o,u,i,c,f,v,s,l,M,h,m=r[0],y=r[1],d=r[2];return n===t?(t[12]=n[0]*m+n[4]*y+n[8]*d+n[12],t[13]=n[1]*m+n[5]*y+n[9]*d+n[13],t[14]=n[2]*m+n[6]*y+n[10]*d+n[14],t[15]=n[3]*m+n[7]*y+n[11]*d+n[15]):(e=n[0],a=n[1],o=n[2],u=n[3],i=n[4],c=n[5],f=n[6],v=n[7],s=n[8],l=n[9],M=n[10],h=n[11],t[0]=e,t[1]=a,t[2]=o,t[3]=u,t[4]=i,t[5]=c,t[6]=f,t[7]=v,t[8]=s,t[9]=l,t[10]=M,t[11]=h,t[12]=e*m+i*y+s*d+n[12],t[13]=a*m+c*y+l*d+n[13],t[14]=o*m+f*y+M*d+n[14],t[15]=u*m+v*y+h*d+n[15]),t}function l(t,n,r){var e=r[0],a=r[1],o=r[2];return t[0]=n[0]*e,t[1]=n[1]*e,t[2]=n[2]*e,t[3]=n[3]*e,t[4]=n[4]*a,t[5]=n[5]*a,t[6]=n[6]*a,t[7]=n[7]*a,t[8]=n[8]*o,t[9]=n[9]*o,t[10]=n[10]*o,t[11]=n[11]*o,t[12]=n[12],t[13]=n[13],t[14]=n[14],t[15]=n[15],t}function M(t,n,r){var e=Math.sin(r),a=Math.cos(r),o=n[4],u=n[5],i=n[6],c=n[7],f=n[8],v=n[9],s=n[10],l=n[11];return n!==t&&(t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[12]=n[12],t[13]=n[13],t[14]=n[14],t[15]=n[15]),t[4]=o*a+f*e,t[5]=u*a+v*e,t[6]=i*a+s*e,t[7]=c*a+l*e,t[8]=f*a-o*e,t[9]=v*a-u*e,t[10]=s*a-i*e,t[11]=l*a-c*e,t}function h(t,n,r){var e=Math.sin(r),a=Math.cos(r),o=n[0],u=n[1],i=n[2],c=n[3],f=n[4],v=n[5],s=n[6],l=n[7];return n!==t&&(t[8]=n[8],t[9]=n[9],t[10]=n[10],t[11]=n[11],t[12]=n[12],t[13]=n[13],t[14]=n[14],t[15]=n[15]),t[0]=o*a+f*e,t[1]=u*a+v*e,t[2]=i*a+s*e,t[3]=c*a+l*e,t[4]=f*a-o*e,t[5]=v*a-u*e,t[6]=s*a-i*e,t[7]=l*a-c*e,t}function m(t,n,r,e,a){var o=1/Math.tan(n/2),u=1/(e-a);return t[0]=o/r,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=o,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=(a+e)*u,t[11]=-1,t[12]=0,t[13]=0,t[14]=2*a*e*u,t[15]=0,t}function y(t,n,r,e,a,o,u){var i=1/(n-r),c=1/(e-a),f=1/(o-u);return t[0]=-2*i,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*c,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*f,t[11]=0,t[12]=(n+r)*i,t[13]=(a+e)*c,t[14]=(u+o)*f,t[15]=1,t}(function(){var t=new Float32Array(3);t[0]=0,t[1]=0,t[2]=0})(),function(){var t=new Float32Array(4);t[0]=0,t[1]=0,t[2]=0,t[3]=0}();return{vec3:{transformMat3:t},vec4:{transformMat4:n},mat2:{create:r,rotate:e,scale:a},mat3:{create:o,fromRotation:u},mat4:{create:i,identity:c,translate:s,scale:l,multiply:v,perspective:m,rotateX:M,rotateZ:h,invert:f,ortho:y}}});
},{}],28:[function(_dereq_,module,exports){
"use strict";function isSupported(e){return!!(isBrowser()&&isArraySupported()&&isFunctionSupported()&&isObjectSupported()&&isJSONSupported()&&isWorkerSupported()&&isUint8ClampedArraySupported()&&isWebGLSupportedCached(e&&e.failIfMajorPerformanceCaveat))}function isBrowser(){return"undefined"!=typeof window&&"undefined"!=typeof document}function isArraySupported(){return Array.prototype&&Array.prototype.every&&Array.prototype.filter&&Array.prototype.forEach&&Array.prototype.indexOf&&Array.prototype.lastIndexOf&&Array.prototype.map&&Array.prototype.some&&Array.prototype.reduce&&Array.prototype.reduceRight&&Array.isArray}function isFunctionSupported(){return Function.prototype&&Function.prototype.bind}function isObjectSupported(){return Object.keys&&Object.create&&Object.getPrototypeOf&&Object.getOwnPropertyNames&&Object.isSealed&&Object.isFrozen&&Object.isExtensible&&Object.getOwnPropertyDescriptor&&Object.defineProperty&&Object.defineProperties&&Object.seal&&Object.freeze&&Object.preventExtensions}function isJSONSupported(){return"JSON"in window&&"parse"in JSON&&"stringify"in JSON}function isWorkerSupported(){if(!("Worker"in window&&"Blob"in window))return!1;var e,t,r=new Blob([""],{type:"text/javascript"}),o=URL.createObjectURL(r);try{t=new Worker(o),e=!0}catch(t){e=!1}return t&&t.terminate(),URL.revokeObjectURL(o),e}function isUint8ClampedArraySupported(){return"Uint8ClampedArray"in window}function isWebGLSupportedCached(e){return void 0===isWebGLSupportedCache[e]&&(isWebGLSupportedCache[e]=isWebGLSupported(e)),isWebGLSupportedCache[e]}function isWebGLSupported(e){var t=document.createElement("canvas"),r=Object.create(isSupported.webGLContextAttributes);return r.failIfMajorPerformanceCaveat=e,t.probablySupportsContext?t.probablySupportsContext("webgl",r)||t.probablySupportsContext("experimental-webgl",r):t.supportsContext?t.supportsContext("webgl",r)||t.supportsContext("experimental-webgl",r):t.getContext("webgl",r)||t.getContext("experimental-webgl",r)}"undefined"!=typeof module&&module.exports?module.exports=isSupported:window&&(window.minemap=window.minemap||{},window.minemap.supported=isSupported);var isWebGLSupportedCache={};isSupported.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0};
},{}],29:[function(_dereq_,module,exports){
"use strict";function Point(t,i,n){this.x=t,this.y=i,this.z=n||0}module.exports=Point,Point.prototype={clone:function(){return new Point(this.x,this.y,this.z)},add:function(t){return this.clone()._add(t)},sub:function(t){return this.clone()._sub(t)},multByPoint:function(t){return this.clone()._multByPoint(t)},divByPoint:function(t){return this.clone()._divByPoint(t)},mult:function(t){return this.clone()._mult(t)},div:function(t){return this.clone()._div(t)},rotate:function(t){return this.clone()._rotate(t)},rotateAround:function(t,i){return this.clone()._rotateAround(t,i)},matMult:function(t){return this.clone()._matMult(t)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(t){return this.x===t.x&&this.y===t.y},dist:function(t){return Math.sqrt(this.distSqr(t))},distSqr:function(t){var i=t.x-this.x,n=t.y-this.y;return i*i+n*n},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(t){return Math.atan2(this.y-t.y,this.x-t.x)},angleWith:function(t){return this.angleWithSep(t.x,t.y)},angleWithSep:function(t,i){return Math.atan2(this.x*i-this.y*t,this.x*t+this.y*i)},_matMult:function(t){var i=t[0]*this.x+t[1]*this.y,n=t[2]*this.x+t[3]*this.y;return this.x=i,this.y=n,this},_add:function(t){return this.x+=t.x,this.y+=t.y,this},_sub:function(t){return this.x-=t.x,this.y-=t.y,this},_mult:function(t){return this.x*=t,this.y*=t,this},_div:function(t){return this.x/=t,this.y/=t,this},_multByPoint:function(t){return this.x*=t.x,this.y*=t.y,this},_divByPoint:function(t){return this.x/=t.x,this.y/=t.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var t=this.y;return this.y=this.x,this.x=-t,this},_rotate:function(t){var i=Math.cos(t),n=Math.sin(t),s=i*this.x-n*this.y,h=n*this.x+i*this.y;return this.x=s,this.y=h,this},_rotateAround:function(t,i){var n=Math.cos(t),s=Math.sin(t),h=i.x+n*(this.x-i.x)-s*(this.y-i.y),r=i.y+s*(this.x-i.x)+n*(this.y-i.y);return this.x=h,this.y=r,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},Point.convert=function(t){return t instanceof Point?t:Array.isArray(t)?new Point(t[0],t[1]):t};
},{}],30:[function(_dereq_,module,exports){
"use strict";function ShelfPack(t,e,h){h=h||{},this.w=t||64,this.h=e||64,this.autoResize=!!h.autoResize,this.shelves=[],this.freebins=[],this.stats={},this.bins={},this.maxId=0}function Shelf(t,e,h){this.x=0,this.y=t,this.w=this.free=e,this.h=h}function Bin(t,e,h,i,s,r,n){this.id=t,this.x=e,this.y=h,this.w=i,this.h=s,this.maxw=r||i,this.maxh=n||s,this.refcount=0}module.exports=ShelfPack,ShelfPack.prototype.pack=function(t,e){var h=this;t=[].concat(t),e=e||{};for(var i,s,r,n,f=[],a=0;a<t.length;a++)if(i=t[a].w||t[a].width,s=t[a].h||t[a].height,r=t[a].id,i&&s){if(!(n=h.packOne(i,s,r)))continue;e.inPlace&&(t[a].x=n.x,t[a].y=n.y,t[a].id=n.id),f.push(n)}return this.shrink(),f},ShelfPack.prototype.packOne=function(t,e,h){var i,s,r,n,f=this,a={freebin:-1,shelf:-1,waste:1/0},o=0;if("string"==typeof h||"number"==typeof h){if(i=this.getBin(h))return this.ref(i),i;"number"==typeof h&&(this.maxId=Math.max(h,this.maxId))}else h=++this.maxId;for(n=0;n<this.freebins.length;n++){if(i=f.freebins[n],e===i.maxh&&t===i.maxw)return f.allocFreebin(n,t,e,h);e>i.maxh||t>i.maxw||e<=i.maxh&&t<=i.maxw&&(r=i.maxw*i.maxh-t*e)<a.waste&&(a.waste=r,a.freebin=n)}for(n=0;n<this.shelves.length;n++)if(s=f.shelves[n],o+=s.h,!(t>s.free)){if(e===s.h)return f.allocShelf(n,t,e,h);e>s.h||e<s.h&&(r=(s.h-e)*t)<a.waste&&(a.freebin=-1,a.waste=r,a.shelf=n)}if(-1!==a.freebin)return this.allocFreebin(a.freebin,t,e,h);if(-1!==a.shelf)return this.allocShelf(a.shelf,t,e,h);if(e<=this.h-o&&t<=this.w)return s=new Shelf(o,this.w,e),this.allocShelf(this.shelves.push(s)-1,t,e,h);if(this.autoResize){var l,c,u,p;return l=c=this.h,u=p=this.w,(u<=l||t>u)&&(p=2*Math.max(t,u)),(l<u||e>l)&&(c=2*Math.max(e,l)),this.resize(p,c),this.packOne(t,e,h)}return null},ShelfPack.prototype.allocFreebin=function(t,e,h,i){var s=this.freebins.splice(t,1)[0];return s.id=i,s.w=e,s.h=h,s.refcount=0,this.bins[i]=s,this.ref(s),s},ShelfPack.prototype.allocShelf=function(t,e,h,i){var s=this.shelves[t],r=s.alloc(e,h,i);return this.bins[i]=r,this.ref(r),r},ShelfPack.prototype.shrink=function(){var t=this;if(this.shelves.length>0){for(var e=0,h=0,i=0;i<this.shelves.length;i++){var s=t.shelves[i];h+=s.h,e=Math.max(s.w-s.free,e)}this.resize(e,h)}},ShelfPack.prototype.getBin=function(t){return this.bins[t]},ShelfPack.prototype.ref=function(t){if(1==++t.refcount){var e=t.h;this.stats[e]=1+(0|this.stats[e])}return t.refcount},ShelfPack.prototype.unref=function(t){return 0===t.refcount?0:(0==--t.refcount&&(this.stats[t.h]--,delete this.bins[t.id],this.freebins.push(t)),t.refcount)},ShelfPack.prototype.clear=function(){this.shelves=[],this.freebins=[],this.stats={},this.bins={},this.maxId=0},ShelfPack.prototype.resize=function(t,e){var h=this;this.w=t,this.h=e;for(var i=0;i<this.shelves.length;i++)h.shelves[i].resize(t);return!0},Shelf.prototype.alloc=function(t,e,h){if(t>this.free||e>this.h)return null;var i=this.x;return this.x+=t,this.free-=t,new Bin(h,i,this.y,t,e,t,this.h)},Shelf.prototype.resize=function(t){return this.free+=t-this.w,this.w=t,!0};
},{}],31:[function(_dereq_,module,exports){
"use strict";function supercluster(t){return new SuperCluster(t)}function SuperCluster(t){this.options=extend(Object.create(this.options),t),this.trees=new Array(this.options.maxZoom+1),autoBind(this)}function createCluster(t,e,n,r,i){return{x:t,y:e,zoom:1/0,id:n,parentId:-1,numPoints:r,properties:i}}function createPointCluster(t,e){var n=t.geometry.coordinates;return{x:lngX(n[0]),y:latY(n[1]),zoom:1/0,id:e,parentId:-1}}function getClusterJSON(t,e){return{type:"Feature",properties:getClusterProperties(t,e),geometry:{type:"Point",coordinates:[xLng(t.x),yLat(t.y)]}}}function getClusterProperties(t,e){var n=t.numPoints,r=n>=1e4?Math.round(n/1e3)+"k":n>=1e3?Math.round(n/100)/10+"k":n;return extend(extend({},t.properties),{cluster:!0,cluster_id:t.id,point_count:n,point_count_abbreviated:r,children:e.options.enableQueryChildren?e.getChildren(t.id):[]})}function lngX(t){return t/360+.5}function latY(t){var e=Math.sin(t*Math.PI/180),n=.5-.25*Math.log((1+e)/(1-e))/Math.PI;return n<0?0:n>1?1:n}function xLng(t){return 360*(t-.5)}function yLat(t){var e=(180-360*t)*Math.PI/180;return 360*Math.atan(Math.exp(e))/Math.PI-90}function extend(t,e){for(var n in e)t[n]=e[n];return t}function getX(t){return t.x}function getY(t){return t.y}var kdbush=_dereq_("kdbush"),autoBind=_dereq_("../auto-bind");module.exports=supercluster,module.exports.default=supercluster,SuperCluster.prototype={options:{minZoom:0,maxZoom:16,radius:40,extent:512,nodeSize:64,log:!1,reduce:null,initial:function(){return{}},map:function(t){return t}},load:function(t){var e=this.options.log;e&&console.time("total time");var n="prepare "+t.length+" points";e&&console.time(n),this.points=t;for(var r=[],i=0;i<t.length;i++)t[i].geometry&&r.push(createPointCluster(t[i],i));this.trees[this.options.maxZoom+1]=kdbush(r,getX,getY,this.options.nodeSize,Float32Array),e&&console.timeEnd(n);for(var o=this.options.maxZoom;o>=this.options.minZoom;o--){var s=+Date.now();r=this._cluster(r,o),this.trees[o]=kdbush(r,getX,getY,this.options.nodeSize,Float32Array),e&&console.log("z%d: %d clusters in %dms",o,r.length,+Date.now()-s)}return e&&console.timeEnd("total time"),this},getClusters:function(t,e){if(t[0]>t[2]){var n=this.getClusters([t[0],t[1],180,t[3]],e),r=this.getClusters([-180,t[1],t[2],t[3]],e);return n.concat(r)}for(var i=this.trees[this._limitZoom(e)],o=i.range(lngX(t[0]),latY(t[3]),lngX(t[2]),latY(t[1])),s=[],u=0;u<o.length;u++){var a=i.points[o[u]];s.push(a.numPoints?getClusterJSON(a,this):this.points[a.id])}return s},getChildren:function(t){var e=t>>5,n=t%32,r="No cluster with the specified id.",i=this.trees[n];if(!i)return[];var o=i.points[e];if(!o)throw new Error(r);for(var s=this.options.radius/(this.options.extent*Math.pow(2,n-1)),u=i.within(o.x,o.y,s),a=[],h=0;h<u.length;h++){var p=i.points[u[h]];p.parentId===t&&(p.numPoints?a.push(getClusterJSON(p,this)):a.push(this.points[p.id]))}if(0===a.length)throw new Error(r);return a},getLeaves:function(t,e,n){e=e||10,n=n||0;var r=[];return this._appendLeaves(r,t,e,n,0),r},getTile:function(t,e,n){var r=this.trees[this._limitZoom(t)],i=Math.pow(2,t),o=this.options.extent,s=this.options.radius,u=s/o,a=(n-u)/i,h=(n+1+u)/i,p={features:[]};return this._addTileFeatures(r.range((e-u)/i,a,(e+1+u)/i,h),r.points,e,n,i,p),0===e&&this._addTileFeatures(r.range(1-u/i,a,1,h),r.points,i,n,i,p),e===i-1&&this._addTileFeatures(r.range(0,a,u/i,h),r.points,-1,n,i,p),p.features.length?p:null},getClusterExpansionZoom:function(t){for(var e=t%32-1;e<this.options.maxZoom;){var n=this.getChildren(t);if(e++,1!==n.length)break;t=n[0].properties.cluster_id}return e},_appendLeaves:function(t,e,n,r,i){for(var o=this.getChildren(e),s=0;s<o.length;s++){var u=o[s].properties;if(u&&u.cluster?i+u.point_count<=r?i+=u.point_count:i=this._appendLeaves(t,u.cluster_id,n,r,i):i<r?i++:t.push(o[s]),t.length===n)break}return i},_addTileFeatures:function(t,e,n,r,i,o){for(var s=0;s<t.length;s++){var u=e[t[s]];o.features.push({type:1,geometry:[[Math.round(this.options.extent*(u.x*i-n)),Math.round(this.options.extent*(u.y*i-r))]],tags:u.numPoints?getClusterProperties(u,this):this.points[u.id].properties})}},_limitZoom:function(t){return Math.max(this.options.minZoom,Math.min(t,this.options.maxZoom+1))},_cluster:function(t,e){for(var n=[],r=this.options.radius/(this.options.extent*Math.pow(2,e)),i=0;i<t.length;i++){var o=t[i];if(!(o.zoom<=e)){o.zoom=e;var s=this.trees[e+1],u=s.within(o.x,o.y,r),a=o.numPoints||1,h=o.x*a,p=o.y*a,l=null;this.options.reduce&&(l=this.options.initial(),this._accumulate(l,o));for(var d=(i<<5)+(e+1),c=0;c<u.length;c++){var m=s.points[u[c]];if(!(m.zoom<=e)){m.zoom=e;var g=m.numPoints||1;h+=m.x*g,p+=m.y*g,a+=g,m.parentId=d,this.options.reduce&&this._accumulate(l,m)}}1===a?n.push(o):(o.parentId=d,n.push(createCluster(h/a,p/a,d,a,l)))}}return n},_accumulate:function(t,e){var n=e.numPoints?e.properties:this.options.map(this.points[e.id].properties);this.options.reduce(t,n)}};
},{"../auto-bind":16,"kdbush":6}],32:[function(_dereq_,module,exports){
"use strict";function TinySDF(t,i,s,e,r,h){this.fontSize=t||24,this.buffer=void 0===i?3:i,this.cutoff=e||.25,this.fontFamily=r||"sans-serif",this.fontWeight=h||"normal",this.radius=s||8;var a=this.size=this.fontSize+2*this.buffer;this.canvas=document.createElement("canvas"),this.canvas.width=this.canvas.height=a,this.ctx=this.canvas.getContext("2d"),this.ctx.font=this.fontWeight+" "+this.fontSize+"px "+this.fontFamily,this.ctx.textBaseline="middle",this.ctx.fillStyle="black",this.gridOuter=new Float64Array(a*a),this.gridInner=new Float64Array(a*a),this.f=new Float64Array(a),this.d=new Float64Array(a),this.z=new Float64Array(a+1),this.v=new Int16Array(a),this.middle=Math.round(a/2*(navigator.userAgent.indexOf("Gecko/")>=0?1.2:1))}function edt(t,i,s,e,r,h,a){for(var n=0;n<i;n++){for(var o=0;o<s;o++)e[o]=t[o*i+n];for(edt1d(e,r,h,a,s),o=0;o<s;o++)t[o*i+n]=r[o]}for(o=0;o<s;o++){for(n=0;n<i;n++)e[n]=t[o*i+n];for(edt1d(e,r,h,a,i),n=0;n<i;n++)t[o*i+n]=Math.sqrt(r[n])}}function edt1d(t,i,s,e,r){s[0]=0,e[0]=-INF,e[1]=+INF;for(var h=1,a=0;h<r;h++){for(var n=(t[h]+h*h-(t[s[a]]+s[a]*s[a]))/(2*h-2*s[a]);n<=e[a];)a--,n=(t[h]+h*h-(t[s[a]]+s[a]*s[a]))/(2*h-2*s[a]);a++,s[a]=h,e[a]=n,e[a+1]=+INF}for(h=0,a=0;h<r;h++){for(;e[a+1]<h;)a++;i[h]=(h-s[a])*(h-s[a])+t[s[a]]}}module.exports=TinySDF;var INF=1e20;TinySDF.prototype.draw=function(t){var i=this;this.ctx.clearRect(0,0,this.size,this.size),this.ctx.fillText(t,this.buffer,this.middle);for(var s=this.ctx.getImageData(0,0,this.size,this.size),e=new Uint8ClampedArray(this.size*this.size),r=0;r<this.size*this.size;r++){var h=s.data[4*r+3]/255;i.gridOuter[r]=1===h?0:0===h?INF:Math.pow(Math.max(0,.5-h),2),i.gridInner[r]=1===h?INF:0===h?0:Math.pow(Math.max(0,h-.5),2)}for(edt(this.gridOuter,this.size,this.size,this.f,this.d,this.v,this.z),edt(this.gridInner,this.size,this.size,this.f,this.d,this.v,this.z),r=0;r<this.size*this.size;r++){var a=i.gridOuter[r]-i.gridInner[r];e[r]=Math.max(0,Math.min(255,Math.round(255-255*(a/i.radius+i.cutoff))))}return e};
},{}],33:[function(_dereq_,module,exports){
"use strict";function UnitBezier(t,i,e,r){this.cx=3*t,this.bx=3*(e-t)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*i,this.by=3*(r-i)-this.cy,this.ay=1-this.cy-this.by,this.p1x=t,this.p1y=r,this.p2x=e,this.p2y=r}module.exports=UnitBezier,UnitBezier.prototype.sampleCurveX=function(t){return((this.ax*t+this.bx)*t+this.cx)*t},UnitBezier.prototype.sampleCurveY=function(t){return((this.ay*t+this.by)*t+this.cy)*t},UnitBezier.prototype.sampleCurveDerivativeX=function(t){return(3*this.ax*t+2*this.bx)*t+this.cx},UnitBezier.prototype.solveCurveX=function(t,i){var e=this;void 0===i&&(i=1e-6);var r,s,h,n,u;for(h=t,u=0;u<8;u++){if(n=e.sampleCurveX(h)-t,Math.abs(n)<i)return h;var a=e.sampleCurveDerivativeX(h);if(Math.abs(a)<1e-6)break;h-=n/a}if(r=0,s=1,(h=t)<r)return r;if(h>s)return s;for(;r<s;){if(n=e.sampleCurveX(h),Math.abs(n-t)<i)return h;t>n?r=h:s=h,h=.5*(s-r)+r}return h},UnitBezier.prototype.solve=function(t,i){return this.sampleCurveY(this.solveCurveX(t,i))};
},{}],34:[function(_dereq_,module,exports){
module.exports.VectorTile=_dereq_("./lib/vectortile.js"),module.exports.VectorTileFeature=_dereq_("./lib/vectortilefeature.js"),module.exports.VectorTileLayer=_dereq_("./lib/vectortilelayer.js");
},{"./lib/vectortile.js":35,"./lib/vectortilefeature.js":36,"./lib/vectortilelayer.js":37}],35:[function(_dereq_,module,exports){
"use strict";function VectorTile(e,r){this.layers=e.readFields(readTile,{},r)}function readTile(e,r,i){if(3===e){var t=new VectorTileLayer(i,i.readVarint()+i.pos);t.length&&(r[t.name]=t)}}var VectorTileLayer=_dereq_("./vectortilelayer");module.exports=VectorTile;
},{"./vectortilelayer":37}],36:[function(_dereq_,module,exports){
"use strict";function VectorTileFeature(e,t,r,i,a){this.properties={},this.extent=r,this.type=0,this._pbf=e,this._geometry=-1,this._keys=i,this._values=a,this._version=arguments[5],e.readFields(readFeature,this,t)}function readFeature(e,t,r){1==e?t.id=r.readVarint():2==e?readTag(r,t):3==e?t.type=r.readVarint():4==e&&(t._geometry=r.pos)}function readTag(e,t){for(var r=e.readVarint()+e.pos;e.pos<r;){var i=t._keys[e.readVarint()],a=t._values[e.readVarint()];t.properties[i]=a}}function classifyRings(e){var t=e.length;if(t<=1)return[e];for(var r,i,a=[],n=0;n<t;n++){var o=signedArea(e[n]);0!==o&&(void 0===i&&(i=o<0),i===o<0?(r&&a.push(r),r=[e[n]]):r.push(e[n]))}return r&&a.push(r),a}function signedArea(e){for(var t,r,i=0,a=0,n=e.length,o=n-1;a<n;o=a++)t=e[a],r=e[o],i+=(r.x-t.x)*(t.y+r.y);return i}var Point=_dereq_("../../../_minemap_/point-geometry");module.exports=VectorTileFeature,VectorTileFeature.types=["Unknown","Point","LineString","Polygon"],VectorTileFeature.prototype.loadGeometry=function(){var e=this._pbf;e.pos=this._geometry;for(var t,r=e.readVarint()+e.pos,i=1,a=0,n=0,o=0,s=0,h=[];e.pos<r;){if(a<=0){var p=e.readVarint();i=7&p,a=p>>3}if(a--,1===i||2===i)n+=e.readSVarint(),o+=e.readSVarint(),this._version>100&&(s+=e.readSVarint()),1===i&&(t&&h.push(t),t=[]),t.push(new Point(n,o,s));else{if(7!==i)throw new Error("unknown command "+i);t&&t.push(t[0].clone())}}return t&&h.push(t),h},VectorTileFeature.prototype.bbox=function(){var e=this._pbf;e.pos=this._geometry;for(var t=e.readVarint()+e.pos,r=1,i=0,a=0,n=0,o=1/0,s=-1/0,h=1/0,p=-1/0;e.pos<t;){if(!i){var u=e.readVarint();r=7&u,i=u>>3}if(i--,1===r||2===r)a+=e.readSVarint(),n+=e.readSVarint(),a<o&&(o=a),a>s&&(s=a),n<h&&(h=n),n>p&&(p=n);else if(7!==r)throw new Error("unknown command "+r)}return[o,h,s,p]},VectorTileFeature.prototype.toGeoJSON=function(e,t,r){function i(e){for(var t=0;t<e.length;t++){var r=e[t],i=180-360*(r.y+h)/o;e[t]=[360*(r.x+s)/o-180,360/Math.PI*Math.atan(Math.exp(i*Math.PI/180))-90]}}var a,n,o=this.extent*Math.pow(2,r),s=this.extent*e,h=this.extent*t,p=this.loadGeometry(),u=VectorTileFeature.types[this.type];switch(this.type){case 1:var d=[];for(a=0;a<p.length;a++)d[a]=p[a][0];p=d,i(p);break;case 2:for(a=0;a<p.length;a++)i(p[a]);break;case 3:for(p=classifyRings(p),a=0;a<p.length;a++)for(n=0;n<p[a].length;n++)i(p[a][n])}1===p.length?p=p[0]:u="Multi"+u;var f={type:"Feature",geometry:{type:u,coordinates:p},properties:this.properties};return"id"in this&&(f.id=this.id),f};
},{"../../../_minemap_/point-geometry":29}],37:[function(_dereq_,module,exports){
"use strict";function VectorTileLayer(e,t){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=e,this._keys=[],this._values=[],this._features=[],e.readFields(readLayer,this,t),this.length=this._features.length}function readLayer(e,t,r){15===e?t.version=r.readVarint():1===e?t.name=r.readString():5===e?t.extent=r.readVarint():2===e?t._features.push(r.pos):3===e?t._keys.push(r.readString()):4===e&&t._values.push(readValueMessage(r))}function readValueMessage(e){for(var t=null,r=e.readVarint()+e.pos;e.pos<r;){var a=e.readVarint()>>3;t=1===a?e.readString():2===a?e.readFloat():3===a?e.readDouble():4===a?e.readVarint64():5===a?e.readVarint():6===a?e.readSVarint():7===a?e.readBoolean():null}return t}var VectorTileFeature=_dereq_("./vectortilefeature.js");module.exports=VectorTileLayer,VectorTileLayer.prototype.feature=function(e){if(e<0||e>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[e];var t=this._pbf.readVarint()+this._pbf.pos;return new VectorTileFeature(this._pbf,t,this.extent,this._keys,this._values,this.version)};
},{"./vectortilefeature.js":36}],38:[function(_dereq_,module,exports){
function fromVectorTileJs(e){var r=new Pbf;return writeTile(e,r),r.finish()}function fromGeojsonVt(e,r){r=r||{};var t={};for(var i in e)t[i]=new GeoJSONWrapper(e[i].features,r),t[i].name=i,t[i].version=r.version,t[i].extent=r.extent;return fromVectorTileJs({layers:t})}function writeTile(e,r){for(var t in e.layers)r.writeMessage(3,writeLayer,e.layers[t])}function writeLayer(e,r){r.writeVarintField(15,e.version||1),r.writeStringField(1,e.name||""),r.writeVarintField(5,e.extent||4096);var t,i={keys:[],values:[],keycache:{},valuecache:{}};for(t=0;t<e.length;t++)i.feature=e.feature(t),r.writeMessage(2,writeFeature,i);var n=i.keys;for(t=0;t<n.length;t++)r.writeStringField(3,n[t]);var a=i.values;for(t=0;t<a.length;t++)r.writeMessage(4,writeValue,a[t])}function writeFeature(e,r){var t=e.feature;void 0!==t.id&&r.writeVarintField(1,t.id),r.writeMessage(2,writeProperties,e),r.writeVarintField(3,t.type),r.writeMessage(4,writeGeometry,t)}function writeProperties(e,r){var t=e.feature,i=e.keys,n=e.values,a=e.keycache,o=e.valuecache;for(var l in t.properties){var s=a[l];void 0===s&&(i.push(l),s=i.length-1,a[l]=s),r.writeVarint(s);var u=t.properties[l],f=typeof u;"string"!==f&&"boolean"!==f&&"number"!==f&&(u=JSON.stringify(u));var w=f+":"+u,v=o[w];void 0===v&&(n.push(u),v=n.length-1,o[w]=v),r.writeVarint(v)}}function command(e,r){return(r<<3)+(7&e)}function zigzag(e){return e<<1^e>>31}function writeGeometry(e,r){for(var t=e.loadGeometry(),i=e.type,n=0,a=0,o=t.length,l=0;l<o;l++){var s=t[l],u=1;1===i&&(u=s.length),r.writeVarint(command(1,u));for(var f=3===i?s.length-1:s.length,w=0;w<f;w++){1===w&&1!==i&&r.writeVarint(command(2,f-1));var v=s[w].x-n,c=s[w].y-a;r.writeVarint(zigzag(v)),r.writeVarint(zigzag(c)),n+=v,a+=c}3===i&&r.writeVarint(command(7,0))}}function writeValue(e,r){var t=typeof e;"string"===t?r.writeStringField(1,e):"boolean"===t?r.writeBooleanField(7,e):"number"===t&&(e%1!=0?r.writeDoubleField(3,e):e<0?r.writeSVarintField(6,e):r.writeVarintField(5,e))}var Pbf=_dereq_("pbf"),GeoJSONWrapper=_dereq_("./lib/geojson_wrapper");module.exports=fromVectorTileJs,module.exports.fromVectorTileJs=fromVectorTileJs,module.exports.fromGeojsonVt=fromGeojsonVt,module.exports.GeoJSONWrapper=GeoJSONWrapper;
},{"./lib/geojson_wrapper":39,"pbf":10}],39:[function(_dereq_,module,exports){
"use strict";function GeoJSONWrapper(e,t){this.options=t||{},this.features=e,this.length=e.length}function FeatureWrapper(e,t){this.id="number"==typeof e.id?e.id:void 0,this.type=e.type,this.rawGeometry=1===e.type?[e.geometry]:e.geometry,this.properties=e.tags,this.extent=t||4096}var Point=_dereq_("../../../_minemap_/point-geometry"),VectorTileFeature=_dereq_("../../../_minemap_/vector-tile").VectorTileFeature;module.exports=GeoJSONWrapper,GeoJSONWrapper.prototype.feature=function(e){return new FeatureWrapper(this.features[e],this.options.extent)},FeatureWrapper.prototype.loadGeometry=function(){var e=this.rawGeometry;this.geometry=[];for(var t=0;t<e.length;t++){for(var r=e[t],o=[],i=0;i<r.length;i++)o.push(new Point(r[i][0],r[i][1]));this.geometry.push(o)}return this.geometry},FeatureWrapper.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var e=this.geometry,t=1/0,r=-1/0,o=1/0,i=-1/0,p=0;p<e.length;p++)for(var a=e[p],n=0;n<a.length;n++){var h=a[n];t=Math.min(t,h.x),r=Math.max(r,h.x),o=Math.min(o,h.y),i=Math.max(i,h.y)}return[t,o,r,i]},FeatureWrapper.prototype.toGeoJSON=VectorTileFeature.prototype.toGeoJSON;
},{"../../../_minemap_/point-geometry":29,"../../../_minemap_/vector-tile":34}],40:[function(_dereq_,module,exports){
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t(e.WhooTS=e.WhooTS||{})}(this,function(e){function t(e,t,r,n,i,s){return s=s||{},e+"?"+["bbox="+o(r,n,i),"format="+(s.format||"image/png"),"service="+(s.service||"WMS"),"version="+(s.version||"1.1.1"),"request="+(s.request||"GetMap"),"srs="+(s.srs||"EPSG:3857"),"width="+(s.width||256),"height="+(s.height||256),"layers="+t].join("&")}function o(e,t,o){t=Math.pow(2,o)-t-1;var n=r(256*e,256*t,o),i=r(256*(e+1),256*(t+1),o);return n[0]+","+n[1]+","+i[0]+","+i[1]}function r(e,t,o){var r=2*Math.PI*6378137/256/Math.pow(2,o);return[e*r-2*Math.PI*6378137/2,t*r-2*Math.PI*6378137/2]}e.getURL=t,e.getTileBBox=o,e.getMercCoords=r,Object.defineProperty(e,"__esModule",{value:!0})});
},{}],41:[function(_dereq_,module,exports){
"use strict";var ref=_dereq_("../util/struct_array"),StructArray=ref.StructArray,ref$1=_dereq_("../util/struct_array"),Struct=ref$1.Struct,ref$2=_dereq_("../util/web_worker_transfer"),register=ref$2.register,Point=_dereq_("../_minemap_/point-geometry"),StructArrayLayout2i4=function(t){function r(){t.apply(this,arguments)}return t&&(r.__proto__=t),r.prototype=Object.create(t&&t.prototype),r.prototype.constructor=r,r.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},r.prototype.emplaceBack=function(t,r){var i=this.length;this.resize(i+1);var u=2*i;return this.int16[u+0]=t,this.int16[u+1]=r,i},r}(StructArray);StructArrayLayout2i4.prototype.bytesPerElement=4,register("StructArrayLayout2i4",StructArrayLayout2i4);var StructArrayLayout4i8=function(t){function r(){t.apply(this,arguments)}return t&&(r.__proto__=t),r.prototype=Object.create(t&&t.prototype),r.prototype.constructor=r,r.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},r.prototype.emplaceBack=function(t,r,i,u){var e=this.length;this.resize(e+1);var o=4*e;return this.int16[o+0]=t,this.int16[o+1]=r,this.int16[o+2]=i,this.int16[o+3]=u,e},r}(StructArray);StructArrayLayout4i8.prototype.bytesPerElement=8,register("StructArrayLayout4i8",StructArrayLayout4i8);var StructArrayLayout3i8=function(t){function r(){t.apply(this,arguments)}return t&&(r.__proto__=t),r.prototype=Object.create(t&&t.prototype),r.prototype.constructor=r,r.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},r.prototype.emplaceBack=function(t,r,i){var u=this.length;this.resize(u+1);var e=4*u;return this.int16[e+0]=t,this.int16[e+1]=r,this.int16[e+2]=i,u},r}(StructArray);StructArrayLayout3i8.prototype.bytesPerElement=8,register("StructArrayLayout3i8",StructArrayLayout3i8);var StructArrayLayout3i4i16=function(t){function r(){t.apply(this,arguments)}return t&&(r.__proto__=t),r.prototype=Object.create(t&&t.prototype),r.prototype.constructor=r,r.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},r.prototype.emplaceBack=function(t,r,i,u,e,o,n){var a=this.length;this.resize(a+1);var y=8*a;return this.int16[y+0]=t,this.int16[y+1]=r,this.int16[y+2]=i,this.int16[y+4]=u,this.int16[y+5]=e,this.int16[y+6]=o,this.int16[y+7]=n,a},r}(StructArray);StructArrayLayout3i4i16.prototype.bytesPerElement=16,register("StructArrayLayout3i4i16",StructArrayLayout3i4i16);var StructArrayLayout4i4ub2ui16=function(t){function r(){t.apply(this,arguments)}return t&&(r.__proto__=t),r.prototype=Object.create(t&&t.prototype),r.prototype.constructor=r,r.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},r.prototype.emplaceBack=function(t,r,i,u,e,o,n,a,y,s){var c=this.length;this.resize(c+1);var p=8*c,h=16*c;return this.int16[p+0]=t,this.int16[p+1]=r,this.int16[p+2]=i,this.int16[p+3]=u,this.uint8[h+8]=e,this.uint8[h+9]=o,this.uint8[h+10]=n,this.uint8[h+11]=a,this.uint16[p+6]=y,this.uint16[p+7]=s,c},r}(StructArray);StructArrayLayout4i4ub2ui16.prototype.bytesPerElement=16,register("StructArrayLayout4i4ub2ui16",StructArrayLayout4i4ub2ui16);var StructArrayLayout4i4ub3ub2ui20=function(t){function r(){t.apply(this,arguments)}return t&&(r.__proto__=t),r.prototype=Object.create(t&&t.prototype),r.prototype.constructor=r,r.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},r.prototype.emplaceBack=function(t,r,i,u,e,o,n,a,y,s,c,p,h){var f=this.length;this.resize(f+1);var A=10*f,_=20*f;return this.int16[A+0]=t,this.int16[A+1]=r,this.int16[A+2]=i,this.int16[A+3]=u,this.uint8[_+8]=e,this.uint8[_+9]=o,this.uint8[_+10]=n,this.uint8[_+11]=a,this.uint8[_+12]=y,this.uint8[_+13]=s,this.uint8[_+14]=c,this.uint16[A+8]=p,this.uint16[A+9]=h,f},r}(StructArray);StructArrayLayout4i4ub3ub2ui20.prototype.bytesPerElement=20,register("StructArrayLayout4i4ub3ub2ui20",StructArrayLayout4i4ub3ub2ui20);var StructArrayLayout2i4i12=function(t){function r(){t.apply(this,arguments)}return t&&(r.__proto__=t),r.prototype=Object.create(t&&t.prototype),r.prototype.constructor=r,r.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},r.prototype.emplaceBack=function(t,r,i,u,e,o){var n=this.length;this.resize(n+1);var a=6*n;return this.int16[a+0]=t,this.int16[a+1]=r,this.int16[a+2]=i,this.int16[a+3]=u,this.int16[a+4]=e,this.int16[a+5]=o,n},r}(StructArray);StructArrayLayout2i4i12.prototype.bytesPerElement=12,register("StructArrayLayout2i4i12",StructArrayLayout2i4i12);var StructArrayLayout4i4ub1ui16=function(t){function r(){t.apply(this,arguments)}return t&&(r.__proto__=t),r.prototype=Object.create(t&&t.prototype),r.prototype.constructor=r,r.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},r.prototype.emplaceBack=function(t,r,i,u,e,o,n,a,y){var s=this.length;this.resize(s+1);var c=8*s,p=16*s;return this.int16[c+0]=t,this.int16[c+1]=r,this.int16[c+2]=i,this.int16[c+3]=u,this.uint8[p+8]=e,this.uint8[p+9]=o,this.uint8[p+10]=n,this.uint8[p+11]=a,this.uint16[c+6]=y,s},r}(StructArray);StructArrayLayout4i4ub1ui16.prototype.bytesPerElement=16,register("StructArrayLayout4i4ub1ui16",StructArrayLayout4i4ub1ui16);var StructArrayLayout4i4ub1ui2ui20=function(t){function r(){t.apply(this,arguments)}return t&&(r.__proto__=t),r.prototype=Object.create(t&&t.prototype),r.prototype.constructor=r,r.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},r.prototype.emplaceBack=function(t,r,i,u,e,o,n,a,y,s,c){var p=this.length;this.resize(p+1);var h=10*p,f=20*p;return this.int16[h+0]=t,this.int16[h+1]=r,this.int16[h+2]=i,this.int16[h+3]=u,this.uint8[f+8]=e,this.uint8[f+9]=o,this.uint8[f+10]=n,this.uint8[f+11]=a,this.uint16[h+6]=y,this.uint16[h+8]=s,this.uint16[h+9]=c,p},r}(StructArray);StructArrayLayout4i4ub1ui2ui20.prototype.bytesPerElement=20,register("StructArrayLayout4i4ub1ui2ui20",StructArrayLayout4i4ub1ui2ui20);var StructArrayLayout4i5ui18=function(t){function r(){t.apply(this,arguments)}return t&&(r.__proto__=t),r.prototype=Object.create(t&&t.prototype),r.prototype.constructor=r,r.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},r.prototype.emplaceBack=function(t,r,i,u,e,o,n,a,y){var s=this.length;this.resize(s+1);var c=9*s;return this.int16[c+0]=t,this.int16[c+1]=r,this.int16[c+2]=i,this.int16[c+3]=u,this.uint16[c+4]=e,this.uint16[c+5]=o,this.uint16[c+6]=n,this.uint16[c+7]=a,this.uint16[c+8]=y,s},r}(StructArray);StructArrayLayout4i5ui18.prototype.bytesPerElement=18,register("StructArrayLayout4i5ui18",StructArrayLayout4i5ui18);var StructArrayLayout3f12=function(t){function r(){t.apply(this,arguments)}return t&&(r.__proto__=t),r.prototype=Object.create(t&&t.prototype),r.prototype.constructor=r,r.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},r.prototype.emplaceBack=function(t,r,i){var u=this.length;this.resize(u+1);var e=3*u;return this.float32[e+0]=t,this.float32[e+1]=r,this.float32[e+2]=i,u},r}(StructArray);StructArrayLayout3f12.prototype.bytesPerElement=12,register("StructArrayLayout3f12",StructArrayLayout3f12);var StructArrayLayout1ul4=function(t){function r(){t.apply(this,arguments)}return t&&(r.__proto__=t),r.prototype=Object.create(t&&t.prototype),r.prototype.constructor=r,r.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)},r.prototype.emplaceBack=function(t){var r=this.length;this.resize(r+1);var i=1*r;return this.uint32[i+0]=t,r},r}(StructArray);StructArrayLayout1ul4.prototype.bytesPerElement=4,register("StructArrayLayout1ul4",StructArrayLayout1ul4);var StructArrayLayout6i1ul2ui2i24=function(t){function r(){t.apply(this,arguments)}return t&&(r.__proto__=t),r.prototype=Object.create(t&&t.prototype),r.prototype.constructor=r,r.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},r.prototype.emplaceBack=function(t,r,i,u,e,o,n,a,y,s,c){var p=this.length;this.resize(p+1);var h=12*p,f=6*p;return this.int16[h+0]=t,this.int16[h+1]=r,this.int16[h+2]=i,this.int16[h+3]=u,this.int16[h+4]=e,this.int16[h+5]=o,this.uint32[f+3]=n,this.uint16[h+8]=a,this.uint16[h+9]=y,this.int16[h+10]=s,this.int16[h+11]=c,p},r}(StructArray);StructArrayLayout6i1ul2ui2i24.prototype.bytesPerElement=24,register("StructArrayLayout6i1ul2ui2i24",StructArrayLayout6i1ul2ui2i24);var StructArrayLayout2i2i2i12=function(t){function r(){t.apply(this,arguments)}return t&&(r.__proto__=t),r.prototype=Object.create(t&&t.prototype),r.prototype.constructor=r,r.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},r.prototype.emplaceBack=function(t,r,i,u,e,o){var n=this.length;this.resize(n+1);var a=6*n;return this.int16[a+0]=t,this.int16[a+1]=r,this.int16[a+2]=i,this.int16[a+3]=u,this.int16[a+4]=e,this.int16[a+5]=o,n},r}(StructArray);StructArrayLayout2i2i2i12.prototype.bytesPerElement=12,register("StructArrayLayout2i2i2i12",StructArrayLayout2i2i2i12);var StructArrayLayout2ub4=function(t){function r(){t.apply(this,arguments)}return t&&(r.__proto__=t),r.prototype=Object.create(t&&t.prototype),r.prototype.constructor=r,r.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer)},r.prototype.emplaceBack=function(t,r){var i=this.length;this.resize(i+1);var u=4*i;return this.uint8[u+0]=t,this.uint8[u+1]=r,i},r}(StructArray);StructArrayLayout2ub4.prototype.bytesPerElement=4,register("StructArrayLayout2ub4",StructArrayLayout2ub4);var StructArrayLayout2i2ui3ul3ui2f2ub40=function(t){function r(){t.apply(this,arguments)}return t&&(r.__proto__=t),r.prototype=Object.create(t&&t.prototype),r.prototype.constructor=r,r.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},r.prototype.emplaceBack=function(t,r,i,u,e,o,n,a,y,s,c,p,h,f){var A=this.length;this.resize(A+1);var _=20*A,S=10*A,l=40*A;return this.int16[_+0]=t,this.int16[_+1]=r,this.uint16[_+2]=i,this.uint16[_+3]=u,this.uint32[S+2]=e,this.uint32[S+3]=o,this.uint32[S+4]=n,this.uint16[_+10]=a,this.uint16[_+11]=y,this.uint16[_+12]=s,this.float32[S+7]=c,this.float32[S+8]=p,this.uint8[l+36]=h,this.uint8[l+37]=f,A},r}(StructArray);StructArrayLayout2i2ui3ul3ui2f2ub40.prototype.bytesPerElement=40,register("StructArrayLayout2i2ui3ul3ui2f2ub40",StructArrayLayout2i2ui3ul3ui2f2ub40);var StructArrayLayout1f4=function(t){function r(){t.apply(this,arguments)}return t&&(r.__proto__=t),r.prototype=Object.create(t&&t.prototype),r.prototype.constructor=r,r.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},r.prototype.emplaceBack=function(t){var r=this.length;this.resize(r+1);var i=1*r;return this.float32[i+0]=t,r},r}(StructArray);StructArrayLayout1f4.prototype.bytesPerElement=4,register("StructArrayLayout1f4",StructArrayLayout1f4);var StructArrayLayout3i6=function(t){function r(){t.apply(this,arguments)}return t&&(r.__proto__=t),r.prototype=Object.create(t&&t.prototype),r.prototype.constructor=r,r.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},r.prototype.emplaceBack=function(t,r,i){var u=this.length;this.resize(u+1);var e=3*u;return this.int16[e+0]=t,this.int16[e+1]=r,this.int16[e+2]=i,u},r}(StructArray);StructArrayLayout3i6.prototype.bytesPerElement=6,register("StructArrayLayout3i6",StructArrayLayout3i6);var StructArrayLayout4i6ui20=function(t){function r(){t.apply(this,arguments)}return t&&(r.__proto__=t),r.prototype=Object.create(t&&t.prototype),r.prototype.constructor=r,r.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},r.prototype.emplaceBack=function(t,r,i,u,e,o,n,a,y,s){var c=this.length;this.resize(c+1);var p=10*c;return this.int16[p+0]=t,this.int16[p+1]=r,this.int16[p+2]=i,this.int16[p+3]=u,this.uint16[p+4]=e,this.uint16[p+5]=o,this.uint16[p+6]=n,this.uint16[p+7]=a,this.uint16[p+8]=y,this.uint16[p+9]=s,c},r}(StructArray);StructArrayLayout4i6ui20.prototype.bytesPerElement=20,register("StructArrayLayout4i6ui20",StructArrayLayout4i6ui20);var StructArrayLayout1ul2ui8=function(t){function r(){t.apply(this,arguments)}return t&&(r.__proto__=t),r.prototype=Object.create(t&&t.prototype),r.prototype.constructor=r,r.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},r.prototype.emplaceBack=function(t,r,i){var u=this.length;this.resize(u+1);var e=2*u,o=4*u;return this.uint32[e+0]=t,this.uint16[o+2]=r,this.uint16[o+3]=i,u},r}(StructArray);StructArrayLayout1ul2ui8.prototype.bytesPerElement=8,register("StructArrayLayout1ul2ui8",StructArrayLayout1ul2ui8);var StructArrayLayout3ui6=function(t){function r(){t.apply(this,arguments)}return t&&(r.__proto__=t),r.prototype=Object.create(t&&t.prototype),r.prototype.constructor=r,r.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},r.prototype.emplaceBack=function(t,r,i){var u=this.length;this.resize(u+1);var e=3*u;return this.uint16[e+0]=t,this.uint16[e+1]=r,this.uint16[e+2]=i,u},r}(StructArray);StructArrayLayout3ui6.prototype.bytesPerElement=6,register("StructArrayLayout3ui6",StructArrayLayout3ui6);var StructArrayLayout2ui4=function(t){function r(){t.apply(this,arguments)}return t&&(r.__proto__=t),r.prototype=Object.create(t&&t.prototype),r.prototype.constructor=r,r.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},r.prototype.emplaceBack=function(t,r){var i=this.length;this.resize(i+1);var u=2*i;return this.uint16[u+0]=t,this.uint16[u+1]=r,i},r}(StructArray);StructArrayLayout2ui4.prototype.bytesPerElement=4,register("StructArrayLayout2ui4",StructArrayLayout2ui4);var StructArrayLayout2f8=function(t){function r(){t.apply(this,arguments)}return t&&(r.__proto__=t),r.prototype=Object.create(t&&t.prototype),r.prototype.constructor=r,r.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},r.prototype.emplaceBack=function(t,r){var i=this.length;this.resize(i+1);var u=2*i;return this.float32[u+0]=t,this.float32[u+1]=r,i},r}(StructArray);StructArrayLayout2f8.prototype.bytesPerElement=8,register("StructArrayLayout2f8",StructArrayLayout2f8);var StructArrayLayout4f16=function(t){function r(){t.apply(this,arguments)}return t&&(r.__proto__=t),r.prototype=Object.create(t&&t.prototype),r.prototype.constructor=r,r.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},r.prototype.emplaceBack=function(t,r,i,u){var e=this.length;this.resize(e+1);var o=4*e;return this.float32[o+0]=t,this.float32[o+1]=r,this.float32[o+2]=i,this.float32[o+3]=u,e},r}(StructArray);StructArrayLayout4f16.prototype.bytesPerElement=16,register("StructArrayLayout4f16",StructArrayLayout4f16);var CollisionBoxStruct=function(t){function r(){t.apply(this,arguments)}t&&(r.__proto__=t),r.prototype=Object.create(t&&t.prototype),r.prototype.constructor=r;var i={anchorPointX:{},anchorPointY:{},x1:{},y1:{},x2:{},y2:{},featureIndex:{},sourceLayerIndex:{},bucketIndex:{},radius:{},signedDistanceFromAnchor:{},anchorPoint:{}};return i.anchorPointX.get=function(){return this._structArray.int16[this._pos2+0]},i.anchorPointX.set=function(t){this._structArray.int16[this._pos2+0]=t},i.anchorPointY.get=function(){return this._structArray.int16[this._pos2+1]},i.anchorPointY.set=function(t){this._structArray.int16[this._pos2+1]=t},i.x1.get=function(){return this._structArray.int16[this._pos2+2]},i.x1.set=function(t){this._structArray.int16[this._pos2+2]=t},i.y1.get=function(){return this._structArray.int16[this._pos2+3]},i.y1.set=function(t){this._structArray.int16[this._pos2+3]=t},i.x2.get=function(){return this._structArray.int16[this._pos2+4]},i.x2.set=function(t){this._structArray.int16[this._pos2+4]=t},i.y2.get=function(){return this._structArray.int16[this._pos2+5]},i.y2.set=function(t){this._structArray.int16[this._pos2+5]=t},i.featureIndex.get=function(){return this._structArray.uint32[this._pos4+3]},i.featureIndex.set=function(t){this._structArray.uint32[this._pos4+3]=t},i.sourceLayerIndex.get=function(){return this._structArray.uint16[this._pos2+8]},i.sourceLayerIndex.set=function(t){this._structArray.uint16[this._pos2+8]=t},i.bucketIndex.get=function(){return this._structArray.uint16[this._pos2+9]},i.bucketIndex.set=function(t){this._structArray.uint16[this._pos2+9]=t},i.radius.get=function(){return this._structArray.int16[this._pos2+10]},i.radius.set=function(t){this._structArray.int16[this._pos2+10]=t},i.signedDistanceFromAnchor.get=function(){return this._structArray.int16[this._pos2+11]},i.signedDistanceFromAnchor.set=function(t){this._structArray.int16[this._pos2+11]=t},i.anchorPoint.get=function(){return new Point(this.anchorPointX,this.anchorPointY)},Object.defineProperties(r.prototype,i),r}(Struct);CollisionBoxStruct.prototype.size=24;var CollisionBoxArray=function(t){function r(){t.apply(this,arguments)}return t&&(r.__proto__=t),r.prototype=Object.create(t&&t.prototype),r.prototype.constructor=r,r.prototype.get=function(t){return new CollisionBoxStruct(this,t)},r}(StructArrayLayout6i1ul2ui2i24);register("CollisionBoxArray",CollisionBoxArray);var PlacedSymbolStruct=function(t){function r(){t.apply(this,arguments)}t&&(r.__proto__=t),r.prototype=Object.create(t&&t.prototype),r.prototype.constructor=r;var i={anchorX:{},anchorY:{},glyphStartIndex:{},numGlyphs:{},vertexStartIndex:{},lineStartIndex:{},lineLength:{},segment:{},lowerSize:{},upperSize:{},lineOffsetX:{},lineOffsetY:{},writingMode:{},hidden:{}};return i.anchorX.get=function(){return this._structArray.int16[this._pos2+0]},i.anchorX.set=function(t){this._structArray.int16[this._pos2+0]=t},i.anchorY.get=function(){return this._structArray.int16[this._pos2+1]},i.anchorY.set=function(t){this._structArray.int16[this._pos2+1]=t},i.glyphStartIndex.get=function(){return this._structArray.uint16[this._pos2+2]},i.glyphStartIndex.set=function(t){this._structArray.uint16[this._pos2+2]=t},i.numGlyphs.get=function(){return this._structArray.uint16[this._pos2+3]},i.numGlyphs.set=function(t){this._structArray.uint16[this._pos2+3]=t},i.vertexStartIndex.get=function(){return this._structArray.uint32[this._pos4+2]},i.vertexStartIndex.set=function(t){this._structArray.uint32[this._pos4+2]=t},i.lineStartIndex.get=function(){return this._structArray.uint32[this._pos4+3]},i.lineStartIndex.set=function(t){this._structArray.uint32[this._pos4+3]=t},i.lineLength.get=function(){return this._structArray.uint32[this._pos4+4]},i.lineLength.set=function(t){this._structArray.uint32[this._pos4+4]=t},i.segment.get=function(){return this._structArray.uint16[this._pos2+10]},i.segment.set=function(t){this._structArray.uint16[this._pos2+10]=t},i.lowerSize.get=function(){return this._structArray.uint16[this._pos2+11]},i.lowerSize.set=function(t){this._structArray.uint16[this._pos2+11]=t},i.upperSize.get=function(){return this._structArray.uint16[this._pos2+12]},i.upperSize.set=function(t){this._structArray.uint16[this._pos2+12]=t},i.lineOffsetX.get=function(){return this._structArray.float32[this._pos4+7]},i.lineOffsetX.set=function(t){this._structArray.float32[this._pos4+7]=t},i.lineOffsetY.get=function(){return this._structArray.float32[this._pos4+8]},i.lineOffsetY.set=function(t){this._structArray.float32[this._pos4+8]=t},i.writingMode.get=function(){return this._structArray.uint8[this._pos1+36]},i.writingMode.set=function(t){this._structArray.uint8[this._pos1+36]=t},i.hidden.get=function(){return this._structArray.uint8[this._pos1+37]},i.hidden.set=function(t){this._structArray.uint8[this._pos1+37]=t},Object.defineProperties(r.prototype,i),r}(Struct);PlacedSymbolStruct.prototype.size=40;var PlacedSymbolArray=function(t){function r(){t.apply(this,arguments)}return t&&(r.__proto__=t),r.prototype=Object.create(t&&t.prototype),r.prototype.constructor=r,r.prototype.get=function(t){return new PlacedSymbolStruct(this,t)},r}(StructArrayLayout2i2ui3ul3ui2f2ub40);register("PlacedSymbolArray",PlacedSymbolArray);var GlyphOffsetStruct=function(t){function r(){t.apply(this,arguments)}t&&(r.__proto__=t),r.prototype=Object.create(t&&t.prototype),r.prototype.constructor=r;var i={offsetX:{}};return i.offsetX.get=function(){return this._structArray.float32[this._pos4+0]},i.offsetX.set=function(t){this._structArray.float32[this._pos4+0]=t},Object.defineProperties(r.prototype,i),r}(Struct);GlyphOffsetStruct.prototype.size=4;var GlyphOffsetArray=function(t){function r(){t.apply(this,arguments)}return t&&(r.__proto__=t),r.prototype=Object.create(t&&t.prototype),r.prototype.constructor=r,r.prototype.getoffsetX=function(t){return this.float32[1*t+0]},r.prototype.get=function(t){return new GlyphOffsetStruct(this,t)},r}(StructArrayLayout1f4);register("GlyphOffsetArray",GlyphOffsetArray);var SymbolLineVertexStruct=function(t){function r(){t.apply(this,arguments)}t&&(r.__proto__=t),r.prototype=Object.create(t&&t.prototype),r.prototype.constructor=r;var i={x:{},y:{},tileUnitDistanceFromAnchor:{}};return i.x.get=function(){return this._structArray.int16[this._pos2+0]},i.x.set=function(t){this._structArray.int16[this._pos2+0]=t},i.y.get=function(){return this._structArray.int16[this._pos2+1]},i.y.set=function(t){this._structArray.int16[this._pos2+1]=t},i.tileUnitDistanceFromAnchor.get=function(){return this._structArray.int16[this._pos2+2]},i.tileUnitDistanceFromAnchor.set=function(t){this._structArray.int16[this._pos2+2]=t},Object.defineProperties(r.prototype,i),r}(Struct);SymbolLineVertexStruct.prototype.size=6;var SymbolLineVertexArray=function(t){function r(){t.apply(this,arguments)}return t&&(r.__proto__=t),r.prototype=Object.create(t&&t.prototype),r.prototype.constructor=r,r.prototype.getx=function(t){return this.int16[3*t+0]},r.prototype.gety=function(t){return this.int16[3*t+1]},r.prototype.gettileUnitDistanceFromAnchor=function(t){return this.int16[3*t+2]},r.prototype.get=function(t){return new SymbolLineVertexStruct(this,t)},r}(StructArrayLayout3i6);register("SymbolLineVertexArray",SymbolLineVertexArray);var FeatureIndexStruct=function(t){function r(){t.apply(this,arguments)}t&&(r.__proto__=t),r.prototype=Object.create(t&&t.prototype),r.prototype.constructor=r;var i={featureIndex:{},sourceLayerIndex:{},bucketIndex:{}};return i.featureIndex.get=function(){return this._structArray.uint32[this._pos4+0]},i.featureIndex.set=function(t){this._structArray.uint32[this._pos4+0]=t},i.sourceLayerIndex.get=function(){return this._structArray.uint16[this._pos2+2]},i.sourceLayerIndex.set=function(t){this._structArray.uint16[this._pos2+2]=t},i.bucketIndex.get=function(){return this._structArray.uint16[this._pos2+3]},i.bucketIndex.set=function(t){this._structArray.uint16[this._pos2+3]=t},Object.defineProperties(r.prototype,i),r}(Struct);FeatureIndexStruct.prototype.size=8;var FeatureIndexArray=function(t){function r(){t.apply(this,arguments)}return t&&(r.__proto__=t),r.prototype=Object.create(t&&t.prototype),r.prototype.constructor=r,r.prototype.get=function(t){return new FeatureIndexStruct(this,t)},r}(StructArrayLayout1ul2ui8);register("FeatureIndexArray",FeatureIndexArray),module.exports={StructArrayLayout2i4:StructArrayLayout2i4,StructArrayLayout4i8:StructArrayLayout4i8,StructArrayLayout3i8:StructArrayLayout3i8,StructArrayLayout3i4i16:StructArrayLayout3i4i16,StructArrayLayout4i4ub2ui16:StructArrayLayout4i4ub2ui16,StructArrayLayout4i4ub3ub2ui20:StructArrayLayout4i4ub3ub2ui20,StructArrayLayout2i4i12:StructArrayLayout2i4i12,StructArrayLayout4i4ub1ui16:StructArrayLayout4i4ub1ui16,StructArrayLayout4i4ub1ui2ui20:StructArrayLayout4i4ub1ui2ui20,StructArrayLayout4i5ui18:StructArrayLayout4i5ui18,StructArrayLayout3f12:StructArrayLayout3f12,StructArrayLayout1ul4:StructArrayLayout1ul4,StructArrayLayout6i1ul2ui2i24:StructArrayLayout6i1ul2ui2i24,StructArrayLayout2i2i2i12:StructArrayLayout2i2i2i12,StructArrayLayout2ub4:StructArrayLayout2ub4,StructArrayLayout2i2ui3ul3ui2f2ub40:StructArrayLayout2i2ui3ul3ui2f2ub40,StructArrayLayout1f4:StructArrayLayout1f4,StructArrayLayout3i6:StructArrayLayout3i6,StructArrayLayout4i6ui20:StructArrayLayout4i6ui20,StructArrayLayout1ul2ui8:StructArrayLayout1ul2ui8,StructArrayLayout3ui6:StructArrayLayout3ui6,StructArrayLayout2ui4:StructArrayLayout2ui4,StructArrayLayout2f8:StructArrayLayout2f8,StructArrayLayout4f16:StructArrayLayout4f16,PosArray:StructArrayLayout2i4,RasterBoundsArray:StructArrayLayout4i8,CircleLayoutArray:StructArrayLayout2i4,FillLayoutArray:StructArrayLayout3i8,ExtrusionLayoutArray:StructArrayLayout3i4i16,HeatmapLayoutArray:StructArrayLayout2i4,LineLayoutArray:StructArrayLayout4i4ub2ui16,SpriteLayoutArray:StructArrayLayout4i4ub3ub2ui20,HistogramLayoutArray:StructArrayLayout2i4i12,TrackingLayoutArray:StructArrayLayout4i4ub1ui16,DynamicLineLayoutArray:StructArrayLayout4i4ub1ui2ui20,AirlineLayoutArray:StructArrayLayout4i4ub1ui2ui20,SymbolLayoutArray:StructArrayLayout4i5ui18,SymbolDynamicLayoutArray:StructArrayLayout3f12,SymbolOpacityArray:StructArrayLayout1ul4,CollisionBoxLayoutArray:StructArrayLayout2i2i2i12,CollisionCircleLayoutArray:StructArrayLayout2i2i2i12,CollisionVertexArray:StructArrayLayout2ub4,SymtrackingLayoutArray:StructArrayLayout4i6ui20,SymtrackingDynamicLayoutArray:StructArrayLayout3f12,TriangleIndexArray:StructArrayLayout3ui6,LineIndexArray:StructArrayLayout2ui4,CollisionBoxArray:CollisionBoxArray,PlacedSymbolArray:PlacedSymbolArray,GlyphOffsetArray:GlyphOffsetArray,SymbolLineVertexArray:SymbolLineVertexArray,FeatureIndexArray:FeatureIndexArray};
},{"../_minemap_/point-geometry":29,"../util/struct_array":310,"../util/web_worker_transfer":318}],42:[function(_dereq_,module,exports){
"use strict";module.exports={deserialize:function(r,e){var t={};if(!e)return t;for(var n=0,a=r;n<a.length;n+=1){var i=a[n],l=i.layerIds.map(function(r){return e.getLayer(r)}).filter(Boolean);if(0!==l.length){i.layers=l;for(var o=0,f=l;o<f.length;o+=1){t[f[o].id]=i}}}return t}};
},{}],43:[function(_dereq_,module,exports){
"use strict";var ref=_dereq_("../../util/struct_array"),createLayout=ref.createLayout;module.exports=createLayout([{name:"a_pos_normal",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_height",components:1,type:"Uint16"},{name:"a_seq",components:2,type:"Uint16"}],4);
},{"../../util/struct_array":310}],44:[function(_dereq_,module,exports){
"use strict";function addLineVertex(e,t,r,i,a,n,s){e.emplaceBack(t.x,t.y,i?1:0,a?1:-1,Math.round(EXTRUDE_SCALE*r.x)+128,Math.round(EXTRUDE_SCALE*r.y)+128,1+(0===n?0:n<0?-1:1)|(s*LINE_DISTANCE_SCALE&63)<<2,s*LINE_DISTANCE_SCALE>>6,h_seq,seq,_count)}var ref=_dereq_("../array_types"),AirlineLayoutArray=ref.AirlineLayoutArray,layoutAttributes=_dereq_("./airline_attributes").members,ref$1=_dereq_("../segment"),SegmentVector=ref$1.SegmentVector,ref$2=_dereq_("../program_configuration"),ProgramConfigurationSet=ref$2.ProgramConfigurationSet,ref$3=_dereq_("../index_array_type"),TriangleIndexArray=ref$3.TriangleIndexArray,loadGeometry=_dereq_("../load_geometry"),EXTENT=_dereq_("../extent"),vectorTileFeatureTypes=_dereq_("../../_minemap_/vector-tile").VectorTileFeature.types,ref$4=_dereq_("../../util/web_worker_transfer"),register=ref$4.register,h_seq=0,seq=0,_count=0,EXTRUDE_SCALE=63,COS_HALF_SHARP_CORNER=Math.cos(Math.PI/180*37.5),SHARP_CORNER_OFFSET=15,LINE_DISTANCE_BUFFER_BITS=15,LINE_DISTANCE_SCALE=.5,MAX_LINE_DISTANCE=Math.pow(2,LINE_DISTANCE_BUFFER_BITS-1)/LINE_DISTANCE_SCALE,AirlineBucket=function(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(function(e){return e.id}),this.index=e.index,this.layoutVertexArray=new AirlineLayoutArray,this.indexArray=new TriangleIndexArray,this.programConfigurations=new ProgramConfigurationSet(layoutAttributes,e.layers,e.zoom),this.segments=new SegmentVector};AirlineBucket.prototype.populate=function(e,t){for(var r=this,i=0,a=e;i<a.length;i+=1){var n=a[i],s=n.feature,u=n.index,o=n.sourceLayerIndex;if(r.layers[0]._featureFilter({zoom:r.zoom},s)){var d=loadGeometry(s);r.addFeature(s,d),t.featureIndex.insert(s,d,u,o,r.index)}}},AirlineBucket.prototype.isEmpty=function(){return 0===this.layoutVertexArray.length},AirlineBucket.prototype.upload=function(e){this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,layoutAttributes),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.programConfigurations.upload(e)},AirlineBucket.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())},AirlineBucket.prototype.addFeature=function(e,t){var r=this,i=this.layers[0].layout,a=i.get("airline-join").evaluate(e),n=i.get("airline-cap"),s=i.get("airline-miter-limit"),u=i.get("airline-round-limit");seq=e.properties.link_seq,_count=e.properties.total;for(var o=0,d=t;o<d.length;o+=1){var l=d[o];r.addLine(l,e,a,n,s,u)}},AirlineBucket.prototype.addLine=function(e,t,r,i,a,n){for(var s=this,u="Polygon"===vectorTileFeatureTypes[t.type],o=e.length;o>=2&&e[o-1].equals(e[o-2]);)o--;for(var d=0;d<o-1&&e[d].equals(e[d+1]);)d++;if(!(o<(u?3:2))){"bevel"===r&&(a=1.05);var l=SHARP_CORNER_OFFSET*(EXTENT/(512*this.overscaling)),h=e[d],c=this.segments.prepareSegment(10*o,this.layoutVertexArray,this.indexArray);this.distance=0;var y,f,_,p=i,x=u?"butt":i,m=!0,A=void 0,g=void 0,v=void 0,C=void 0;this.e1=this.e2=this.e3=-1,u&&(y=e[o-2],C=h.sub(y)._unit()._perp());for(var E=d;E<o;E++)if(h_seq=0===E?10*t.properties.start_height:10*t.properties.end_height,!(g=u&&E===o-1?e[d+1]:e[E+1])||!e[E].equals(g)){C&&(v=C),y&&(A=y),y=e[E],C=g?g.sub(y)._unit()._perp():v,v=v||C;var V=v.add(C);0===V.x&&0===V.y||V._unit();var S=V.x*C.x+V.y*C.y,L=0!==S?1/S:1/0,B=S<COS_HALF_SHARP_CORNER&&A&&g;if(B&&E>d){var T=y.dist(A);if(T>2*l){var I=y.sub(y.sub(A)._mult(l/T)._round());s.distance+=I.dist(A),s.addCurrentVertex(I,s.distance,v.mult(1),0,0,!1,c),A=I}}var b=A&&g,N=b?r:g?p:x;if(b&&"round"===N&&(L<n?N="miter":L<=2&&(N="fakeround")),"miter"===N&&L>a&&(N="bevel"),"bevel"===N&&(L>2&&(N="flipbevel"),L<a&&(N="miter")),A&&(s.distance+=y.dist(A)),"miter"===N)V._mult(L),s.addCurrentVertex(y,s.distance,V,0,0,!1,c);else if("flipbevel"===N){if(L>100)V=C.clone().mult(-1);else{var k=v.x*C.y-v.y*C.x>0?-1:1,q=L*v.add(C).mag()/v.sub(C).mag();V._perp()._mult(q*k)}s.addCurrentVertex(y,s.distance,V,0,0,!1,c),s.addCurrentVertex(y,s.distance,V.mult(-1),0,0,!1,c)}else if("bevel"===N||"fakeround"===N){var R=v.x*C.y-v.y*C.x>0,F=-Math.sqrt(L*L-1);if(R?(_=0,f=F):(f=0,_=F),m||s.addCurrentVertex(y,s.distance,v,f,_,!1,c),"fakeround"===N){for(var P=Math.floor(8*(.5-(S-.5))),D=void 0,M=0;M<P;M++)D=C.mult((M+1)/(P+1))._add(v)._unit(),s.addPieSliceVertex(y,s.distance,D,R,c);s.addPieSliceVertex(y,s.distance,V,R,c);for(var O=P-1;O>=0;O--)D=v.mult((O+1)/(P+1))._add(C)._unit(),s.addPieSliceVertex(y,s.distance,D,R,c)}g&&s.addCurrentVertex(y,s.distance,C,-f,-_,!1,c)}else"butt"===N?(m||s.addCurrentVertex(y,s.distance,v,0,0,!1,c),g&&s.addCurrentVertex(y,s.distance,C,0,0,!1,c)):"square"===N?(m||(s.addCurrentVertex(y,s.distance,v,1,1,!1,c),s.e1=s.e2=-1),g&&s.addCurrentVertex(y,s.distance,C,-1,-1,!1,c)):"round"===N&&(m||(s.addCurrentVertex(y,s.distance,v,0,0,!1,c),s.addCurrentVertex(y,s.distance,v,1,1,!0,c),s.e1=s.e2=-1),g&&(s.addCurrentVertex(y,s.distance,C,-1,-1,!0,c),s.addCurrentVertex(y,s.distance,C,0,0,!1,c)));if(B&&E<o-1){var $=y.dist(g);if($>2*l){var w=y.add(g.sub(y)._mult(l/$)._round());s.distance+=w.dist(y),s.addCurrentVertex(w,s.distance,C.mult(1),0,0,!1,c),y=w}}m=!1}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t)}},AirlineBucket.prototype.addCurrentVertex=function(e,t,r,i,a,n,s){var u,o=this.layoutVertexArray,d=this.indexArray;u=r.clone(),i&&u._sub(r.perp()._mult(i)),addLineVertex(o,e,u,n,!1,i,t),this.e3=s.vertexLength++,this.e1>=0&&this.e2>=0&&(d.emplaceBack(this.e1,this.e2,this.e3),s.primitiveLength++),this.e1=this.e2,this.e2=this.e3,u=r.mult(-1),a&&u._sub(r.perp()._mult(a)),addLineVertex(o,e,u,n,!0,-a,t),this.e3=s.vertexLength++,this.e1>=0&&this.e2>=0&&(d.emplaceBack(this.e1,this.e2,this.e3),s.primitiveLength++),this.e1=this.e2,this.e2=this.e3,t>MAX_LINE_DISTANCE/2&&(this.distance=0,this.addCurrentVertex(e,this.distance,r,i,a,n,s))},AirlineBucket.prototype.addPieSliceVertex=function(e,t,r,i,a){r=r.mult(i?-1:1);var n=this.layoutVertexArray,s=this.indexArray;addLineVertex(n,e,r,!1,i,0,t),this.e3=a.vertexLength++,this.e1>=0&&this.e2>=0&&(s.emplaceBack(this.e1,this.e2,this.e3),a.primitiveLength++),i?this.e2=this.e3:this.e1=this.e3},register("AirlineBucket",AirlineBucket,{omit:["layers"]}),module.exports=AirlineBucket;
},{"../../_minemap_/vector-tile":34,"../../util/web_worker_transfer":318,"../array_types":41,"../extent":67,"../index_array_type":69,"../load_geometry":70,"../program_configuration":72,"../segment":74,"./airline_attributes":43}],45:[function(_dereq_,module,exports){
"use strict";var ref=_dereq_("../../util/struct_array"),createLayout=ref.createLayout;module.exports=createLayout([{name:"a_pos",components:2,type:"Int16"}],4);
},{"../../util/struct_array":310}],46:[function(_dereq_,module,exports){
"use strict";function addCircleVertex(e,r,t,a,i){e.emplaceBack(2*r+(a+1)/2,2*t+(i+1)/2)}var ref=_dereq_("../array_types"),CircleLayoutArray=ref.CircleLayoutArray,layoutAttributes=_dereq_("./circle_attributes").members,ref$1=_dereq_("../segment"),SegmentVector=ref$1.SegmentVector,ref$2=_dereq_("../program_configuration"),ProgramConfigurationSet=ref$2.ProgramConfigurationSet,ref$3=_dereq_("../index_array_type"),TriangleIndexArray=ref$3.TriangleIndexArray,loadGeometry=_dereq_("../load_geometry"),EXTENT=_dereq_("../extent"),ref$4=_dereq_("../../util/web_worker_transfer"),register=ref$4.register,CircleBucket=function(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(function(e){return e.id}),this.index=e.index,this.layoutVertexArray=new CircleLayoutArray,this.indexArray=new TriangleIndexArray,this.segments=new SegmentVector,this.programConfigurations=new ProgramConfigurationSet(layoutAttributes,e.layers,e.zoom)};CircleBucket.prototype.populate=function(e,r){for(var t=this,a=0,i=e;a<i.length;a+=1){var o=i[a],n=o.feature,u=o.index,s=o.sourceLayerIndex;if(t.layers[0]._featureFilter({zoom:t.zoom},n)){var y=loadGeometry(n);t.addFeature(n,y),r.featureIndex.insert(n,y,u,s,t.index)}}},CircleBucket.prototype.isEmpty=function(){return 0===this.layoutVertexArray.length},CircleBucket.prototype.upload=function(e){this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,layoutAttributes),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.programConfigurations.upload(e)},CircleBucket.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())},CircleBucket.prototype.addFeature=function(e,r){for(var t=this,a=0,i=r;a<i.length;a+=1)for(var o=i[a],n=0,u=o;n<u.length;n+=1){var s=u[n],y=s.x,l=s.y;if(!(y<0||y>=EXTENT||l<0||l>=EXTENT)){var c=t.segments.prepareSegment(4,t.layoutVertexArray,t.indexArray),f=c.vertexLength;addCircleVertex(t.layoutVertexArray,y,l,-1,-1),addCircleVertex(t.layoutVertexArray,y,l,1,-1),addCircleVertex(t.layoutVertexArray,y,l,1,1),addCircleVertex(t.layoutVertexArray,y,l,-1,1),t.indexArray.emplaceBack(f,f+1,f+2),t.indexArray.emplaceBack(f,f+3,f+2),c.vertexLength+=4,c.primitiveLength+=2}}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e)},register("CircleBucket",CircleBucket,{omit:["layers"]}),module.exports=CircleBucket;
},{"../../util/web_worker_transfer":318,"../array_types":41,"../extent":67,"../index_array_type":69,"../load_geometry":70,"../program_configuration":72,"../segment":74,"./circle_attributes":45}],47:[function(_dereq_,module,exports){
"use strict";var ref=_dereq_("../../util/struct_array"),createLayout=ref.createLayout;module.exports=createLayout([{name:"a_pos_normal",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_seq",components:1,type:"Uint16"},{name:"a_info",components:2,type:"Uint16"}],4);
},{"../../util/struct_array":310}],48:[function(_dereq_,module,exports){
"use strict";function addLineVertex(e,t,r,i,a,n,s){e.emplaceBack(t.x,t.y,i?1:0,a?1:-1,Math.round(EXTRUDE_SCALE*r.x)+128,Math.round(EXTRUDE_SCALE*r.y)+128,1+(0===n?0:n<0?-1:1)|(s*LINE_DISTANCE_SCALE&63)<<2,s*LINE_DISTANCE_SCALE>>6,seq,total,offset)}var ref=_dereq_("../array_types"),DynamicLineLayoutArray=ref.DynamicLineLayoutArray,layoutAttributes=_dereq_("./dynamic_line_attributes").members,ref$1=_dereq_("../segment"),SegmentVector=ref$1.SegmentVector,ref$2=_dereq_("../program_configuration"),ProgramConfigurationSet=ref$2.ProgramConfigurationSet,ref$3=_dereq_("../index_array_type"),TriangleIndexArray=ref$3.TriangleIndexArray,loadGeometry=_dereq_("../load_geometry"),EXTENT=_dereq_("../extent"),vectorTileFeatureTypes=_dereq_("../../_minemap_/vector-tile").VectorTileFeature.types,ref$4=_dereq_("../../util/web_worker_transfer"),register=ref$4.register,seq=0,total=0,offset=0,EXTRUDE_SCALE=63,COS_HALF_SHARP_CORNER=Math.cos(Math.PI/180*37.5),SHARP_CORNER_OFFSET=15,LINE_DISTANCE_BUFFER_BITS=15,LINE_DISTANCE_SCALE=.5,MAX_LINE_DISTANCE=Math.pow(2,LINE_DISTANCE_BUFFER_BITS-1)/LINE_DISTANCE_SCALE,DynamicLineBucket=function(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(function(e){return e.id}),this.index=e.index,this.layoutVertexArray=new DynamicLineLayoutArray,this.indexArray=new TriangleIndexArray,this.programConfigurations=new ProgramConfigurationSet(layoutAttributes,e.layers,e.zoom),this.segments=new SegmentVector};DynamicLineBucket.prototype.populate=function(e,t){for(var r=this,i=0,a=e;i<a.length;i+=1){var n=a[i],s=n.feature,o=n.index,u=n.sourceLayerIndex;if(r.layers[0]._featureFilter({zoom:r.zoom},s)){var d=loadGeometry(s);r.addFeature(s,d),t.featureIndex.insert(s,d,o,u,r.index)}}},DynamicLineBucket.prototype.isEmpty=function(){return 0===this.layoutVertexArray.length},DynamicLineBucket.prototype.upload=function(e){this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,layoutAttributes),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.programConfigurations.upload(e)},DynamicLineBucket.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())},DynamicLineBucket.prototype.addFeature=function(e,t){var r=this,i=this.layers[0].layout,a=i.get("dynamicLine-join").evaluate(e),n=i.get("dynamicLine-cap"),s=i.get("dynamicLine-miter-limit"),o=i.get("dynamicLine-round-limit");seq=e.properties.link_seq,total=e.properties.total_link_count,offset=e.properties.offset_link_count;for(var u=0,d=t;u<d.length;u+=1){var c=d[u];r.addLine(c,e,a,n,s,o)}},DynamicLineBucket.prototype.addLine=function(e,t,r,i,a,n){for(var s=this,o="Polygon"===vectorTileFeatureTypes[t.type],u=e.length;u>=2&&e[u-1].equals(e[u-2]);)u--;for(var d=0;d<u-1&&e[d].equals(e[d+1]);)d++;if(!(u<(o?3:2))){"bevel"===r&&(a=1.05);var c=SHARP_CORNER_OFFSET*(EXTENT/(512*this.overscaling)),y=e[d],l=this.segments.prepareSegment(10*u,this.layoutVertexArray,this.indexArray);this.distance=0;var h,m,f,x=i,_=o?"butt":i,p=!0,g=void 0,L=void 0,v=void 0,A=void 0;this.e1=this.e2=this.e3=-1,o&&(h=e[u-2],A=y.sub(h)._unit()._perp());for(var C=d;C<u;C++)if(seq++,!(L=o&&C===u-1?e[d+1]:e[C+1])||!e[C].equals(L)){A&&(v=A),h&&(g=h),h=e[C],A=L?L.sub(h)._unit()._perp():v,v=v||A;var E=v.add(A);0===E.x&&0===E.y||E._unit();var V=E.x*A.x+E.y*A.y,S=0!==V?1/V:1/0,B=V<COS_HALF_SHARP_CORNER&&g&&L;if(B&&C>d){var T=h.dist(g);if(T>2*c){var D=h.sub(h.sub(g)._mult(c/T)._round());s.distance+=D.dist(g),s.addCurrentVertex(D,s.distance,v.mult(1),0,0,!1,l),g=D}}var I=g&&L,k=I?r:L?x:_;if(I&&"round"===k&&(S<n?k="miter":S<=2&&(k="fakeround")),"miter"===k&&S>a&&(k="bevel"),"bevel"===k&&(S>2&&(k="flipbevel"),S<a&&(k="miter")),g&&(s.distance+=h.dist(g)),"miter"===k)E._mult(S),s.addCurrentVertex(h,s.distance,E,0,0,!1,l);else if("flipbevel"===k){if(S>100)E=A.clone().mult(-1);else{var b=v.x*A.y-v.y*A.x>0?-1:1,N=S*v.add(A).mag()/v.sub(A).mag();E._perp()._mult(N*b)}s.addCurrentVertex(h,s.distance,E,0,0,!1,l),s.addCurrentVertex(h,s.distance,E.mult(-1),0,0,!1,l)}else if("bevel"===k||"fakeround"===k){var q=v.x*A.y-v.y*A.x>0,R=-Math.sqrt(S*S-1);if(q?(f=0,m=R):(m=0,f=R),p||s.addCurrentVertex(h,s.distance,v,m,f,!1,l),"fakeround"===k){for(var F=Math.floor(8*(.5-(V-.5))),P=void 0,M=0;M<F;M++)P=A.mult((M+1)/(F+1))._add(v)._unit(),s.addPieSliceVertex(h,s.distance,P,q,l);s.addPieSliceVertex(h,s.distance,E,q,l);for(var O=F-1;O>=0;O--)P=v.mult((O+1)/(F+1))._add(A)._unit(),s.addPieSliceVertex(h,s.distance,P,q,l)}L&&s.addCurrentVertex(h,s.distance,A,-m,-f,!1,l)}else"butt"===k?(p||s.addCurrentVertex(h,s.distance,v,0,0,!1,l),L&&s.addCurrentVertex(h,s.distance,A,0,0,!1,l)):"square"===k?(p||(s.addCurrentVertex(h,s.distance,v,1,1,!1,l),s.e1=s.e2=-1),L&&s.addCurrentVertex(h,s.distance,A,-1,-1,!1,l)):"round"===k&&(p||(s.addCurrentVertex(h,s.distance,v,0,0,!1,l),s.addCurrentVertex(h,s.distance,v,1,1,!0,l),s.e1=s.e2=-1),L&&(s.addCurrentVertex(h,s.distance,A,-1,-1,!0,l),s.addCurrentVertex(h,s.distance,A,0,0,!1,l)));if(B&&C<u-1){var $=h.dist(L);if($>2*c){var w=h.add(L.sub(h)._mult(c/$)._round());s.distance+=w.dist(h),s.addCurrentVertex(w,s.distance,A.mult(1),0,0,!1,l),h=w}}p=!1}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t)}},DynamicLineBucket.prototype.addCurrentVertex=function(e,t,r,i,a,n,s){var o,u=this.layoutVertexArray,d=this.indexArray;o=r.clone(),i&&o._sub(r.perp()._mult(i)),addLineVertex(u,e,o,n,!1,i,t),this.e3=s.vertexLength++,this.e1>=0&&this.e2>=0&&(d.emplaceBack(this.e1,this.e2,this.e3),s.primitiveLength++),this.e1=this.e2,this.e2=this.e3,o=r.mult(-1),a&&o._sub(r.perp()._mult(a)),addLineVertex(u,e,o,n,!0,-a,t),this.e3=s.vertexLength++,this.e1>=0&&this.e2>=0&&(d.emplaceBack(this.e1,this.e2,this.e3),s.primitiveLength++),this.e1=this.e2,this.e2=this.e3,t>MAX_LINE_DISTANCE/2&&(this.distance=0,this.addCurrentVertex(e,this.distance,r,i,a,n,s))},DynamicLineBucket.prototype.addPieSliceVertex=function(e,t,r,i,a){r=r.mult(i?-1:1);var n=this.layoutVertexArray,s=this.indexArray;addLineVertex(n,e,r,!1,i,0,t),this.e3=a.vertexLength++,this.e1>=0&&this.e2>=0&&(s.emplaceBack(this.e1,this.e2,this.e3),a.primitiveLength++),i?this.e2=this.e3:this.e1=this.e3},register("DynamicLineBucket",DynamicLineBucket,{omit:["layers"]}),module.exports=DynamicLineBucket;
},{"../../_minemap_/vector-tile":34,"../../util/web_worker_transfer":318,"../array_types":41,"../extent":67,"../index_array_type":69,"../load_geometry":70,"../program_configuration":72,"../segment":74,"./dynamic_line_attributes":47}],49:[function(_dereq_,module,exports){
"use strict";var ref=_dereq_("../../util/struct_array"),createLayout=ref.createLayout;module.exports=createLayout([{name:"a_pos",components:3,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4);
},{"../../util/struct_array":310}],50:[function(_dereq_,module,exports){
"use strict";function addVertex(e,r,t,i,a,n,o,u,s){e.emplaceBack(r,t,s-500,2*Math.floor(i*FACTOR)+o,a*FACTOR*2,n*FACTOR*2,Math.round(u))}function isBoundaryEdge(e,r){return e.x===r.x&&(e.x<0||e.x>EXTENT)||e.y===r.y&&(e.y<0||e.y>EXTENT)}function isEntirelyOutside(e){return e.every(function(e){return e.x<0})||e.every(function(e){return e.x>EXTENT})||e.every(function(e){return e.y<0})||e.every(function(e){return e.y>EXTENT})}var ref=_dereq_("../array_types"),ExtrusionLayoutArray=ref.ExtrusionLayoutArray,layoutAttributes=_dereq_("./extrusion_attributes").members,ref$1=_dereq_("../segment"),SegmentVector=ref$1.SegmentVector,MAX_VERTEX_ARRAY_LENGTH=ref$1.MAX_VERTEX_ARRAY_LENGTH,ref$2=_dereq_("../program_configuration"),ProgramConfigurationSet=ref$2.ProgramConfigurationSet,ref$3=_dereq_("../index_array_type"),TriangleIndexArray=ref$3.TriangleIndexArray,loadGeometry=_dereq_("../load_geometry"),EXTENT=_dereq_("../extent"),earcut=_dereq_("earcut"),classifyRings=_dereq_("../../util/classify_rings"),EARCUT_MAX_RINGS=500,ref$4=_dereq_("../../util/web_worker_transfer"),register=ref$4.register,FACTOR=Math.pow(2,13),FillExtrusionBucket=function(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(function(e){return e.id}),this.index=e.index,this.layoutVertexArray=new ExtrusionLayoutArray,this.indexArray=new TriangleIndexArray,this.programConfigurations=new ProgramConfigurationSet(layoutAttributes,e.layers,e.zoom),this.segments=new SegmentVector};FillExtrusionBucket.prototype.populate=function(e,r){for(var t=this,i=0,a=e;i<a.length;i+=1){var n=a[i],o=n.feature,u=n.index,s=n.sourceLayerIndex;if(t.layers[0]._featureFilter({zoom:t.zoom},o)){var y=loadGeometry(o);t.addFeature(o,y),r.featureIndex.insert(o,y,u,s,t.index)}}},FillExtrusionBucket.prototype.isEmpty=function(){return 0===this.layoutVertexArray.length},FillExtrusionBucket.prototype.upload=function(e){this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,layoutAttributes),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.programConfigurations.upload(e)},FillExtrusionBucket.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())},FillExtrusionBucket.prototype.addFeature=function(e,r){for(var t=this,i=0,a=classifyRings(r,EARCUT_MAX_RINGS);i<a.length;i+=1){for(var n=a[i],o=0,u=0,s=n;u<s.length;u+=1){o+=s[u].length}for(var y=t.segments.prepareSegment(4,t.layoutVertexArray,t.indexArray),l=0,x=n;l<x.length;l+=1){var f=x[l];if(0!==f.length&&!isEntirelyOutside(f))for(var g=0,d=0;d<f.length;d++){var h=f[d];if(d>=1){var A=f[d-1];if(!isBoundaryEdge(h,A)){y.vertexLength+4>MAX_VERTEX_ARRAY_LENGTH&&(y=t.segments.prepareSegment(4,t.layoutVertexArray,t.indexArray));var c=h.sub(A)._perp()._unit(),p=A.dist(h);g+p>32768&&(g=0),addVertex(t.layoutVertexArray,h.x,h.y,c.x,c.y,0,0,g,h.z),addVertex(t.layoutVertexArray,h.x,h.y,c.x,c.y,0,1,g,h.z),g+=p,addVertex(t.layoutVertexArray,A.x,A.y,c.x,c.y,0,0,g,h.z),addVertex(t.layoutVertexArray,A.x,A.y,c.x,c.y,0,1,g,h.z);var E=y.vertexLength;t.indexArray.emplaceBack(E,E+1,E+2),t.indexArray.emplaceBack(E+1,E+2,E+3),y.vertexLength+=4,y.primitiveLength+=2}}}}y.vertexLength+o>MAX_VERTEX_ARRAY_LENGTH&&(y=t.segments.prepareSegment(o,t.layoutVertexArray,t.indexArray));for(var m=[],v=[],V=y.vertexLength,_=0,T=n;_<T.length;_+=1){var B=T[_];if(0!==B.length){B!==n[0]&&v.push(m.length/2);for(var R=0;R<B.length;R++){var L=B[R];addVertex(t.layoutVertexArray,L.x,L.y,0,0,1,1,0,L.z),m.push(L.x),m.push(L.y)}}}for(var F=earcut(m,v),X=0;X<F.length;X+=3)t.indexArray.emplaceBack(V+F[X],V+F[X+1],V+F[X+2]);y.primitiveLength+=F.length/3,y.vertexLength+=o}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e)},register("ExtrusionBucket",FillExtrusionBucket,{omit:["layers"]}),module.exports=FillExtrusionBucket;
},{"../../util/classify_rings":289,"../../util/web_worker_transfer":318,"../array_types":41,"../extent":67,"../index_array_type":69,"../load_geometry":70,"../program_configuration":72,"../segment":74,"./extrusion_attributes":49,"earcut":3}],51:[function(_dereq_,module,exports){
"use strict";var ref=_dereq_("../../util/struct_array"),createLayout=ref.createLayout;module.exports=createLayout([{name:"a_pos",components:3,type:"Int16"}],4);
},{"../../util/struct_array":310}],52:[function(_dereq_,module,exports){
"use strict";var ref=_dereq_("../array_types"),FillLayoutArray=ref.FillLayoutArray,layoutAttributes=_dereq_("./fill_attributes").members,ref$1=_dereq_("../segment"),SegmentVector=ref$1.SegmentVector,ref$2=_dereq_("../program_configuration"),ProgramConfigurationSet=ref$2.ProgramConfigurationSet,ref$3=_dereq_("../index_array_type"),LineIndexArray=ref$3.LineIndexArray,TriangleIndexArray=ref$3.TriangleIndexArray,loadGeometry=_dereq_("../load_geometry"),earcut=_dereq_("earcut"),classifyRings=_dereq_("../../util/classify_rings"),EARCUT_MAX_RINGS=500,ref$4=_dereq_("../../util/web_worker_transfer"),register=ref$4.register,FillBucket=function(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(function(e){return e.id}),this.index=e.index,this.layoutVertexArray=new FillLayoutArray,this.indexArray=new TriangleIndexArray,this.indexArray2=new LineIndexArray,this.programConfigurations=new ProgramConfigurationSet(layoutAttributes,e.layers,e.zoom),this.segments=new SegmentVector,this.segments2=new SegmentVector};FillBucket.prototype.populate=function(e,r){for(var t=this,i=0,a=e;i<a.length;i+=1){var n=a[i],o=n.feature,s=n.index,l=n.sourceLayerIndex;if(t.layers[0]._featureFilter({zoom:t.zoom},o)){var u=loadGeometry(o);t.addFeature(o,u),r.featureIndex.insert(o,u,s,l,t.index)}}},FillBucket.prototype.isEmpty=function(){return 0===this.layoutVertexArray.length},FillBucket.prototype.upload=function(e){this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,layoutAttributes),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.indexBuffer2=e.createIndexBuffer(this.indexArray2),this.programConfigurations.upload(e)},FillBucket.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())},FillBucket.prototype.addFeature=function(e,r){for(var t=this,i=0,a=classifyRings(r,EARCUT_MAX_RINGS);i<a.length;i+=1){for(var n=a[i],o=0,s=0,l=n;s<l.length;s+=1){o+=l[s].length}for(var u=t.segments.prepareSegment(o,t.layoutVertexArray,t.indexArray),y=u.vertexLength,g=[],f=[],h=0,p=n;h<p.length;h+=1){var x=p[h];if(0!==x.length){x!==n[0]&&f.push(g.length/2);var d=t.segments2.prepareSegment(x.length,t.layoutVertexArray,t.indexArray2),c=d.vertexLength,m=x[0].x>32767?32767:x[0].x;m=x[0].x<-32768?-32768:x[0].x;var A=x[0].y>32767?32767:x[0].y;A=x[0].y<-32768?-32768:x[0].y;var v=null!==e.properties&&void 0!==e.properties&&e.properties.hasOwnProperty("levels")?10*e.properties.levels:x[0].z;t.layoutVertexArray.emplaceBack(m,A,0!==v?v-500:0),t.indexArray2.emplaceBack(c+x.length-1,c),g.push(x[0].x),g.push(x[0].y);for(var B=1;B<x.length;B++){var V=x[B].x>32767?32767:x[B].x;V=x[B].x<-32768?-32768:x[B].x;var k=x[B].y>32767?32767:x[B].y;k=x[B].y<-32768?-32768:x[B].y;var F=null!==e.properties&&void 0!==e.properties&&e.properties.hasOwnProperty("levels")?10*e.properties.levels:x[B].z;t.layoutVertexArray.emplaceBack(V,k,0!==F?F-500:0),t.indexArray2.emplaceBack(c+B-1,c+B),g.push(x[B].x),g.push(x[B].y)}d.vertexLength+=x.length,d.primitiveLength+=x.length}}for(var _=earcut(g,f),I=0;I<_.length;I+=3)t.indexArray.emplaceBack(y+_[I],y+_[I+1],y+_[I+2]);u.vertexLength+=o,u.primitiveLength+=_.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e)},register("FillBucket",FillBucket,{omit:["layers"]}),module.exports=FillBucket;
},{"../../util/classify_rings":289,"../../util/web_worker_transfer":318,"../array_types":41,"../index_array_type":69,"../load_geometry":70,"../program_configuration":72,"../segment":74,"./fill_attributes":51,"earcut":3}],53:[function(_dereq_,module,exports){
"use strict";var CircleBucket=_dereq_("./circle_bucket"),ref=_dereq_("../../util/web_worker_transfer"),register=ref.register,HeatmapBucket=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t}(CircleBucket);register("HeatmapBucket",HeatmapBucket,{omit:["layers"]}),module.exports=HeatmapBucket;
},{"../../util/web_worker_transfer":318,"./circle_bucket":46}],54:[function(_dereq_,module,exports){
"use strict";var ref=_dereq_("../../util/struct_array"),createLayout=ref.createLayout;module.exports=createLayout([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4);
},{"../../util/struct_array":310}],55:[function(_dereq_,module,exports){
"use strict";function addVertex(e,r,t,a,i,o,n,u){e.emplaceBack(r,t,2*Math.floor(a*FACTOR)+n,i*FACTOR*2,o*FACTOR*2,Math.round(u))}function isBoundaryEdge(e,r){return e.x===r.x&&(e.x<0||e.x>EXTENT)||e.y===r.y&&(e.y<0||e.y>EXTENT)}function isEntirelyOutside(e){return e.every(function(e){return e.x<0})||e.every(function(e){return e.x>EXTENT})||e.every(function(e){return e.y<0})||e.every(function(e){return e.y>EXTENT})}var ref=_dereq_("../array_types"),HistogramLayoutArray=ref.HistogramLayoutArray,layoutAttributes=_dereq_("./histogram_attributes").members,ref$1=_dereq_("../segment"),SegmentVector=ref$1.SegmentVector,MAX_VERTEX_ARRAY_LENGTH=ref$1.MAX_VERTEX_ARRAY_LENGTH,ref$2=_dereq_("../program_configuration"),ProgramConfigurationSet=ref$2.ProgramConfigurationSet,ref$3=_dereq_("../index_array_type"),TriangleIndexArray=ref$3.TriangleIndexArray,loadGeometry=_dereq_("../load_geometry"),EXTENT=_dereq_("../extent"),earcut=_dereq_("earcut"),classifyRings=_dereq_("../../util/classify_rings"),EARCUT_MAX_RINGS=500,ref$4=_dereq_("../../util/web_worker_transfer"),register=ref$4.register,FACTOR=Math.pow(2,13),HistogramBucket=function(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(function(e){return e.id}),this.index=e.index,this.layoutVertexArray=new HistogramLayoutArray,this.indexArray=new TriangleIndexArray,this.programConfigurations=new ProgramConfigurationSet(layoutAttributes,e.layers,e.zoom),this.segments=new SegmentVector};HistogramBucket.prototype.populate=function(e,r){for(var t=this,a=0,i=e;a<i.length;a+=1){var o=i[a],n=o.feature,u=o.index,s=o.sourceLayerIndex;if(t.layers[0]._featureFilter({zoom:t.zoom},n)){var y=loadGeometry(n);t.addFeature(n,y),r.featureIndex.insert(n,y,u,s,t.index)}}},HistogramBucket.prototype.isEmpty=function(){return 0===this.layoutVertexArray.length},HistogramBucket.prototype.upload=function(e){this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,layoutAttributes),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.programConfigurations.upload(e)},HistogramBucket.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())},HistogramBucket.prototype.addFeature=function(e,r){for(var t=this,a=0,i=classifyRings(r,EARCUT_MAX_RINGS);a<i.length;a+=1){for(var o=i[a],n=0,u=0,s=o;u<s.length;u+=1){n+=s[u].length}for(var y=t.segments.prepareSegment(4,t.layoutVertexArray,t.indexArray),g=0,f=o;g<f.length;g+=1){var x=f[g];if(0!==x.length&&!isEntirelyOutside(x))for(var l=0,d=0;d<x.length;d++){var h=x[d];if(d>=1){var m=x[d-1];if(!isBoundaryEdge(h,m)){y.vertexLength+4>MAX_VERTEX_ARRAY_LENGTH&&(y=t.segments.prepareSegment(4,t.layoutVertexArray,t.indexArray));var A=h.sub(m)._perp()._unit(),c=m.dist(h);l+c>32768&&(l=0),addVertex(t.layoutVertexArray,h.x,h.y,A.x,A.y,0,0,l),addVertex(t.layoutVertexArray,h.x,h.y,A.x,A.y,0,1,l),l+=c,addVertex(t.layoutVertexArray,m.x,m.y,A.x,A.y,0,0,l),addVertex(t.layoutVertexArray,m.x,m.y,A.x,A.y,0,1,l);var p=y.vertexLength;t.indexArray.emplaceBack(p,p+1,p+2),t.indexArray.emplaceBack(p+1,p+2,p+3),y.vertexLength+=4,y.primitiveLength+=2}}}}y.vertexLength+n>MAX_VERTEX_ARRAY_LENGTH&&(y=t.segments.prepareSegment(n,t.layoutVertexArray,t.indexArray));for(var v=[],E=[],V=y.vertexLength,_=0,T=o;_<T.length;_+=1){var B=T[_];if(0!==B.length){B!==o[0]&&E.push(v.length/2);for(var R=0;R<B.length;R++){var H=B[R];addVertex(t.layoutVertexArray,H.x,H.y,0,0,1,1,0),v.push(H.x),v.push(H.y)}}}for(var L=earcut(v,E),X=0;X<L.length;X+=3)t.indexArray.emplaceBack(V+L[X],V+L[X+1],V+L[X+2]);y.primitiveLength+=L.length/3,y.vertexLength+=n}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e)},register("HistogramBucket",HistogramBucket,{omit:["layers"]}),module.exports=HistogramBucket;
},{"../../util/classify_rings":289,"../../util/web_worker_transfer":318,"../array_types":41,"../extent":67,"../index_array_type":69,"../load_geometry":70,"../program_configuration":72,"../segment":74,"./histogram_attributes":54,"earcut":3}],56:[function(_dereq_,module,exports){
"use strict";var ref=_dereq_("../../util/struct_array"),createLayout=ref.createLayout;module.exports=createLayout([{name:"a_pos_normal",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_ext",components:2,type:"Uint16"}],4);
},{"../../util/struct_array":310}],57:[function(_dereq_,module,exports){
"use strict";function addLineVertex(e,t,r,i,a,n,s){e.emplaceBack(t.x,t.y,i?1:0,a?1:-1,Math.round(EXTRUDE_SCALE*r.x)+128,Math.round(EXTRUDE_SCALE*r.y)+128,1+(0===n?0:n<0?-1:1)|(s*LINE_DISTANCE_SCALE&63)<<2,s*LINE_DISTANCE_SCALE>>6,lineHeight>0?50*lineHeight:t.z-500<0?5:t.z-500+5,_percent)}var ref=_dereq_("../array_types"),LineLayoutArray=ref.LineLayoutArray,layoutAttributes=_dereq_("./line_attributes").members,ref$1=_dereq_("../segment"),SegmentVector=ref$1.SegmentVector,ref$2=_dereq_("../program_configuration"),ProgramConfigurationSet=ref$2.ProgramConfigurationSet,ref$3=_dereq_("../index_array_type"),TriangleIndexArray=ref$3.TriangleIndexArray,loadGeometry=_dereq_("../load_geometry"),EXTENT=_dereq_("../extent"),vectorTileFeatureTypes=_dereq_("../../_minemap_/vector-tile").VectorTileFeature.types,ref$4=_dereq_("../../util/web_worker_transfer"),register=ref$4.register,EXTRUDE_SCALE=63,lineHeight=0,_percent=0,COS_HALF_SHARP_CORNER=Math.cos(Math.PI/180*37.5),SHARP_CORNER_OFFSET=15,LINE_DISTANCE_BUFFER_BITS=15,LINE_DISTANCE_SCALE=.5,MAX_LINE_DISTANCE=Math.pow(2,LINE_DISTANCE_BUFFER_BITS-1)/LINE_DISTANCE_SCALE,LineBucket=function(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(function(e){return e.id}),this.index=e.index,this.layoutVertexArray=new LineLayoutArray,this.indexArray=new TriangleIndexArray,this.programConfigurations=new ProgramConfigurationSet(layoutAttributes,e.layers,e.zoom),this.segments=new SegmentVector};LineBucket.prototype.populate=function(e,t){for(var r=this,i=0,a=e;i<a.length;i+=1){var n=a[i],s=n.feature,u=n.index,d=n.sourceLayerIndex;if(r.layers[0]._featureFilter({zoom:r.zoom},s)){var o=loadGeometry(s);r.addFeature(s,o),t.featureIndex.insert(s,o,u,d,r.index)}}},LineBucket.prototype.isEmpty=function(){return 0===this.layoutVertexArray.length},LineBucket.prototype.upload=function(e){this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,layoutAttributes),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.programConfigurations.upload(e)},LineBucket.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())},LineBucket.prototype.addFeature=function(e,t){var r=this,i=this.layers[0].layout,a=i.get("line-join").evaluate(e),n=i.get("line-cap"),s=i.get("line-miter-limit"),u=i.get("line-round-limit");lineHeight=null!==e.properties&&e.properties.hasOwnProperty("ELEV")?e.properties.ELEV:0;for(var d=0,o=t;d<o.length;d+=1){var l=o[d];r.addLine(l,e,a,n,s,u)}},LineBucket.prototype.addLine=function(e,t,r,i,a,n){for(var s=this,u="Polygon"===vectorTileFeatureTypes[t.type],d=e.length;d>=2&&e[d-1].equals(e[d-2]);)d--;for(var o=0;o<d-1&&e[o].equals(e[o+1]);)o++;if(!(d<(u?3:2))){"bevel"===r&&(a=1.05);var l=SHARP_CORNER_OFFSET*(EXTENT/(512*this.overscaling)),h=e[o],c=this.segments.prepareSegment(10*d,this.layoutVertexArray,this.indexArray);this.distance=0;var y,f,p,x=i,_=u?"butt":i,m=!0,g=void 0,L=void 0,v=void 0,E=void 0;this.e1=this.e2=this.e3=-1,u&&(y=e[d-2],E=h.sub(y)._unit()._perp());for(var A=o;A<d;A++)if(_percent=A/d*1e3,!(L=u&&A===d-1?e[o+1]:e[A+1])||!e[A].equals(L)){E&&(v=E),y&&(g=y),y=e[A],E=L?L.sub(y)._unit()._perp():v,v=v||E;var C=v.add(E);0===C.x&&0===C.y||C._unit();var V=C.x*E.x+C.y*E.y,S=0!==V?1/V:1/0,B=V<COS_HALF_SHARP_CORNER&&g&&L;if(B&&A>o){var T=y.dist(g);if(T>2*l){var I=y.sub(y.sub(g)._mult(l/T)._round());s.distance+=I.dist(g),s.addCurrentVertex(I,s.distance,v.mult(1),0,0,!1,c),g=I}}var b=g&&L,N=b?r:L?x:_;if(b&&"round"===N&&(S<n?N="miter":S<=2&&(N="fakeround")),"miter"===N&&S>a&&(N="bevel"),"bevel"===N&&(S>2&&(N="flipbevel"),S<a&&(N="miter")),g&&(s.distance+=y.dist(g)),"miter"===N)C._mult(S),s.addCurrentVertex(y,s.distance,C,0,0,!1,c);else if("flipbevel"===N){if(S>100)C=E.clone().mult(-1);else{var k=v.x*E.y-v.y*E.x>0?-1:1,R=S*v.add(E).mag()/v.sub(E).mag();C._perp()._mult(R*k)}s.addCurrentVertex(y,s.distance,C,0,0,!1,c),s.addCurrentVertex(y,s.distance,C.mult(-1),0,0,!1,c)}else if("bevel"===N||"fakeround"===N){var F=v.x*E.y-v.y*E.x>0,P=-Math.sqrt(S*S-1);if(F?(p=0,f=P):(f=0,p=P),m||s.addCurrentVertex(y,s.distance,v,f,p,!1,c),"fakeround"===N){for(var q=Math.floor(8*(.5-(V-.5))),D=void 0,H=0;H<q;H++)D=E.mult((H+1)/(q+1))._add(v)._unit(),s.addPieSliceVertex(y,s.distance,D,F,c);s.addPieSliceVertex(y,s.distance,C,F,c);for(var M=q-1;M>=0;M--)D=v.mult((M+1)/(q+1))._add(E)._unit(),s.addPieSliceVertex(y,s.distance,D,F,c)}L&&s.addCurrentVertex(y,s.distance,E,-f,-p,!1,c)}else"butt"===N?(m||s.addCurrentVertex(y,s.distance,v,0,0,!1,c),L&&s.addCurrentVertex(y,s.distance,E,0,0,!1,c)):"square"===N?(m||(s.addCurrentVertex(y,s.distance,v,1,1,!1,c),s.e1=s.e2=-1),L&&s.addCurrentVertex(y,s.distance,E,-1,-1,!1,c)):"round"===N&&(m||(s.addCurrentVertex(y,s.distance,v,0,0,!1,c),s.addCurrentVertex(y,s.distance,v,1,1,!0,c),s.e1=s.e2=-1),L&&(s.addCurrentVertex(y,s.distance,E,-1,-1,!0,c),s.addCurrentVertex(y,s.distance,E,0,0,!1,c)));if(B&&A<d-1){var O=y.dist(L);if(O>2*l){var w=y.add(L.sub(y)._mult(l/O)._round());s.distance+=w.dist(y),s.addCurrentVertex(w,s.distance,E.mult(1),0,0,!1,c),y=w}}m=!1}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t)}},LineBucket.prototype.addCurrentVertex=function(e,t,r,i,a,n,s){var u,d=this.layoutVertexArray,o=this.indexArray;u=r.clone(),i&&u._sub(r.perp()._mult(i)),addLineVertex(d,e,u,n,!1,i,t),this.e3=s.vertexLength++,this.e1>=0&&this.e2>=0&&(o.emplaceBack(this.e1,this.e2,this.e3),s.primitiveLength++),this.e1=this.e2,this.e2=this.e3,u=r.mult(-1),a&&u._sub(r.perp()._mult(a)),addLineVertex(d,e,u,n,!0,-a,t),this.e3=s.vertexLength++,this.e1>=0&&this.e2>=0&&(o.emplaceBack(this.e1,this.e2,this.e3),s.primitiveLength++),this.e1=this.e2,this.e2=this.e3,t>MAX_LINE_DISTANCE/2&&(this.distance=0,this.addCurrentVertex(e,this.distance,r,i,a,n,s))},LineBucket.prototype.addPieSliceVertex=function(e,t,r,i,a){r=r.mult(i?-1:1);var n=this.layoutVertexArray,s=this.indexArray;addLineVertex(n,e,r,!1,i,0,t),this.e3=a.vertexLength++,this.e1>=0&&this.e2>=0&&(s.emplaceBack(this.e1,this.e2,this.e3),a.primitiveLength++),i?this.e2=this.e3:this.e1=this.e3},register("LineBucket",LineBucket,{omit:["layers"]}),module.exports=LineBucket;
},{"../../_minemap_/vector-tile":34,"../../util/web_worker_transfer":318,"../array_types":41,"../extent":67,"../index_array_type":69,"../load_geometry":70,"../program_configuration":72,"../segment":74,"./line_attributes":56}],58:[function(_dereq_,module,exports){
"use strict";var ref=_dereq_("../../util/struct_array"),createLayout=ref.createLayout;module.exports=createLayout([{name:"a_pos_normal",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_extra_m",components:3,type:"Uint8"},{name:"a_i_p_e",components:2,type:"Uint16"}],4);
},{"../../util/struct_array":310}],59:[function(_dereq_,module,exports){
"use strict";function addLineVertex(e,t,r,i,a,s,n){e.emplaceBack(t.x,t.y,i?1:0,a?1:-1,Math.round(EXTRUDE_SCALE*r.x)+128,Math.round(EXTRUDE_SCALE*r.y)+128,1+(0===s?0:s<0?-1:1)|(n*LINE_DISTANCE_SCALE&63)<<2,n*LINE_DISTANCE_SCALE>>6,255&curOpacity,parseInt(curNum),parseInt(curStatus),parseInt(0===t.z?0:t.z-500<6?6:t.z-500+6),parseInt(_percent))}var ref=_dereq_("../array_types"),SpriteLayoutArray=ref.SpriteLayoutArray,layoutAttributes=_dereq_("./sprite_attributes").members,ref$1=_dereq_("../segment"),SegmentVector=ref$1.SegmentVector,ref$2=_dereq_("../program_configuration"),ProgramConfigurationSet=ref$2.ProgramConfigurationSet,ref$3=_dereq_("../index_array_type"),TriangleIndexArray=ref$3.TriangleIndexArray,loadGeometry=_dereq_("../load_geometry"),EXTENT=_dereq_("../extent"),vectorTileFeatureTypes=_dereq_("../../_minemap_/vector-tile").VectorTileFeature.types,ref$4=_dereq_("../../util/web_worker_transfer"),register=ref$4.register,EXTRUDE_SCALE=63,COS_HALF_SHARP_CORNER=Math.cos(Math.PI/180*37.5),SHARP_CORNER_OFFSET=15,LINE_DISTANCE_BUFFER_BITS=15,LINE_DISTANCE_SCALE=.5,MAX_LINE_DISTANCE=Math.pow(2,LINE_DISTANCE_BUFFER_BITS-1)/LINE_DISTANCE_SCALE,curOpacity=0,curNum=0,curStatus=1,_percent=0,LineBucket=function(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(function(e){return e.id}),this.index=e.index,this.layoutVertexArray=new SpriteLayoutArray,this.indexArray=new TriangleIndexArray,this.programConfigurations=new ProgramConfigurationSet(layoutAttributes,e.layers,e.zoom),this.segments=new SegmentVector};LineBucket.prototype.populate=function(e,t){for(var r=this,i=0,a=e;i<a.length;i+=1){var s=a[i],n=s.feature,u=s.index,o=s.sourceLayerIndex;if(r.layers[0]._featureFilter({zoom:r.zoom},n)){var d=loadGeometry(n);r.addFeature(n,d),t.featureIndex.insert(n,d,u,o,r.index)}}},LineBucket.prototype.isEmpty=function(){return 0===this.layoutVertexArray.length},LineBucket.prototype.upload=function(e){this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,layoutAttributes),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.programConfigurations.upload(e)},LineBucket.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())},LineBucket.prototype.addFeature=function(e,t){var r=this,i=this.layers[0].layout,a=i.get("sprite-join").evaluate(e),s=i.get("sprite-cap"),n=i.get("sprite-miter-limit"),u=i.get("sprite-round-limit");curNum=e.properties.link_seq?e.properties.link_seq:curNum,curNum%=10,curStatus=e.properties.status||1,_percent=100*e.properties.link_seq/e.properties.total||1;for(var o=0,d=t;o<d.length;o+=1){var c=d[o];r.addLine(c,e,a,s,n,u)}},LineBucket.prototype.addLine=function(e,t,r,i,a,s){for(var n=this,u="Polygon"===vectorTileFeatureTypes[t.type],o=e.length;o>=2&&e[o-1].equals(e[o-2]);)o--;for(var d=0;d<o-1&&e[d].equals(e[d+1]);)d++;if(!(o<(u?3:2))){"bevel"===r&&(a=1.05);var c=SHARP_CORNER_OFFSET*(EXTENT/(512*this.overscaling)),l=e[d],h=this.segments.prepareSegment(10*o,this.layoutVertexArray,this.indexArray);this.distance=0;var p,y,f,x=i,_=u?"butt":i,m=!0,g=void 0,v=void 0,A=void 0,C=void 0;this.e1=this.e2=this.e3=-1,u&&(p=e[o-2],C=l.sub(p)._unit()._perp());for(var L=d;L<o;L++)if(curOpacity=Math.round(255/o*L),!(v=u&&L===o-1?e[d+1]:e[L+1])||!e[L].equals(v)){C&&(A=C),p&&(g=p),p=e[L],C=v?v.sub(p)._unit()._perp():A,A=A||C;var S=A.add(C);0===S.x&&0===S.y||S._unit();var E=S.x*C.x+S.y*C.y,V=0!==E?1/E:1/0,I=E<COS_HALF_SHARP_CORNER&&g&&v;if(I&&L>d){var B=p.dist(g);if(B>2*c){var N=p.sub(p.sub(g)._mult(c/B)._round());n.distance+=N.dist(g),n.addCurrentVertex(N,n.distance,A.mult(1),0,0,!1,h),g=N}}var T=g&&v,k=T?r:v?x:_;if(T&&"round"===k&&(V<s?k="miter":V<=2&&(k="fakeround")),"miter"===k&&V>a&&(k="bevel"),"bevel"===k&&(V>2&&(k="flipbevel"),V<a&&(k="miter")),g&&(n.distance+=p.dist(g)),"miter"===k)S._mult(V),n.addCurrentVertex(p,n.distance,S,0,0,!1,h);else if("flipbevel"===k){if(V>100)S=C.clone().mult(-1);else{var b=A.x*C.y-A.y*C.x>0?-1:1,q=V*A.add(C).mag()/A.sub(C).mag();S._perp()._mult(q*b)}n.addCurrentVertex(p,n.distance,S,0,0,!1,h),n.addCurrentVertex(p,n.distance,S.mult(-1),0,0,!1,h)}else if("bevel"===k||"fakeround"===k){var R=A.x*C.y-A.y*C.x>0,F=-Math.sqrt(V*V-1);if(R?(f=0,y=F):(y=0,f=F),m||n.addCurrentVertex(p,n.distance,A,y,f,!1,h),"fakeround"===k){for(var P=Math.floor(8*(.5-(E-.5))),D=void 0,O=0;O<P;O++)D=C.mult((O+1)/(P+1))._add(A)._unit(),n.addPieSliceVertex(p,n.distance,D,R,h);n.addPieSliceVertex(p,n.distance,S,R,h);for(var M=P-1;M>=0;M--)D=A.mult((M+1)/(P+1))._add(C)._unit(),n.addPieSliceVertex(p,n.distance,D,R,h)}v&&n.addCurrentVertex(p,n.distance,C,-y,-f,!1,h)}else"butt"===k?(m||n.addCurrentVertex(p,n.distance,A,0,0,!1,h),v&&n.addCurrentVertex(p,n.distance,C,0,0,!1,h)):"square"===k?(m||(n.addCurrentVertex(p,n.distance,A,1,1,!1,h),n.e1=n.e2=-1),v&&n.addCurrentVertex(p,n.distance,C,-1,-1,!1,h)):"round"===k&&(m||(n.addCurrentVertex(p,n.distance,A,0,0,!1,h),n.addCurrentVertex(p,n.distance,A,1,1,!0,h),n.e1=n.e2=-1),v&&(n.addCurrentVertex(p,n.distance,C,-1,-1,!0,h),n.addCurrentVertex(p,n.distance,C,0,0,!1,h)));if(I&&L<o-1){var z=p.dist(v);if(z>2*c){var $=p.add(v.sub(p)._mult(c/z)._round());n.distance+=$.dist(p),n.addCurrentVertex($,n.distance,C.mult(1),0,0,!1,h),p=$}}m=!1}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t)}},LineBucket.prototype.addCurrentVertex=function(e,t,r,i,a,s,n){var u,o=this.layoutVertexArray,d=this.indexArray;u=r.clone(),i&&u._sub(r.perp()._mult(i)),addLineVertex(o,e,u,s,!1,i,t),this.e3=n.vertexLength++,this.e1>=0&&this.e2>=0&&(d.emplaceBack(this.e1,this.e2,this.e3),n.primitiveLength++),this.e1=this.e2,this.e2=this.e3,u=r.mult(-1),a&&u._sub(r.perp()._mult(a)),addLineVertex(o,e,u,s,!0,-a,t),this.e3=n.vertexLength++,this.e1>=0&&this.e2>=0&&(d.emplaceBack(this.e1,this.e2,this.e3),n.primitiveLength++),this.e1=this.e2,this.e2=this.e3,t>MAX_LINE_DISTANCE/2&&(this.distance=0,this.addCurrentVertex(e,this.distance,r,i,a,s,n))},LineBucket.prototype.addPieSliceVertex=function(e,t,r,i,a){r=r.mult(i?-1:1);var s=this.layoutVertexArray,n=this.indexArray;addLineVertex(s,e,r,!1,i,0,t),this.e3=a.vertexLength++,this.e1>=0&&this.e2>=0&&(n.emplaceBack(this.e1,this.e2,this.e3),a.primitiveLength++),i?this.e2=this.e3:this.e1=this.e3},register("SpriteBucket",LineBucket,{omit:["layers"]}),module.exports=LineBucket;
},{"../../_minemap_/vector-tile":34,"../../util/web_worker_transfer":318,"../array_types":41,"../extent":67,"../index_array_type":69,"../load_geometry":70,"../program_configuration":72,"../segment":74,"./sprite_attributes":58}],60:[function(_dereq_,module,exports){
"use strict";var ref=_dereq_("../../util/struct_array"),createLayout=ref.createLayout,symbolLayoutAttributes=createLayout([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_height",components:1,type:"Uint16"}]),dynamicLayoutAttributes=createLayout([{name:"a_projected_pos",components:3,type:"Float32"}],4),placementOpacityAttributes=createLayout([{name:"a_fade_opacity",components:1,type:"Uint32"}],4),collisionVertexAttributes=createLayout([{name:"a_placed",components:2,type:"Uint8"}],4),symbolAttributes={symbolLayoutAttributes:symbolLayoutAttributes,dynamicLayoutAttributes:dynamicLayoutAttributes,placementOpacityAttributes:placementOpacityAttributes,collisionVertexAttributes:collisionVertexAttributes,collisionBox:createLayout([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"},{type:"Int16",name:"radius"},{type:"Int16",name:"signedDistanceFromAnchor"}]),collisionBoxLayout:createLayout([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),collisionCircleLayout:createLayout([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),placement:createLayout([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"hidden"}]),glyphOffset:createLayout([{type:"Float32",name:"offsetX"}]),lineVertex:createLayout([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}])};module.exports=symbolAttributes;
},{"../../util/struct_array":310}],61:[function(_dereq_,module,exports){
"use strict";function addVertex(e,t,r,o,i,a,n,s,l){e.emplaceBack(t,r,Math.round(32*o),Math.round(32*i),a,n,s?s[0]:0,s?s[1]:0,l)}function addDynamicAttributes(e,t,r){e.emplaceBack(t.x,t.y,r),e.emplaceBack(t.x,t.y,r),e.emplaceBack(t.x,t.y,r),e.emplaceBack(t.x,t.y,r)}var ref=_dereq_("./symbol_attributes"),symbolLayoutAttributes=ref.symbolLayoutAttributes,collisionVertexAttributes=ref.collisionVertexAttributes,collisionBoxLayout=ref.collisionBoxLayout,collisionCircleLayout=ref.collisionCircleLayout,dynamicLayoutAttributes=ref.dynamicLayoutAttributes,ref$1=_dereq_("../array_types"),SymbolLayoutArray=ref$1.SymbolLayoutArray,SymbolDynamicLayoutArray=ref$1.SymbolDynamicLayoutArray,SymbolOpacityArray=ref$1.SymbolOpacityArray,CollisionBoxLayoutArray=ref$1.CollisionBoxLayoutArray,CollisionCircleLayoutArray=ref$1.CollisionCircleLayoutArray,CollisionVertexArray=ref$1.CollisionVertexArray,PlacedSymbolArray=ref$1.PlacedSymbolArray,GlyphOffsetArray=ref$1.GlyphOffsetArray,SymbolLineVertexArray=ref$1.SymbolLineVertexArray,Point=_dereq_("../../_minemap_/point-geometry"),ref$2=_dereq_("../segment"),SegmentVector=ref$2.SegmentVector,ref$3=_dereq_("../program_configuration"),ProgramConfigurationSet=ref$3.ProgramConfigurationSet,ref$4=_dereq_("../index_array_type"),TriangleIndexArray=ref$4.TriangleIndexArray,LineIndexArray=ref$4.LineIndexArray,transformText=_dereq_("../../symbol/transform_text"),mergeLines=_dereq_("../../symbol/mergelines"),scriptDetection=_dereq_("../../util/script_detection"),loadGeometry=_dereq_("../load_geometry"),vectorTileFeatureTypes=_dereq_("../../_minemap_/vector-tile").VectorTileFeature.types,verticalizePunctuation=_dereq_("../../util/verticalize_punctuation"),Anchor=_dereq_("../../symbol/anchor"),ref$5=_dereq_("../../symbol/symbol_size"),getSizeData=ref$5.getSizeData,ref$6=_dereq_("../../util/web_worker_transfer"),register=ref$6.register,shaderOpacityAttributes=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}],SymbolBuffers=function(e){this.layoutVertexArray=new SymbolLayoutArray,this.indexArray=new TriangleIndexArray,this.programConfigurations=e,this.segments=new SegmentVector,this.dynamicLayoutVertexArray=new SymbolDynamicLayoutArray,this.opacityVertexArray=new SymbolOpacityArray,this.placedSymbolArray=new PlacedSymbolArray};SymbolBuffers.prototype.upload=function(e,t){this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,symbolLayoutAttributes.members),this.indexBuffer=e.createIndexBuffer(this.indexArray,t),this.programConfigurations.upload(e),this.dynamicLayoutVertexBuffer=e.createVertexBuffer(this.dynamicLayoutVertexArray,dynamicLayoutAttributes.members,!0),this.opacityVertexBuffer=e.createVertexBuffer(this.opacityVertexArray,shaderOpacityAttributes,!0),this.opacityVertexBuffer.itemSize=1},SymbolBuffers.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())},register("SymbolBuffers",SymbolBuffers);var CollisionBuffers=function(e,t,r){this.layoutVertexArray=new e,this.layoutAttributes=t,this.indexArray=new r,this.segments=new SegmentVector,this.collisionVertexArray=new CollisionVertexArray};CollisionBuffers.prototype.upload=function(e){this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=e.createVertexBuffer(this.collisionVertexArray,collisionVertexAttributes.members,!0)},CollisionBuffers.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())},register("CollisionBuffers",CollisionBuffers);var SymbolBucket=function(e){this.collisionBoxArray=e.collisionBoxArray,this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(function(e){return e.id}),this.index=e.index,this.pixelRatio=e.pixelRatio;var t=this.layers[0],r=t._unevaluatedLayout._values;this.textSizeData=getSizeData(this.zoom,r["text-size"]),this.iconSizeData=getSizeData(this.zoom,r["icon-size"]);var o=this.layers[0].layout;this.sortFeaturesByY=o.get("text-allow-overlap")||o.get("icon-allow-overlap")||o.get("text-ignore-placement")||o.get("icon-ignore-placement")};SymbolBucket.prototype.createArrays=function(){this.text=new SymbolBuffers(new ProgramConfigurationSet(symbolLayoutAttributes.members,this.layers,this.zoom,function(e){return/^text/.test(e)})),this.icon=new SymbolBuffers(new ProgramConfigurationSet(symbolLayoutAttributes.members,this.layers,this.zoom,function(e){return/^icon/.test(e)})),this.collisionBox=new CollisionBuffers(CollisionBoxLayoutArray,collisionBoxLayout.members,LineIndexArray),this.collisionCircle=new CollisionBuffers(CollisionCircleLayoutArray,collisionCircleLayout.members,TriangleIndexArray),this.glyphOffsetArray=new GlyphOffsetArray,this.lineVertexArray=new SymbolLineVertexArray},SymbolBucket.prototype.populate=function(e,t){var r=this,o=this.layers[0],i=o.layout,a=i.get("text-font"),n=i.get("text-field"),s=i.get("icon-image"),l=("constant"!==n.value.kind||n.value.value.length>0)&&("constant"!==a.value.kind||a.value.value.length>0),y="constant"!==s.value.kind||s.value.value&&s.value.value.length>0;if(this.features=[],l||y){for(var c=t.iconDependencies,u=t.glyphDependencies,x={zoom:this.zoom},f=0,h=e;f<h.length;f+=1){var m=h[f],d=m.feature,p=m.index,g=m.sourceLayerIndex;if(o._featureFilter(x,d)){var A=void 0;l&&(A=o.getValueAndResolveTokens("text-field",d),A=transformText(A,o,d));var b=void 0;if(y&&(b=o.getValueAndResolveTokens("icon-image",d)),A||b){var B={text:A,icon:b,index:p,sourceLayerIndex:g,geometry:loadGeometry(d),properties:d.properties,type:vectorTileFeatureTypes[d.type]};if(void 0!==d.id&&(B.id=d.id),r.features.push(B),b&&(c[b]=!0),A)for(var v=a.evaluate(d).join(","),S=u[v]=u[v]||{},V="map"===i.get("text-rotation-alignment")&&"line"===i.get("symbol-placement"),C=scriptDetection.allowsVerticalWritingMode(A),k=0;k<A.length;k++)if(S[A.charCodeAt(k)]=!0,V&&C){var L=verticalizePunctuation.lookup[A.charAt(k)];L&&(S[L.charCodeAt(0)]=!0)}}}}"line"===i.get("symbol-placement")&&(this.features=mergeLines(this.features))}},SymbolBucket.prototype.isEmpty=function(){return 0===this.symbolInstances.length},SymbolBucket.prototype.upload=function(e){this.text.upload(e,this.sortFeaturesByY),this.icon.upload(e,this.sortFeaturesByY),this.collisionBox.upload(e),this.collisionCircle.upload(e)},SymbolBucket.prototype.destroy=function(){this.text.destroy(),this.icon.destroy(),this.collisionBox.destroy(),this.collisionCircle.destroy()},SymbolBucket.prototype.addToLineVertexArray=function(e,t){var r=this,o=this.lineVertexArray.length;if(void 0!==e.segment){for(var i=e.dist(t[e.segment+1]),a=e.dist(t[e.segment]),n={},s=e.segment+1;s<t.length;s++)n[s]={x:t[s].x,y:t[s].y,tileUnitDistanceFromAnchor:i},s<t.length-1&&(i+=t[s+1].dist(t[s]));for(var l=e.segment||0;l>=0;l--)n[l]={x:t[l].x,y:t[l].y,tileUnitDistanceFromAnchor:a},l>0&&(a+=t[l-1].dist(t[l]));for(var y=0;y<t.length;y++){var c=n[y];r.lineVertexArray.emplaceBack(c.x,c.y,c.tileUnitDistanceFromAnchor)}}return{lineStartIndex:o,lineLength:this.lineVertexArray.length-o}},SymbolBucket.prototype.addSymbols=function(e,t,r,o,i,a,n,s,l,y){for(var c=this,u=e.indexArray,x=e.layoutVertexArray,f=e.dynamicLayoutVertexArray,h=e.segments.prepareSegment(4*t.length,e.layoutVertexArray,e.indexArray),m=this.glyphOffsetArray.length,d=h.vertexLength,p=0,g=t;p<g.length;p+=1){var A=g[p],b=A.tl,B=A.tr,v=A.bl,S=A.br,V=A.tex,C=h.vertexLength,k=A.glyphOffset[1],L=null!==a.properties&&void 0!==a.properties&&a.properties.hasOwnProperty("levels")?a.properties.levels:0;addVertex(x,s.x,s.y,b.x,k+b.y,V.x,V.y,r,L),addVertex(x,s.x,s.y,B.x,k+B.y,V.x+V.w,V.y,r,L),addVertex(x,s.x,s.y,v.x,k+v.y,V.x,V.y+V.h,r,L),addVertex(x,s.x,s.y,S.x,k+S.y,V.x+V.w,V.y+V.h,r,L),addDynamicAttributes(f,s,0),u.emplaceBack(C,C+1,C+2),u.emplaceBack(C+1,C+2,C+3),h.vertexLength+=4,h.primitiveLength+=2,c.glyphOffsetArray.emplaceBack(A.glyphOffset[0])}e.placedSymbolArray.emplaceBack(s.x,s.y,m,this.glyphOffsetArray.length-m,d,l,y,s.segment,r?r[0]:0,r?r[1]:0,o[0],o[1],n,!1),e.programConfigurations.populatePaintArrays(e.layoutVertexArray.length,a)},SymbolBucket.prototype._addCollisionDebugVertex=function(e,t,r,o,i){return t.emplaceBack(0,0),e.emplaceBack(r.x,r.y,o.x,o.y,Math.round(i.x),Math.round(i.y))},SymbolBucket.prototype.addCollisionDebugVertices=function(e,t,r,o,i,a,n,s){var l=i.segments.prepareSegment(4,i.layoutVertexArray,i.indexArray),y=l.vertexLength,c=i.layoutVertexArray,u=i.collisionVertexArray;if(this._addCollisionDebugVertex(c,u,a,n.anchor,new Point(e,t)),this._addCollisionDebugVertex(c,u,a,n.anchor,new Point(r,t)),this._addCollisionDebugVertex(c,u,a,n.anchor,new Point(r,o)),this._addCollisionDebugVertex(c,u,a,n.anchor,new Point(e,o)),l.vertexLength+=4,s){var x=i.indexArray;x.emplaceBack(y,y+1,y+2),x.emplaceBack(y,y+2,y+3),l.primitiveLength+=2}else{var f=i.indexArray;f.emplaceBack(y,y+1),f.emplaceBack(y+1,y+2),f.emplaceBack(y+2,y+3),f.emplaceBack(y+3,y),l.primitiveLength+=4}},SymbolBucket.prototype.generateCollisionDebugBuffers=function(){for(var e=this,t=0,r=e.symbolInstances;t<r.length;t+=1){var o=r[t];o.textCollisionFeature={boxStartIndex:o.textBoxStartIndex,boxEndIndex:o.textBoxEndIndex},o.iconCollisionFeature={boxStartIndex:o.iconBoxStartIndex,boxEndIndex:o.iconBoxEndIndex};for(var i=0;i<2;i++){var a=o[0===i?"textCollisionFeature":"iconCollisionFeature"];if(a)for(var n=a.boxStartIndex;n<a.boxEndIndex;n++){var s=e.collisionBoxArray.get(n),l=s.x1,y=s.y1,c=s.x2,u=s.y2,x=s.radius>0;e.addCollisionDebugVertices(l,y,c,u,x?e.collisionCircle:e.collisionBox,s.anchorPoint,o,x)}}}},SymbolBucket.prototype.deserializeCollisionBoxes=function(e,t,r,o,i){for(var a={},n=t;n<r;n++){var s=e.get(n);if(0===s.radius){a.textBox={x1:s.x1,y1:s.y1,x2:s.x2,y2:s.y2,anchorPointX:s.anchorPointX,anchorPointY:s.anchorPointY};break}a.textCircles||(a.textCircles=[]);a.textCircles.push(s.anchorPointX,s.anchorPointY,s.radius,s.signedDistanceFromAnchor,1)}for(var l=o;l<i;l++){var y=e.get(l);if(0===y.radius){a.iconBox={x1:y.x1,y1:y.y1,x2:y.x2,y2:y.y2,anchorPointX:y.anchorPointX,anchorPointY:y.anchorPointY};break}}return a},SymbolBucket.prototype.hasTextData=function(){return this.text.segments.get().length>0},SymbolBucket.prototype.hasIconData=function(){return this.icon.segments.get().length>0},SymbolBucket.prototype.hasCollisionBoxData=function(){return this.collisionBox.segments.get().length>0},SymbolBucket.prototype.hasCollisionCircleData=function(){return this.collisionCircle.segments.get().length>0},SymbolBucket.prototype.sortFeatures=function(e){var t=this;if(this.sortFeaturesByY&&this.sortedAngle!==e&&(this.sortedAngle=e,!(this.text.segments.get().length>1||this.icon.segments.get().length>1))){for(var r=[],o=0;o<this.symbolInstances.length;o++)r.push(o);var i=Math.sin(e),a=Math.cos(e);r.sort(function(e,r){var o=t.symbolInstances[e],n=t.symbolInstances[r];return(i*o.anchor.x+a*o.anchor.y|0)-(i*n.anchor.x+a*n.anchor.y|0)||n.featureIndex-o.featureIndex}),this.text.indexArray.clear(),this.icon.indexArray.clear();for(var n=0,s=r;n<s.length;n+=1){for(var l=s[n],y=t.symbolInstances[l],c=0,u=y.placedTextSymbolIndices;c<u.length;c+=1)for(var x=u[c],f=t.text.placedSymbolArray.get(x),h=f.vertexStartIndex+4*f.numGlyphs,m=f.vertexStartIndex;m<h;m+=4)t.text.indexArray.emplaceBack(m,m+1,m+2),t.text.indexArray.emplaceBack(m+1,m+2,m+3);var d=t.icon.placedSymbolArray.get(l);if(d.numGlyphs){var p=d.vertexStartIndex;t.icon.indexArray.emplaceBack(p,p+1,p+2),t.icon.indexArray.emplaceBack(p+1,p+2,p+3)}}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}},register("SymbolBucket",SymbolBucket,{omit:["layers","collisionBoxArray","features","compareText"],shallow:["symbolInstances"]}),SymbolBucket.MAX_GLYPHS=65535,SymbolBucket.addDynamicAttributes=addDynamicAttributes,module.exports=SymbolBucket;
},{"../../_minemap_/point-geometry":29,"../../_minemap_/vector-tile":34,"../../symbol/anchor":245,"../../symbol/mergelines":253,"../../symbol/symbol_size":260,"../../symbol/transform_text":261,"../../util/script_detection":307,"../../util/verticalize_punctuation":317,"../../util/web_worker_transfer":318,"../array_types":41,"../index_array_type":69,"../load_geometry":70,"../program_configuration":72,"../segment":74,"./symbol_attributes":60}],62:[function(_dereq_,module,exports){
"use strict";var ref=_dereq_("../../util/struct_array"),createLayout=ref.createLayout,symbolLayoutAttributes=createLayout([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_extra",components:2,type:"Uint16"}]),dynamicLayoutAttributes=createLayout([{name:"a_projected_pos",components:3,type:"Float32"}],4),placementOpacityAttributes=createLayout([{name:"a_fade_opacity",components:1,type:"Uint32"}],4),collisionVertexAttributes=createLayout([{name:"a_placed",components:2,type:"Uint8"}],4),symbolAttributes={symbolLayoutAttributes:symbolLayoutAttributes,dynamicLayoutAttributes:dynamicLayoutAttributes,placementOpacityAttributes:placementOpacityAttributes,collisionVertexAttributes:collisionVertexAttributes,collisionBox:createLayout([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"},{type:"Int16",name:"radius"},{type:"Int16",name:"signedDistanceFromAnchor"}]),collisionBoxLayout:createLayout([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),collisionCircleLayout:createLayout([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),placement:createLayout([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"hidden"}]),glyphOffset:createLayout([{type:"Float32",name:"offsetX"}]),lineVertex:createLayout([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}])};module.exports=symbolAttributes;
},{"../../util/struct_array":310}],63:[function(_dereq_,module,exports){
"use strict";function addVertex(e,t,r,i,o,a,n,s,y,l){e.emplaceBack(t,r,Math.round(32*i),Math.round(32*o),a,n,s?s[0]:0,s?s[1]:0,y,0===l?0:l-500<0?5:l-500+5)}function addDynamicAttributes(e,t,r){e.emplaceBack(t.x,t.y,r),e.emplaceBack(t.x,t.y,r),e.emplaceBack(t.x,t.y,r),e.emplaceBack(t.x,t.y,r)}var ref=_dereq_("./symtracking_attributes"),symbolLayoutAttributes=ref.symbolLayoutAttributes,collisionVertexAttributes=ref.collisionVertexAttributes,collisionBoxLayout=ref.collisionBoxLayout,collisionCircleLayout=ref.collisionCircleLayout,dynamicLayoutAttributes=ref.dynamicLayoutAttributes,ref$1=_dereq_("../array_types"),SymtrackingLayoutArray=ref$1.SymtrackingLayoutArray,SymtrackingDynamicLayoutArray=ref$1.SymtrackingDynamicLayoutArray,SymbolOpacityArray=ref$1.SymbolOpacityArray,CollisionBoxLayoutArray=ref$1.CollisionBoxLayoutArray,CollisionCircleLayoutArray=ref$1.CollisionCircleLayoutArray,CollisionVertexArray=ref$1.CollisionVertexArray,PlacedSymbolArray=ref$1.PlacedSymbolArray,GlyphOffsetArray=ref$1.GlyphOffsetArray,SymbolLineVertexArray=ref$1.SymbolLineVertexArray,Point=_dereq_("../../_minemap_/point-geometry"),ref$2=_dereq_("../segment"),SegmentVector=ref$2.SegmentVector,ref$3=_dereq_("../program_configuration"),ProgramConfigurationSet=ref$3.ProgramConfigurationSet,ref$4=_dereq_("../index_array_type"),TriangleIndexArray=ref$4.TriangleIndexArray,LineIndexArray=ref$4.LineIndexArray,transformText=_dereq_("../../symbol/transform_text"),scriptDetection=_dereq_("../../util/script_detection"),loadGeometry=_dereq_("../load_geometry"),vectorTileFeatureTypes=_dereq_("../../_minemap_/vector-tile").VectorTileFeature.types,verticalizePunctuation=_dereq_("../../util/verticalize_punctuation"),Anchor=_dereq_("../../symbol/anchor"),ref$5=_dereq_("../../symbol/symbol_size"),getSizeData=ref$5.getSizeData,ref$6=_dereq_("../../util/web_worker_transfer"),register=ref$6.register,shaderOpacityAttributes=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}],SymtrackingBuffers=function(e){this.layoutVertexArray=new SymtrackingLayoutArray,this.indexArray=new TriangleIndexArray,this.programConfigurations=e,this.segments=new SegmentVector,this.dynamicLayoutVertexArray=new SymtrackingDynamicLayoutArray,this.opacityVertexArray=new SymbolOpacityArray,this.placedSymbolArray=new PlacedSymbolArray};SymtrackingBuffers.prototype.upload=function(e,t){this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,symbolLayoutAttributes.members),this.indexBuffer=e.createIndexBuffer(this.indexArray,t),this.programConfigurations.upload(e),this.dynamicLayoutVertexBuffer=e.createVertexBuffer(this.dynamicLayoutVertexArray,dynamicLayoutAttributes.members,!0),this.opacityVertexBuffer=e.createVertexBuffer(this.opacityVertexArray,shaderOpacityAttributes,!0),this.opacityVertexBuffer.itemSize=1},SymtrackingBuffers.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())},register("SymtrackingBuffers",SymtrackingBuffers);var CollisionBufferst=function(e,t,r){this.layoutVertexArray=new e,this.layoutAttributes=t,this.indexArray=new r,this.segments=new SegmentVector,this.collisionVertexArray=new CollisionVertexArray};CollisionBufferst.prototype.upload=function(e){this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=e.createVertexBuffer(this.collisionVertexArray,collisionVertexAttributes.members,!0)},CollisionBufferst.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())},register("CollisionBufferst",CollisionBufferst);var SymtrackingBucket=function(e){this.collisionBoxArray=e.collisionBoxArray,this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(function(e){return e.id}),this.index=e.index,this.pixelRatio=e.pixelRatio;var t=this.layers[0],r=t._unevaluatedLayout._values;this.textSizeData=getSizeData(this.zoom,r["text-size"]),this.iconSizeData=getSizeData(this.zoom,r["icon-size"]);var i=this.layers[0].layout;this.sortFeaturesByY=i.get("text-allow-overlap")||i.get("icon-allow-overlap")||i.get("text-ignore-placement")||i.get("icon-ignore-placement")};SymtrackingBucket.prototype.createArrays=function(){this.text=new SymtrackingBuffers(new ProgramConfigurationSet(symbolLayoutAttributes.members,this.layers,this.zoom,function(e){return/^text/.test(e)})),this.icon=new SymtrackingBuffers(new ProgramConfigurationSet(symbolLayoutAttributes.members,this.layers,this.zoom,function(e){return/^icon/.test(e)})),this.collisionBox=new CollisionBufferst(CollisionBoxLayoutArray,collisionBoxLayout.members,LineIndexArray),this.collisionCircle=new CollisionBufferst(CollisionCircleLayoutArray,collisionCircleLayout.members,TriangleIndexArray),this.glyphOffsetArray=new GlyphOffsetArray,this.lineVertexArray=new SymbolLineVertexArray},SymtrackingBucket.prototype.populate=function(e,t){var r=this,i=this.layers[0],o=i.layout,a=o.get("text-font"),n=o.get("text-field"),s=o.get("icon-image"),y=("constant"!==n.value.kind||n.value.value.length>0)&&("constant"!==a.value.kind||a.value.value.length>0),l="constant"!==s.value.kind||s.value.value&&s.value.value.length>0;if(this.features=[],y||l)for(var c=t.iconDependencies,u=t.glyphDependencies,x={zoom:this.zoom},f=0,h=e;f<h.length;f+=1){var m=h[f],d=m.feature,g=m.index,p=m.sourceLayerIndex;if(i._featureFilter(x,d)){var A=void 0;y&&(A=i.getValueAndResolveTokens("text-field",d),A=transformText(A,i,d));var B=void 0;if(l&&(B=i.getValueAndResolveTokens("icon-image",d)),A||B){var k={text:A,icon:B,index:g,sourceLayerIndex:p,geometry:loadGeometry(d),properties:d.properties,type:vectorTileFeatureTypes[d.type]};if(void 0!==d.id&&(k.id=d.id),r.features.push(k),B&&(c[B]=!0),A)for(var v=a.evaluate(d).join(","),b=u[v]=u[v]||{},S=(scriptDetection.allowsVerticalWritingMode(A),0);S<A.length;S++){b[A.charCodeAt(S)]=!0}}}}},SymtrackingBucket.prototype.isEmpty=function(){return 0===this.symbolInstances.length},SymtrackingBucket.prototype.upload=function(e){this.text.upload(e,this.sortFeaturesByY),this.icon.upload(e,this.sortFeaturesByY),this.collisionBox.upload(e),this.collisionCircle.upload(e)},SymtrackingBucket.prototype.destroy=function(){this.text.destroy(),this.icon.destroy(),this.collisionBox.destroy(),this.collisionCircle.destroy()},SymtrackingBucket.prototype.addToLineVertexArray=function(e,t){var r=this,i=this.lineVertexArray.length;if(void 0!==e.segment){for(var o=e.dist(t[e.segment+1]),a=e.dist(t[e.segment]),n={},s=e.segment+1;s<t.length;s++)n[s]={x:t[s].x,y:t[s].y,tileUnitDistanceFromAnchor:o},s<t.length-1&&(o+=t[s+1].dist(t[s]));for(var y=e.segment||0;y>=0;y--)n[y]={x:t[y].x,y:t[y].y,tileUnitDistanceFromAnchor:a},y>0&&(a+=t[y-1].dist(t[y]));for(var l=0;l<t.length;l++){var c=n[l];r.lineVertexArray.emplaceBack(c.x,c.y,c.tileUnitDistanceFromAnchor)}}return{lineStartIndex:i,lineLength:this.lineVertexArray.length-i}},SymtrackingBucket.prototype.addSymbols=function(e,t,r,i,o,a,n,s,y,l){for(var c=this,u=e.indexArray,x=e.layoutVertexArray,f=e.dynamicLayoutVertexArray,h=e.segments.prepareSegment(4*t.length,e.layoutVertexArray,e.indexArray),m=this.glyphOffsetArray.length,d=h.vertexLength,g=0,p=t;g<p.length;g+=1){var A=p[g],B=A.tl,k=A.tr,v=A.bl,b=A.br,S=A.tex,V=h.vertexLength,C=A.glyphOffset[1];addVertex(x,s.x,s.y,B.x,C+B.y,S.x,S.y,r,a.properties.link_seq,a.geometry[0][0].z),addVertex(x,s.x,s.y,k.x,C+k.y,S.x+S.w,S.y,r,a.properties.link_seq,a.geometry[0][0].z),addVertex(x,s.x,s.y,v.x,C+v.y,S.x,S.y+S.h,r,a.properties.link_seq,a.geometry[0][0].z),addVertex(x,s.x,s.y,b.x,C+b.y,S.x+S.w,S.y+S.h,r,a.properties.link_seq,a.geometry[0][0].z),addDynamicAttributes(f,s,0),u.emplaceBack(V,V+1,V+2),u.emplaceBack(V+1,V+2,V+3),h.vertexLength+=4,h.primitiveLength+=2,c.glyphOffsetArray.emplaceBack(A.glyphOffset[0])}e.placedSymbolArray.emplaceBack(s.x,s.y,m,this.glyphOffsetArray.length-m,d,y,l,s.segment,r?r[0]:0,r?r[1]:0,i[0],i[1],n,!1),e.programConfigurations.populatePaintArrays(e.layoutVertexArray.length,a)},SymtrackingBucket.prototype._addCollisionDebugVertex=function(e,t,r,i,o){return t.emplaceBack(0,0),e.emplaceBack(r.x,r.y,i.x,i.y,Math.round(o.x),Math.round(o.y))},SymtrackingBucket.prototype.addCollisionDebugVertices=function(e,t,r,i,o,a,n,s){var y=o.segments.prepareSegment(4,o.layoutVertexArray,o.indexArray),l=y.vertexLength,c=o.layoutVertexArray,u=o.collisionVertexArray;if(this._addCollisionDebugVertex(c,u,a,n.anchor,new Point(e,t)),this._addCollisionDebugVertex(c,u,a,n.anchor,new Point(r,t)),this._addCollisionDebugVertex(c,u,a,n.anchor,new Point(r,i)),this._addCollisionDebugVertex(c,u,a,n.anchor,new Point(e,i)),y.vertexLength+=4,s){var x=o.indexArray;x.emplaceBack(l,l+1,l+2),x.emplaceBack(l,l+2,l+3),y.primitiveLength+=2}else{var f=o.indexArray;f.emplaceBack(l,l+1),f.emplaceBack(l+1,l+2),f.emplaceBack(l+2,l+3),f.emplaceBack(l+3,l),y.primitiveLength+=4}},SymtrackingBucket.prototype.generateCollisionDebugBuffers=function(){for(var e=this,t=0,r=e.symbolInstances;t<r.length;t+=1){var i=r[t];i.textCollisionFeature={boxStartIndex:i.textBoxStartIndex,boxEndIndex:i.textBoxEndIndex},i.iconCollisionFeature={boxStartIndex:i.iconBoxStartIndex,boxEndIndex:i.iconBoxEndIndex};for(var o=0;o<2;o++){var a=i[0===o?"textCollisionFeature":"iconCollisionFeature"];if(a)for(var n=a.boxStartIndex;n<a.boxEndIndex;n++){var s=e.collisionBoxArray.get(n),y=s.x1,l=s.y1,c=s.x2,u=s.y2,x=s.radius>0;e.addCollisionDebugVertices(y,l,c,u,x?e.collisionCircle:e.collisionBox,s.anchorPoint,i,x)}}}},SymtrackingBucket.prototype.deserializeCollisionBoxes=function(e,t,r,i,o){for(var a={},n=t;n<r;n++){var s=e.get(n);if(0===s.radius){a.textBox={x1:s.x1,y1:s.y1,x2:s.x2,y2:s.y2,anchorPointX:s.anchorPointX,anchorPointY:s.anchorPointY};break}a.textCircles||(a.textCircles=[]);a.textCircles.push(s.anchorPointX,s.anchorPointY,s.radius,s.signedDistanceFromAnchor,1)}for(var y=i;y<o;y++){var l=e.get(y);if(0===l.radius){a.iconBox={x1:l.x1,y1:l.y1,x2:l.x2,y2:l.y2,anchorPointX:l.anchorPointX,anchorPointY:l.anchorPointY};break}}return a},SymtrackingBucket.prototype.hasTextData=function(){return this.text.segments.get().length>0},SymtrackingBucket.prototype.hasIconData=function(){return this.icon.segments.get().length>0},SymtrackingBucket.prototype.hasCollisionBoxData=function(){return this.collisionBox.segments.get().length>0},SymtrackingBucket.prototype.hasCollisionCircleData=function(){return this.collisionCircle.segments.get().length>0},SymtrackingBucket.prototype.sortFeatures=function(e){var t=this;if(this.sortFeaturesByY&&this.sortedAngle!==e&&(this.sortedAngle=e,!(this.text.segments.get().length>1||this.icon.segments.get().length>1))){for(var r=[],i=0;i<this.symbolInstances.length;i++)r.push(i);var o=Math.sin(e),a=Math.cos(e);r.sort(function(e,r){var i=t.symbolInstances[e],n=t.symbolInstances[r];return(o*i.anchor.x+a*i.anchor.y|0)-(o*n.anchor.x+a*n.anchor.y|0)||n.featureIndex-i.featureIndex}),this.text.indexArray.clear(),this.icon.indexArray.clear();for(var n=0,s=r;n<s.length;n+=1){for(var y=s[n],l=t.symbolInstances[y],c=0,u=l.placedTextSymbolIndices;c<u.length;c+=1)for(var x=u[c],f=t.text.placedSymbolArray.get(x),h=f.vertexStartIndex+4*f.numGlyphs,m=f.vertexStartIndex;m<h;m+=4)t.text.indexArray.emplaceBack(m,m+1,m+2),t.text.indexArray.emplaceBack(m+1,m+2,m+3);var d=t.icon.placedSymbolArray.get(y);if(d.numGlyphs){var g=d.vertexStartIndex;t.icon.indexArray.emplaceBack(g,g+1,g+2),t.icon.indexArray.emplaceBack(g+1,g+2,g+3)}}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}},register("SymtrackingBucket",SymtrackingBucket,{omit:["layers","collisionBoxArray","features","compareText"],shallow:["symbolInstances"]}),SymtrackingBucket.MAX_GLYPHS=65535,SymtrackingBucket.addDynamicAttributes=addDynamicAttributes,module.exports=SymtrackingBucket;
},{"../../_minemap_/point-geometry":29,"../../_minemap_/vector-tile":34,"../../symbol/anchor":245,"../../symbol/symbol_size":260,"../../symbol/transform_text":261,"../../util/script_detection":307,"../../util/verticalize_punctuation":317,"../../util/web_worker_transfer":318,"../array_types":41,"../index_array_type":69,"../load_geometry":70,"../program_configuration":72,"../segment":74,"./symtracking_attributes":62}],64:[function(_dereq_,module,exports){
"use strict";var ref=_dereq_("../../util/struct_array"),createLayout=ref.createLayout;module.exports=createLayout([{name:"a_pos_normal",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_seq",components:1,type:"Uint16"}],4);
},{"../../util/struct_array":310}],65:[function(_dereq_,module,exports){
"use strict";function addLineVertex(e,t,r,i,a,n,s){e.emplaceBack(t.x,t.y,i?1:0,a?1:-1,Math.round(EXTRUDE_SCALE*r.x)+128,Math.round(EXTRUDE_SCALE*r.y)+128,1+(0===n?0:n<0?-1:1)|(s*LINE_DISTANCE_SCALE&63)<<2,s*LINE_DISTANCE_SCALE>>6,seq)}var ref=_dereq_("../array_types"),TrackingLayoutArray=ref.TrackingLayoutArray,layoutAttributes=_dereq_("./tracking_attributes").members,ref$1=_dereq_("../segment"),SegmentVector=ref$1.SegmentVector,ref$2=_dereq_("../program_configuration"),ProgramConfigurationSet=ref$2.ProgramConfigurationSet,ref$3=_dereq_("../index_array_type"),TriangleIndexArray=ref$3.TriangleIndexArray,loadGeometry=_dereq_("../load_geometry"),EXTENT=_dereq_("../extent"),vectorTileFeatureTypes=_dereq_("../../_minemap_/vector-tile").VectorTileFeature.types,ref$4=_dereq_("../../util/web_worker_transfer"),register=ref$4.register,seq=0,EXTRUDE_SCALE=63,COS_HALF_SHARP_CORNER=Math.cos(Math.PI/180*37.5),SHARP_CORNER_OFFSET=15,LINE_DISTANCE_BUFFER_BITS=15,LINE_DISTANCE_SCALE=.5,MAX_LINE_DISTANCE=Math.pow(2,LINE_DISTANCE_BUFFER_BITS-1)/LINE_DISTANCE_SCALE,TrackingBucket=function(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(function(e){return e.id}),this.index=e.index,this.layoutVertexArray=new TrackingLayoutArray,this.indexArray=new TriangleIndexArray,this.programConfigurations=new ProgramConfigurationSet(layoutAttributes,e.layers,e.zoom),this.segments=new SegmentVector};TrackingBucket.prototype.populate=function(e,t){for(var r=this,i=0,a=e;i<a.length;i+=1){var n=a[i],s=n.feature,u=n.index,d=n.sourceLayerIndex;if(r.layers[0]._featureFilter({zoom:r.zoom},s)){var o=loadGeometry(s);r.addFeature(s,o),t.featureIndex.insert(s,o,u,d,r.index)}}},TrackingBucket.prototype.isEmpty=function(){return 0===this.layoutVertexArray.length},TrackingBucket.prototype.upload=function(e){this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,layoutAttributes),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.programConfigurations.upload(e)},TrackingBucket.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())},TrackingBucket.prototype.addFeature=function(e,t){var r=this,i=this.layers[0].layout,a=i.get("tracking-join").evaluate(e),n=i.get("tracking-cap"),s=i.get("tracking-miter-limit"),u=i.get("tracking-round-limit");seq=e.properties.link_seq;for(var d=0,o=t;d<o.length;d+=1){var c=o[d];r.addLine(c,e,a,n,s,u)}},TrackingBucket.prototype.addLine=function(e,t,r,i,a,n){for(var s=this,u="Polygon"===vectorTileFeatureTypes[t.type],d=e.length;d>=2&&e[d-1].equals(e[d-2]);)d--;for(var o=0;o<d-1&&e[o].equals(e[o+1]);)o++;if(!(d<(u?3:2))){"bevel"===r&&(a=1.05);var c=SHARP_CORNER_OFFSET*(EXTENT/(512*this.overscaling)),l=e[o],h=this.segments.prepareSegment(10*d,this.layoutVertexArray,this.indexArray);this.distance=0;var y,f,g,x=i,_=u?"butt":i,m=!0,p=void 0,v=void 0,A=void 0,C=void 0;this.e1=this.e2=this.e3=-1,u&&(y=e[d-2],C=l.sub(y)._unit()._perp());for(var E=o;E<d;E++)if(seq++,!(v=u&&E===d-1?e[o+1]:e[E+1])||!e[E].equals(v)){C&&(A=C),y&&(p=y),y=e[E],C=v?v.sub(y)._unit()._perp():A,A=A||C;var T=A.add(C);0===T.x&&0===T.y||T._unit();var k=T.x*C.x+T.y*C.y,V=0!==k?1/k:1/0,S=k<COS_HALF_SHARP_CORNER&&p&&v;if(S&&E>o){var L=y.dist(p);if(L>2*c){var B=y.sub(y.sub(p)._mult(c/L)._round());s.distance+=B.dist(p),s.addCurrentVertex(B,s.distance,A.mult(1),0,0,!1,h),p=B}}var I=p&&v,b=I?r:v?x:_;if(I&&"round"===b&&(V<n?b="miter":V<=2&&(b="fakeround")),"miter"===b&&V>a&&(b="bevel"),"bevel"===b&&(V>2&&(b="flipbevel"),V<a&&(b="miter")),p&&(s.distance+=y.dist(p)),"miter"===b)T._mult(V),s.addCurrentVertex(y,s.distance,T,0,0,!1,h);else if("flipbevel"===b){if(V>100)T=C.clone().mult(-1);else{var N=A.x*C.y-A.y*C.x>0?-1:1,q=V*A.add(C).mag()/A.sub(C).mag();T._perp()._mult(q*N)}s.addCurrentVertex(y,s.distance,T,0,0,!1,h),s.addCurrentVertex(y,s.distance,T.mult(-1),0,0,!1,h)}else if("bevel"===b||"fakeround"===b){var R=A.x*C.y-A.y*C.x>0,F=-Math.sqrt(V*V-1);if(R?(g=0,f=F):(f=0,g=F),m||s.addCurrentVertex(y,s.distance,A,f,g,!1,h),"fakeround"===b){for(var P=Math.floor(8*(.5-(k-.5))),D=void 0,M=0;M<P;M++)D=C.mult((M+1)/(P+1))._add(A)._unit(),s.addPieSliceVertex(y,s.distance,D,R,h);s.addPieSliceVertex(y,s.distance,T,R,h);for(var O=P-1;O>=0;O--)D=A.mult((O+1)/(P+1))._add(C)._unit(),s.addPieSliceVertex(y,s.distance,D,R,h)}v&&s.addCurrentVertex(y,s.distance,C,-f,-g,!1,h)}else"butt"===b?(m||s.addCurrentVertex(y,s.distance,A,0,0,!1,h),v&&s.addCurrentVertex(y,s.distance,C,0,0,!1,h)):"square"===b?(m||(s.addCurrentVertex(y,s.distance,A,1,1,!1,h),s.e1=s.e2=-1),v&&s.addCurrentVertex(y,s.distance,C,-1,-1,!1,h)):"round"===b&&(m||(s.addCurrentVertex(y,s.distance,A,0,0,!1,h),s.addCurrentVertex(y,s.distance,A,1,1,!0,h),s.e1=s.e2=-1),v&&(s.addCurrentVertex(y,s.distance,C,-1,-1,!0,h),s.addCurrentVertex(y,s.distance,C,0,0,!1,h)));if(S&&E<d-1){var $=y.dist(v);if($>2*c){var w=y.add(v.sub(y)._mult(c/$)._round());s.distance+=w.dist(y),s.addCurrentVertex(w,s.distance,C.mult(1),0,0,!1,h),y=w}}m=!1}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t)}},TrackingBucket.prototype.addCurrentVertex=function(e,t,r,i,a,n,s){var u,d=this.layoutVertexArray,o=this.indexArray;u=r.clone(),i&&u._sub(r.perp()._mult(i)),addLineVertex(d,e,u,n,!1,i,t),this.e3=s.vertexLength++,this.e1>=0&&this.e2>=0&&(o.emplaceBack(this.e1,this.e2,this.e3),s.primitiveLength++),this.e1=this.e2,this.e2=this.e3,u=r.mult(-1),a&&u._sub(r.perp()._mult(a)),addLineVertex(d,e,u,n,!0,-a,t),this.e3=s.vertexLength++,this.e1>=0&&this.e2>=0&&(o.emplaceBack(this.e1,this.e2,this.e3),s.primitiveLength++),this.e1=this.e2,this.e2=this.e3,t>MAX_LINE_DISTANCE/2&&(this.distance=0,this.addCurrentVertex(e,this.distance,r,i,a,n,s))},TrackingBucket.prototype.addPieSliceVertex=function(e,t,r,i,a){r=r.mult(i?-1:1);var n=this.layoutVertexArray,s=this.indexArray;addLineVertex(n,e,r,!1,i,0,t),this.e3=a.vertexLength++,this.e1>=0&&this.e2>=0&&(s.emplaceBack(this.e1,this.e2,this.e3),a.primitiveLength++),i?this.e2=this.e3:this.e1=this.e3},register("TrackingBucket",TrackingBucket,{omit:["layers"]}),module.exports=TrackingBucket;
},{"../../_minemap_/vector-tile":34,"../../util/web_worker_transfer":318,"../array_types":41,"../extent":67,"../index_array_type":69,"../load_geometry":70,"../program_configuration":72,"../segment":74,"./tracking_attributes":64}],66:[function(_dereq_,module,exports){
"use strict";var ref=_dereq_("../util/image"),RGBAImage=ref.RGBAImage,util=_dereq_("../util/util"),ref$1=_dereq_("../util/web_worker_transfer"),register=ref$1.register,Level=function(e,t,r){if(e<=0)throw new RangeError("Level must have positive dimension");this.dim=e,this.border=t,this.stride=this.dim+2*this.border,this.data=r||new Int32Array((this.dim+2*this.border)*(this.dim+2*this.border))};Level.prototype.set=function(e,t,r){this.data[this._idx(e,t)]=r+65536},Level.prototype.get=function(e,t){return this.data[this._idx(e,t)]-65536},Level.prototype._idx=function(e,t){if(e<-this.border||e>=this.dim+this.border||t<-this.border||t>=this.dim+this.border)throw new RangeError("out of range source coordinates for DEM data");return(t+this.border)*this.stride+(e+this.border)},register("Level",Level);var DEMData=function(e,t,r){this.uid=e,this.scale=t||1,this.level=r||new Level(256,512),this.loaded=!!r};DEMData.prototype.loadFromImage=function(e,t){if(e.height!==e.width)throw new RangeError("DEM tiles must be square");var r=this.level=new Level(e.width,e.width/2),i=e.data;this._unpackData(r,i,t||"mapbox");for(var a=0;a<r.dim;a++)r.set(-1,a,r.get(0,a)),r.set(r.dim,a,r.get(r.dim-1,a)),r.set(a,-1,r.get(a,0)),r.set(a,r.dim,r.get(a,r.dim-1));r.set(-1,-1,r.get(0,0)),r.set(r.dim,-1,r.get(r.dim-1,0)),r.set(-1,r.dim,r.get(0,r.dim-1)),r.set(r.dim,r.dim,r.get(r.dim-1,r.dim-1)),this.loaded=!0},DEMData.prototype._unpackMapbox=function(e,t,r){return(256*e*256+256*t+r)/10-1e4},DEMData.prototype._unpackTerrarium=function(e,t,r){return 256*e+t+r/256-32768},DEMData.prototype._unpackData=function(e,t,r){for(var i=this,a={mapbox:this._unpackMapbox,terrarium:this._unpackTerrarium},d=a[r],o=0;o<e.dim;o++)for(var s=0;s<e.dim;s++){var m=o*e.dim+s,h=4*m;e.set(s,o,i.scale*d(t[h],t[h+1],t[h+2]))}},DEMData.prototype.getPixels=function(){return new RGBAImage({width:this.level.dim+2*this.level.border,height:this.level.dim+2*this.level.border},new Uint8Array(this.level.data.buffer))},DEMData.prototype.backfillBorder=function(e,t,r){var i=this.level,a=e.level;if(i.dim!==a.dim)throw new Error("level mismatch (dem dimension)");var d=t*i.dim,o=t*i.dim+i.dim,s=r*i.dim,m=r*i.dim+i.dim;switch(t){case-1:d=o-1;break;case 1:o=d+1}switch(r){case-1:s=m-1;break;case 1:m=s+1}for(var h=clamp(d,-i.border,i.dim+i.border),n=clamp(o,-i.border,i.dim+i.border),l=clamp(s,-i.border,i.dim+i.border),u=clamp(m,-i.border,i.dim+i.border),c=-t*i.dim,p=-r*i.dim,v=l;v<u;v++)for(var b=h;b<n;b++)i.set(b,v,a.get(b+c,v+p))},register("DEMData",DEMData),module.exports={DEMData:DEMData,Level:Level};
},{"../util/image":298,"../util/util":315,"../util/web_worker_transfer":318}],67:[function(_dereq_,module,exports){
"use strict";module.exports=8192;
},{}],68:[function(_dereq_,module,exports){
"use strict";function topDownFeatureComparator(e,r){return r-e}var Point=_dereq_("../_minemap_/point-geometry"),loadGeometry=_dereq_("./load_geometry"),EXTENT=_dereq_("./extent"),featureFilter=_dereq_("../style-spec/feature_filter"),Grid=_dereq_("grid-index"),DictionaryCoder=_dereq_("../util/dictionary_coder"),vt=_dereq_("../_minemap_/vector-tile"),Protobuf=_dereq_("pbf"),GeoJSONFeature=_dereq_("../util/vectortile_to_geojson"),arraysIntersect=_dereq_("../util/util").arraysIntersect,ref=_dereq_("../source/tile_id"),OverscaledTileID=ref.OverscaledTileID,ref$1=_dereq_("../util/web_worker_transfer"),register=ref$1.register,ref$2=_dereq_("./array_types"),FeatureIndexArray=ref$2.FeatureIndexArray,FeatureIndex=function(e,r,t,a){this.tileID=e,this.overscaling=r,this.x=e.canonical.x,this.y=e.canonical.y,this.z=e.canonical.z,this.grid=t||new Grid(EXTENT,16,0),this.featureIndexArray=a||new FeatureIndexArray};FeatureIndex.prototype.insert=function(e,r,t,a,i){var o=this,n=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(t,a,i);for(var s=0;s<r.length;s++){for(var u=r[s],l=[1/0,1/0,-1/0,-1/0],y=0;y<u.length;y++){var c=u[y];l[0]=Math.min(l[0],c.x),l[1]=Math.min(l[1],c.y),l[2]=Math.max(l[2],c.x),l[3]=Math.max(l[3],c.y)}o.grid.insert(n,l[0],l[1],l[2],l[3])}},FeatureIndex.prototype.query=function(e,r){this.vtLayers||(this.vtLayers=new vt.VectorTile(new Protobuf(this.rawTileData)).layers,this.sourceLayerCoder=new DictionaryCoder(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"]));for(var t={},a=e.params||{},i=EXTENT/e.tileSize/e.scale,o=featureFilter(a.filter),n=e.queryGeometry,s=e.queryPadding*i,u=1/0,l=1/0,y=-1/0,c=-1/0,d=0;d<n.length;d++)for(var f=n[d],h=0;h<f.length;h++){var x=f[h];u=Math.min(u,x.x),l=Math.min(l,x.y),y=Math.max(y,x.x),c=Math.max(c,x.y)}var v=this.grid.query(u-s,l-s,y+s,c+s);v.sort(topDownFeatureComparator),this.filterMatching(t,v,this.featureIndexArray,n,o,a.layers,r,i,e.posMatrix,e.transform);var I=e.collisionIndex?e.collisionIndex.queryRenderedSymbols(n,this.tileID,e.tileSize/EXTENT,e.collisionBoxArray,e.sourceID,e.bucketInstanceIds):[];return I.sort(),this.filterMatching(t,I,e.collisionBoxArray,n,o,a.layers,r,i,e.posMatrix,e.transform),t},FeatureIndex.prototype.filterMatching=function(e,r,t,a,i,o,n,s,u,l){for(var y,c=this,d=0;d<r.length;d++){var f=r[d];if(f!==y){y=f;var h=t.get(f),x=c.bucketLayerIDs[h.bucketIndex];if(!o||arraysIntersect(o,x)){var v=c.sourceLayerCoder.decode(h.sourceLayerIndex),I=c.vtLayers[v],m=I.feature(h.featureIndex);if(i({zoom:c.tileID.overscaledZ},m))for(var g=null,p=0;p<x.length;p++){var q=x[p];if(!(o&&o.indexOf(q)<0)){var F=n[q];if(F&&("symbol"===F.type||"symtracking"===F.type||(g||(g=loadGeometry(m)),F.queryIntersectsFeature(a,m,g,c.z,l,s,u)))){var D=new GeoJSONFeature(m,c.z,c.x,c.y);D.layer=F.serialize();var T=e[q];void 0===T&&(T=e[q]=[]),T.push({featureIndex:f,feature:D})}}}}}}},FeatureIndex.prototype.hasLayer=function(e){for(var r=this,t=0,a=r.bucketLayerIDs;t<a.length;t+=1)for(var i=a[t],o=0,n=i;o<n.length;o+=1){var s=n[o];if(e===s)return!0}return!1},register("FeatureIndex",FeatureIndex,{omit:["rawTileData","sourceLayerCoder"]}),module.exports=FeatureIndex;
},{"../_minemap_/point-geometry":29,"../_minemap_/vector-tile":34,"../source/tile_id":134,"../style-spec/feature_filter":168,"../util/dictionary_coder":291,"../util/util":315,"../util/vectortile_to_geojson":316,"../util/web_worker_transfer":318,"./array_types":41,"./extent":67,"./load_geometry":70,"grid-index":4,"pbf":10}],69:[function(_dereq_,module,exports){
"use strict";module.exports={LineIndexArray:_dereq_("./array_types").LineIndexArray,TriangleIndexArray:_dereq_("./array_types").TriangleIndexArray};
},{"./array_types":41}],70:[function(_dereq_,module,exports){
"use strict";function createBounds(n){return{min:-1*Math.pow(2,n-1),max:Math.pow(2,n-1)-1}}var util=_dereq_("../util/util"),EXTENT=_dereq_("./extent"),bounds=createBounds(16);module.exports=function(n){for(var t=EXTENT/n.extent,e=n.loadGeometry(),r=0;r<e.length;r++)for(var u=e[r],o=0;o<u.length;o++){var a=u[o];a.x=Math.round(a.x*t),a.y=Math.round(a.y*t),(a.x<bounds.min||a.x>bounds.max||a.y<bounds.min||a.y>bounds.max)&&util.warnOnce("")}return e};
},{"../util/util":315,"./extent":67}],71:[function(_dereq_,module,exports){
"use strict";var ref=_dereq_("../util/struct_array"),createLayout=ref.createLayout;module.exports=createLayout([{name:"a_pos",type:"Int16",components:2}]);
},{"../util/struct_array":310}],72:[function(_dereq_,module,exports){
"use strict";function packColor(r,t){return t?[packUint8ToFloat(r[0],r[1]),packUint8ToFloat(r[2],r[3])]:[packUint8ToFloat(255*r.r,255*r.g),packUint8ToFloat(255*r.b,255*r.a)]}function paintAttributeName(r,t){return{"text-opacity":"opacity","icon-opacity":"opacity","text-color":"fill_color","icon-color":"fill_color","text-halo-color":"halo_color","icon-halo-color":"halo_color","text-halo-blur":"halo_blur","icon-halo-blur":"halo_blur","text-halo-width":"halo_width","icon-halo-width":"halo_width","line-gap-width":"gapwidth"}[r]||r.replace(t+"-","").replace(/-/g,"_")}var packUint8ToFloat=_dereq_("../shaders/encode_attribute").packUint8ToFloat,Color=_dereq_("../style-spec/util/color"),ref=_dereq_("../util/web_worker_transfer"),register=ref.register,ref$1=_dereq_("../style/properties"),PossiblyEvaluatedPropertyValue=ref$1.PossiblyEvaluatedPropertyValue,ref$2=_dereq_("./array_types"),StructArrayLayout1f4=ref$2.StructArrayLayout1f4,StructArrayLayout2f8=ref$2.StructArrayLayout2f8,StructArrayLayout4f16=ref$2.StructArrayLayout4f16,ConstantBinder=function(r,t,o){this.value=r,this.name=t,this.type=o,this.statistics={max:-1/0}};ConstantBinder.prototype.defines=function(){return["#define HAS_UNIFORM_u_"+this.name]},ConstantBinder.prototype.populatePaintArray=function(){},ConstantBinder.prototype.upload=function(){},ConstantBinder.prototype.destroy=function(){},ConstantBinder.prototype.setUniforms=function(r,t,o,e){var i=e.constantOr(this.value),n=r.gl;"color"===this.type?n.uniform4f(t.uniforms["u_"+this.name],i.r,i.g,i.b,i.a):n.uniform1f(t.uniforms["u_"+this.name],i)};var SourceExpressionBinder=function(r,t,o){this.expression=r,this.name=t,this.type=o,this.statistics={max:-1/0};var e="color"===o?StructArrayLayout2f8:StructArrayLayout1f4;this.paintVertexAttributes=[{name:"a_"+t,type:"Float32",components:"color"===o?2:1,offset:0}],this.paintVertexArray=new e};SourceExpressionBinder.prototype.defines=function(){return[]},SourceExpressionBinder.prototype.populatePaintArray=function(r,t){var o=this.paintVertexArray,e=o.length;o.reserve(r);var i=this.expression.evaluate({zoom:0},t);if("color"===this.type)for(var n=packColor(i,"color"!==this.name&&"fill_color"!==this.name),a=e;a<r;a++)o.emplaceBack(n[0],n[1]);else{for(var s=e;s<r;s++)o.emplaceBack(i);this.statistics.max=Math.max(this.statistics.max,i)}},SourceExpressionBinder.prototype.upload=function(r){this.paintVertexArray&&(this.paintVertexBuffer=r.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes))},SourceExpressionBinder.prototype.destroy=function(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()},SourceExpressionBinder.prototype.setUniforms=function(r,t){r.gl.uniform1f(t.uniforms["a_"+this.name+"_t"],0)};var CompositeExpressionBinder=function(r,t,o,e,i){this.expression=r,this.name=t,this.type=o,this.useIntegerZoom=e,this.zoom=i,this.statistics={max:-1/0};var n="color"===o?StructArrayLayout4f16:StructArrayLayout2f8;this.paintVertexAttributes=[{name:"a_"+t,type:"Float32",components:"color"===o?4:2,offset:0}],this.paintVertexArray=new n};CompositeExpressionBinder.prototype.defines=function(){return[]},CompositeExpressionBinder.prototype.populatePaintArray=function(r,t){var o=this.paintVertexArray,e=o.length;o.reserve(r);var i=this.expression.evaluate({zoom:this.zoom},t),n=this.expression.evaluate({zoom:this.zoom+1},t);if("color"===this.type)for(var a=packColor(i),s=packColor(n),p=e;p<r;p++)o.emplaceBack(a[0],a[1],s[0],s[1]);else{for(var u=e;u<r;u++)o.emplaceBack(i,n);this.statistics.max=Math.max(this.statistics.max,i,n)}},CompositeExpressionBinder.prototype.upload=function(r){this.paintVertexArray&&(this.paintVertexBuffer=r.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes))},CompositeExpressionBinder.prototype.destroy=function(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()},CompositeExpressionBinder.prototype.interpolationFactor=function(r){return this.useIntegerZoom?this.expression.interpolationFactor(Math.floor(r),this.zoom,this.zoom+1):this.expression.interpolationFactor(r,this.zoom,this.zoom+1)},CompositeExpressionBinder.prototype.setUniforms=function(r,t,o){r.gl.uniform1f(t.uniforms["a_"+this.name+"_t"],this.interpolationFactor(o.zoom))};var ProgramConfiguration=function(){this.binders={},this.cacheKey="",this._buffers=[]};ProgramConfiguration.createDynamic=function(r,t,o){var e=new ProgramConfiguration,i=[];for(var n in r.paint._values)if(o(n)){var a=r.paint.get(n);if(a instanceof PossiblyEvaluatedPropertyValue&&a.property.specification["property-function"]){var s=paintAttributeName(n,r.type),p=a.property.specification.type,u=a.property.useIntegerZoom;"constant"===a.value.kind?(e.binders[n]=new ConstantBinder(a.value,s,p),i.push("/u_"+s)):"source"===a.value.kind?(e.binders[n]=new SourceExpressionBinder(a.value,s,p),i.push("/a_"+s)):(e.binders[n]=new CompositeExpressionBinder(a.value,s,p,u,t),i.push("/z_"+s))}}return e.cacheKey=i.sort().join(""),e},ProgramConfiguration.prototype.populatePaintArrays=function(r,t){var o=this;for(var e in o.binders)o.binders[e].populatePaintArray(r,t)},ProgramConfiguration.prototype.defines=function(){var r=this,t=[];for(var o in r.binders)t.push.apply(t,r.binders[o].defines());return t},ProgramConfiguration.prototype.setUniforms=function(r,t,o,e){var i=this;for(var n in i.binders){i.binders[n].setUniforms(r,t,e,o.get(n))}},ProgramConfiguration.prototype.getPaintVertexBuffers=function(){return this._buffers},ProgramConfiguration.prototype.upload=function(r){var t=this;for(var o in t.binders)t.binders[o].upload(r);var e=[];for(var i in t.binders){var n=t.binders[i];(n instanceof SourceExpressionBinder||n instanceof CompositeExpressionBinder)&&n.paintVertexBuffer&&e.push(n.paintVertexBuffer)}this._buffers=e},ProgramConfiguration.prototype.destroy=function(){var r=this;for(var t in r.binders)r.binders[t].destroy()};var ProgramConfigurationSet=function(r,t,o,e){var i=this;void 0===e&&(e=function(){return!0}),this.programConfigurations={};for(var n=0,a=t;n<a.length;n+=1){var s=a[n];i.programConfigurations[s.id]=ProgramConfiguration.createDynamic(s,o,e),i.programConfigurations[s.id].layoutAttributes=r}};ProgramConfigurationSet.prototype.populatePaintArrays=function(r,t){var o=this;for(var e in o.programConfigurations)o.programConfigurations[e].populatePaintArrays(r,t)},ProgramConfigurationSet.prototype.get=function(r){return this.programConfigurations[r]},ProgramConfigurationSet.prototype.upload=function(r){var t=this;for(var o in t.programConfigurations)t.programConfigurations[o].upload(r)},ProgramConfigurationSet.prototype.destroy=function(){var r=this;for(var t in r.programConfigurations)r.programConfigurations[t].destroy()},register("ConstantBinder",ConstantBinder),register("SourceExpressionBinder",SourceExpressionBinder),register("CompositeExpressionBinder",CompositeExpressionBinder),register("ProgramConfiguration",ProgramConfiguration,{omit:["_buffers"]}),register("ProgramConfigurationSet",ProgramConfigurationSet),module.exports={ProgramConfiguration:ProgramConfiguration,ProgramConfigurationSet:ProgramConfigurationSet};
},{"../shaders/encode_attribute":117,"../style-spec/util/color":173,"../style/properties":208,"../util/web_worker_transfer":318,"./array_types":41}],73:[function(_dereq_,module,exports){
"use strict";var ref=_dereq_("../util/struct_array"),createLayout=ref.createLayout;module.exports=createLayout([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);
},{"../util/struct_array":310}],74:[function(_dereq_,module,exports){
"use strict";var ref=_dereq_("../util/util"),warnOnce=ref.warnOnce,ref$1=_dereq_("../util/web_worker_transfer"),register=ref$1.register,MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,SegmentVector=function(e){void 0===e&&(e=[]),this.segments=e};SegmentVector.prototype.prepareSegment=function(e,t,r){var n=this.segments[this.segments.length-1];return e>MAX_VERTEX_ARRAY_LENGTH&&warnOnce("Max vertices per segment is "+MAX_VERTEX_ARRAY_LENGTH+": bucket requested "+e),(!n||n.vertexLength+e>module.exports.MAX_VERTEX_ARRAY_LENGTH)&&(n={vertexOffset:t.length,primitiveOffset:r.length,vertexLength:0,primitiveLength:0},this.segments.push(n)),n},SegmentVector.prototype.get=function(){return this.segments},SegmentVector.prototype.destroy=function(){for(var e=this,t=0,r=e.segments;t<r.length;t+=1){var n=r[t];for(var s in n.vaos)n.vaos[s].destroy()}},register("SegmentVector",SegmentVector),module.exports={SegmentVector:SegmentVector,MAX_VERTEX_ARRAY_LENGTH:MAX_VERTEX_ARRAY_LENGTH};
},{"../util/util":315,"../util/web_worker_transfer":318}],75:[function(_dereq_,module,exports){
"use strict";var Coordinate=function(o,t,n){this.column=o,this.row=t,this.zoom=n};Coordinate.prototype.clone=function(){return new Coordinate(this.column,this.row,this.zoom)},Coordinate.prototype.zoomTo=function(o){return this.clone()._zoomTo(o)},Coordinate.prototype.sub=function(o){return this.clone()._sub(o)},Coordinate.prototype._zoomTo=function(o){var t=Math.pow(2,o-this.zoom);return this.column*=t,this.row*=t,this.zoom=o,this},Coordinate.prototype._sub=function(o){return o=o.zoomTo(this.zoom),this.column-=o.column,this.row-=o.row,this},module.exports=Coordinate;
},{}],76:[function(_dereq_,module,exports){
"use strict";var wrap=_dereq_("../util/util").wrap,LngLat=function(t,n){if(isNaN(t)||isNaN(n))throw new Error("Invalid LngLat object: ("+t+", "+n+")");if(this.lng=+t,this.lat=+n,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")};LngLat.prototype.wrap=function(){return new LngLat(wrap(this.lng,-180,180),this.lat)},LngLat.prototype.toArray=function(){return[this.lng,this.lat]},LngLat.prototype.wrapToBestWorld=function(t){var n=new LngLat(this.lng,this.lat);return Math.abs(this.lng-t.lng)>180&&(t.lng<0?n.lng-=360:n.lng+=360),n},LngLat.prototype.toString=function(){return"LngLat("+this.lng+", "+this.lat+")"},LngLat.prototype.toBounds=function(t){var n=360*t/40075017,a=n/Math.cos(Math.PI/180*this.lat);return new(_dereq_("./lng_lat_bounds"))(new LngLat(this.lng-a,this.lat-n),new LngLat(this.lng+a,this.lat+n))},LngLat.convert=function(t){if(t instanceof LngLat)return t;if(Array.isArray(t)&&(2===t.length||3===t.length))return new LngLat(Number(t[0]),Number(t[1]));if(!Array.isArray(t)&&"object"==typeof t&&null!==t)return new LngLat(Number(t.lng),Number(t.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")},module.exports=LngLat;
},{"../util/util":315,"./lng_lat_bounds":77}],77:[function(_dereq_,module,exports){
"use strict";var LngLat=_dereq_("./lng_lat"),LngLatBounds=function(t,n){t&&(n?this.setSouthWest(t).setNorthEast(n):4===t.length?this.setSouthWest([t[0],t[1]]).setNorthEast([t[2],t[3]]):this.setSouthWest(t[0]).setNorthEast(t[1]))};LngLatBounds.prototype.setNorthEast=function(t){return this._ne=t instanceof LngLat?new LngLat(t.lng,t.lat):LngLat.convert(t),this},LngLatBounds.prototype.setSouthWest=function(t){return this._sw=t instanceof LngLat?new LngLat(t.lng,t.lat):LngLat.convert(t),this},LngLatBounds.prototype.extend=function(t){var n,e,s=this._sw,o=this._ne;if(t instanceof LngLat)n=t,e=t;else{if(!(t instanceof LngLatBounds))return Array.isArray(t)?t.every(Array.isArray)?this.extend(LngLatBounds.convert(t)):this.extend(LngLat.convert(t)):this;if(n=t._sw,e=t._ne,!n||!e)return this}return s||o?(s.lng=Math.min(n.lng,s.lng),s.lat=Math.min(n.lat,s.lat),o.lng=Math.max(e.lng,o.lng),o.lat=Math.max(e.lat,o.lat)):(this._sw=new LngLat(n.lng,n.lat),this._ne=new LngLat(e.lng,e.lat)),this},LngLatBounds.prototype.getCenter=function(){return new LngLat((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)},LngLatBounds.prototype.getSouthWest=function(){return this._sw},LngLatBounds.prototype.getNorthEast=function(){return this._ne},LngLatBounds.prototype.getNorthWest=function(){return new LngLat(this.getWest(),this.getNorth())},LngLatBounds.prototype.getSouthEast=function(){return new LngLat(this.getEast(),this.getSouth())},LngLatBounds.prototype.getWest=function(){return this._sw.lng},LngLatBounds.prototype.getSouth=function(){return this._sw.lat},LngLatBounds.prototype.getEast=function(){return this._ne.lng},LngLatBounds.prototype.getNorth=function(){return this._ne.lat},LngLatBounds.prototype.toArray=function(){return[this._sw.toArray(),this._ne.toArray()]},LngLatBounds.prototype.toString=function(){return"LngLatBounds("+this._sw.toString()+", "+this._ne.toString()+")"},LngLatBounds.prototype.isEmpty=function(){return!(this._sw&&this._ne)},LngLatBounds.convert=function(t){return!t||t instanceof LngLatBounds?t:new LngLatBounds(t)},module.exports=LngLatBounds;
},{"./lng_lat":76}],78:[function(_dereq_,module,exports){
"use strict";var LngLat=_dereq_("./lng_lat"),Point=_dereq_("../_minemap_/point-geometry"),Coordinate=_dereq_("./coordinate"),util=_dereq_("../util/util"),interp=_dereq_("../style-spec/util/interpolate").number,tileCover=_dereq_("../util/tile_cover"),ref=_dereq_("../source/tile_id"),CanonicalTileID=ref.CanonicalTileID,UnwrappedTileID=ref.UnwrappedTileID,EXTENT=_dereq_("../data/extent"),glmatrix=_dereq_("../_minemap_/gl-matrix"),vec4=glmatrix.vec4,mat4=glmatrix.mat4,mat2=glmatrix.mat2,Transform=function(t,i,o){this.tileSize=512,this._renderWorldCopies=void 0===o||o,this._minZoom=t||0,this._maxZoom=i||22,this.latRange=[-85.05113,85.05113],this.width=0,this.height=0,this._center=new LngLat(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._unmodified=!0,this._posMatrixCache={},this._alignedPosMatrixCache={}},prototypeAccessors={minZoom:{},maxZoom:{},renderWorldCopies:{},worldSize:{},centerPoint:{},size:{},bearing:{},pitch:{},fov:{},zoom:{},center:{},unmodified:{},x:{},y:{},point:{}};Transform.prototype.clone=function(){var t=new Transform(this._minZoom,this._maxZoom,this._renderWorldCopies);return t.tileSize=this.tileSize,t.latRange=this.latRange,t.width=this.width,t.height=this.height,t._center=this._center,t.zoom=this.zoom,t.angle=this.angle,t._fov=this._fov,t._pitch=this._pitch,t._unmodified=this._unmodified,t._calcMatrices(),t},prototypeAccessors.minZoom.get=function(){return this._minZoom},prototypeAccessors.minZoom.set=function(t){this._minZoom!==t&&(this._minZoom=t,this.zoom=Math.max(this.zoom,t))},prototypeAccessors.maxZoom.get=function(){return this._maxZoom},prototypeAccessors.maxZoom.set=function(t){this._maxZoom!==t&&(this._maxZoom=t,this.zoom=Math.min(this.zoom,t))},prototypeAccessors.renderWorldCopies.get=function(){return this._renderWorldCopies},prototypeAccessors.renderWorldCopies.set=function(t){void 0===t?t=!0:null===t&&(t=!1),this._renderWorldCopies=t},prototypeAccessors.worldSize.get=function(){return this.tileSize*this.scale},prototypeAccessors.centerPoint.get=function(){return this.size._div(2)},prototypeAccessors.size.get=function(){return new Point(this.width,this.height)},prototypeAccessors.bearing.get=function(){return-this.angle/Math.PI*180},prototypeAccessors.bearing.set=function(t){var i=-util.wrap(t,-180,180)*Math.PI/180;this.angle!==i&&(this._unmodified=!1,this.angle=i,this._calcMatrices(),this.rotationMatrix=mat2.create(),mat2.rotate(this.rotationMatrix,this.rotationMatrix,this.angle))},prototypeAccessors.pitch.get=function(){return this._pitch/Math.PI*180},prototypeAccessors.pitch.set=function(t){var i=util.clamp(t,0,60)/180*Math.PI;this._pitch!==i&&(this._unmodified=!1,this._pitch=i,this._calcMatrices())},prototypeAccessors.fov.get=function(){return this._fov/Math.PI*180},prototypeAccessors.fov.set=function(t){t=Math.max(.01,Math.min(60,t)),this._fov!==t&&(this._unmodified=!1,this._fov=t/180*Math.PI,this._calcMatrices())},prototypeAccessors.zoom.get=function(){return this._zoom},prototypeAccessors.zoom.set=function(t){var i=Math.min(Math.max(t,this.minZoom),this.maxZoom);this._zoom!==i&&(this._unmodified=!1,this._zoom=i,this.scale=this.zoomScale(i),this.tileZoom=Math.floor(i),this.zoomFraction=i-this.tileZoom,this._constrain(),this._calcMatrices())},prototypeAccessors.center.get=function(){return this._center},prototypeAccessors.center.set=function(t){t.lat===this._center.lat&&t.lng===this._center.lng||(this._unmodified=!1,this._center=t,this._constrain(),this._calcMatrices())},Transform.prototype.coveringZoomLevel=function(t){return(t.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/t.tileSize))},Transform.prototype.getVisibleUnwrappedCoordinates=function(t){var i=this.pointCoordinate(new Point(0,0),0),o=this.pointCoordinate(new Point(this.width,0),0),e=Math.floor(i.column),r=Math.floor(o.column),n=[new UnwrappedTileID(0,t)];if(this._renderWorldCopies)for(var s=e;s<=r;s++)0!==s&&n.push(new UnwrappedTileID(s,t));return n},Transform.prototype.coveringTiles=function(t){var i=this.coveringZoomLevel(t),o=i;if(void 0!==t.minzoom&&i<t.minzoom)return[];void 0!==t.maxzoom&&i>t.maxzoom&&(i=t.maxzoom);var e=this.pointCoordinate(this.centerPoint,i),r=new Point(e.column-.5,e.row-.5),n=[this.pointCoordinate(new Point(0,0),i),this.pointCoordinate(new Point(this.width,0),i),this.pointCoordinate(new Point(this.width,this.height),i),this.pointCoordinate(new Point(0,this.height),i)];return tileCover(i,n,t.reparseOverscaled?o:i,this._renderWorldCopies).sort(function(t,i){return r.dist(t.canonical)-r.dist(i.canonical)})},Transform.prototype.resize=function(t,i){this.width=t,this.height=i,this.pixelsToGLUnits=[2/t,-2/i],this._constrain(),this._calcMatrices()},prototypeAccessors.unmodified.get=function(){return this._unmodified},Transform.prototype.zoomScale=function(t){return Math.pow(2,t)},Transform.prototype.scaleZoom=function(t){return Math.log(t)/Math.LN2},Transform.prototype.project=function(t){return new Point(this.lngX(t.lng),this.latY(t.lat))},Transform.prototype.unproject=function(t){return new LngLat(this.xLng(t.x),this.yLat(t.y))},prototypeAccessors.x.get=function(){return this.lngX(this.center.lng)},prototypeAccessors.y.get=function(){return this.latY(this.center.lat)},prototypeAccessors.point.get=function(){return new Point(this.x,this.y)},Transform.prototype.lngX=function(t){return(180+t)*this.worldSize/360},Transform.prototype.latY=function(t){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+t*Math.PI/360)))*this.worldSize/360},Transform.prototype.xLng=function(t){return 360*t/this.worldSize-180},Transform.prototype.yLat=function(t){var i=180-360*t/this.worldSize;return 360/Math.PI*Math.atan(Math.exp(i*Math.PI/180))-90},Transform.prototype.setLocationAtPoint=function(t,i){var o=this.pointCoordinate(i)._sub(this.pointCoordinate(this.centerPoint));this.center=this.coordinateLocation(this.locationCoordinate(t)._sub(o)),this._renderWorldCopies&&(this.center=this.center.wrap())},Transform.prototype.locationPoint=function(t){return this.coordinatePoint(this.locationCoordinate(t))},Transform.prototype.pointLocation=function(t){return this.coordinateLocation(this.pointCoordinate(t))},Transform.prototype.locationCoordinate=function(t){return new Coordinate(this.lngX(t.lng)/this.tileSize,this.latY(t.lat)/this.tileSize,this.zoom).zoomTo(this.tileZoom)},Transform.prototype.coordinateLocation=function(t){var i=t.zoomTo(this.zoom);return new LngLat(this.xLng(i.column*this.tileSize),this.yLat(i.row*this.tileSize))},Transform.prototype.pointCoordinate=function(t,i){void 0===i&&(i=this.tileZoom);var o=[t.x,t.y,0,1],e=[t.x,t.y,1,1];vec4.transformMat4(o,o,this.pixelMatrixInverse),vec4.transformMat4(e,e,this.pixelMatrixInverse);var r=o[3],n=e[3],s=o[0]/r,a=e[0]/n,h=o[1]/r,c=e[1]/n,l=o[2]/r,m=e[2]/n,p=l===m?0:(0-l)/(m-l);return new Coordinate(interp(s,a,p)/this.tileSize,interp(h,c,p)/this.tileSize,this.zoom)._zoomTo(i)},Transform.prototype.coordinatePoint=function(t){var i=t.zoomTo(this.zoom),o=[i.column*this.tileSize,i.row*this.tileSize,0,1];return vec4.transformMat4(o,o,this.pixelMatrix),new Point(o[0]/o[3],o[1]/o[3])},Transform.prototype.calculatePosMatrix=function(t,i){void 0===i&&(i=!1);var o=t.key,e=i?this._alignedPosMatrixCache:this._posMatrixCache;if(e[o])return e[o];var r=t.canonical,n=this.worldSize/this.zoomScale(r.z),s=r.x+Math.pow(2,r.z)*t.wrap,a=mat4.identity(new Float64Array(16));return mat4.translate(a,a,[s*n,r.y*n,0]),mat4.scale(a,a,[n/EXTENT,n/EXTENT,1]),mat4.multiply(a,i?this.alignedProjMatrix:this.projMatrix,a),e[o]=new Float32Array(a),e[o]},Transform.prototype._constrain=function(){if(this.center&&this.width&&this.height&&!this._constraining){this._constraining=!0;var t,i,o,e,r=-90,n=90,s=-180,a=180,h=this.size,c=this._unmodified;if(this.latRange){var l=this.latRange;r=this.latY(l[1]),n=this.latY(l[0]),t=n-r<h.y?h.y/(n-r):0}if(this.lngRange){var m=this.lngRange;s=this.lngX(m[0]),a=this.lngX(m[1]),i=a-s<h.x?h.x/(a-s):0}var p=Math.max(i||0,t||0);if(p)return this.center=this.unproject(new Point(i?(a+s)/2:this.x,t?(n+r)/2:this.y)),this.zoom+=this.scaleZoom(p),this._unmodified=c,void(this._constraining=!1);if(this.latRange){var u=this.y,f=h.y/2;u-f<r&&(e=r+f),u+f>n&&(e=n-f)}if(this.lngRange){var d=this.x,g=h.x/2;d-g<s&&(o=s+g),d+g>a&&(o=a-g)}void 0===o&&void 0===e||(this.center=this.unproject(new Point(void 0!==o?o:this.x,void 0!==e?e:this.y))),this._unmodified=c,this._constraining=!1}},Transform.prototype._calcMatrices=function(){if(this.height){this.cameraToCenterDistance=.5/Math.tan(this._fov/2)*this.height;var t=this._fov/2,i=Math.PI/2+this._pitch,o=Math.sin(t)*this.cameraToCenterDistance/Math.sin(Math.PI-i-t),e=this.x,r=this.y,n=Math.cos(Math.PI/2-this._pitch)*o+this.cameraToCenterDistance,s=1.01*n,a=new Float64Array(16);mat4.perspective(a,this._fov,this.width/this.height,1,s),mat4.scale(a,a,[1,-1,1]),mat4.translate(a,a,[0,0,-this.cameraToCenterDistance]),mat4.rotateX(a,a,this._pitch),mat4.rotateZ(a,a,this.angle),mat4.translate(a,a,[-e,-r,0]);var h=this.worldSize/(2*Math.PI*6378137*Math.abs(Math.cos(this.center.lat*(Math.PI/180))));mat4.scale(a,a,[1,1,h,1]),this.projMatrix=a;var c=this.width%2/2,l=this.height%2/2,m=Math.cos(this.angle),p=Math.sin(this.angle),u=e-Math.round(e)+m*c+p*l,f=r-Math.round(r)+m*l+p*c,d=new Float64Array(a);if(mat4.translate(d,d,[u>.5?u-1:u,f>.5?f-1:f,0]),this.alignedProjMatrix=d,a=mat4.create(),mat4.scale(a,a,[this.width/2,-this.height/2,1]),mat4.translate(a,a,[1,-1,0]),this.pixelMatrix=mat4.multiply(new Float64Array(16),a,this.projMatrix),!(a=mat4.invert(new Float64Array(16),this.pixelMatrix)))throw new Error("failed to invert matrix");this.pixelMatrixInverse=a,this._posMatrixCache={},this._alignedPosMatrixCache={}}},Transform.prototype.maxPitchScaleFactor=function(){if(!this.pixelMatrixInverse)return 1;var t=this.pointCoordinate(new Point(0,0)).zoomTo(this.zoom),i=[t.column*this.tileSize,t.row*this.tileSize,0,1];return vec4.transformMat4(i,i,this.pixelMatrix)[3]/this.cameraToCenterDistance},Object.defineProperties(Transform.prototype,prototypeAccessors),module.exports=Transform;
},{"../_minemap_/gl-matrix":27,"../_minemap_/point-geometry":29,"../data/extent":67,"../source/tile_id":134,"../style-spec/util/interpolate":178,"../util/tile_cover":313,"../util/util":315,"./coordinate":75,"./lng_lat":76}],79:[function(_dereq_,module,exports){
"use strict";var Color=_dereq_("../style-spec/util/color"),ZERO=0,ONE=1,ONE_MINUS_SRC_ALPHA=771,ColorMode=function(o,e,l){this.blendFunction=o,this.blendColor=e,this.mask=l};ColorMode.Replace=[ONE,ZERO],ColorMode.disabled=new ColorMode(ColorMode.Replace,Color.transparent,[!1,!1,!1,!1]),ColorMode.unblended=new ColorMode(ColorMode.Replace,Color.transparent,[!0,!0,!0,!0]),ColorMode.alphaBlended=new ColorMode([ONE,ONE_MINUS_SRC_ALPHA],Color.transparent,[!0,!0,!0,!0]),module.exports=ColorMode;
},{"../style-spec/util/color":173}],80:[function(_dereq_,module,exports){
"use strict";var IndexBuffer=_dereq_("./index_buffer"),VertexBuffer=_dereq_("./vertex_buffer"),Framebuffer=_dereq_("./framebuffer"),DepthMode=_dereq_("./depth_mode"),StencilMode=_dereq_("./stencil_mode"),ColorMode=_dereq_("./color_mode"),util=_dereq_("../util/util"),ref=_dereq_("./value"),ClearColor=ref.ClearColor,ClearDepth=ref.ClearDepth,ClearStencil=ref.ClearStencil,ColorMask=ref.ColorMask,DepthMask=ref.DepthMask,StencilMask=ref.StencilMask,StencilFunc=ref.StencilFunc,StencilOp=ref.StencilOp,StencilTest=ref.StencilTest,DepthRange=ref.DepthRange,DepthTest=ref.DepthTest,DepthFunc=ref.DepthFunc,Blend=ref.Blend,BlendFunc=ref.BlendFunc,BlendColor=ref.BlendColor,Program=ref.Program,LineWidth=ref.LineWidth,ActiveTextureUnit=ref.ActiveTextureUnit,Viewport=ref.Viewport,BindFramebuffer=ref.BindFramebuffer,BindRenderbuffer=ref.BindRenderbuffer,BindTexture=ref.BindTexture,BindVertexBuffer=ref.BindVertexBuffer,BindElementBuffer=ref.BindElementBuffer,BindVertexArrayOES=ref.BindVertexArrayOES,PixelStoreUnpack=ref.PixelStoreUnpack,PixelStoreUnpackPremultiplyAlpha=ref.PixelStoreUnpackPremultiplyAlpha,Context=function(e){this.gl=e,this.extVertexArrayObject=this.gl.getExtension("OES_vertex_array_object"),this.lineWidthRange=e.getParameter(e.ALIASED_LINE_WIDTH_RANGE),this.clearColor=new ClearColor(this),this.clearDepth=new ClearDepth(this),this.clearStencil=new ClearStencil(this),this.colorMask=new ColorMask(this),this.depthMask=new DepthMask(this),this.stencilMask=new StencilMask(this),this.stencilFunc=new StencilFunc(this),this.stencilOp=new StencilOp(this),this.stencilTest=new StencilTest(this),this.depthRange=new DepthRange(this),this.depthTest=new DepthTest(this),this.depthFunc=new DepthFunc(this),this.blend=new Blend(this),this.blendFunc=new BlendFunc(this),this.blendColor=new BlendColor(this),this.program=new Program(this),this.lineWidth=new LineWidth(this),this.activeTexture=new ActiveTextureUnit(this),this.viewport=new Viewport(this),this.bindFramebuffer=new BindFramebuffer(this),this.bindRenderbuffer=new BindRenderbuffer(this),this.bindTexture=new BindTexture(this),this.bindVertexBuffer=new BindVertexBuffer(this),this.bindElementBuffer=new BindElementBuffer(this),this.bindVertexArrayOES=this.extVertexArrayObject&&new BindVertexArrayOES(this),this.pixelStoreUnpack=new PixelStoreUnpack(this),this.pixelStoreUnpackPremultiplyAlpha=new PixelStoreUnpackPremultiplyAlpha(this),this.extTextureFilterAnisotropic=e.getExtension("EXT_texture_filter_anisotropic")||e.getExtension("MOZ_EXT_texture_filter_anisotropic")||e.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=e.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.extTextureHalfFloat=e.getExtension("OES_texture_half_float"),this.extTextureHalfFloat&&e.getExtension("OES_texture_half_float_linear")};Context.prototype.createIndexBuffer=function(e,t){return new IndexBuffer(this,e,t)},Context.prototype.createVertexBuffer=function(e,t,r){return new VertexBuffer(this,e,t,r)},Context.prototype.createRenderbuffer=function(e,t,r){var i=this.gl,n=i.createRenderbuffer();return this.bindRenderbuffer.set(n),i.renderbufferStorage(i.RENDERBUFFER,e,t,r),this.bindRenderbuffer.set(null),n},Context.prototype.createFramebuffer=function(e,t){return new Framebuffer(this,e,t)},Context.prototype.clear=function(e){var t=e.color,r=e.depth,i=this.gl,n=0;t&&(n|=i.COLOR_BUFFER_BIT,this.clearColor.set(t),this.colorMask.set([!0,!0,!0,!0])),void 0!==r&&(n|=i.DEPTH_BUFFER_BIT,this.clearDepth.set(r),this.depthMask.set(!0)),i.clear(n)},Context.prototype.setDepthMode=function(e){e.func!==this.gl.ALWAYS||e.mask?(this.depthTest.set(!0),this.depthFunc.set(e.func),this.depthMask.set(e.mask),this.depthRange.set(e.range)):this.depthTest.set(!1)},Context.prototype.setStencilMode=function(e){e.func!==this.gl.ALWAYS||e.mask?(this.stencilTest.set(!0),this.stencilMask.set(e.mask),this.stencilOp.set([e.fail,e.depthFail,e.pass]),this.stencilFunc.set({func:e.test.func,ref:e.ref,mask:e.test.mask})):this.stencilTest.set(!1)},Context.prototype.setColorMode=function(e){util.deepEqual(e.blendFunction,ColorMode.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(e.blendFunction),this.blendColor.set(e.blendColor)),this.colorMask.set(e.mask)},module.exports=Context;
},{"../util/util":315,"./color_mode":79,"./depth_mode":81,"./framebuffer":82,"./index_buffer":83,"./stencil_mode":84,"./value":86,"./vertex_buffer":87}],81:[function(_dereq_,module,exports){
"use strict";var ALWAYS=519,DepthMode=function(e,t,d){this.func=e,this.mask=t,this.range=d};DepthMode.ReadOnly=!1,DepthMode.ReadWrite=!0,DepthMode.disabled=new DepthMode(ALWAYS,DepthMode.ReadOnly,[0,1]),module.exports=DepthMode;
},{}],82:[function(_dereq_,module,exports){
"use strict";var ref=_dereq_("./value"),ColorAttachment=ref.ColorAttachment,DepthAttachment=ref.DepthAttachment,Framebuffer=function(t,e,r){this.context=t,this.width=e,this.height=r;var h=t.gl,a=this.framebuffer=h.createFramebuffer();this.colorAttachment=new ColorAttachment(t,a),this.depthAttachment=new DepthAttachment(t,a)};Framebuffer.prototype.destroy=function(){var t=this.context.gl,e=this.colorAttachment.get();e&&t.deleteTexture(e);var r=this.depthAttachment.get();r&&t.deleteRenderbuffer(r),t.deleteFramebuffer(this.framebuffer)},module.exports=Framebuffer;
},{"./value":86}],83:[function(_dereq_,module,exports){
"use strict";var IndexBuffer=function(e,t,r){this.context=e;var f=e.gl;this.buffer=f.createBuffer(),this.dynamicDraw=Boolean(r),this.unbindVAO(),e.bindElementBuffer.set(this.buffer),f.bufferData(f.ELEMENT_ARRAY_BUFFER,t.arrayBuffer,this.dynamicDraw?f.DYNAMIC_DRAW:f.STATIC_DRAW),this.dynamicDraw||delete t.arrayBuffer};IndexBuffer.prototype.unbindVAO=function(){this.context.extVertexArrayObject&&this.context.bindVertexArrayOES.set(null)},IndexBuffer.prototype.bind=function(){this.context.bindElementBuffer.set(this.buffer)},IndexBuffer.prototype.updateData=function(e){var t=this.context.gl;this.unbindVAO(),this.bind(),t.bufferSubData(t.ELEMENT_ARRAY_BUFFER,0,e.arrayBuffer)},IndexBuffer.prototype.destroy=function(){var e=this.context.gl;this.buffer&&(e.deleteBuffer(this.buffer),delete this.buffer)},module.exports=IndexBuffer;
},{}],84:[function(_dereq_,module,exports){
"use strict";var ALWAYS=519,KEEP=7680,StencilMode=function(t,e,i,s,d,l){this.test=t,this.ref=e,this.mask=i,this.fail=s,this.depthFail=d,this.pass=l};StencilMode.disabled=new StencilMode({func:ALWAYS,mask:0},0,0,KEEP,KEEP,KEEP),module.exports=StencilMode;
},{}],85:[function(_dereq_,module,exports){
"use strict";var glMatrix=_dereq_("../_minemap_/gl-matrix"),Texture=_dereq_("../render/texture"),Color=_dereq_("../style-spec/util/color"),DepthMode=_dereq_("../gl/depth_mode"),mat4=glMatrix.mat4,StencilMode=_dereq_("../gl/stencil_mode");exports.drawToExtrusionFramebuffer=function(e,t){var r=e.context,o=r.gl,i=t.viewportFrame;if(e.depthRboNeedsClear&&e.setupOffscreenDepthRenderbuffer(),!i){var a=new Texture(r,{width:e.width,height:e.height,data:null},o.RGBA);a.bind(o.LINEAR,o.CLAMP_TO_EDGE),i=t.viewportFrame=r.createFramebuffer(e.width,e.height),i.colorAttachment.set(a.texture)}r.bindFramebuffer.set(i.framebuffer),i.depthAttachment.set(e.depthRbo),e.depthRboNeedsClear&&(r.clear({depth:1}),e.depthRboNeedsClear=!1),r.clear({color:Color.transparent}),r.setStencilMode(StencilMode.disabled),r.setDepthMode(new DepthMode(o.LEQUAL,DepthMode.ReadWrite,[0,1])),r.setColorMode(e.colorModeForRenderPass())},exports.drawExtrusionTexture=function(e,t){var r=t.viewportFrame;if(r){var o=e.context,i=o.gl,a=e.useProgram("extrusionTexture");o.setStencilMode(StencilMode.disabled),o.setDepthMode(DepthMode.disabled),o.setColorMode(e.colorModeForRenderPass()),o.activeTexture.set(i.TEXTURE0),i.bindTexture(i.TEXTURE_2D,r.colorAttachment.get()),"object"==typeof t.paint.get(t.type+"-opacity")?i.uniform1f(a.uniforms.u_opacity,t.paint.get(t.type+"-opacity").value.value):i.uniform1f(a.uniforms.u_opacity,t.paint.get(t.type+"-opacity")),i.uniform1i(a.uniforms.u_image,0);var d=mat4.create();mat4.ortho(d,0,e.width,e.height,0,0,1),i.uniformMatrix4fv(a.uniforms.u_matrix,!1,d),i.uniform2f(a.uniforms.u_world,i.drawingBufferWidth,i.drawingBufferHeight),e.viewportVAO.bind(o,a,e.viewportBuffer,[]),i.drawArrays(i.TRIANGLE_STRIP,0,4)}},exports.destroy=function(e){e&&e.viewportFrame&&(e.viewportFrame.destroy(),e.viewportFrame=null)},exports.setExtrusionOpacity=function(){};
},{"../_minemap_/gl-matrix":27,"../gl/depth_mode":81,"../gl/stencil_mode":84,"../render/texture":114,"../style-spec/util/color":173}],86:[function(_dereq_,module,exports){
"use strict";var Color=_dereq_("../style-spec/util/color"),util=_dereq_("../util/util"),ClearColor=function(t){this.context=t,this.current=Color.transparent};ClearColor.prototype.get=function(){return this.current},ClearColor.prototype.set=function(t){var e=this.current;t.r===e.r&&t.g===e.g&&t.b===e.b&&t.a===e.a||(this.context.gl.clearColor(t.r,t.g,t.b,t.a),this.current=t)};var ClearDepth=function(t){this.context=t,this.current=1};ClearDepth.prototype.get=function(){return this.current},ClearDepth.prototype.set=function(t){this.current!==t&&(this.context.gl.clearDepth(t),this.current=t)};var ClearStencil=function(t){this.context=t,this.current=0};ClearStencil.prototype.get=function(){return this.current},ClearStencil.prototype.set=function(t){this.current!==t&&(this.context.gl.clearStencil(t),this.current=t)};var ColorMask=function(t){this.context=t,this.current=[!0,!0,!0,!0]};ColorMask.prototype.get=function(){return this.current},ColorMask.prototype.set=function(t){var e=this.current;t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]||(this.context.gl.colorMask(t[0],t[1],t[2],t[3]),this.current=t)};var DepthMask=function(t){this.context=t,this.current=!0};DepthMask.prototype.get=function(){return this.current},DepthMask.prototype.set=function(t){this.current!==t&&(this.context.gl.depthMask(t),this.current=t)};var StencilMask=function(t){this.context=t,this.current=255};StencilMask.prototype.get=function(){return this.current},StencilMask.prototype.set=function(t){this.current!==t&&(this.context.gl.stencilMask(t),this.current=t)};var StencilFunc=function(t){this.context=t,this.current={func:t.gl.ALWAYS,ref:0,mask:255}};StencilFunc.prototype.get=function(){return this.current},StencilFunc.prototype.set=function(t){var e=this.current;t.func===e.func&&t.ref===e.ref&&t.mask===e.mask||(this.context.gl.stencilFunc(t.func,t.ref,t.mask),this.current=t)};var StencilOp=function(t){this.context=t;var e=this.context.gl;this.current=[e.KEEP,e.KEEP,e.KEEP]};StencilOp.prototype.get=function(){return this.current},StencilOp.prototype.set=function(t){var e=this.current;t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]||(this.context.gl.stencilOp(t[0],t[1],t[2]),this.current=t)};var StencilTest=function(t){this.context=t,this.current=!1};StencilTest.prototype.get=function(){return this.current},StencilTest.prototype.set=function(t){if(this.current!==t){var e=this.context.gl;t?e.enable(e.STENCIL_TEST):e.disable(e.STENCIL_TEST),this.current=t}};var DepthRange=function(t){this.context=t,this.current=[0,1]};DepthRange.prototype.get=function(){return this.current},DepthRange.prototype.set=function(t){var e=this.current;t[0]===e[0]&&t[1]===e[1]||(this.context.gl.depthRange(t[0],t[1]),this.current=t)};var DepthTest=function(t){this.context=t,this.current=!1};DepthTest.prototype.get=function(){return this.current},DepthTest.prototype.set=function(t){if(this.current!==t){var e=this.context.gl;t?e.enable(e.DEPTH_TEST):e.disable(e.DEPTH_TEST),this.current=t}};var DepthFunc=function(t){this.context=t,this.current=t.gl.LESS};DepthFunc.prototype.get=function(){return this.current},DepthFunc.prototype.set=function(t){this.current!==t&&(this.context.gl.depthFunc(t),this.current=t)};var Blend=function(t){this.context=t,this.current=!1};Blend.prototype.get=function(){return this.current},Blend.prototype.set=function(t){if(this.current!==t){var e=this.context.gl;t?e.enable(e.BLEND):e.disable(e.BLEND),this.current=t}};var BlendFunc=function(t){this.context=t;var e=this.context.gl;this.current=[e.ONE,e.ZERO]};BlendFunc.prototype.get=function(){return this.current},BlendFunc.prototype.set=function(t){var e=this.current;t[0]===e[0]&&t[1]===e[1]||(this.context.gl.blendFunc(t[0],t[1]),this.current=t)};var BlendColor=function(t){this.context=t,this.current=Color.transparent};BlendColor.prototype.get=function(){return this.current},BlendColor.prototype.set=function(t){var e=this.current;t.r===e.r&&t.g===e.g&&t.b===e.b&&t.a===e.a||(this.context.gl.blendColor(t.r,t.g,t.b,t.a),this.current=t)};var Program=function(t){this.context=t,this.current=null};Program.prototype.get=function(){return this.current},Program.prototype.set=function(t){this.current!==t&&(this.context.gl.useProgram(t),this.current=t)};var LineWidth=function(t){this.context=t,this.current=1};LineWidth.prototype.get=function(){return this.current},LineWidth.prototype.set=function(t){var e=this.context.lineWidthRange,r=util.clamp(t,e[0],e[1]);this.current!==r&&(this.context.gl.lineWidth(r),this.current=t)};var ActiveTextureUnit=function(t){this.context=t,this.current=t.gl.TEXTURE0};ActiveTextureUnit.prototype.get=function(){return this.current},ActiveTextureUnit.prototype.set=function(t){this.current!==t&&(this.context.gl.activeTexture(t),this.current=t)};var Viewport=function(t){this.context=t;var e=this.context.gl;this.current=[0,0,e.drawingBufferWidth,e.drawingBufferHeight]};Viewport.prototype.get=function(){return this.current},Viewport.prototype.set=function(t){var e=this.current;t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]||(this.context.gl.viewport(t[0],t[1],t[2],t[3]),this.current=t)};var BindFramebuffer=function(t){this.context=t,this.current=null};BindFramebuffer.prototype.get=function(){return this.current},BindFramebuffer.prototype.set=function(t){if(this.current!==t){var e=this.context.gl;e.bindFramebuffer(e.FRAMEBUFFER,t),this.current=t}};var BindRenderbuffer=function(t){this.context=t,this.current=null};BindRenderbuffer.prototype.get=function(){return this.current},BindRenderbuffer.prototype.set=function(t){if(this.current!==t){var e=this.context.gl;e.bindRenderbuffer(e.RENDERBUFFER,t),this.current=t}};var BindTexture=function(t){this.context=t,this.current=null};BindTexture.prototype.get=function(){return this.current},BindTexture.prototype.set=function(t){if(this.current!==t){var e=this.context.gl;e.bindTexture(e.TEXTURE_2D,t),this.current=t}};var BindVertexBuffer=function(t){this.context=t,this.current=null};BindVertexBuffer.prototype.get=function(){return this.current},BindVertexBuffer.prototype.set=function(t){if(this.current!==t){var e=this.context.gl;e.bindBuffer(e.ARRAY_BUFFER,t),this.current=t}};var BindElementBuffer=function(t){this.context=t,this.current=null};BindElementBuffer.prototype.get=function(){return this.current},BindElementBuffer.prototype.set=function(t){var e=this.context.gl;e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,t),this.current=t};var BindVertexArrayOES=function(t){this.context=t,this.current=null};BindVertexArrayOES.prototype.get=function(){return this.current},BindVertexArrayOES.prototype.set=function(t){this.current!==t&&this.context.extVertexArrayObject&&(this.context.extVertexArrayObject.bindVertexArrayOES(t),this.current=t)};var PixelStoreUnpack=function(t){this.context=t,this.current=4};PixelStoreUnpack.prototype.get=function(){return this.current},PixelStoreUnpack.prototype.set=function(t){if(this.current!==t){var e=this.context.gl;e.pixelStorei(e.UNPACK_ALIGNMENT,t),this.current=t}};var PixelStoreUnpackPremultiplyAlpha=function(t){this.context=t,this.current=!1};PixelStoreUnpackPremultiplyAlpha.prototype.get=function(){return this.current},PixelStoreUnpackPremultiplyAlpha.prototype.set=function(t){if(this.current!==t){var e=this.context.gl;e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,t),this.current=t}};var FramebufferValue=function(t,e){this.context=t,this.current=null,this.parent=e};FramebufferValue.prototype.get=function(){return this.current};var ColorAttachment=function(t){function e(e,r){t.call(this,e,r),this.dirty=!1}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.set=function(t){if(this.dirty||this.current!==t){var e=this.context.gl;this.context.bindFramebuffer.set(this.parent),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,t,0),this.current=t,this.dirty=!1}},e.prototype.setDirty=function(){this.dirty=!0},e}(FramebufferValue),DepthAttachment=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.set=function(t){if(this.current!==t){var e=this.context.gl;this.context.bindFramebuffer.set(this.parent),e.framebufferRenderbuffer(e.FRAMEBUFFER,e.DEPTH_ATTACHMENT,e.RENDERBUFFER,t),this.current=t}},e}(FramebufferValue);module.exports={ClearColor:ClearColor,ClearDepth:ClearDepth,ClearStencil:ClearStencil,ColorMask:ColorMask,DepthMask:DepthMask,StencilMask:StencilMask,StencilFunc:StencilFunc,StencilOp:StencilOp,StencilTest:StencilTest,DepthRange:DepthRange,DepthTest:DepthTest,DepthFunc:DepthFunc,Blend:Blend,BlendFunc:BlendFunc,BlendColor:BlendColor,Program:Program,LineWidth:LineWidth,ActiveTextureUnit:ActiveTextureUnit,Viewport:Viewport,BindFramebuffer:BindFramebuffer,BindRenderbuffer:BindRenderbuffer,BindTexture:BindTexture,BindVertexBuffer:BindVertexBuffer,BindElementBuffer:BindElementBuffer,BindVertexArrayOES:BindVertexArrayOES,PixelStoreUnpack:PixelStoreUnpack,PixelStoreUnpackPremultiplyAlpha:PixelStoreUnpackPremultiplyAlpha,ColorAttachment:ColorAttachment,DepthAttachment:DepthAttachment};
},{"../style-spec/util/color":173,"../util/util":315}],87:[function(_dereq_,module,exports){
"use strict";var AttributeType={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"},VertexBuffer=function(t,e,r,i){this.length=e.length,this.attributes=r,this.itemSize=e.bytesPerElement,this.dynamicDraw=i,this.context=t;var f=t.gl;this.buffer=f.createBuffer(),t.bindVertexBuffer.set(this.buffer),f.bufferData(f.ARRAY_BUFFER,e.arrayBuffer,this.dynamicDraw?f.DYNAMIC_DRAW:f.STATIC_DRAW),this.dynamicDraw||delete e.arrayBuffer};VertexBuffer.prototype.bind=function(){this.context.bindVertexBuffer.set(this.buffer)},VertexBuffer.prototype.updateData=function(t){var e=this.context.gl;this.bind(),e.bufferSubData(e.ARRAY_BUFFER,0,t.arrayBuffer)},VertexBuffer.prototype.enableAttributes=function(t,e){for(var r=this,i=0;i<this.attributes.length;i++){var f=r.attributes[i],n=e.attributes[f.name];void 0!==n&&t.enableVertexAttribArray(n)}},VertexBuffer.prototype.setVertexAttribPointers=function(t,e,r){for(var i=this,f=0;f<this.attributes.length;f++){var n=i.attributes[f],u=e.attributes[n.name];void 0!==u&&t.vertexAttribPointer(u,n.components,t[AttributeType[n.type]],!1,i.itemSize,n.offset+i.itemSize*(r||0))}},VertexBuffer.prototype.destroy=function(){var t=this.context.gl;this.buffer&&(t.deleteBuffer(this.buffer),delete this.buffer)},module.exports=VertexBuffer;
},{}],88:[function(_dereq_,module,exports){
"use strict";var supported=_dereq_("./_minemap_/minemap-supported"),browser=_dereq_("./util/browser"),version=_dereq_("../package.json").version,Map=_dereq_("./ui/map"),Navigation=_dereq_("./ui/control/navigation_control"),Geolocate=_dereq_("./ui/control/geolocate_control"),Attribution=_dereq_("./ui/control/attribution_control"),Scale=_dereq_("./ui/control/scale_control"),Fullscreen=_dereq_("./ui/control/fullscreen_control"),Popup=_dereq_("./ui/popup"),Marker=_dereq_("./ui/marker"),Style=_dereq_("./style/style"),LngLat=_dereq_("./geo/lng_lat"),LngLatBounds=_dereq_("./geo/lng_lat_bounds"),Point=_dereq_("./_minemap_/point-geometry"),Evented=_dereq_("./util/evented"),config=_dereq_("./util/config"),service=_dereq_("./util/service"),IndoorMap=_dereq_("./util/indoor/indoormap"),EvaluationParameters=_dereq_("./style/evaluation_parameters"),util={getJSON:_dereq_("./util/ajax").getJSON,getArrayBuffer:_dereq_("./util/ajax").getArrayBuffer};module.exports={version:version,supported:supported,workerCount:Math.max(Math.floor(browser.hardwareConcurrency/2),1),Map:Map,Navigation:Navigation,Geolocate:Geolocate,Attribution:Attribution,Scale:Scale,Fullscreen:Fullscreen,Popup:Popup,Marker:Marker,Style:Style,LngLat:LngLat,LngLatBounds:LngLatBounds,Point:Point,Evented:Evented,config:config,service:service,IndoorMap:IndoorMap,util:util,browser:browser,EvaluationParameters:EvaluationParameters,get accessToken(){return config.ACCESS_TOKEN},set accessToken(e){config.ACCESS_TOKEN=e},get solution(){return config.SOLU},set solution(e){config.SOLU=e},get dataVersion(){return config.DATA_VERSION},set dataVersion(e){config.DATA_VERSION=e},get TRW(){return config.TRW},set TRW(e){config.TRW=e},get spriteUrl(){return config.spriteUrl},set spriteUrl(e){config.spriteUrl=e},get fontsUrl(){return config.fontsUrl},set fontsUrl(e){config.fontsUrl=e},get serviceUrl(){return config.SERVICE_URL},set serviceUrl(e){config.SERVICE_URL=e},get domainUrl(){return config.DOMAIN},set domainUrl(e){config.DOMAIN=e,config.SRC_URL=config.DOMAIN+config.SRC_BASE,config.SERVICE_URL=config.DOMAIN+config.SERVICE_BASE},get dataDomainUrl(){return config.DATA_DOMAIN},set dataDomainUrl(e){config.DATA_DOMAIN=e,config.API_URL=config.DATA_DOMAIN+config.API_BASE,config.DYN_URL=config.DATA_DOMAIN+config.DYN_BASE,config.MERGE_URL=config.DATA_DOMAIN+config.MERGE_BASE,config.OTHER_URL=config.DATA_DOMAIN+config.OTHER_BASE}};
},{"../package.json":15,"./_minemap_/minemap-supported":28,"./_minemap_/point-geometry":29,"./geo/lng_lat":76,"./geo/lng_lat_bounds":77,"./style/evaluation_parameters":202,"./style/style":210,"./ui/control/attribution_control":265,"./ui/control/fullscreen_control":266,"./ui/control/geolocate_control":267,"./ui/control/navigation_control":269,"./ui/control/scale_control":270,"./ui/map":281,"./ui/marker":282,"./ui/popup":283,"./util/ajax":285,"./util/browser":286,"./util/config":290,"./util/evented":295,"./util/indoor/indoormap":300,"./util/service":308}],89:[function(_dereq_,module,exports){
"use strict";function drawLineTile(e,r,t,i,n,s,o,a,u,l){var f=r.context,m=f.gl;(a||u)&&m.uniform2f(e.uniforms.u_gl_units_to_pixels,1/r.transform.pixelsToGLUnits[0],1/r.transform.pixelsToGLUnits[1]),m.uniform1f(e.uniforms.u_start,l-segmentGroup),m.uniform1f(e.uniforms.u_segments,segmentGroup),m.uniform1f(e.uniforms.u_discard,discardLine),f.setStencilMode(r.stencilModeForClipping(s));var p=r.translatePosMatrix(s.posMatrix,t,n.paint.get("airline-translate"),n.paint.get("airline-translate-anchor"));m.uniformMatrix4fv(e.uniforms.u_matrix,!1,p),m.uniform1f(e.uniforms.u_ratio,1/pixelsToTileUnits(t,1,r.transform.zoom)),e.draw(f,m.TRIANGLES,n.id,i.layoutVertexBuffer,i.indexBuffer,i.segments,o)}var browser=_dereq_("../util/browser"),pixelsToTileUnits=_dereq_("../source/pixels_to_tile_units"),DepthMode=_dereq_("../gl/depth_mode"),tileDrawHelper=_dereq_("../gl/tile_draw_helper"),segmentGroup=20,discardLine=0;module.exports=function(e,r,t,i){var n=this;if(0!==t.paint.get("airline-opacity"))if("offscreen"===e.renderPass){tileDrawHelper.drawToExtrusionFramebuffer(e,t),segmentGroup=t.paint.get("airline-seg-group")||20,discardLine="none"===t.paint.get("airline-type")?0:1,"real-time"===t.paint.get("airline-type")&&(this.count||(this.start=(new Date).getTime(),this.count=1),this.end=(new Date).getTime(),this.end-this.start>=1e3/t.paint.get("airline-speed")&&(this.count+=1,this.start=this.end));for(var s,o=!0,a=0,u=i;a<u.length;a+=1){var l=u[a],f=r.getTile(l),m=f.getBucket(t);if(m){var p=m.programConfigurations.get(t.id),g=e.context.program.get(),d=e.useProgram("airline",p),c=o||d.program!==g,x=s!==f.tileID.overscaledZ;c&&p.setUniforms(e.context,d,t.paint,{zoom:e.transform.zoom}),drawLineTile(d,e,f,m,t,l,p,c,x,n.count),s=f.tileID.overscaledZ,o=!1}}}else"translucent"===e.renderPass&&tileDrawHelper.drawExtrusionTexture(e,t)};
},{"../gl/depth_mode":81,"../gl/tile_draw_helper":85,"../source/pixels_to_tile_units":125,"../util/browser":286}],90:[function(_dereq_,module,exports){
"use strict";function drawBackground(e,t,r){var a=r.paint.get("background-color"),n=r.paint.get("background-opacity");if(0!==n){var o=e.context,i=o.gl,d=e.transform,u=d.tileSize,l=r.paint.get("background-pattern"),s=l||1!==a.a||1!==n?"translucent":"opaque";if(e.renderPass===s){o.setStencilMode(StencilMode.disabled),o.setDepthMode(e.depthModeForSublayer(0,"opaque"===s?DepthMode.ReadWrite:DepthMode.ReadOnly)),o.setColorMode(e.colorModeForRenderPass());var p;if(l){if(pattern.isPatternMissing(l,e))return;p=e.useProgram("backgroundPattern"),pattern.prepare(l,e,p),e.tileExtentPatternVAO.bind(o,p,e.tileExtentBuffer,[])}else p=e.useProgram("background"),i.uniform4fv(p.uniforms.u_color,[a.r,a.g,a.b,a.a]),e.tileExtentVAO.bind(o,p,e.tileExtentBuffer,[]);i.uniform1f(p.uniforms.u_opacity,n);for(var c=d.coveringTiles({tileSize:u},!0),f=0,g=c;f<g.length;f+=1){var m=g[f];l&&pattern.setTile({tileID:m,tileSize:u},e,p),i.uniformMatrix4fv(p.uniforms.u_matrix,!1,e.transform.calculatePosMatrix(m.toUnwrapped())),i.drawArrays(i.TRIANGLE_STRIP,0,e.tileExtentBuffer.length)}}}}var pattern=_dereq_("./pattern"),StencilMode=_dereq_("../gl/stencil_mode"),DepthMode=_dereq_("../gl/depth_mode");module.exports=drawBackground;
},{"../gl/depth_mode":81,"../gl/stencil_mode":84,"./pattern":112}],91:[function(_dereq_,module,exports){
"use strict";function drawCircles(e,t,r,i){if("translucent"===e.renderPass){var o=r.paint.get("circle-opacity"),a=r.paint.get("circle-stroke-width"),n=r.paint.get("circle-stroke-opacity");if(0!==o.constantOr(1)||0!==a.constantOr(1)&&0!==n.constantOr(1)){var s=e.context,c=s.gl;s.setDepthMode(e.depthModeForSublayer(0,DepthMode.ReadOnly)),s.setStencilMode(StencilMode.disabled),s.setColorMode(e.colorModeForRenderPass());for(var l=!0,m=0;m<i.length;m++){var u=i[m],f=t.getTile(u),p=f.getBucket(r);if(p){var d=e.context.program.get(),_=p.programConfigurations.get(r.id),g=e.useProgram("circle",_);if((l||g.program!==d)&&(_.setUniforms(s,g,r.paint,{zoom:e.transform.zoom}),l=!1),c.uniform1f(g.uniforms.u_camera_to_center_distance,e.transform.cameraToCenterDistance),c.uniform1i(g.uniforms.u_scale_with_map,"map"===r.paint.get("circle-pitch-scale")?1:0),"map"===r.paint.get("circle-pitch-alignment")){c.uniform1i(g.uniforms.u_pitch_with_map,1);var h=pixelsToTileUnits(f,1,e.transform.zoom);c.uniform2f(g.uniforms.u_extrude_scale,h,h)}else c.uniform1i(g.uniforms.u_pitch_with_map,0),c.uniform2fv(g.uniforms.u_extrude_scale,e.transform.pixelsToGLUnits);c.uniformMatrix4fv(g.uniforms.u_matrix,!1,e.translatePosMatrix(u.posMatrix,f,r.paint.get("circle-translate"),r.paint.get("circle-translate-anchor"))),g.draw(s,c.TRIANGLES,r.id,p.layoutVertexBuffer,p.indexBuffer,p.segments,_)}}}}}var pixelsToTileUnits=_dereq_("../source/pixels_to_tile_units"),StencilMode=_dereq_("../gl/stencil_mode"),DepthMode=_dereq_("../gl/depth_mode");module.exports=drawCircles;
},{"../gl/depth_mode":81,"../gl/stencil_mode":84,"../source/pixels_to_tile_units":125}],92:[function(_dereq_,module,exports){
"use strict";function drawCollisionDebugGeometry(e,o,i,r,t){var l=e.context,s=l.gl,n=t?e.useProgram("collisionCircle"):e.useProgram("collisionBox");l.setDepthMode(DepthMode.disabled),l.setStencilMode(StencilMode.disabled),l.setColorMode(e.colorModeForRenderPass());for(var u=0;u<r.length;u++){var a=r[u],c=o.getTile(a),m=c.getBucket(i);if(m instanceof SymbolBucket||m instanceof SymtrackingBucket){var d=t?m.collisionCircle:m.collisionBox;if(d){s.uniformMatrix4fv(n.uniforms.u_matrix,!1,a.posMatrix),t||l.lineWidth.set(1),s.uniform1f(n.uniforms.u_camera_to_center_distance,e.transform.cameraToCenterDistance);var f=pixelsToTileUnits(c,1,e.transform.zoom),_=Math.pow(2,e.transform.zoom-c.tileID.overscaledZ);s.uniform1f(n.uniforms.u_pixels_to_tile_units,f),s.uniform2f(n.uniforms.u_extrude_scale,e.transform.pixelsToGLUnits[0]/(f*_),e.transform.pixelsToGLUnits[1]/(f*_)),n.draw(l,t?s.TRIANGLES:s.LINES,i.id,d.layoutVertexBuffer,d.indexBuffer,d.segments,null,d.collisionVertexBuffer,null)}}}}function drawCollisionDebug(e,o,i,r){drawCollisionDebugGeometry(e,o,i,r,!1),drawCollisionDebugGeometry(e,o,i,r,!0)}var pixelsToTileUnits=_dereq_("../source/pixels_to_tile_units"),DepthMode=_dereq_("../gl/depth_mode"),StencilMode=_dereq_("../gl/stencil_mode"),SymbolBucket=_dereq_("../data/bucket/symbol_bucket"),SymtrackingBucket=_dereq_("../data/bucket/symtracking_bucket");module.exports=drawCollisionDebug;
},{"../data/bucket/symbol_bucket":61,"../data/bucket/symtracking_bucket":63,"../gl/depth_mode":81,"../gl/stencil_mode":84,"../source/pixels_to_tile_units":125}],93:[function(_dereq_,module,exports){
"use strict";function drawDebug(e,r,t){for(var o=0;o<t.length;o++)drawDebugTile(e,r,t[o])}function drawDebugTile(e,r,t){var o=e.context,a=o.gl;o.lineWidth.set(1*browser.devicePixelRatio);var i=t.posMatrix,u=e.useProgram("debug");o.setDepthMode(DepthMode.disabled),o.setStencilMode(StencilMode.disabled),o.setColorMode(e.colorModeForRenderPass()),a.uniformMatrix4fv(u.uniforms.u_matrix,!1,i),a.uniform4f(u.uniforms.u_color,1,0,0,1),e.debugVAO.bind(o,u,e.debugBuffer,[]),a.drawArrays(a.LINE_STRIP,0,e.debugBuffer.length);for(var n=createTextVerticies(t.toString(),50,200,5),s=new PosArray,l=0;l<n.length;l+=2)s.emplaceBack(n[l],n[l+1]);var d=o.createVertexBuffer(s,posAttributes.members);(new VertexArrayObject).bind(o,u,d,[]),a.uniform4f(u.uniforms.u_color,1,1,1,1);for(var f=r.getTile(t).tileSize,m=EXTENT/(Math.pow(2,e.transform.zoom-t.overscaledZ)*f),c=[[-1,-1],[-1,1],[1,-1],[1,1]],g=0;g<c.length;g++){var b=c[g];a.uniformMatrix4fv(u.uniforms.u_matrix,!1,mat4.translate([],i,[m*b[0],m*b[1],0])),a.drawArrays(a.LINES,0,d.length)}a.uniform4f(u.uniforms.u_color,0,0,0,1),a.uniformMatrix4fv(u.uniforms.u_matrix,!1,i),a.drawArrays(a.LINES,0,d.length)}function createTextVerticies(e,r,t,o){o=o||1;var a,i,u,n,s,l,d,f,m=[];for(a=0,i=e.length;a<i;a++)if(s=simplexFont[e[a]]){for(f=null,u=0,n=s[1].length;u<n;u+=2)-1===s[1][u]&&-1===s[1][u+1]?f=null:(l=r+s[1][u]*o,d=t-s[1][u+1]*o,f&&m.push(f.x,f.y,l,d),f={x:l,y:d});r+=s[0]*o}return m}var browser=_dereq_("../util/browser"),mat4=_dereq_("../_minemap_/gl-matrix").mat4,EXTENT=_dereq_("../data/extent"),VertexArrayObject=_dereq_("./vertex_array_object"),ref=_dereq_("../data/array_types"),PosArray=ref.PosArray,posAttributes=_dereq_("../data/pos_attributes"),DepthMode=_dereq_("../gl/depth_mode"),StencilMode=_dereq_("../gl/stencil_mode");module.exports=drawDebug;var simplexFont={" ":[16,[]],"!":[10,[5,21,5,7,-1,-1,5,2,4,1,5,0,6,1,5,2]],'"':[16,[4,21,4,14,-1,-1,12,21,12,14]],"#":[21,[11,25,4,-7,-1,-1,17,25,10,-7,-1,-1,4,12,18,12,-1,-1,3,6,17,6]],$:[20,[8,25,8,-4,-1,-1,12,25,12,-4,-1,-1,17,18,15,20,12,21,8,21,5,20,3,18,3,16,4,14,5,13,7,12,13,10,15,9,16,8,17,6,17,3,15,1,12,0,8,0,5,1,3,3]],"%":[24,[21,21,3,0,-1,-1,8,21,10,19,10,17,9,15,7,14,5,14,3,16,3,18,4,20,6,21,8,21,10,20,13,19,16,19,19,20,21,21,-1,-1,17,7,15,6,14,4,14,2,16,0,18,0,20,1,21,3,21,5,19,7,17,7]],"&":[26,[23,12,23,13,22,14,21,14,20,13,19,11,17,6,15,3,13,1,11,0,7,0,5,1,4,2,3,4,3,6,4,8,5,9,12,13,13,14,14,16,14,18,13,20,11,21,9,20,8,18,8,16,9,13,11,10,16,3,18,1,20,0,22,0,23,1,23,2]],"'":[10,[5,19,4,20,5,21,6,20,6,18,5,16,4,15]],"(":[14,[11,25,9,23,7,20,5,16,4,11,4,7,5,2,7,-2,9,-5,11,-7]],")":[14,[3,25,5,23,7,20,9,16,10,11,10,7,9,2,7,-2,5,-5,3,-7]],"*":[16,[8,21,8,9,-1,-1,3,18,13,12,-1,-1,13,18,3,12]],"+":[26,[13,18,13,0,-1,-1,4,9,22,9]],",":[10,[6,1,5,0,4,1,5,2,6,1,6,-1,5,-3,4,-4]],"-":[26,[4,9,22,9]],".":[10,[5,2,4,1,5,0,6,1,5,2]],"/":[22,[20,25,2,-7]],0:[20,[9,21,6,20,4,17,3,12,3,9,4,4,6,1,9,0,11,0,14,1,16,4,17,9,17,12,16,17,14,20,11,21,9,21]],1:[20,[6,17,8,18,11,21,11,0]],2:[20,[4,16,4,17,5,19,6,20,8,21,12,21,14,20,15,19,16,17,16,15,15,13,13,10,3,0,17,0]],3:[20,[5,21,16,21,10,13,13,13,15,12,16,11,17,8,17,6,16,3,14,1,11,0,8,0,5,1,4,2,3,4]],4:[20,[13,21,3,7,18,7,-1,-1,13,21,13,0]],5:[20,[15,21,5,21,4,12,5,13,8,14,11,14,14,13,16,11,17,8,17,6,16,3,14,1,11,0,8,0,5,1,4,2,3,4]],6:[20,[16,18,15,20,12,21,10,21,7,20,5,17,4,12,4,7,5,3,7,1,10,0,11,0,14,1,16,3,17,6,17,7,16,10,14,12,11,13,10,13,7,12,5,10,4,7]],7:[20,[17,21,7,0,-1,-1,3,21,17,21]],8:[20,[8,21,5,20,4,18,4,16,5,14,7,13,11,12,14,11,16,9,17,7,17,4,16,2,15,1,12,0,8,0,5,1,4,2,3,4,3,7,4,9,6,11,9,12,13,13,15,14,16,16,16,18,15,20,12,21,8,21]],9:[20,[16,14,15,11,13,9,10,8,9,8,6,9,4,11,3,14,3,15,4,18,6,20,9,21,10,21,13,20,15,18,16,14,16,9,15,4,13,1,10,0,8,0,5,1,4,3]],":":[10,[5,14,4,13,5,12,6,13,5,14,-1,-1,5,2,4,1,5,0,6,1,5,2]],";":[10,[5,14,4,13,5,12,6,13,5,14,-1,-1,6,1,5,0,4,1,5,2,6,1,6,-1,5,-3,4,-4]],"<":[24,[20,18,4,9,20,0]],"=":[26,[4,12,22,12,-1,-1,4,6,22,6]],">":[24,[4,18,20,9,4,0]],"?":[18,[3,16,3,17,4,19,5,20,7,21,11,21,13,20,14,19,15,17,15,15,14,13,13,12,9,10,9,7,-1,-1,9,2,8,1,9,0,10,1,9,2]],"@":[27,[18,13,17,15,15,16,12,16,10,15,9,14,8,11,8,8,9,6,11,5,14,5,16,6,17,8,-1,-1,12,16,10,14,9,11,9,8,10,6,11,5,-1,-1,18,16,17,8,17,6,19,5,21,5,23,7,24,10,24,12,23,15,22,17,20,19,18,20,15,21,12,21,9,20,7,19,5,17,4,15,3,12,3,9,4,6,5,4,7,2,9,1,12,0,15,0,18,1,20,2,21,3,-1,-1,19,16,18,8,18,6,19,5]],A:[18,[9,21,1,0,-1,-1,9,21,17,0,-1,-1,4,7,14,7]],B:[21,[4,21,4,0,-1,-1,4,21,13,21,16,20,17,19,18,17,18,15,17,13,16,12,13,11,-1,-1,4,11,13,11,16,10,17,9,18,7,18,4,17,2,16,1,13,0,4,0]],C:[21,[18,16,17,18,15,20,13,21,9,21,7,20,5,18,4,16,3,13,3,8,4,5,5,3,7,1,9,0,13,0,15,1,17,3,18,5]],D:[21,[4,21,4,0,-1,-1,4,21,11,21,14,20,16,18,17,16,18,13,18,8,17,5,16,3,14,1,11,0,4,0]],E:[19,[4,21,4,0,-1,-1,4,21,17,21,-1,-1,4,11,12,11,-1,-1,4,0,17,0]],F:[18,[4,21,4,0,-1,-1,4,21,17,21,-1,-1,4,11,12,11]],G:[21,[18,16,17,18,15,20,13,21,9,21,7,20,5,18,4,16,3,13,3,8,4,5,5,3,7,1,9,0,13,0,15,1,17,3,18,5,18,8,-1,-1,13,8,18,8]],H:[22,[4,21,4,0,-1,-1,18,21,18,0,-1,-1,4,11,18,11]],I:[8,[4,21,4,0]],J:[16,[12,21,12,5,11,2,10,1,8,0,6,0,4,1,3,2,2,5,2,7]],K:[21,[4,21,4,0,-1,-1,18,21,4,7,-1,-1,9,12,18,0]],L:[17,[4,21,4,0,-1,-1,4,0,16,0]],M:[24,[4,21,4,0,-1,-1,4,21,12,0,-1,-1,20,21,12,0,-1,-1,20,21,20,0]],N:[22,[4,21,4,0,-1,-1,4,21,18,0,-1,-1,18,21,18,0]],O:[22,[9,21,7,20,5,18,4,16,3,13,3,8,4,5,5,3,7,1,9,0,13,0,15,1,17,3,18,5,19,8,19,13,18,16,17,18,15,20,13,21,9,21]],P:[21,[4,21,4,0,-1,-1,4,21,13,21,16,20,17,19,18,17,18,14,17,12,16,11,13,10,4,10]],Q:[22,[9,21,7,20,5,18,4,16,3,13,3,8,4,5,5,3,7,1,9,0,13,0,15,1,17,3,18,5,19,8,19,13,18,16,17,18,15,20,13,21,9,21,-1,-1,12,4,18,-2]],R:[21,[4,21,4,0,-1,-1,4,21,13,21,16,20,17,19,18,17,18,15,17,13,16,12,13,11,4,11,-1,-1,11,11,18,0]],S:[20,[17,18,15,20,12,21,8,21,5,20,3,18,3,16,4,14,5,13,7,12,13,10,15,9,16,8,17,6,17,3,15,1,12,0,8,0,5,1,3,3]],T:[16,[8,21,8,0,-1,-1,1,21,15,21]],U:[22,[4,21,4,6,5,3,7,1,10,0,12,0,15,1,17,3,18,6,18,21]],V:[18,[1,21,9,0,-1,-1,17,21,9,0]],W:[24,[2,21,7,0,-1,-1,12,21,7,0,-1,-1,12,21,17,0,-1,-1,22,21,17,0]],X:[20,[3,21,17,0,-1,-1,17,21,3,0]],Y:[18,[1,21,9,11,9,0,-1,-1,17,21,9,11]],Z:[20,[17,21,3,0,-1,-1,3,21,17,21,-1,-1,3,0,17,0]],"[":[14,[4,25,4,-7,-1,-1,5,25,5,-7,-1,-1,4,25,11,25,-1,-1,4,-7,11,-7]],"\\":[14,[0,21,14,-3]],"]":[14,[9,25,9,-7,-1,-1,10,25,10,-7,-1,-1,3,25,10,25,-1,-1,3,-7,10,-7]],"^":[16,[6,15,8,18,10,15,-1,-1,3,12,8,17,13,12,-1,-1,8,17,8,0]],_:[16,[0,-2,16,-2]],"`":[10,[6,21,5,20,4,18,4,16,5,15,6,16,5,17]],a:[19,[15,14,15,0,-1,-1,15,11,13,13,11,14,8,14,6,13,4,11,3,8,3,6,4,3,6,1,8,0,11,0,13,1,15,3]],b:[19,[4,21,4,0,-1,-1,4,11,6,13,8,14,11,14,13,13,15,11,16,8,16,6,15,3,13,1,11,0,8,0,6,1,4,3]],c:[18,[15,11,13,13,11,14,8,14,6,13,4,11,3,8,3,6,4,3,6,1,8,0,11,0,13,1,15,3]],d:[19,[15,21,15,0,-1,-1,15,11,13,13,11,14,8,14,6,13,4,11,3,8,3,6,4,3,6,1,8,0,11,0,13,1,15,3]],e:[18,[3,8,15,8,15,10,14,12,13,13,11,14,8,14,6,13,4,11,3,8,3,6,4,3,6,1,8,0,11,0,13,1,15,3]],f:[12,[10,21,8,21,6,20,5,17,5,0,-1,-1,2,14,9,14]],g:[19,[15,14,15,-2,14,-5,13,-6,11,-7,8,-7,6,-6,-1,-1,15,11,13,13,11,14,8,14,6,13,4,11,3,8,3,6,4,3,6,1,8,0,11,0,13,1,15,3]],h:[19,[4,21,4,0,-1,-1,4,10,7,13,9,14,12,14,14,13,15,10,15,0]],i:[8,[3,21,4,20,5,21,4,22,3,21,-1,-1,4,14,4,0]],j:[10,[5,21,6,20,7,21,6,22,5,21,-1,-1,6,14,6,-3,5,-6,3,-7,1,-7]],k:[17,[4,21,4,0,-1,-1,14,14,4,4,-1,-1,8,8,15,0]],l:[8,[4,21,4,0]],m:[30,[4,14,4,0,-1,-1,4,10,7,13,9,14,12,14,14,13,15,10,15,0,-1,-1,15,10,18,13,20,14,23,14,25,13,26,10,26,0]],n:[19,[4,14,4,0,-1,-1,4,10,7,13,9,14,12,14,14,13,15,10,15,0]],o:[19,[8,14,6,13,4,11,3,8,3,6,4,3,6,1,8,0,11,0,13,1,15,3,16,6,16,8,15,11,13,13,11,14,8,14]],p:[19,[4,14,4,-7,-1,-1,4,11,6,13,8,14,11,14,13,13,15,11,16,8,16,6,15,3,13,1,11,0,8,0,6,1,4,3]],q:[19,[15,14,15,-7,-1,-1,15,11,13,13,11,14,8,14,6,13,4,11,3,8,3,6,4,3,6,1,8,0,11,0,13,1,15,3]],r:[13,[4,14,4,0,-1,-1,4,8,5,11,7,13,9,14,12,14]],s:[17,[14,11,13,13,10,14,7,14,4,13,3,11,4,9,6,8,11,7,13,6,14,4,14,3,13,1,10,0,7,0,4,1,3,3]],t:[12,[5,21,5,4,6,1,8,0,10,0,-1,-1,2,14,9,14]],u:[19,[4,14,4,4,5,1,7,0,10,0,12,1,15,4,-1,-1,15,14,15,0]],v:[16,[2,14,8,0,-1,-1,14,14,8,0]],w:[22,[3,14,7,0,-1,-1,11,14,7,0,-1,-1,11,14,15,0,-1,-1,19,14,15,0]],x:[17,[3,14,14,0,-1,-1,14,14,3,0]],y:[16,[2,14,8,0,-1,-1,14,14,8,0,6,-4,4,-6,2,-7,1,-7]],z:[17,[14,14,3,0,-1,-1,3,14,14,14,-1,-1,3,0,14,0]],"{":[14,[9,25,7,24,6,23,5,21,5,19,6,17,7,16,8,14,8,12,6,10,-1,-1,7,24,6,22,6,20,7,18,8,17,9,15,9,13,8,11,4,9,8,7,9,5,9,3,8,1,7,0,6,-2,6,-4,7,-6,-1,-1,6,8,8,6,8,4,7,2,6,1,5,-1,5,-3,6,-5,7,-6,9,-7]],"|":[8,[4,25,4,-7]],"}":[14,[5,25,7,24,8,23,9,21,9,19,8,17,7,16,6,14,6,12,8,10,-1,-1,7,24,8,22,8,20,7,18,6,17,5,15,5,13,6,11,10,9,6,7,5,5,5,3,6,1,7,0,8,-2,8,-4,7,-6,-1,-1,8,8,6,6,6,4,7,2,8,1,9,-1,9,-3,8,-5,7,-6,5,-7]],"~":[24,[3,6,3,8,4,11,6,12,8,12,10,11,14,8,16,7,18,7,20,8,21,10,-1,-1,3,8,4,10,6,11,8,11,10,10,14,7,16,6,18,6,20,7,21,10,21,12]]};
},{"../_minemap_/gl-matrix":27,"../data/array_types":41,"../data/extent":67,"../data/pos_attributes":71,"../gl/depth_mode":81,"../gl/stencil_mode":84,"../util/browser":286,"./vertex_array_object":116}],94:[function(_dereq_,module,exports){
"use strict";function drawLineTile(e,i,t,r,n,o,a,s,u,f){var m,l,g,d,p=i.context,_=p.gl,c=n.paint.get("dynamicLine-dasharray"),h=n.paint.get("dynamicLine-pattern");if(s||u){var x=1/pixelsToTileUnits(t,1,i.transform.tileZoom);if(c){m=i.lineAtlas.getDash(c.from,"round"===n.layout.get("dynamicLine-cap")),l=i.lineAtlas.getDash(c.to,"round"===n.layout.get("dynamicLine-cap"));var y=m.width*c.fromScale,v=l.width*c.toScale;_.uniform2f(e.uniforms.u_patternscale_a,x/y,-m.height/2),_.uniform2f(e.uniforms.u_patternscale_b,x/v,-l.height/2),_.uniform1f(e.uniforms.u_sdfgamma,i.lineAtlas.width/(256*Math.min(y,v)*browser.devicePixelRatio)/2)}else if(h){if(g=i.imageManager.getPattern(h.from),d=i.imageManager.getPattern(h.to),!g||!d)return;_.uniform2f(e.uniforms.u_pattern_size_a,g.displaySize[0]*h.fromScale/x,d.displaySize[1]),_.uniform2f(e.uniforms.u_pattern_size_b,d.displaySize[0]*h.toScale/x,d.displaySize[1]);var T=i.imageManager.getPixelSize(),M=T.width,b=T.height;_.uniform2fv(e.uniforms.u_texsize,[M,b])}_.uniform2f(e.uniforms.u_gl_units_to_pixels,1/i.transform.pixelsToGLUnits[0],1/i.transform.pixelsToGLUnits[1])}s&&(c?(_.uniform1i(e.uniforms.u_image,0),p.activeTexture.set(_.TEXTURE0),i.lineAtlas.bind(p),_.uniform1f(e.uniforms.u_tex_y_a,m.y),_.uniform1f(e.uniforms.u_tex_y_b,l.y),_.uniform1f(e.uniforms.u_mix,c.t)):h&&(_.uniform1i(e.uniforms.u_image,0),p.activeTexture.set(_.TEXTURE0),i.imageManager.bind(p),_.uniform2fv(e.uniforms.u_pattern_tl_a,g.tl),_.uniform2fv(e.uniforms.u_pattern_br_a,g.br),_.uniform2fv(e.uniforms.u_pattern_tl_b,d.tl),_.uniform2fv(e.uniforms.u_pattern_br_b,d.br),_.uniform1f(e.uniforms.u_fade,h.t))),p.setStencilMode(i.stencilModeForClipping(o));var L=i.translatePosMatrix(o.posMatrix,t,n.paint.get("dynamicLine-translate"),n.paint.get("dynamicLine-translate-anchor"));_.uniformMatrix4fv(e.uniforms.u_matrix,!1,L),_.uniform1f(e.uniforms.u_ratio,1/pixelsToTileUnits(t,1,i.transform.zoom)),_.uniform1f(e.uniforms.u_count,f),_.uniform1f(e.uniforms.u_segments,segmentGroup),e.draw(p,_.TRIANGLES,n.id,r.layoutVertexBuffer,r.indexBuffer,r.segments,a)}var browser=_dereq_("../util/browser"),pixelsToTileUnits=_dereq_("../source/pixels_to_tile_units"),DepthMode=_dereq_("../gl/depth_mode"),config=_dereq_("../util/config"),segmentGroup=20;module.exports=function(e,i,t,r){if("translucent"===e.renderPass){if(0!==t.paint.get("dynamicLine-opacity").constantOr(1)){var n=e.context;n.setDepthMode(e.depthModeForSublayer(0,DepthMode.ReadOnly)),n.setColorMode(e.colorModeForRenderPass()),segmentGroup=t.paint.get("dynamicLine-seg-group")||20,t.histEnd=(new Date).getTime(),t.first||(t.first=!0,t.histStart=0,t.histCount=0),t.histEnd-t.histStart>=1e3/t.paint.get("dynamicLine-speed")&&(t.histCount++,config.TRW&&config.TRW.setProgress(this.histCount),t.histStart=t.histEnd);for(var o,a=!0,s=0,u=r;s<u.length;s+=1){var f=u[s],m=i.getTile(f),l=m.getBucket(t);if(l){var g=l.programConfigurations.get(t.id),d=e.context.program.get(),p=e.useProgram("dynamicLine",g),_=a||p.program!==d,c=o!==m.tileID.overscaledZ;_&&g.setUniforms(e.context,p,t.paint,{zoom:e.transform.zoom}),drawLineTile(p,e,m,l,t,f,g,_,c,t.histCount),o=m.tileID.overscaledZ,a=!1}}}}};
},{"../gl/depth_mode":81,"../source/pixels_to_tile_units":125,"../util/browser":286,"../util/config":290}],95:[function(_dereq_,module,exports){
"use strict";function draw(r,t,e,i){if(0!==e.paint.get("extrusion-opacity"))if("offscreen"===r.renderPass){tileDrawHelper.drawToExtrusionFramebuffer(r,e);for(var o=!0,a=0,n=i;a<n.length;a+=1){var s=n[a],u=t.getTile(s),f=u.getBucket(e);f&&(drawExtrusion(r,t,e,u,s,f,o),o=!1)}}else"translucent"===r.renderPass&&tileDrawHelper.drawExtrusionTexture(r,e)}function drawExtrusion(r,t,e,i,o,a,n){var s=r.context,u=s.gl,f=e.paint.get("extrusion-pattern"),l=r.context.program.get(),p=a.programConfigurations.get(e.id),g=r.useProgram(f?"fillExtrusionPattern":"fillExtrusion",p);if((n||g.program!==l)&&p.setUniforms(s,g,e.paint,{zoom:r.transform.zoom}),f){if(pattern.isPatternMissing(f,r))return;pattern.prepare(f,r,g),pattern.setTile(i,r,g),u.uniform1f(g.uniforms.u_height_factor,-Math.pow(2,o.overscaledZ)/i.tileSize/8),u.uniform1f(g.uniforms.u_zoom_factor,Math.pow(2,17-Math.floor(r.transform.zoom)))}r.context.gl.uniformMatrix4fv(g.uniforms.u_matrix,!1,r.translatePosMatrix(o.posMatrix,i,e.paint.get("extrusion-translate"),e.paint.get("extrusion-translate-anchor"))),u.uniform1f(g.uniforms.u_render_road,e.paint.get("render-road")),tileDrawHelper.setExtrusionOpacity(e.paint.get("extrusion-opacity")),setLight(g,r),g.draw(s,u.TRIANGLES,e.id,a.layoutVertexBuffer,a.indexBuffer,a.segments,p)}function setLight(r,t){var e=t.context.gl,i=t.style.light,o=i.properties.get("position"),a=[o.x,o.y,o.z],n=mat3.create();"viewport"===i.properties.get("anchor")&&mat3.fromRotation(n,-t.transform.angle),vec3.transformMat3(a,a,n);var s=i.properties.get("color");e.uniform3fv(r.uniforms.u_lightpos,a),e.uniform1f(r.uniforms.u_lightintensity,i.properties.get("intensity")),e.uniform3f(r.uniforms.u_lightcolor,s.r,s.g,s.b)}var glMatrix=_dereq_("../_minemap_/gl-matrix"),pattern=_dereq_("./pattern"),mat3=glMatrix.mat3,vec3=glMatrix.vec3,tileDrawHelper=_dereq_("../gl/tile_draw_helper");module.exports=draw;
},{"../_minemap_/gl-matrix":27,"../gl/tile_draw_helper":85,"./pattern":112}],96:[function(_dereq_,module,exports){
"use strict";function drawFill(e,t,r,o){var i=r.paint.get("fill-color"),a=r.paint.get("fill-opacity");if(0!==a.constantOr(1)){drawWater="water"===r.paint.get("fill-water");var n=e.context;if(n.setColorMode(e.colorModeForRenderPass()),r.paint.get("render-3d"))"offscreen"===e.renderPass?(tileDrawHelper.drawToExtrusionFramebuffer(e,r),drawFillTiles(e,t,r,o,drawFillTile)):"translucent"===e.renderPass&&tileDrawHelper.drawExtrusionTexture(e,r);else{var l=r.paint.get("fill-pattern")||1!==i.constantOr(Color.transparent).a||1!==a.constantOr(0)?"translucent":"opaque";e.renderPass===l&&(n.setDepthMode(e.depthModeForSublayer(1,"opaque"===e.renderPass?DepthMode.ReadWrite:DepthMode.ReadOnly)),drawFillTiles(e,t,r,o,drawFillTile)),"translucent"===e.renderPass&&r.paint.get("fill-antialias")&&(n.lineWidth.set(2),n.setDepthMode(e.depthModeForSublayer(r.getPaintProperty("fill-outline-color")?2:0,DepthMode.ReadOnly)),drawFillTiles(e,t,r,o,drawStrokeTile))}}}function drawFillTiles(e,t,r,o,i){if(!pattern.isPatternMissing(r.paint.get("fill-pattern"),e))for(var a=!0,n=0,l=o;n<l.length;n+=1){var s=l[n],f=t.getTile(s),p=f.getBucket(r);p&&(e.context.setStencilMode(e.stencilModeForClipping(s)),i(e,t,r,f,s,p,a),a=!1)}}function drawFillTile(e,t,r,o,i,a,n){var l=e.context.gl,s=a.programConfigurations.get(r.id),f=setFillProgram("fill",r.paint.get("fill-pattern"),e,s,r,o,i,n);r.paint.get("render-3d")&&setLight(f,e),f.draw(e.context,l.TRIANGLES,r.id,a.layoutVertexBuffer,a.indexBuffer,a.segments,s)}function drawStrokeTile(e,t,r,o,i,a,n){var l=e.context.gl,s=a.programConfigurations.get(r.id),f=r.getPaintProperty("fill-outline-color")?null:r.paint.get("fill-pattern"),p=setFillProgram("fillOutline",f,e,s,r,o,i,n);l.uniform2f(p.uniforms.u_world,l.drawingBufferWidth,l.drawingBufferHeight),p.draw(e.context,l.LINES,r.id,a.layoutVertexBuffer,a.indexBuffer2,a.segments2,s)}function setFillProgram(e,t,r,o,i,a,n,l){var s,f=r.context.program.get();return drawWater?(s=r.useProgram("fillWater",o),(l||s.program!==f)&&o.setUniforms(r.context,s,i.paint,{zoom:r.transform.zoom}),r.context.gl.uniform1f(s.uniforms.u_time,performance.now()/1e3)):t?(s=r.useProgram(e+"Pattern",o),(l||s.program!==f)&&(o.setUniforms(r.context,s,i.paint,{zoom:r.transform.zoom}),pattern.prepare(t,r,s),r.context.gl.uniform1f(s.uniforms.u_zoom_factor,Math.pow(2,20-Math.floor(r.transform.zoom)))),pattern.setTile(a,r,s)):(s=r.useProgram(i.paint.get("render-3d")?"fill3d":e,o),(l||s.program!==f)&&o.setUniforms(r.context,s,i.paint,{zoom:r.transform.zoom})),r.context.gl.uniformMatrix4fv(s.uniforms.u_matrix,!1,r.translatePosMatrix(n.posMatrix,a,i.paint.get("fill-translate"),i.paint.get("fill-translate-anchor"))),s}function setLight(e,t){var r=t.context.gl,o=t.style.light,i=o.properties.get("position"),a=[i.x,i.y,i.z],n=mat3.create();"viewport"===o.properties.get("anchor")&&mat3.fromRotation(n,-t.transform.angle),vec3.transformMat3(a,a,n);var l=o.properties.get("color");r.uniform3fv(e.uniforms.u_lightpos,a),r.uniform1f(e.uniforms.u_lightintensity,o.properties.get("intensity")),r.uniform3f(e.uniforms.u_lightcolor,l.r,l.g,l.b)}var glMatrix=_dereq_("../_minemap_/gl-matrix"),pattern=_dereq_("./pattern"),mat3=glMatrix.mat3,vec3=glMatrix.vec3,Color=_dereq_("../style-spec/util/color"),DepthMode=_dereq_("../gl/depth_mode"),tileDrawHelper=_dereq_("../gl/tile_draw_helper"),drawWater=!1;module.exports=drawFill;
},{"../_minemap_/gl-matrix":27,"../gl/depth_mode":81,"../gl/tile_draw_helper":85,"../style-spec/util/color":173,"./pattern":112}],97:[function(_dereq_,module,exports){
"use strict";function drawHeatmap(e,t,r,a){if(0!==r.paint.get("heatmap-opacity"))if("offscreen"===e.renderPass){var o=e.context,i=o.gl;o.setDepthMode(e.depthModeForSublayer(0,DepthMode.ReadOnly)),o.setStencilMode(StencilMode.disabled),bindFramebuffer(o,e,r),o.clear({color:Color.transparent}),o.setColorMode(new ColorMode([i.ONE,i.ONE],Color.transparent,[!0,!0,!0,!0]));for(var n=!0,u=0;u<a.length;u++){var T=a[u];if(!t.hasRenderableParent(T)){var m=t.getTile(T),f=m.getBucket(r);if(f){var l=e.context.program.get(),s=f.programConfigurations.get(r.id),d=e.useProgram("heatmap",s),E=e.transform,x=E.zoom;(n||d.program!==l)&&(s.setUniforms(e.context,d,r.paint,{zoom:x}),n=!1),i.uniform1f(d.uniforms.u_extrude_scale,pixelsToTileUnits(m,1,x)),i.uniform1f(d.uniforms.u_intensity,r.paint.get("heatmap-intensity")),i.uniformMatrix4fv(d.uniforms.u_matrix,!1,T.posMatrix),d.draw(o,i.TRIANGLES,r.id,f.layoutVertexBuffer,f.indexBuffer,f.segments,s)}}}o.viewport.set([0,0,e.width,e.height])}else"translucent"===e.renderPass&&(e.context.setColorMode(e.colorModeForRenderPass()),renderTextureToMap(e,r))}function bindFramebuffer(e,t,r){var a=e.gl;e.activeTexture.set(a.TEXTURE1),e.viewport.set([0,0,t.width/4,t.height/4]);var o=r.heatmapFbo;if(o)a.bindTexture(a.TEXTURE_2D,o.colorAttachment.get()),e.bindFramebuffer.set(o.framebuffer);else{var i=a.createTexture();a.bindTexture(a.TEXTURE_2D,i),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_S,a.CLAMP_TO_EDGE),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_T,a.CLAMP_TO_EDGE),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,a.LINEAR),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MAG_FILTER,a.LINEAR),o=r.heatmapFbo=e.createFramebuffer(t.width/4,t.height/4),bindTextureToFramebuffer(e,t,i,o)}}function bindTextureToFramebuffer(e,t,r,a){var o=e.gl;o.texImage2D(o.TEXTURE_2D,0,o.RGBA,t.width/4,t.height/4,0,o.RGBA,e.extTextureHalfFloat?e.extTextureHalfFloat.HALF_FLOAT_OES:o.UNSIGNED_BYTE,null),a.colorAttachment.set(r),e.extTextureHalfFloat&&o.checkFramebufferStatus(o.FRAMEBUFFER)!==o.FRAMEBUFFER_COMPLETE&&(e.extTextureHalfFloat=null,a.colorAttachment.setDirty(),bindTextureToFramebuffer(e,t,r,a))}function renderTextureToMap(e,t){var r=e.context,a=r.gl,o=t.heatmapFbo;if(o){r.activeTexture.set(a.TEXTURE0),a.bindTexture(a.TEXTURE_2D,o.colorAttachment.get()),r.activeTexture.set(a.TEXTURE1);var i=t.colorRampTexture;i||(i=t.colorRampTexture=new Texture(r,t.colorRamp,a.RGBA)),i.bind(a.LINEAR,a.CLAMP_TO_EDGE),r.setDepthMode(DepthMode.disabled);var n=e.useProgram("heatmapTexture"),u=t.paint.get("heatmap-opacity");a.uniform1f(n.uniforms.u_opacity,u),a.uniform1i(n.uniforms.u_image,0),a.uniform1i(n.uniforms.u_color_ramp,1);var T=mat4.create();mat4.ortho(T,0,e.width,e.height,0,0,1),a.uniformMatrix4fv(n.uniforms.u_matrix,!1,T),a.uniform2f(n.uniforms.u_world,a.drawingBufferWidth,a.drawingBufferHeight),e.viewportVAO.bind(e.context,n,e.viewportBuffer,[]),a.drawArrays(a.TRIANGLE_STRIP,0,4)}}var mat4=_dereq_("../_minemap_/gl-matrix").mat4,Texture=_dereq_("./texture"),pixelsToTileUnits=_dereq_("../source/pixels_to_tile_units"),Color=_dereq_("../style-spec/util/color"),DepthMode=_dereq_("../gl/depth_mode"),StencilMode=_dereq_("../gl/stencil_mode"),ColorMode=_dereq_("../gl/color_mode");module.exports=drawHeatmap;
},{"../_minemap_/gl-matrix":27,"../gl/color_mode":79,"../gl/depth_mode":81,"../gl/stencil_mode":84,"../source/pixels_to_tile_units":125,"../style-spec/util/color":173,"./texture":114}],98:[function(_dereq_,module,exports){
"use strict";function drawHillshade(e,r,t,a){if("offscreen"===e.renderPass||"translucent"===e.renderPass){var i=e.context;i.setDepthMode(e.depthModeForSublayer(0,DepthMode.ReadOnly)),i.setStencilMode(StencilMode.disabled),i.setColorMode(e.colorModeForRenderPass());for(var n=0,o=a;n<o.length;n+=1){var s=o[n],d=r.getTile(s);d.needsHillshadePrepare&&"offscreen"===e.renderPass?prepareHillshade(e,d):"translucent"===e.renderPass&&renderHillshade(e,d,t)}i.viewport.set([0,0,e.width,e.height])}}function setLight(e,r,t){var a=t.paint.get("hillshade-illumination-direction")*(Math.PI/180);"viewport"===t.paint.get("hillshade-illumination-anchor")&&(a-=r.transform.angle),r.context.gl.uniform2f(e.uniforms.u_light,t.paint.get("hillshade-exaggeration"),a)}function getTileLatRange(e,r){var t=r.toCoordinate(),a=new Coordinate(t.column,t.row+1,t.zoom);return[e.transform.coordinateLocation(t).lat,e.transform.coordinateLocation(a).lat]}function renderHillshade(e,r,t){var a=e.context,i=a.gl,n=r.fbo;if(n){var o=e.useProgram("hillshade"),s=e.transform.calculatePosMatrix(r.tileID.toUnwrapped());setLight(o,e,t);var d=getTileLatRange(e,r.tileID);a.activeTexture.set(i.TEXTURE0),i.bindTexture(i.TEXTURE_2D,n.colorAttachment.get()),i.uniformMatrix4fv(o.uniforms.u_matrix,!1,s),i.uniform2fv(o.uniforms.u_latrange,d),i.uniform1i(o.uniforms.u_image,0);var l=t.paint.get("hillshade-shadow-color");i.uniform4f(o.uniforms.u_shadow,l.r,l.g,l.b,l.a);var u=t.paint.get("hillshade-highlight-color");i.uniform4f(o.uniforms.u_highlight,u.r,u.g,u.b,u.a);var f=t.paint.get("hillshade-accent-color");if(i.uniform4f(o.uniforms.u_accent,f.r,f.g,f.b,f.a),r.maskedBoundsBuffer&&r.maskedIndexBuffer&&r.segments)o.draw(a,i.TRIANGLES,t.id,r.maskedBoundsBuffer,r.maskedIndexBuffer,r.segments);else{var m=e.rasterBoundsBuffer;e.rasterBoundsVAO.bind(a,o,m,[]),i.drawArrays(i.TRIANGLE_STRIP,0,m.length)}}}function prepareHillshade(e,r){var t=e.context,a=t.gl;if(r.dem&&r.dem.level){var i=r.dem.level.dim,n=r.dem.getPixels();if(t.activeTexture.set(a.TEXTURE1),t.pixelStoreUnpackPremultiplyAlpha.set(!1),r.demTexture=r.demTexture||e.getTileTexture(r.tileSize),r.demTexture){var o=r.demTexture;o.update(n,!1),o.bind(a.NEAREST,a.CLAMP_TO_EDGE)}else r.demTexture=new Texture(t,n,a.RGBA,!1),r.demTexture.bind(a.NEAREST,a.CLAMP_TO_EDGE);t.activeTexture.set(a.TEXTURE0);var s=r.fbo;if(!s){var d=new Texture(t,{width:i,height:i,data:null},a.RGBA);d.bind(a.LINEAR,a.CLAMP_TO_EDGE),s=r.fbo=t.createFramebuffer(i,i),s.colorAttachment.set(d.texture)}t.bindFramebuffer.set(s.framebuffer),t.viewport.set([0,0,i,i]);var l=mat4.create();mat4.ortho(l,0,EXTENT,-EXTENT,0,0,1),mat4.translate(l,l,[0,-EXTENT,0]);var u=e.useProgram("hillshadePrepare");a.uniformMatrix4fv(u.uniforms.u_matrix,!1,l),a.uniform1f(u.uniforms.u_zoom,r.tileID.overscaledZ),a.uniform2fv(u.uniforms.u_dimension,[2*i,2*i]),a.uniform1i(u.uniforms.u_image,1);var f=e.rasterBoundsBuffer;e.rasterBoundsVAO.bind(t,u,f,[]),a.drawArrays(a.TRIANGLE_STRIP,0,f.length),r.needsHillshadePrepare=!1}}var Coordinate=_dereq_("../geo/coordinate"),Texture=_dereq_("./texture"),EXTENT=_dereq_("../data/extent"),mat4=_dereq_("../_minemap_/gl-matrix").mat4,StencilMode=_dereq_("../gl/stencil_mode"),DepthMode=_dereq_("../gl/depth_mode");module.exports=drawHillshade;
},{"../_minemap_/gl-matrix":27,"../data/extent":67,"../geo/coordinate":75,"../gl/depth_mode":81,"../gl/stencil_mode":84,"./texture":114}],99:[function(_dereq_,module,exports){
"use strict";function draw(r,t,o,e){if(0!==o.paint.get("histogram-opacity")){if(o.hasOwnProperty("_hasRendered")||(o._hasRendered=!0),o.paint.get("histogram-dynamic"))if(o.hasOwnProperty("_transform")&&o.hasOwnProperty("_count")||(o._transform=Date.now(),o._count=0),config.TRW&&!config.TRW.stayStatic){var i=Date.now()-o._transform;o._count+=i/o.paint.get("histogram-time")*500,o._count>=500*o.paint.get("histogram-count")&&(o._count=0),o._transform=Date.now()}else o._transform=Date.now();if("offscreen"===r.renderPass){tileDrawHelper.drawToExtrusionFramebuffer(r,o);for(var a=!0,n=0,s=e;n<s.length;n+=1){var m=s[n],u=t.getTile(m),f=u.getBucket(o);f&&(drawExtrusion(r,t,o,u,m,f,a),a=!1)}}else"translucent"===r.renderPass&&tileDrawHelper.drawExtrusionTexture(r,o)}}function drawExtrusion(r,t,o,e,i,a,n){var s=r.context,m=s.gl;if(a){var u=o.paint.get("histogram-dynamic"),f=o.layout.get("histogram-color-render"),g=null,l=r.context.program.get(),c=a.programConfigurations.get(o.id);if(g=u?r.useProgram("histogramDynamic",c):r.useProgram(f?"histogramColor":"histogram",c),m.uniform1f(g.uniforms.u_fluorescent,o.paint.get("histogram-fluorescent")),(n||g.program!==l)&&c.setUniforms(s,g,o.paint,{zoom:r.transform.zoom}),f){for(var h=o.paint.get("histogram-colors"),p=o.paint.get("histogram-max-height"),_=[],x=0;x<h.length;x++){var d=colorParser.parseCSSColor(h[x]);d[0]/=255,d[1]/=255,d[2]/=255,_.push(d)}m.uniform1f(g.uniforms.u_max_height,3*p),m.uniform4fv(g.uniforms.u_color_a,_[0]),m.uniform4fv(g.uniforms.u_color_b,_[1]),m.uniform4fv(g.uniforms.u_color_c,_[2]),m.uniform4fv(g.uniforms.u_color_d,_[3]),m.uniform4fv(g.uniforms.u_color_e,_[4])}u&&m.uniform1f(g.uniforms.u_dyn_count,o._count),r.context.gl.uniformMatrix4fv(g.uniforms.u_matrix,!1,r.translatePosMatrix(i.posMatrix,e,o.paint.get("histogram-translate"),o.paint.get("histogram-translate-anchor"))),m.uniform1f(g.uniforms.u_is_max_length,o.layout.get("histogram-max-height-render")),setLight(g,r),g.draw(s,m.TRIANGLES,o.id,a.layoutVertexBuffer,a.indexBuffer,a.segments,c)}}function setLight(r,t){var o=t.context.gl,e=t.style.light,i=e.properties.get("position"),a=[i.x,i.y,i.z],n=mat3.create();"viewport"===e.properties.get("anchor")&&mat3.fromRotation(n,-t.transform.angle),vec3.transformMat3(a,a,n);var s=e.properties.get("color");o.uniform3fv(r.uniforms.u_lightpos,a),o.uniform1f(r.uniforms.u_lightintensity,e.properties.get("intensity")),o.uniform3f(r.uniforms.u_lightcolor,s.r,s.g,s.b)}var glMatrix=_dereq_("../_minemap_/gl-matrix"),mat3=glMatrix.mat3,vec3=glMatrix.vec3,colorParser=_dereq_("csscolorparser"),config=_dereq_("../util/config"),tileDrawHelper=_dereq_("../gl/tile_draw_helper");module.exports=draw;
},{"../_minemap_/gl-matrix":27,"../gl/tile_draw_helper":85,"../util/config":290,"csscolorparser":2}],100:[function(_dereq_,module,exports){
"use strict";function drawLineTile(e,r,i,t,n,o,a,u,f){var s,l,m,g,p=r.context,_=p.gl,d=n.paint.get("line-dasharray"),c=n.paint.get("line-pattern");if(u||f){var h=1/pixelsToTileUnits(i,1,r.transform.tileZoom);if(d){s=r.lineAtlas.getDash(d.from,"round"===n.layout.get("line-cap")),l=r.lineAtlas.getDash(d.to,"round"===n.layout.get("line-cap"));var v=s.width*d.fromScale,x=l.width*d.toScale;_.uniform2f(e.uniforms.u_patternscale_a,h/v,-s.height/2),_.uniform2f(e.uniforms.u_patternscale_b,h/x,-l.height/2),_.uniform1f(e.uniforms.u_sdfgamma,r.lineAtlas.width/(256*Math.min(v,x)*browser.devicePixelRatio)/2)}else if(c){if(m=r.imageManager.getPattern(c.from),g=r.imageManager.getPattern(c.to),!m||!g)return;_.uniform2f(e.uniforms.u_pattern_size_a,m.displaySize[0]*c.fromScale/h,g.displaySize[1]),_.uniform2f(e.uniforms.u_pattern_size_b,g.displaySize[0]*c.toScale/h,g.displaySize[1]);var T=r.imageManager.getPixelSize(),S=T.width,b=T.height;_.uniform2fv(e.uniforms.u_texsize,[S,b])}_.uniform2f(e.uniforms.u_gl_units_to_pixels,1/r.transform.pixelsToGLUnits[0],1/r.transform.pixelsToGLUnits[1])}if(n.paint.get("render-3d")&&_.uniform1f(e.uniforms.u_is_contour,n.paint.get("line-is-contour")),_.uniform1f(e.uniforms.u_half_render,n.paint.get("half-render")),_.uniform1f(e.uniforms.u_interpolate,n.paint.get("line-interpolate")),_.uniform1f(e.uniforms.u_height_offset,n.paint.get("line-height-offset")),n.paint.get("render-3d")&&n.paint.get("line-is-contour")){for(var w=[],y=n.paint.get("line-contour-colors"),M=n.paint.get("line-max-contour-height"),P=0;P<y.length;P++){var D=colorParser.parseCSSColor(y[P]);D[0]/=255,D[1]/=255,D[2]/=255,w.push(D)}_.uniform1f(e.uniforms.u_max_height,5*M),_.uniform1f(e.uniforms.u_shine_height,n.contourCount),_.uniform4fv(e.uniforms.u_color_a,w[0]),_.uniform4fv(e.uniforms.u_color_b,w[1]),_.uniform4fv(e.uniforms.u_color_c,w[2]),_.uniform4fv(e.uniforms.u_color_d,w[3]),_.uniform4fv(e.uniforms.u_color_e,w[4])}else if(n.paint.get("render-3d")&&n.paint.get("line-interpolation")){for(var z=n.paint.get("line-contour-colors"),C=n.paint.get("line-max-contour-height"),U=[],E=0;E<4;E++){var F=colorParser.parseCSSColor(z[E]);F[0]/=255,F[1]/=255,F[2]/=255,U.push(U)}_.uniform1f(e.uniforms.u_max_height,5*C),_.uniform1f(e.uniforms.u_shine_height,n.contourCount),_.uniform4fv(e.uniforms.u_interp_colors,U)}u&&(d?(_.uniform1i(e.uniforms.u_image,0),p.activeTexture.set(_.TEXTURE0),r.lineAtlas.bind(p),_.uniform1f(e.uniforms.u_tex_y_a,s.y),_.uniform1f(e.uniforms.u_tex_y_b,l.y),_.uniform1f(e.uniforms.u_mix,d.t)):c&&(_.uniform1i(e.uniforms.u_image,0),p.activeTexture.set(_.TEXTURE0),r.imageManager.bind(p),_.uniform2fv(e.uniforms.u_pattern_tl_a,m.tl),_.uniform2fv(e.uniforms.u_pattern_br_a,m.br),_.uniform2fv(e.uniforms.u_pattern_tl_b,g.tl),_.uniform2fv(e.uniforms.u_pattern_br_b,g.br),_.uniform1f(e.uniforms.u_fade,c.t))),p.setStencilMode(r.stencilModeForClipping(o));var L=r.translatePosMatrix(o.posMatrix,i,n.paint.get("line-translate"),n.paint.get("line-translate-anchor"));_.uniformMatrix4fv(e.uniforms.u_matrix,!1,L),_.uniform1f(e.uniforms.u_ratio,1/pixelsToTileUnits(i,1,r.transform.zoom)),e.draw(p,_.TRIANGLES,n.id,t.layoutVertexBuffer,t.indexBuffer,t.segments,a)}var browser=_dereq_("../util/browser"),pixelsToTileUnits=_dereq_("../source/pixels_to_tile_units"),DepthMode=_dereq_("../gl/depth_mode"),tileDrawHelper=_dereq_("../gl/tile_draw_helper"),colorParser=_dereq_("csscolorparser");module.exports=function(e,r,i,t){var n=i.paint.get("render-3d");if("translucent"===e.renderPass||n){if(0!==i.paint.get("line-opacity").constantOr(1)){var o=e.context;if(o.setDepthMode(e.depthModeForSublayer(0,DepthMode.ReadOnly)),o.setColorMode(e.colorModeForRenderPass()),n)if(i.contourCount||(i.contourCount=0),i.contourCount+=5,"offscreen"===e.renderPass){var a=i.paint.get("line-dasharray")?"lineSDF3d":i.paint.get("line-pattern")?"linePattern3d":"line3d";tileDrawHelper.drawToExtrusionFramebuffer(e,i);for(var u,f=!0,s=0,l=t;s<l.length;s+=1){var m=l[s],g=r.getTile(m),p=g.getBucket(i);if(p){var _=p.programConfigurations.get(i.id),d=e.context.program.get(),c=e.useProgram(a,_),h=f||c.program!==d,v=u!==g.tileID.overscaledZ;h&&_.setUniforms(e.context,c,i.paint,{zoom:e.transform.zoom}),drawLineTile(c,e,g,p,i,m,_,h,v),u=g.tileID.overscaledZ,f=!1}}}else"translucent"===e.renderPass&&tileDrawHelper.drawExtrusionTexture(e,i);else for(var x,T=i.paint.get("line-dasharray")?"lineSDF":i.paint.get("line-pattern")?"linePattern":"line",S=!0,b=0,w=t;b<w.length;b+=1){var y=w[b],M=r.getTile(y),P=M.getBucket(i);if(P){var D=P.programConfigurations.get(i.id),z=e.context.program.get(),C=e.useProgram(T,D),U=S||C.program!==z,E=x!==M.tileID.overscaledZ;U&&D.setUniforms(e.context,C,i.paint,{zoom:e.transform.zoom}),drawLineTile(C,e,M,P,i,y,D,U,E),x=M.tileID.overscaledZ,S=!1}}}}};
},{"../gl/depth_mode":81,"../gl/tile_draw_helper":85,"../source/pixels_to_tile_units":125,"../util/browser":286,"csscolorparser":2}],101:[function(_dereq_,module,exports){
"use strict";function drawRaster(e,r,t,a){if("translucent"===e.renderPass&&0!==t.paint.get("raster-opacity")){var i=e.context,o=i.gl,n=r.getSource(),s=e.useProgram("raster");i.setStencilMode(StencilMode.disabled),i.setColorMode(e.colorModeForRenderPass()),o.uniform1f(s.uniforms.u_brightness_low,t.paint.get("raster-brightness-min")),o.uniform1f(s.uniforms.u_brightness_high,t.paint.get("raster-brightness-max")),o.uniform1f(s.uniforms.u_saturation_factor,saturationFactor(t.paint.get("raster-saturation"))),o.uniform1f(s.uniforms.u_contrast_factor,contrastFactor(t.paint.get("raster-contrast"))),o.uniform3fv(s.uniforms.u_spin_weights,spinWeights(t.paint.get("raster-hue-rotate"))),o.uniform1f(s.uniforms.u_buffer_scale,1),o.uniform1i(s.uniforms.u_image0,0),o.uniform1i(s.uniforms.u_image1,1);for(var u=a.length&&a[0].overscaledZ,d=0,f=a;d<f.length;d+=1){var c=f[d];i.setDepthMode(e.depthModeForSublayer(c.overscaledZ-u,1===t.paint.get("raster-opacity")?DepthMode.ReadWrite:DepthMode.ReadOnly,o.LESS));var m=r.getTile(c),l=e.transform.calculatePosMatrix(c.toUnwrapped());m.registerFadeDuration(t.paint.get("raster-fade-duration")),o.uniformMatrix4fv(s.uniforms.u_matrix,!1,l);var g=r.findLoadedParent(c,0,{}),p=getFadeValues(m,g,r,t,e.transform),_=void 0,h=void 0;if(i.activeTexture.set(o.TEXTURE0),m.texture.bind(o.LINEAR,o.CLAMP_TO_EDGE,o.LINEAR_MIPMAP_NEAREST),i.activeTexture.set(o.TEXTURE1),g?(g.texture.bind(o.LINEAR,o.CLAMP_TO_EDGE,o.LINEAR_MIPMAP_NEAREST),_=Math.pow(2,g.tileID.overscaledZ-m.tileID.overscaledZ),h=[m.tileID.canonical.x*_%1,m.tileID.canonical.y*_%1]):m.texture.bind(o.LINEAR,o.CLAMP_TO_EDGE,o.LINEAR_MIPMAP_NEAREST),o.uniform2fv(s.uniforms.u_tl_parent,h||[0,0]),o.uniform1f(s.uniforms.u_scale_parent,_||1),o.uniform1f(s.uniforms.u_fade_t,p.mix),o.uniform1f(s.uniforms.u_opacity,p.opacity*t.paint.get("raster-opacity")),n instanceof ImageSource){var E=n.boundsBuffer;n.boundsVAO.bind(i,s,E,[]),o.drawArrays(o.TRIANGLE_STRIP,0,E.length)}else if(m.maskedBoundsBuffer&&m.maskedIndexBuffer&&m.segments)s.draw(i,o.TRIANGLES,t.id,m.maskedBoundsBuffer,m.maskedIndexBuffer,m.segments);else{var M=e.rasterBoundsBuffer,v=e.rasterBoundsVAO;v.bind(i,s,M,[]),o.drawArrays(o.TRIANGLE_STRIP,0,M.length)}}}}function spinWeights(e){e*=Math.PI/180;var r=Math.sin(e),t=Math.cos(e);return[(2*t+1)/3,(-Math.sqrt(3)*r-t+1)/3,(Math.sqrt(3)*r-t+1)/3]}function contrastFactor(e){return e>0?1/(1-e):1+e}function saturationFactor(e){return e>0?1-1/(1.001-e):-e}function getFadeValues(e,r,t,a,i){var o=a.paint.get("raster-fade-duration");if(o>0){var n=browser.now(),s=(n-e.timeAdded)/o,u=r?(n-r.timeAdded)/o:-1,d=t.getSource(),f=i.coveringZoomLevel({tileSize:d.tileSize,roundZoom:d.roundZoom}),c=!r||Math.abs(r.tileID.overscaledZ-f)>Math.abs(e.tileID.overscaledZ-f),m=c&&e.refreshedUponExpiration?1:util.clamp(c?s:1-u,0,1);return e.refreshedUponExpiration&&s>=1&&(e.refreshedUponExpiration=!1),r?{opacity:1,mix:1-m}:{opacity:m,mix:0}}return{opacity:1,mix:0}}var util=_dereq_("../util/util"),ImageSource=_dereq_("../source/image_source"),browser=_dereq_("../util/browser"),StencilMode=_dereq_("../gl/stencil_mode"),DepthMode=_dereq_("../gl/depth_mode");module.exports=drawRaster;
},{"../gl/depth_mode":81,"../gl/stencil_mode":84,"../source/image_source":123,"../util/browser":286,"../util/util":315}],102:[function(_dereq_,module,exports){
"use strict";function drawLineTile(e,r,t,i,o,s,a,n,p){var l=r.context,d=l.gl;(n||p)&&d.uniform2f(e.uniforms.u_gl_units_to_pixels,1/r.transform.pixelsToGLUnits[0],1/r.transform.pixelsToGLUnits[1]),d.uniform1f(e.uniforms.u_interpolate,o.paint.get("sprite-interpolate")),d.uniform1f(e.uniforms.u_height_offset,o.paint.get("sprite-height-offset")),l.setStencilMode(r.stencilModeForClipping(s)),d.uniform4f(e.uniforms.u_speed_mat,curEleObj.getCalculatedSpeed(1,o),curEleObj.getCalculatedSpeed(2,o),curEleObj.getCalculatedSpeed(3,o),curEleObj.getCalculatedSpeed(4,o));var u=r.translatePosMatrix(s.posMatrix,t,o.paint.get("sprite-translate"),o.paint.get("sprite-translate-anchor"));d.uniformMatrix4fv(e.uniforms.u_matrix,!1,u),d.uniform1f(e.uniforms.u_ratio,1/pixelsToTileUnits(t,1,r.transform.zoom)),e.draw(l,d.TRIANGLES,o.id,i.layoutVertexBuffer,i.indexBuffer,i.segments,a)}var browser=_dereq_("../util/browser"),pixelsToTileUnits=_dereq_("../source/pixels_to_tile_units"),tileDrawHelper=_dereq_("../gl/tile_draw_helper"),DepthMode=_dereq_("../gl/depth_mode"),curEleObj={speedExt1:2,speedExt2:4,speedExt3:5,speedExt4:6,getCalculatedSpeed:function(e,r){return parseInt(r["speed"+e]/e/this["speedExt"+e])}};module.exports=function(e,r,t,i){var o=t.paint.get("render-3d");if("translucent"===e.renderPass||o){if(0!==t.paint.get("sprite-opacity").constantOr(1)){var s=e.context;s.setDepthMode(e.depthModeForSublayer(0,DepthMode.ReadOnly)),s.setColorMode(e.colorModeForRenderPass());var a,n=!0;if(o)if("offscreen"===e.renderPass){var p=t.paint.get("sprite-speed-factor");t.hasOwnProperty("speed"+p)||(t["speed"+p]=0),t["speed"+p]+=2,t["speed"+p]%=1===p?20:2===p?80:3===p?150:240,tileDrawHelper.drawToExtrusionFramebuffer(e,t);for(var l=0,d=i;l<d.length;l+=1){var u=d[l],f=r.getTile(u),g=f.getBucket(t);if(g){var c=g.programConfigurations.get(t.id),m=e.context.program.get(),x=e.useProgram("sprite3d",c),v=n||x.program!==m,_=a!==f.tileID.overscaledZ;v&&c.setUniforms(e.context,x,t.paint,{zoom:e.transform.zoom}),drawLineTile(x,e,f,g,t,u,c,v,_),a=f.tileID.overscaledZ,n=!1}}}else"translucent"===e.renderPass&&tileDrawHelper.drawExtrusionTexture(e,t);else{var h=t.paint.get("sprite-speed-factor");t.hasOwnProperty("speed"+h)||(t["speed"+h]=0),t["speed"+h]+=1,t["speed"+h]%=1===h?20:2===h?80:3===h?150:240;for(var w=0,T=i;w<T.length;w+=1){var E=T[w],M=r.getTile(E),D=M.getBucket(t);if(D){var b=D.programConfigurations.get(t.id),C=e.context.program.get(),O=e.useProgram("sprite",b),P=n||O.program!==C,S=a!==M.tileID.overscaledZ;P&&b.setUniforms(e.context,O,t.paint,{zoom:e.transform.zoom}),drawLineTile(O,e,M,D,t,E,b,P,S),a=M.tileID.overscaledZ,n=!1}}}}}};
},{"../gl/depth_mode":81,"../gl/tile_draw_helper":85,"../source/pixels_to_tile_units":125,"../util/browser":286}],103:[function(_dereq_,module,exports){
"use strict";function drawSymbols(t,e,o,i){var r=o.paint.get("render-3d");if("translucent"===t.renderPass||r){var a=t.context;a.setStencilMode(StencilMode.disabled),a.setColorMode(t.colorModeForRenderPass()),r?"offscreen"===t.renderPass?(tileDrawHelper.drawToExtrusionFramebuffer(t,o),0!==o.paint.get("icon-opacity").constantOr(1)&&drawLayerSymbols(t,e,o,i,!1,o.paint.get("icon-translate"),o.paint.get("icon-translate-anchor"),o.layout.get("icon-rotation-alignment"),o.layout.get("icon-pitch-alignment"),o.layout.get("icon-keep-upright")),0!==o.paint.get("text-opacity").constantOr(1)&&drawLayerSymbols(t,e,o,i,!0,o.paint.get("text-translate"),o.paint.get("text-translate-anchor"),o.layout.get("text-rotation-alignment"),o.layout.get("text-pitch-alignment"),o.layout.get("text-keep-upright")),e.map.showCollisionBoxes&&drawCollisionDebug(t,e,o,i)):"translucent"===t.renderPass&&tileDrawHelper.drawExtrusionTexture(t,o):(0!==o.paint.get("icon-opacity").constantOr(1)&&drawLayerSymbols(t,e,o,i,!1,o.paint.get("icon-translate"),o.paint.get("icon-translate-anchor"),o.layout.get("icon-rotation-alignment"),o.layout.get("icon-pitch-alignment"),o.layout.get("icon-keep-upright")),0!==o.paint.get("text-opacity").constantOr(1)&&drawLayerSymbols(t,e,o,i,!0,o.paint.get("text-translate"),o.paint.get("text-translate-anchor"),o.layout.get("text-rotation-alignment"),o.layout.get("text-pitch-alignment"),o.layout.get("text-keep-upright")),e.map.showCollisionBoxes&&drawCollisionDebug(t,e,o,i))}}function drawLayerSymbols(t,e,o,i,r,a,n,s,l,u){var m=t.context,f=m.gl,c=t.transform,p="map"===s,g="map"===l,d=p&&"line"===o.layout.get("symbol-placement"),y=p&&!g&&!d;if(o.paint.get("render-3d"))f.enable(f.DEPTH_TEST);else{var _=g;m.setDepthMode(_?t.depthModeForSublayer(0,DepthMode.ReadOnly):DepthMode.disabled)}for(var x,h=0,b=i;h<b.length;h+=1){var S=b[h],w=e.getTile(S),T=w.getBucket(o);if(T){var z=r?T.text:T.icon;if(z&&z.segments.get().length){var M=z.programConfigurations.get(o.id),v=r||T.sdfIcons,D=r?T.textSizeData:T.iconSizeData;if(x||(x=t.useProgram(v?"symbolSDF":"symbolIcon",M),M.setUniforms(t.context,x,o.paint,{zoom:t.transform.zoom}),setSymbolDrawState(x,t,o,r,y,g,D)),m.activeTexture.set(f.TEXTURE0),f.uniform1i(x.uniforms.u_texture,0),r)w.glyphAtlasTexture.bind(f.LINEAR,f.CLAMP_TO_EDGE),f.uniform2fv(x.uniforms.u_texsize,w.glyphAtlasTexture.size);else{var E=1!==o.layout.get("icon-size").constantOr(0)||T.iconsNeedLinear,P=g||0!==c.pitch;w.iconAtlasTexture.bind(v||t.options.rotating||t.options.zooming||E||P?f.LINEAR:f.NEAREST,f.CLAMP_TO_EDGE),f.uniform2fv(x.uniforms.u_texsize,w.iconAtlasTexture.size)}f.uniformMatrix4fv(x.uniforms.u_matrix,!1,t.translatePosMatrix(S.posMatrix,w,a,n));var L=pixelsToTileUnits(w,1,t.transform.zoom),C=symbolProjection.getLabelPlaneMatrix(S.posMatrix,g,p,t.transform,L),A=symbolProjection.getGlCoordMatrix(S.posMatrix,g,p,t.transform,L);f.uniformMatrix4fv(x.uniforms.u_gl_coord_matrix,!1,t.translatePosMatrix(A,w,a,n,!0)),d?(f.uniformMatrix4fv(x.uniforms.u_label_plane_matrix,!1,identityMat4),symbolProjection.updateLineLabels(T,S.posMatrix,t,r,C,A,g,u)):f.uniformMatrix4fv(x.uniforms.u_label_plane_matrix,!1,C),f.uniform1f(x.uniforms.u_fade_change,t.options.fadeDuration?t.symbolFadeChange:1),f.uniform1f(x.uniforms.u_height_offset,o.paint.get("symbol-height-offset")),drawTileSymbols(x,M,t,o,w,z,r,v,g)}}}}function setSymbolDrawState(t,e,o,i,r,a,n){var s=e.context.gl,l=e.transform;s.uniform1i(t.uniforms.u_pitch_with_map,a?1:0),s.uniform1f(t.uniforms.u_is_text,i?1:0),s.uniform1f(t.uniforms.u_pitch,l.pitch/360*2*Math.PI);var u="constant"===n.functionType||"source"===n.functionType,m="constant"===n.functionType||"camera"===n.functionType;s.uniform1i(t.uniforms.u_is_size_zoom_constant,u?1:0),s.uniform1i(t.uniforms.u_is_size_feature_constant,m?1:0),s.uniform1f(t.uniforms.u_camera_to_center_distance,l.cameraToCenterDistance);var f=symbolSize.evaluateSizeForZoom(n,l.zoom,symbolLayoutProperties.properties[i?"text-size":"icon-size"]);void 0!==f.uSizeT&&s.uniform1f(t.uniforms.u_size_t,f.uSizeT),void 0!==f.uSize&&s.uniform1f(t.uniforms.u_size,!0===o.paint.get("render-road-mark")?f.uSize/Math.pow(2,19.5-l.zoom):f.uSize),s.uniform1f(t.uniforms.u_aspect_ratio,l.width/l.height),s.uniform1f(t.uniforms.u_render_3d,o.paint.get("render-3d")),s.uniform1i(t.uniforms.u_rotate_symbol,r?1:0)}function drawTileSymbols(t,e,o,i,r,a,n,s,l){var u=o.context,m=u.gl,f=o.transform;if(s){var c=0!==i.paint.get(n?"text-halo-width":"icon-halo-width").constantOr(1),p=l?Math.cos(f._pitch)*f.cameraToCenterDistance:1;m.uniform1f(t.uniforms.u_gamma_scale,p),c&&(m.uniform1f(t.uniforms.u_is_halo,1),drawSymbolElements(a,i,u,t)),m.uniform1f(t.uniforms.u_is_halo,0)}drawSymbolElements(a,i,u,t)}function drawSymbolElements(t,e,o,i){i.draw(o,o.gl.TRIANGLES,e.id,t.layoutVertexBuffer,t.indexBuffer,t.segments,t.programConfigurations.get(e.id),t.dynamicLayoutVertexBuffer,t.opacityVertexBuffer)}var drawCollisionDebug=_dereq_("./draw_collision_debug"),pixelsToTileUnits=_dereq_("../source/pixels_to_tile_units"),symbolProjection=_dereq_("../symbol/projection"),symbolSize=_dereq_("../symbol/symbol_size"),mat4=_dereq_("../_minemap_/gl-matrix").mat4,identityMat4=mat4.identity(new Float32Array(16)),symbolLayoutProperties=_dereq_("../style/style_layer/symbol_style_layer_properties").layout,StencilMode=_dereq_("../gl/stencil_mode"),DepthMode=_dereq_("../gl/depth_mode"),tileDrawHelper=_dereq_("../gl/tile_draw_helper");module.exports=drawSymbols;
},{"../_minemap_/gl-matrix":27,"../gl/depth_mode":81,"../gl/stencil_mode":84,"../gl/tile_draw_helper":85,"../source/pixels_to_tile_units":125,"../style/style_layer/symbol_style_layer_properties":237,"../symbol/projection":256,"../symbol/symbol_size":260,"./draw_collision_debug":92}],104:[function(_dereq_,module,exports){
"use strict";function drawSymbols(t,e,o,i){var n=o.paint.get("render-3d");if("translucent"===t.renderPass||n){this.start||(this.start=Date.now(),this.count=0),this.end=Date.now();var r=o.layout.get("symtracking-fps"),a=o.layout.get("symtracking-time-segment");if(offset=o.paint.get("symtracking-delay"),this.end-this.start>=1e3/r){this.count+=1;var s=config.TRW&&config.TRW.hasOwnProperty("replaceOffset")?config.TRW.replaceOffset:r*(a+offset);this.count%=s;var u=config.TRW&&config.TRW.hasOwnProperty("requestOffset")?config.TRW.requestOffset:a*r;this.count===u&&config.TRW&&config.TRW.request(),0===this.count&&(config.TRW&&config.TRW.replace(),this.count=offset),config.TRW&&(config.TRW.currentSeq=this.count),_count=this.count,config.TRW&&config.TRW.hasOwnProperty("setProgress")&&config.TRW.setProgress(_count),this.start=this.end}var l=t.context;l.setStencilMode(StencilMode.disabled),l.setColorMode(t.colorModeForRenderPass()),n?"offscreen"===t.renderPass?(0!==o.paint.get("icon-opacity").constantOr(1)&&drawLayerSymbols(t,e,o,i,!1,o.paint.get("icon-translate"),o.paint.get("icon-translate-anchor"),o.layout.get("icon-rotation-alignment"),o.layout.get("icon-pitch-alignment"),o.layout.get("icon-keep-upright"),_count),0!==o.paint.get("text-opacity").constantOr(1)&&drawLayerSymbols(t,e,o,i,!0,o.paint.get("text-translate"),o.paint.get("text-translate-anchor"),o.layout.get("text-rotation-alignment"),o.layout.get("text-pitch-alignment"),o.layout.get("text-keep-upright"),_count),e.map.showCollisionBoxes&&drawCollisionDebug(t,e,o,i)):"translucent"===t.renderPass&&tileDrawHelper.drawExtrusionTexture(t,o):(0!==o.paint.get("icon-opacity").constantOr(1)&&drawLayerSymbols(t,e,o,i,!1,o.paint.get("icon-translate"),o.paint.get("icon-translate-anchor"),o.layout.get("icon-rotation-alignment"),o.layout.get("icon-pitch-alignment"),o.layout.get("icon-keep-upright"),_count),0!==o.paint.get("text-opacity").constantOr(1)&&drawLayerSymbols(t,e,o,i,!0,o.paint.get("text-translate"),o.paint.get("text-translate-anchor"),o.layout.get("text-rotation-alignment"),o.layout.get("text-pitch-alignment"),o.layout.get("text-keep-upright"),_count),e.map.showCollisionBoxes&&drawCollisionDebug(t,e,o,i))}}function drawLayerSymbols(t,e,o,i,n,r,a,s,u,l,f){var c=t.context,m=c.gl,g=t.transform,p="map"===s,y="map"===u,d=p&&!y&&!0;if(o.paint.get("render-3d"))m.enable(m.DEPTH_TEST);else{var _=y;c.setDepthMode(_?t.depthModeForSublayer(0,DepthMode.ReadOnly):DepthMode.disabled)}for(var h,x=0,T=i;x<T.length;x+=1){var b=T[x],w=e.getTile(b),S=w.getBucket(o);if(S){var v=n?S.text:S.icon;if(v&&v.segments.get().length){var z=v.programConfigurations.get(o.id),M=n||S.sdfIcons,D=n?S.textSizeData:S.iconSizeData;if(h||(h=t.useProgram(M?"symtrackingSDF":"symtrackingIcon",z),z.setUniforms(t.context,h,o.paint,{zoom:t.transform.zoom}),setSymbolDrawState(h,t,o,n,d,y,D,f)),c.activeTexture.set(m.TEXTURE0),m.uniform1i(h.uniforms.u_texture,0),m.uniform1f(h.uniforms.u_render_3d,o.paint.get("render-3d")),m.uniform1f(h.uniforms.u_height_offset,o.paint.get("symtracking-height-offset")),n)w.glyphAtlasTexture.bind(m.LINEAR,m.CLAMP_TO_EDGE),m.uniform2fv(h.uniforms.u_texsize,w.glyphAtlasTexture.size);else{var P=1!==o.layout.get("icon-size").constantOr(0)||S.iconsNeedLinear,R=y||0!==g.pitch;w.iconAtlasTexture.bind(M||t.options.rotating||t.options.zooming||P||R?m.LINEAR:m.NEAREST,m.CLAMP_TO_EDGE),m.uniform2fv(h.uniforms.u_texsize,w.iconAtlasTexture.size)}m.uniformMatrix4fv(h.uniforms.u_matrix,!1,t.translatePosMatrix(b.posMatrix,w,r,a));var E=pixelsToTileUnits(w,1,t.transform.zoom),O=symbolProjection.getLabelPlaneMatrix(b.posMatrix,y,p,t.transform,E),q=symbolProjection.getGlCoordMatrix(b.posMatrix,y,p,t.transform,E);m.uniformMatrix4fv(h.uniforms.u_gl_coord_matrix,!1,t.translatePosMatrix(q,w,r,a,!0)),m.uniformMatrix4fv(h.uniforms.u_label_plane_matrix,!1,O),m.uniform1f(h.uniforms.u_fade_change,t.options.fadeDuration?t.symbolFadeChange:1),drawTileSymbols(h,z,t,o,w,v,n,M,y)}}}}function setSymbolDrawState(t,e,o,i,n,r,a,s){var u=e.context.gl,l=e.transform;u.uniform1i(t.uniforms.u_pitch_with_map,r?1:0),u.uniform1f(t.uniforms.u_is_text,i?1:0),u.uniform1f(t.uniforms.u_pitch,l.pitch/360*2*Math.PI);var f="constant"===a.functionType||"source"===a.functionType,c="constant"===a.functionType||"camera"===a.functionType;u.uniform1i(t.uniforms.u_is_size_zoom_constant,f?1:0),u.uniform1i(t.uniforms.u_is_size_feature_constant,c?1:0),u.uniform1f(t.uniforms.u_camera_to_center_distance,l.cameraToCenterDistance);var m=symbolSize.evaluateSizeForZoom(a,l.zoom,symbolLayoutProperties.properties[i?"text-size":"icon-size"]);void 0!==m.uSizeT&&u.uniform1f(t.uniforms.u_size_t,m.uSizeT),void 0!==m.uSize&&u.uniform1f(t.uniforms.u_size,m.uSize),u.uniform1f(t.uniforms.u_aspect_ratio,l.width/l.height),u.uniform1i(t.uniforms.u_rotate_symbol,n?1:0),u.uniform1f(t.uniforms.u_seq,s)}function drawTileSymbols(t,e,o,i,n,r,a,s,u){var l=o.context,f=l.gl,c=o.transform;if(s){var m=0!==i.paint.get(a?"text-halo-width":"icon-halo-width").constantOr(1),g=u?Math.cos(c._pitch)*c.cameraToCenterDistance:1;f.uniform1f(t.uniforms.u_gamma_scale,g),m&&(f.uniform1f(t.uniforms.u_is_halo,1),drawSymbolElements(r,i,l,t)),f.uniform1f(t.uniforms.u_is_halo,0)}drawSymbolElements(r,i,l,t)}function drawSymbolElements(t,e,o,i){i.draw(o,o.gl.TRIANGLES,e.id,t.layoutVertexBuffer,t.indexBuffer,t.segments,t.programConfigurations.get(e.id),t.dynamicLayoutVertexBuffer,t.opacityVertexBuffer)}var drawCollisionDebug=_dereq_("./draw_collision_debug"),pixelsToTileUnits=_dereq_("../source/pixels_to_tile_units"),symbolProjection=_dereq_("../symbol/projection"),symbolSize=_dereq_("../symbol/symbol_size"),mat4=_dereq_("../_minemap_/gl-matrix").mat4,identityMat4=mat4.identity(new Float32Array(16)),symbolLayoutProperties=_dereq_("../style/style_layer/symtracking_style_layer_properties").layout,StencilMode=_dereq_("../gl/stencil_mode"),DepthMode=_dereq_("../gl/depth_mode"),tileDrawHelper=_dereq_("../gl/tile_draw_helper"),config=_dereq_("../util/config"),_count=0,offset=10;module.exports=drawSymbols;
},{"../_minemap_/gl-matrix":27,"../gl/depth_mode":81,"../gl/stencil_mode":84,"../gl/tile_draw_helper":85,"../source/pixels_to_tile_units":125,"../style/style_layer/symtracking_style_layer_properties":239,"../symbol/projection":256,"../symbol/symbol_size":260,"../util/config":290,"./draw_collision_debug":92}],105:[function(_dereq_,module,exports){
"use strict";function checkFrwardAndBackward(t,e){if(e&&e.TRW&&"null"!==e.TRW){e.TRW.layerForwards||(e.TRW.layerForwards=[]);for(var r=0;r<e.TRW.layerForwards.length;r++){var i=e.TRW.layerForwards[r];if(i.id===t.id){t.count&&(t.count+=i.count),e.TRW.layerForwards.splice(r,1);break}}}}function drawLineTile(t,e,r,i,n,s,o,a,u,g,c,f){var l=e.context,p=l.gl;(a||u)&&p.uniform2f(t.uniforms.u_gl_units_to_pixels,1/e.transform.pixelsToGLUnits[0],1/e.transform.pixelsToGLUnits[1]),l.setStencilMode(e.stencilModeForClipping(s));var d=e.translatePosMatrix(s.posMatrix,r,n.paint.get("tracking-translate"),n.paint.get("tracking-translate-anchor"));p.uniformMatrix4fv(t.uniforms.u_matrix,!1,d),p.uniform1f(t.uniforms.u_ratio,1/pixelsToTileUnits(r,1,e.transform.zoom)),p.uniform1f(t.uniforms.u_start,g-segmentGroup),p.uniform1f(t.uniforms.u_end,g),p.uniform1f(t.uniforms.u_segments,segmentGroup),p.uniform1f(t.uniforms.u_reverse,c),p.uniform1f(t.uniforms.u_reserve,f),t.draw(l,p.TRIANGLES,n.id,i.layoutVertexBuffer,i.indexBuffer,i.segments,o)}var browser=_dereq_("../util/browser"),pixelsToTileUnits=_dereq_("../source/pixels_to_tile_units"),DepthMode=_dereq_("../gl/depth_mode"),config=_dereq_("../util/config"),offset=20,segmentGroup=20;module.exports=function(t,e,r,i){if("translucent"===t.renderPass){if(0!==r.paint.get("tracking-opacity").constantOr(1)){var n=t.context;if(n.setDepthMode(t.depthModeForSublayer(0,DepthMode.ReadOnly)),n.setColorMode(t.colorModeForRenderPass()),segmentGroup=r.paint.get("tracking-seg-group"),offset=r.paint.get("tracking-delay"),"history"===r.paint.get("tracking-type"))r.histEnd=Date.now(),r.first||(r.first=!0,r.histStart=0,r.histCount=0,r.isReverse=!1,r.isReserve=!1),r.histEnd-r.histStart>=1e3/r.paint.get("tracking-speed")&&("loop"===r.layout.get("tracking-display-mode")?(r.histCount++,r.histCount%=r.paint.get("tracking-seg-count"),r.histCount=0===r.histCount?1:r.histCount):"reverse"===r.layout.get("tracking-display-mode")?(r.histCount>=r.paint.get("tracking-seg-count")+r.paint.get("tracking-seg-group")?r.isReverse=!0:r.histCount<=1&&(r.isReverse=!1),r.histCount=r.isReverse?r.histCount-1:r.histCount+1):"loop-reserve"===r.layout.get("tracking-display-mode")?(r.isReserve=!0,r.histCount++,r.histCount%=r.paint.get("tracking-seg-count"),r.histCount=0===r.histCount?1:r.histCount):"reverse-reserve"===r.layout.get("tracking-display-mode")&&(r.isReserve=!0,r.histCount>=r.paint.get("tracking-seg-count")+r.paint.get("tracking-seg-group")?r.isReverse=!0:r.histCount<=1&&(r.isReverse=!1),r.histCount=r.isReverse?r.histCount-1:r.histCount+1),config.TRW&&config.TRW.setProgress(r.histCount),r.histStart=r.histEnd);else if(r.count||(r.start=Date.now(),r.count=1),r.end=Date.now(),r.end-r.start>=1e3/r.paint.get("tracking-speed")){var s=config.TRW||r.paint.get("tracking-trw");r.count+=1;var o=s&&s.hasOwnProperty("replaceOffset")?s.replaceOffset:120+offset;r.count%=o;var a=s&&s.hasOwnProperty("requestOffset")?s.requestOffset:90+offset;r.count===a&&s&&s.request(),0===r.count&&(s&&s.replace(),r.count=offset),s&&(s.currentSeq=r.count),r.start=r.end}checkFrwardAndBackward(r,config);for(var u,g=!0,c=0,f=i;c<f.length;c+=1){var l=f[c],p=e.getTile(l),d=p.getBucket(r);if(d){var h=d.programConfigurations.get(r.id),m=t.context.program.get(),v=t.useProgram("tracking",h),k=g||v.program!==m,C=u!==p.tileID.overscaledZ;k&&h.setUniforms(t.context,v,r.paint,{zoom:t.transform.zoom}),drawLineTile(v,t,p,d,r,l,h,k,C,"history"===r.paint.get("tracking-type")?r.histCount:r.count,r.isReverse,r.isReserve),u=p.tileID.overscaledZ,g=!1}}}}};
},{"../gl/depth_mode":81,"../source/pixels_to_tile_units":125,"../util/browser":286,"../util/config":290}],106:[function(_dereq_,module,exports){
"use strict";function makeGlyphAtlas(a){var e=new AlphaImage({width:0,height:0}),i={},t=new ShelfPack(0,0,{autoResize:!0});for(var h in a){var r=a[h],p=i[h]={};for(var m in r){var d=r[+m];if(d&&0!==d.bitmap.width&&0!==d.bitmap.height){var g=t.packOne(d.bitmap.width+2*padding,d.bitmap.height+2*padding);e.resize({width:t.w,height:t.h}),AlphaImage.copy(d.bitmap,e,{x:0,y:0},{x:g.x+padding,y:g.y+padding},d.bitmap),p[m]={rect:g,metrics:d.metrics}}}}return t.shrink(),e.resize({width:t.w,height:t.h}),{image:e,positions:i}}var ShelfPack=_dereq_("../_minemap_/shelf-pack"),ref=_dereq_("../util/image"),AlphaImage=ref.AlphaImage,padding=1;module.exports={makeGlyphAtlas:makeGlyphAtlas};
},{"../_minemap_/shelf-pack":30,"../util/image":298}],107:[function(_dereq_,module,exports){
"use strict";var loadGlyphRange=_dereq_("../style/load_glyph_range"),TinySDF=_dereq_("../_minemap_/tiny-sdf"),isChar=_dereq_("../util/is_char_in_unicode_block"),ref=_dereq_("../util/util"),asyncAll=ref.asyncAll,ref$1=_dereq_("../util/image"),AlphaImage=ref$1.AlphaImage,GlyphManager=function(e,r){this.requestTransform=e,this.localIdeographFontFamily=r,this.entries={}};GlyphManager.prototype.setURL=function(e){this.url=e},GlyphManager.prototype.getGlyphs=function(e,r){var i=this,t=[];for(var a in e)for(var l=0,n=e[a];l<n.length;l+=1){var s=n[l];t.push({stack:a,id:s})}asyncAll(t,function(e,r){var t=e.stack,a=e.id,l=i.entries[t];l||(l=i.entries[t]={glyphs:{},requests:{}});var n=l.glyphs[a];if(void 0!==n)return void r(null,{stack:t,id:a,glyph:n});if(n=i._tinySDF(l,t,a))return void r(null,{stack:t,id:a,glyph:n});var s=Math.floor(a/256);if(256*s>65535)return void r(new Error("glyphs > 65535 not supported"));var o=l.requests[s];o||(o=l.requests[s]=[],loadGlyphRange(t,s,i.url,i.requestTransform,function(e,r){if(r)for(var i in r)l.glyphs[+i]=r[+i];for(var t=0,a=o;t<a.length;t+=1){(0,a[t])(e,r)}delete l.requests[s]})),o.push(function(e,i){e?r(e):i&&r(null,{stack:t,id:a,glyph:i[a]||null})})},function(e,i){if(e)r(e);else if(i){for(var t={},a=0,l=i;a<l.length;a+=1){var n=l[a],s=n.stack,o=n.id,h=n.glyph;(t[s]||(t[s]={}))[o]=h&&{id:h.id,bitmap:h.bitmap.clone(),metrics:h.metrics}}r(null,t)}})},GlyphManager.prototype._tinySDF=function(e,r,i){var t=this.localIdeographFontFamily;if(t&&(isChar["CJK Unified Ideographs"](i)||isChar["Hangul Syllables"](i))){var a=e.tinySDF;if(!a){var l="400";/bold/i.test(r)?l="900":/medium/i.test(r)?l="500":/light/i.test(r)&&(l="200"),a=e.tinySDF=new TinySDF(24,3,8,.25,t,l)}return{id:i,bitmap:new AlphaImage({width:30,height:30},a.draw(String.fromCharCode(i))),metrics:{width:24,height:24,left:0,top:-8,advance:24}}}},module.exports=GlyphManager;
},{"../_minemap_/tiny-sdf":32,"../style/load_glyph_range":204,"../util/image":298,"../util/is_char_in_unicode_block":302,"../util/util":315}],108:[function(_dereq_,module,exports){
"use strict";function imagePosition(i,a){var e=a.pixelRatio,t={x:i.x+padding,y:i.y+padding,w:i.w-2*padding,h:i.h-2*padding};return{pixelRatio:e,textureRect:t,tl:[t.x,t.y],br:[t.x+t.w,t.y+t.h],displaySize:[t.w/e,t.h/e]}}function makeImageAtlas(i){var a=new RGBAImage({width:0,height:0}),e={},t=new ShelfPack(0,0,{autoResize:!0});for(var d in i){var g=i[d],n=t.packOne(g.data.width+2*padding,g.data.height+2*padding);a.resize({width:t.w,height:t.h}),RGBAImage.copy(g.data,a,{x:0,y:0},{x:n.x+padding,y:n.y+padding},g.data),e[d]=imagePosition(n,g)}return t.shrink(),a.resize({width:t.w,height:t.h}),{image:a,positions:e}}var ShelfPack=_dereq_("../_minemap_/shelf-pack"),ref=_dereq_("../util/image"),RGBAImage=ref.RGBAImage,padding=1;module.exports={imagePosition:imagePosition,makeImageAtlas:makeImageAtlas};
},{"../_minemap_/shelf-pack":30,"../util/image":298}],109:[function(_dereq_,module,exports){
"use strict";var ShelfPack=_dereq_("../_minemap_/shelf-pack"),ref=_dereq_("../util/image"),RGBAImage=ref.RGBAImage,ref$1=_dereq_("./image_atlas"),imagePosition=ref$1.imagePosition,Texture=_dereq_("./texture"),padding=1,ImageManager=function(){this.images={},this.loaded=!1,this.requestors=[],this.shelfPack=new ShelfPack(64,64,{autoResize:!0}),this.patterns={},this.atlasImage=new RGBAImage({width:64,height:64}),this.dirty=!0};ImageManager.prototype.isLoaded=function(){return this.loaded},ImageManager.prototype.setLoaded=function(e){var t=this;if(this.loaded!==e&&(this.loaded=e,e)){for(var a=0,i=t.requestors;a<i.length;a+=1){var r=i[a],s=r.ids,h=r.callback;t._notify(s,h)}this.requestors=[]}},ImageManager.prototype.getImage=function(e){return this.images[e]},ImageManager.prototype.addImage=function(e,t){this.images[e]=t},ImageManager.prototype.removeImage=function(e){delete this.images[e];var t=this.patterns[e];t&&(this.shelfPack.unref(t.bin),delete this.patterns[e])},ImageManager.prototype.getImages=function(e,t){var a=this,i=!0;if(!this.isLoaded())for(var r=0,s=e;r<s.length;r+=1){var h=s[r];a.images[h]||(i=!1)}this.isLoaded()||i?this._notify(e,t):this.requestors.push({ids:e,callback:t})},ImageManager.prototype._notify=function(e,t){for(var a=this,i={},r=0,s=e;r<s.length;r+=1){var h=s[r],g=a.images[h];g&&(i[h]={data:g.data.clone(),pixelRatio:g.pixelRatio,sdf:g.sdf})}t(null,i)},ImageManager.prototype.getPixelSize=function(){return{width:this.shelfPack.w,height:this.shelfPack.h}},ImageManager.prototype.getPattern=function(e){var t=this.patterns[e];if(t)return t.position;var a=this.getImage(e);if(!a)return null;var i=a.data.width+2*padding,r=a.data.height+2*padding,s=this.shelfPack.packOne(i,r);if(!s)return null;this.atlasImage.resize(this.getPixelSize());var h=a.data,g=this.atlasImage,n=s.x+padding,o=s.y+padding,d=h.width,l=h.height;RGBAImage.copy(h,g,{x:0,y:0},{x:n,y:o},{width:d,height:l}),RGBAImage.copy(h,g,{x:0,y:l-1},{x:n,y:o-1},{width:d,height:1}),RGBAImage.copy(h,g,{x:0,y:0},{x:n,y:o+l},{width:d,height:1}),RGBAImage.copy(h,g,{x:d-1,y:0},{x:n-1,y:o},{width:1,height:l}),RGBAImage.copy(h,g,{x:0,y:0},{x:n+d,y:o},{width:1,height:l}),this.dirty=!0;var m=imagePosition(s,a);return this.patterns[e]={bin:s,position:m},m},ImageManager.prototype.bind=function(e){var t=e.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new Texture(e,this.atlasImage,t.RGBA),this.atlasTexture.bind(t.LINEAR,t.CLAMP_TO_EDGE)},module.exports=ImageManager;
},{"../_minemap_/shelf-pack":30,"../util/image":298,"./image_atlas":108,"./texture":114}],110:[function(_dereq_,module,exports){
"use strict";var util=_dereq_("../util/util"),LineAtlas=function(t,i){this.width=t,this.height=i,this.nextRow=0,this.bytes=4,this.data=new Uint8Array(this.width*this.height*this.bytes),this.positions={}};LineAtlas.prototype.getDash=function(t,i){var h=t.join(",")+String(i);return this.positions[h]||(this.positions[h]=this.addDash(t,i)),this.positions[h]},LineAtlas.prototype.addDash=function(t,i){var h=this,e=i?7:0,s=2*e+1;if(this.nextRow+s>this.height)return null;for(var a=0,r=0;r<t.length;r++)a+=t[r];for(var n=this.width/a,E=n/2,T=t.length%2==1,o=-e;o<=e;o++)for(var R=h.nextRow+e+o,d=h.width*R,u=T?-t[t.length-1]:0,x=t[0],l=1,_=0;_<this.width;_++){for(;x<_/n;)u=x,x+=t[l],T&&l===t.length-1&&(x+=t[0]),l++;var g=Math.abs(_-u*n),A=Math.abs(_-x*n),D=Math.min(g,A),U=l%2==1,w=void 0;if(i){var v=e?o/e*(E+1):0;if(U){var X=E-Math.abs(v);w=Math.sqrt(D*D+X*X)}else w=E-Math.sqrt(D*D+v*v)}else w=(U?1:-1)*D;h.data[3+4*(d+_)]=Math.max(0,Math.min(255,w+128))}var f={y:(this.nextRow+e+.5)/this.height,height:2*e/this.height,width:a};return this.nextRow+=s,this.dirty=!0,f},LineAtlas.prototype.bind=function(t){var i=t.gl;this.texture?(i.bindTexture(i.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,i.texSubImage2D(i.TEXTURE_2D,0,0,0,this.width,this.height,i.RGBA,i.UNSIGNED_BYTE,this.data))):(this.texture=i.createTexture(),i.bindTexture(i.TEXTURE_2D,this.texture),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_S,i.REPEAT),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_T,i.REPEAT),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MIN_FILTER,i.LINEAR),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MAG_FILTER,i.LINEAR),i.texImage2D(i.TEXTURE_2D,0,i.RGBA,this.width,this.height,0,i.RGBA,i.UNSIGNED_BYTE,this.data))},module.exports=LineAtlas;
},{"../util/util":315}],111:[function(_dereq_,module,exports){
"use strict";var browser=_dereq_("../util/browser"),mat4=_dereq_("../_minemap_/gl-matrix").mat4,SourceCache=_dereq_("../source/source_cache"),EXTENT=_dereq_("../data/extent"),pixelsToTileUnits=_dereq_("../source/pixels_to_tile_units"),util=_dereq_("../util/util"),VertexArrayObject=_dereq_("./vertex_array_object"),ref=_dereq_("../data/array_types"),RasterBoundsArray=ref.RasterBoundsArray,PosArray=ref.PosArray,rasterBoundsAttributes=_dereq_("../data/raster_bounds_attributes"),posAttributes=_dereq_("../data/pos_attributes"),ref$1=_dereq_("../data/program_configuration"),ProgramConfiguration=ref$1.ProgramConfiguration,CrossTileSymbolIndex=_dereq_("../symbol/cross_tile_symbol_index"),shaders=_dereq_("../shaders"),Program=_dereq_("./program"),Context=_dereq_("../gl/context"),DepthMode=_dereq_("../gl/depth_mode"),StencilMode=_dereq_("../gl/stencil_mode"),ColorMode=_dereq_("../gl/color_mode"),Texture=_dereq_("./texture"),updateTileMasks=_dereq_("./tile_mask"),Color=_dereq_("../style-spec/util/color"),draw={symbol:_dereq_("./draw_symbol"),circle:_dereq_("./draw_circle"),heatmap:_dereq_("./draw_heatmap"),line:_dereq_("./draw_line"),fill:_dereq_("./draw_fill"),extrusion:_dereq_("./draw_extrusion"),hillshade:_dereq_("./draw_hillshade"),raster:_dereq_("./draw_raster"),background:_dereq_("./draw_background"),debug:_dereq_("./draw_debug"),sprite:_dereq_("./draw_sprite"),histogram:_dereq_("./draw_histogram"),symtracking:_dereq_("./draw_symtracking"),tracking:_dereq_("./draw_tracking"),dynamicLine:_dereq_("./draw_dynamic_line"),airline:_dereq_("./draw_airline")},Painter=function(e,r){this.context=new Context(e),this.transform=r,this._tileTextures={},this.setup(),this.numSublayers=SourceCache.maxUnderzooming+SourceCache.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.depthRboNeedsClear=!0,this.emptyProgramConfiguration=new ProgramConfiguration,this.crossTileSymbolIndex=new CrossTileSymbolIndex};Painter.prototype.resize=function(e,r){var t=this,i=this.context.gl;if(this.width=e*browser.devicePixelRatio,this.height=r*browser.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(var s=0,a=t.style._order;s<a.length;s+=1){var o=a[s];t.style._layers[o].resize()}this.depthRbo&&(i.deleteRenderbuffer(this.depthRbo),this.depthRbo=null)},Painter.prototype.setup=function(){var e=this.context,r=new PosArray;r.emplaceBack(0,0),r.emplaceBack(EXTENT,0),r.emplaceBack(0,EXTENT),r.emplaceBack(EXTENT,EXTENT),this.tileExtentBuffer=e.createVertexBuffer(r,posAttributes.members),this.tileExtentVAO=new VertexArrayObject,this.tileExtentPatternVAO=new VertexArrayObject;var t=new PosArray;t.emplaceBack(0,0),t.emplaceBack(EXTENT,0),t.emplaceBack(EXTENT,EXTENT),t.emplaceBack(0,EXTENT),t.emplaceBack(0,0),this.debugBuffer=e.createVertexBuffer(t,posAttributes.members),this.debugVAO=new VertexArrayObject;var i=new RasterBoundsArray;i.emplaceBack(0,0,0,0),i.emplaceBack(EXTENT,0,EXTENT,0),i.emplaceBack(0,EXTENT,0,EXTENT),i.emplaceBack(EXTENT,EXTENT,EXTENT,EXTENT),this.rasterBoundsBuffer=e.createVertexBuffer(i,rasterBoundsAttributes.members),this.rasterBoundsVAO=new VertexArrayObject;var s=new PosArray;s.emplaceBack(0,0),s.emplaceBack(1,0),s.emplaceBack(0,1),s.emplaceBack(1,1),this.viewportBuffer=e.createVertexBuffer(s,posAttributes.members),this.viewportVAO=new VertexArrayObject},Painter.prototype.clearStencil=function(){var e=this.context,r=e.gl;e.setColorMode(ColorMode.disabled),e.setDepthMode(DepthMode.disabled),e.setStencilMode(new StencilMode({func:r.ALWAYS,mask:0},0,255,r.ZERO,r.ZERO,r.ZERO));var t=mat4.create();mat4.ortho(t,0,this.width,this.height,0,0,1),mat4.scale(t,t,[r.drawingBufferWidth,r.drawingBufferHeight,0]);var i=this.useProgram("clippingMask");r.uniformMatrix4fv(i.uniforms.u_matrix,!1,t),this.viewportVAO.bind(e,i,this.viewportBuffer,[]),r.drawArrays(r.TRIANGLE_STRIP,0,4)},Painter.prototype._renderTileClippingMasks=function(e){var r=this,t=this.context,i=t.gl;t.setColorMode(ColorMode.disabled),t.setDepthMode(DepthMode.disabled);var s=1;this._tileClippingMaskIDs={};for(var a=0,o=e;a<o.length;a+=1){var n=o[a],l=r._tileClippingMaskIDs[n.key]=s++;t.setStencilMode(new StencilMode({func:i.ALWAYS,mask:0},l,255,i.KEEP,i.KEEP,i.REPLACE));var c=r.useProgram("clippingMask");i.uniformMatrix4fv(c.uniforms.u_matrix,!1,n.posMatrix),r.tileExtentVAO.bind(r.context,c,r.tileExtentBuffer,[]),i.drawArrays(i.TRIANGLE_STRIP,0,r.tileExtentBuffer.length)}},Painter.prototype.stencilModeForClipping=function(e){var r=this.context.gl;return new StencilMode({func:r.EQUAL,mask:255},this._tileClippingMaskIDs[e.key],0,r.KEEP,r.KEEP,r.REPLACE)},Painter.prototype.colorModeForRenderPass=function(){var e=this.context.gl;if(this._showOverdrawInspector){return new ColorMode([e.CONSTANT_COLOR,e.ONE],new Color(1/8,1/8,1/8,0),[!0,!0,!0,!0])}return"opaque"===this.renderPass?ColorMode.unblended:ColorMode.alphaBlended},Painter.prototype.depthModeForSublayer=function(e,r,t){var i=1-((1+this.currentLayer)*this.numSublayers+e)*this.depthEpsilon,s=i-1+this.depthRange;return new DepthMode(t||this.context.gl.LEQUAL,r,[s,i])},Painter.prototype.render=function(e,r){var t=this;this.style=e,this.options=r,this.lineAtlas=e.lineAtlas,this.imageManager=e.imageManager,this.glyphManager=e.glyphManager,this.symbolFadeChange=e.placement.symbolFadeChange(browser.now());for(var i in e.sourceCaches){var s=t.style.sourceCaches[i];s.used&&s.prepare(t.context)}var a=this.style._order,o=util.filterObject(this.style.sourceCaches,function(e){return"raster"===e.getSource().type||"raster-dem"===e.getSource().type});for(var n in o)!function(e){var r=o[e],i=r.getVisibleCoordinates(),s=i.map(function(e){return r.getTile(e)});updateTileMasks(s,t.context)}(n);this.renderPass="offscreen";var l,c=[];this.depthRboNeedsClear=!0;for(var u=0;u<a.length;u++){var h=t.style._layers[a[u]];h.hasOffscreenPass()&&!h.isHidden(t.transform.zoom)&&(h.source!==(l&&l.id)&&(l=t.style.sourceCaches[h.source],c=[],l&&(c=l.getVisibleCoordinates(),c.reverse())),c.length&&t.renderLayer(t,l,h,c))}this.context.bindFramebuffer.set(null),this.context.clear({color:r.showOverdrawInspector?Color.black:Color.transparent,depth:1}),this._showOverdrawInspector=r.showOverdrawInspector,this.depthRange=(e._order.length+2)*this.numSublayers*this.depthEpsilon,this.renderPass="opaque";var d,p=[];for(this.currentLayer=a.length-1,this.currentLayer;this.currentLayer>=0;this.currentLayer--){var m=t.style._layers[a[t.currentLayer]];m.source!==(d&&d.id)&&(d=t.style.sourceCaches[m.source],p=[],d&&(t.clearStencil(),p=d.getVisibleCoordinates(),d.getSource().isTileClipped&&t._renderTileClippingMasks(p))),t.renderLayer(t,d,m,p)}this.renderPass="translucent";var f,g=[];for(this.currentLayer=0,this.currentLayer;this.currentLayer<a.length;this.currentLayer++){var y=t.style._layers[a[t.currentLayer]];y.source!==(f&&f.id)&&(f=t.style.sourceCaches[y.source],g=[],f&&(t.clearStencil(),g=f.getVisibleCoordinates(),f.getSource().isTileClipped&&t._renderTileClippingMasks(g)),g.reverse()),t.renderLayer(t,f,y,g)}if(this.options.showTileBoundaries){var w=this.style.sourceCaches[Object.keys(this.style.sourceCaches)[0]];w&&draw.debug(this,w,w.getVisibleCoordinates())}},Painter.prototype.setupOffscreenDepthRenderbuffer=function(){var e=this.context;this.depthRbo||(this.depthRbo=e.createRenderbuffer(e.gl.DEPTH_COMPONENT16,this.width,this.height))},Painter.prototype.renderLayer=function(e,r,t,i){t.isHidden(this.transform.zoom)||("background"===t.type||i.length)&&(this.id=t.id,draw[t.type](e,r,t,i))},Painter.prototype.translatePosMatrix=function(e,r,t,i,s){if(!t[0]&&!t[1])return e;var a=s?"map"===i?this.transform.angle:0:"viewport"===i?-this.transform.angle:0;if(a){var o=Math.sin(a),n=Math.cos(a);t=[t[0]*n-t[1]*o,t[0]*o+t[1]*n]}var l=[s?t[0]:pixelsToTileUnits(r,t[0],this.transform.zoom),s?t[1]:pixelsToTileUnits(r,t[1],this.transform.zoom),0],c=new Float32Array(16);return mat4.translate(c,e,l),c},Painter.prototype.saveTileTexture=function(e){var r=this._tileTextures[e.size[0]];r?r.push(e):this._tileTextures[e.size[0]]=[e]},Painter.prototype.getTileTexture=function(e){var r=this._tileTextures[e];return r&&r.length>0?r.pop():null},Painter.prototype._createProgramCached=function(e,r){this.cache=this.cache||{};var t=""+e+(r.cacheKey||"")+(this._showOverdrawInspector?"/overdraw":"");return this.cache[t]||(this.cache[t]=new Program(this.context,shaders[e],r,this._showOverdrawInspector)),this.cache[t]},Painter.prototype.useProgram=function(e,r){var t=this._createProgramCached(e,r||this.emptyProgramConfiguration);return this.context.program.set(t.program),t},module.exports=Painter;
},{"../_minemap_/gl-matrix":27,"../data/array_types":41,"../data/extent":67,"../data/pos_attributes":71,"../data/program_configuration":72,"../data/raster_bounds_attributes":73,"../gl/color_mode":79,"../gl/context":80,"../gl/depth_mode":81,"../gl/stencil_mode":84,"../shaders":118,"../source/pixels_to_tile_units":125,"../source/source_cache":131,"../style-spec/util/color":173,"../symbol/cross_tile_symbol_index":250,"../util/browser":286,"../util/util":315,"./draw_airline":89,"./draw_background":90,"./draw_circle":91,"./draw_debug":93,"./draw_dynamic_line":94,"./draw_extrusion":95,"./draw_fill":96,"./draw_heatmap":97,"./draw_hillshade":98,"./draw_histogram":99,"./draw_line":100,"./draw_raster":101,"./draw_sprite":102,"./draw_symbol":103,"./draw_symtracking":104,"./draw_tracking":105,"./program":113,"./texture":114,"./tile_mask":115,"./vertex_array_object":116}],112:[function(_dereq_,module,exports){
"use strict";var pixelsToTileUnits=_dereq_("../source/pixels_to_tile_units");exports.isPatternMissing=function(e,i){if(!e)return!1;var r=i.imageManager.getPattern(e.from),t=i.imageManager.getPattern(e.to);return!r||!t},exports.prepare=function(e,i,r){var t=i.context,n=t.gl,o=i.imageManager.getPattern(e.from),a=i.imageManager.getPattern(e.to);n.uniform1i(r.uniforms.u_image,0),n.uniform2fv(r.uniforms.u_pattern_tl_a,o.tl),n.uniform2fv(r.uniforms.u_pattern_br_a,o.br),n.uniform2fv(r.uniforms.u_pattern_tl_b,a.tl),n.uniform2fv(r.uniforms.u_pattern_br_b,a.br);var u=i.imageManager.getPixelSize(),f=u.width,m=u.height;n.uniform2fv(r.uniforms.u_texsize,[f,m]),n.uniform1f(r.uniforms.u_mix,e.t),n.uniform2fv(r.uniforms.u_pattern_size_a,o.displaySize),n.uniform2fv(r.uniforms.u_pattern_size_b,a.displaySize),n.uniform1f(r.uniforms.u_scale_a,e.fromScale),n.uniform1f(r.uniforms.u_scale_b,e.toScale),t.activeTexture.set(n.TEXTURE0),i.imageManager.bind(i.context)},exports.setTile=function(e,i,r){var t=i.context.gl;t.uniform1f(r.uniforms.u_tile_units_to_pixels,1/pixelsToTileUnits(e,1,i.transform.tileZoom));var n=Math.pow(2,e.tileID.overscaledZ),o=e.tileSize*Math.pow(2,i.transform.tileZoom)/n,a=o*(e.tileID.canonical.x+e.tileID.wrap*n),u=o*e.tileID.canonical.y;t.uniform2f(r.uniforms.u_pixel_coord_upper,a>>16,u>>16),t.uniform2f(r.uniforms.u_pixel_coord_lower,65535&a,65535&u)};
},{"../source/pixels_to_tile_units":125}],113:[function(_dereq_,module,exports){
"use strict";var browser=_dereq_("../util/browser"),shaders=_dereq_("../shaders"),ref=_dereq_("../data/program_configuration"),ProgramConfiguration=ref.ProgramConfiguration,VertexArrayObject=_dereq_("./vertex_array_object"),Context=_dereq_("../gl/context"),Program=function(r,e,t,a){var o=this,i=r.gl;this.program=i.createProgram();var n=t.defines().concat("#define DEVICE_PIXEL_RATIO "+browser.devicePixelRatio.toFixed(1));a&&n.push("#define OVERDRAW_INSPECTOR;");var s=n.concat(shaders.prelude.fragmentSource,e.fragmentSource).join("\n"),m=n.concat(shaders.prelude.vertexSource,e.vertexSource).join("\n"),g=i.createShader(i.FRAGMENT_SHADER);i.shaderSource(g,s),i.compileShader(g),i.attachShader(this.program,g);var c=i.createShader(i.VERTEX_SHADER);i.shaderSource(c,m),i.compileShader(c),i.attachShader(this.program,c);for(var u=t.layoutAttributes||[],h=0;h<u.length;h++)i.bindAttribLocation(o.program,h,u[h].name);i.linkProgram(this.program),this.numAttributes=i.getProgramParameter(this.program,i.ACTIVE_ATTRIBUTES),this.attributes={},this.uniforms={};for(var f=0;f<this.numAttributes;f++){var d=i.getActiveAttrib(o.program,f);d&&(o.attributes[d.name]=i.getAttribLocation(o.program,d.name))}for(var v=i.getProgramParameter(this.program,i.ACTIVE_UNIFORMS),p=0;p<v;p++){var S=i.getActiveUniform(o.program,p);S&&(o.uniforms[S.name]=i.getUniformLocation(o.program,S.name))}};Program.prototype.draw=function(r,e,t,a,o,i,n,s,m){for(var g,c=this,u=r.gl,h=(g={},g[u.LINES]=2,g[u.TRIANGLES]=3,g)[e],f=0,d=i.get();f<d.length;f+=1){var v=d[f],p=v.vaos||(v.vaos={});(p[t]||(p[t]=new VertexArrayObject)).bind(r,c,a,n?n.getPaintVertexBuffers():[],o,v.vertexOffset,s,m),u.drawElements(e,v.primitiveLength*h,u.UNSIGNED_SHORT,v.primitiveOffset*h*2)}},module.exports=Program;
},{"../data/program_configuration":72,"../gl/context":80,"../shaders":118,"../util/browser":286,"./vertex_array_object":116}],114:[function(_dereq_,module,exports){
"use strict";var ref=_dereq_("../util/window"),HTMLImageElement=ref.HTMLImageElement,HTMLCanvasElement=ref.HTMLCanvasElement,HTMLVideoElement=ref.HTMLVideoElement,ImageData=ref.ImageData,Texture=function(e,t,i,r){this.context=e;var a=t.width,T=t.height;this.size=[a,T],this.format=i,this.texture=e.gl.createTexture(),this.update(t,r)};Texture.prototype.update=function(e,t){var i=e.width,r=e.height;this.size=[i,r];var a=this,T=a.context,n=T.gl;n.bindTexture(n.TEXTURE_2D,this.texture),T.pixelStoreUnpack.set(1),this.format===n.RGBA&&!1!==t&&T.pixelStoreUnpackPremultiplyAlpha.set(!0),e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement||e instanceof ImageData?n.texImage2D(n.TEXTURE_2D,0,this.format,this.format,n.UNSIGNED_BYTE,e):n.texImage2D(n.TEXTURE_2D,0,this.format,i,r,0,this.format,n.UNSIGNED_BYTE,e.data)},Texture.prototype.bind=function(e,t,i){var r=this,a=r.context,T=a.gl;T.bindTexture(T.TEXTURE_2D,this.texture),e!==this.filter&&(T.texParameteri(T.TEXTURE_2D,T.TEXTURE_MAG_FILTER,e),T.texParameteri(T.TEXTURE_2D,T.TEXTURE_MIN_FILTER,i||e),this.filter=e),t!==this.wrap&&(T.texParameteri(T.TEXTURE_2D,T.TEXTURE_WRAP_S,t),T.texParameteri(T.TEXTURE_2D,T.TEXTURE_WRAP_T,t),this.wrap=t)},Texture.prototype.destroy=function(){this.context.gl.deleteTexture(this.texture),this.texture=null},module.exports=Texture;
},{"../util/window":288}],115:[function(_dereq_,module,exports){
"use strict";function computeTileMasks(e,i,l,a,r){for(var n=0;n<l.length;n++){var s=l[n];if(a.isLessThan(s.tileID))break;if(i.key===s.tileID.key)return;if(s.tileID.isChildOf(i)){for(var t=i.children(1/0),c=0;c<t.length;c++){computeTileMasks(e,t[c],l.slice(n),a,r)}return}}var o=i.overscaledZ-e.overscaledZ,D=new CanonicalTileID(o,i.canonical.x-(e.canonical.x<<o),i.canonical.y-(e.canonical.y<<o));r[D.key]=r[D.key]||D}var ref=_dereq_("../source/tile_id"),OverscaledTileID=ref.OverscaledTileID,CanonicalTileID=ref.CanonicalTileID;module.exports=function(e,i){for(var l=e.sort(function(e,i){return e.tileID.isLessThan(i.tileID)?-1:i.tileID.isLessThan(e.tileID)?1:0}),a=0;a<l.length;a++){var r={},n=l[a],s=l.slice(a+1);computeTileMasks(n.tileID.wrapped(),n.tileID,s,new OverscaledTileID(0,n.tileID.wrap+1,0,0,0),r),n.setMask(r,i)}};
},{"../source/tile_id":134}],116:[function(_dereq_,module,exports){
"use strict";var VertexArrayObject=function(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null};VertexArrayObject.prototype.bind=function(t,e,r,i,n,s,u,o){var b=this;this.context=t;for(var a=this.boundPaintVertexBuffers.length!==i.length,f=0;!a&&f<i.length;f++)b.boundPaintVertexBuffers[f]!==i[f]&&(a=!0);var x=!this.vao||this.boundProgram!==e||this.boundLayoutVertexBuffer!==r||a||this.boundIndexBuffer!==n||this.boundVertexOffset!==s||this.boundDynamicVertexBuffer!==u||this.boundDynamicVertexBuffer2!==o;!t.extVertexArrayObject||x?this.freshBind(e,r,i,n,s,u,o):(t.bindVertexArrayOES.set(this.vao),u&&u.bind(),n&&n.dynamicDraw&&n.bind(),o&&o.bind())},VertexArrayObject.prototype.freshBind=function(t,e,r,i,n,s,u){var o,b=t.numAttributes,a=this.context,f=a.gl;if(a.extVertexArrayObject)this.vao&&this.destroy(),this.vao=a.extVertexArrayObject.createVertexArrayOES(),a.bindVertexArrayOES.set(this.vao),o=0,this.boundProgram=t,this.boundLayoutVertexBuffer=e,this.boundPaintVertexBuffers=r,this.boundIndexBuffer=i,this.boundVertexOffset=n,this.boundDynamicVertexBuffer=s,this.boundDynamicVertexBuffer2=u;else{o=a.currentNumAttributes||0;for(var x=b;x<o;x++)f.disableVertexAttribArray(x)}e.enableAttributes(f,t);for(var d=0,h=r;d<h.length;d+=1){h[d].enableAttributes(f,t)}s&&s.enableAttributes(f,t),u&&u.enableAttributes(f,t),e.bind(),e.setVertexAttribPointers(f,t,n);for(var V=0,l=r;V<l.length;V+=1){var y=l[V];y.bind(),y.setVertexAttribPointers(f,t,n)}s&&(s.bind(),s.setVertexAttribPointers(f,t,n)),i&&i.bind(),u&&(u.bind(),u.setVertexAttribPointers(f,t,n)),a.currentNumAttributes=b},VertexArrayObject.prototype.destroy=function(){this.vao&&(this.context.extVertexArrayObject.deleteVertexArrayOES(this.vao),this.vao=null)},module.exports=VertexArrayObject;
},{}],117:[function(_dereq_,module,exports){
"use strict";var util=_dereq_("../util/util");exports.packUint8ToFloat=function(t,l){return t=util.clamp(Math.floor(t),0,255),l=util.clamp(Math.floor(l),0,255),256*t+l};
},{"../util/util":315}],118:[function(_dereq_,module,exports){
"use strict";var shaders={prelude:{fragmentSource:"#ifdef GL_ES\r\nprecision mediump float;\r\n#else\r\n\r\n#if !defined(lowp)\r\n#define lowp\r\n#endif\r\n\r\n#if !defined(mediump)\r\n#define mediump\r\n#endif\r\n\r\n#if !defined(highp)\r\n#define highp\r\n#endif\r\n\r\n#endif\r\n",vertexSource:"#ifdef GL_ES\r\nprecision highp float;\r\n#else\r\n\r\n#if !defined(lowp)\r\n#define lowp\r\n#endif\r\n\r\n#if !defined(mediump)\r\n#define mediump\r\n#endif\r\n\r\n#if !defined(highp)\r\n#define highp\r\n#endif\r\n\r\n#endif\r\n\r\n// Unpack a pair of values that have been packed into a single float.\r\n// The packed values are assumed to be 8-bit unsigned integers, and are\r\n// packed like so:\r\n// packedValue = floor(input[0]) * 256 + input[1],\r\nvec2 unpack_float(const float packedValue) {\r\n    int packedIntValue = int(packedValue);\r\n    int v0 = packedIntValue / 256;\r\n    return vec2(v0, packedIntValue - v0 * 256);\r\n}\r\n\r\nvec2 unpack_opacity(const float packedOpacity) {\r\n    int intOpacity = int(packedOpacity) / 2;\r\n    return vec2(float(intOpacity) / 127.0, mod(packedOpacity, 2.0));\r\n}\r\n\r\n// To minimize the number of attributes needed, we encode a 4-component\r\n// color into a pair of floats (i.e. a vec2) as follows:\r\n// [ floor(color.r * 255) * 256 + color.g * 255,\r\n//   floor(color.b * 255) * 256 + color.g * 255 ]\r\nvec4 decode_color(const vec2 encodedColor) {\r\n    return vec4(\r\n        unpack_float(encodedColor[0]) / 255.0,\r\n        unpack_float(encodedColor[1]) / 255.0\r\n    );\r\n}\r\n\r\n// Unpack a pair of paint values and interpolate between them.\r\nfloat unpack_mix_vec2(const vec2 packedValue, const float t) {\r\n    return mix(packedValue[0], packedValue[1], t);\r\n}\r\n\r\n// Unpack a pair of paint values and interpolate between them.\r\nvec4 unpack_mix_vec4(const vec4 packedColors, const float t) {\r\n    vec4 minColor = decode_color(vec2(packedColors[0], packedColors[1]));\r\n    vec4 maxColor = decode_color(vec2(packedColors[2], packedColors[3]));\r\n    return mix(minColor, maxColor, t);\r\n}\r\n\r\n// The offset depends on how many pixels are between the world origin and the edge of the tile:\r\n// vec2 offset = mod(pixel_coord, size)\r\n//\r\n// At high zoom levels there are a ton of pixels between the world origin and the edge of the tile.\r\n// The glsl spec only guarantees 16 bits of precision for highp floats. We need more than that.\r\n//\r\n// The pixel_coord is passed in as two 16 bit values:\r\n// pixel_coord_upper = floor(pixel_coord / 2^16)\r\n// pixel_coord_lower = mod(pixel_coord, 2^16)\r\n//\r\n// The offset is calculated in a series of steps that should preserve this precision:\r\nvec2 get_pattern_pos(const vec2 pixel_coord_upper, const vec2 pixel_coord_lower,\r\n    const vec2 pattern_size, const float tile_units_to_pixels, const vec2 pos) {\r\n\r\n    vec2 offset = mod(mod(mod(pixel_coord_upper, pattern_size) * 256.0, pattern_size) * 256.0 + pixel_coord_lower, pattern_size);\r\n    return (tile_units_to_pixels * pos + offset) / pattern_size;\r\n}\r\n\r\nvec3 get_interp_color(const vec3 in_color, const vec3 out_color, const float percent) {\r\n\r\n    return mix(in_color,out_color,percent) / 255.0;\r\n}\r\n"},background:{fragmentSource:"uniform vec4 u_color;\r\nuniform float u_opacity;\r\n\r\nvoid main() {\r\n    gl_FragColor = u_color * u_opacity;\r\n\r\n#ifdef OVERDRAW_INSPECTOR\r\n    gl_FragColor = vec4(1.0);\r\n#endif\r\n}\r\n",vertexSource:"attribute vec2 a_pos;\r\n\r\nuniform mat4 u_matrix;\r\n\r\nvoid main() {\r\n    gl_Position = u_matrix * vec4(a_pos, 0, 1);\r\n}\r\n"},backgroundPattern:{fragmentSource:"uniform vec2 u_pattern_tl_a;\r\nuniform vec2 u_pattern_br_a;\r\nuniform vec2 u_pattern_tl_b;\r\nuniform vec2 u_pattern_br_b;\r\nuniform vec2 u_texsize;\r\nuniform float u_mix;\r\nuniform float u_opacity;\r\n\r\nuniform sampler2D u_image;\r\n\r\nvarying vec2 v_pos_a;\r\nvarying vec2 v_pos_b;\r\n\r\nvoid main() {\r\n    vec2 imagecoord = mod(v_pos_a, 1.0);\r\n    vec2 pos = mix(u_pattern_tl_a / u_texsize, u_pattern_br_a / u_texsize, imagecoord);\r\n    vec4 color1 = texture2D(u_image, pos);\r\n\r\n    vec2 imagecoord_b = mod(v_pos_b, 1.0);\r\n    vec2 pos2 = mix(u_pattern_tl_b / u_texsize, u_pattern_br_b / u_texsize, imagecoord_b);\r\n    vec4 color2 = texture2D(u_image, pos2);\r\n\r\n    gl_FragColor = mix(color1, color2, u_mix) * u_opacity;\r\n\r\n#ifdef OVERDRAW_INSPECTOR\r\n    gl_FragColor = vec4(1.0);\r\n#endif\r\n}\r\n",vertexSource:"uniform mat4 u_matrix;\r\nuniform vec2 u_pattern_size_a;\r\nuniform vec2 u_pattern_size_b;\r\nuniform vec2 u_pixel_coord_upper;\r\nuniform vec2 u_pixel_coord_lower;\r\nuniform float u_scale_a;\r\nuniform float u_scale_b;\r\nuniform float u_tile_units_to_pixels;\r\n\r\nattribute vec2 a_pos;\r\n\r\nvarying vec2 v_pos_a;\r\nvarying vec2 v_pos_b;\r\n\r\nvoid main() {\r\n    gl_Position = u_matrix * vec4(a_pos, 0, 1);\r\n\r\n    v_pos_a = get_pattern_pos(u_pixel_coord_upper, u_pixel_coord_lower, u_scale_a * u_pattern_size_a, u_tile_units_to_pixels, a_pos);\r\n    v_pos_b = get_pattern_pos(u_pixel_coord_upper, u_pixel_coord_lower, u_scale_b * u_pattern_size_b, u_tile_units_to_pixels, a_pos);\r\n}\r\n"},circle:{fragmentSource:"#pragma minemap: define highp vec4 color\r\n#pragma minemap: define mediump float radius\r\n#pragma minemap: define lowp float blur\r\n#pragma minemap: define lowp float opacity\r\n#pragma minemap: define highp vec4 stroke_color\r\n#pragma minemap: define mediump float stroke_width\r\n#pragma minemap: define lowp float stroke_opacity\r\n\r\nvarying vec3 v_data;\r\n\r\nvoid main() {\r\n    #pragma minemap: initialize highp vec4 color\r\n    #pragma minemap: initialize mediump float radius\r\n    #pragma minemap: initialize lowp float blur\r\n    #pragma minemap: initialize lowp float opacity\r\n    #pragma minemap: initialize highp vec4 stroke_color\r\n    #pragma minemap: initialize mediump float stroke_width\r\n    #pragma minemap: initialize lowp float stroke_opacity\r\n\r\n    vec2 extrude = v_data.xy;\r\n    float extrude_length = length(extrude);\r\n\r\n    lowp float antialiasblur = v_data.z;\r\n    float antialiased_blur = -max(blur, antialiasblur);\r\n\r\n    float opacity_t = smoothstep(0.0, antialiased_blur, extrude_length - 1.0);\r\n\r\n    float color_t = stroke_width < 0.01 ? 0.0 : smoothstep(\r\n        antialiased_blur,\r\n        0.0,\r\n        extrude_length - radius / (radius + stroke_width)\r\n    );\r\n\r\n    gl_FragColor = opacity_t * mix(color * opacity, stroke_color * stroke_opacity, color_t);\r\n\r\n#ifdef OVERDRAW_INSPECTOR\r\n    gl_FragColor = vec4(1.0);\r\n#endif\r\n}\r\n",vertexSource:"uniform mat4 u_matrix;\r\nuniform bool u_scale_with_map;\r\nuniform bool u_pitch_with_map;\r\nuniform vec2 u_extrude_scale;\r\nuniform highp float u_camera_to_center_distance;\r\n\r\nattribute vec2 a_pos;\r\n\r\n#pragma minemap: define highp vec4 color\r\n#pragma minemap: define mediump float radius\r\n#pragma minemap: define lowp float blur\r\n#pragma minemap: define lowp float opacity\r\n#pragma minemap: define highp vec4 stroke_color\r\n#pragma minemap: define mediump float stroke_width\r\n#pragma minemap: define lowp float stroke_opacity\r\n\r\nvarying vec3 v_data;\r\n\r\nvoid main(void) {\r\n    #pragma minemap: initialize highp vec4 color\r\n    #pragma minemap: initialize mediump float radius\r\n    #pragma minemap: initialize lowp float blur\r\n    #pragma minemap: initialize lowp float opacity\r\n    #pragma minemap: initialize highp vec4 stroke_color\r\n    #pragma minemap: initialize mediump float stroke_width\r\n    #pragma minemap: initialize lowp float stroke_opacity\r\n\r\n    // unencode the extrusion vector that we snuck into the a_pos vector\r\n    vec2 extrude = vec2(mod(a_pos, 2.0) * 2.0 - 1.0);\r\n\r\n    // multiply a_pos by 0.5, since we had it * 2 in order to sneak\r\n    // in extrusion data\r\n    vec2 circle_center = floor(a_pos * 0.5);\r\n    if (u_pitch_with_map) {\r\n        vec2 corner_position = circle_center;\r\n        if (u_scale_with_map) {\r\n            corner_position += extrude * (radius + stroke_width) * u_extrude_scale;\r\n        } else {\r\n            // Pitching the circle with the map effectively scales it with the map\r\n            // To counteract the effect for pitch-scale: viewport, we rescale the\r\n            // whole circle based on the pitch scaling effect at its central point\r\n            vec4 projected_center = u_matrix * vec4(circle_center, 0, 1);\r\n            corner_position += extrude * (radius + stroke_width) * u_extrude_scale * (projected_center.w / u_camera_to_center_distance);\r\n        }\r\n\r\n        gl_Position = u_matrix * vec4(corner_position, 0, 1);\r\n    } else {\r\n        gl_Position = u_matrix * vec4(circle_center, 0, 1);\r\n\r\n        if (u_scale_with_map) {\r\n            gl_Position.xy += extrude * (radius + stroke_width) * u_extrude_scale * u_camera_to_center_distance;\r\n        } else {\r\n            gl_Position.xy += extrude * (radius + stroke_width) * u_extrude_scale * gl_Position.w;\r\n        }\r\n    }\r\n\r\n    // This is a minimum blur distance that serves as a faux-antialiasing for\r\n    // the circle. since blur is a ratio of the circle's size and the intent is\r\n    // to keep the blur at roughly 1px, the two are inversely related.\r\n    lowp float antialiasblur = 1.0 / DEVICE_PIXEL_RATIO / (radius + stroke_width);\r\n\r\n    v_data = vec3(extrude.x, extrude.y, antialiasblur);\r\n}\r\n"},clippingMask:{fragmentSource:"void main() {\r\n    gl_FragColor = vec4(1.0);\r\n}\r\n",vertexSource:"attribute vec2 a_pos;\r\n\r\nuniform mat4 u_matrix;\r\n\r\nvoid main() {\r\n    gl_Position = u_matrix * vec4(a_pos, 0, 1);\r\n}\r\n"},heatmap:{fragmentSource:"#pragma minemap: define highp float weight\r\n\r\nuniform highp float u_intensity;\r\nvarying vec2 v_extrude;\r\n\r\n// Gaussian kernel coefficient: 1 / sqrt(2 * PI)\r\n#define GAUSS_COEF 0.3989422804014327\r\n\r\nvoid main() {\r\n    #pragma minemap: initialize highp float weight\r\n\r\n    // Kernel density estimation with a Gaussian kernel of size 5x5\r\n    float d = -0.5 * 3.0 * 3.0 * dot(v_extrude, v_extrude);\r\n    float val = weight * u_intensity * GAUSS_COEF * exp(d);\r\n\r\n    gl_FragColor = vec4(val, 1.0, 1.0, 1.0);\r\n\r\n#ifdef OVERDRAW_INSPECTOR\r\n    gl_FragColor = vec4(1.0);\r\n#endif\r\n}\r\n",vertexSource:"#pragma minemap: define highp float weight\r\n#pragma minemap: define mediump float radius\r\n\r\nuniform mat4 u_matrix;\r\nuniform float u_extrude_scale;\r\nuniform float u_opacity;\r\nuniform float u_intensity;\r\n\r\nattribute vec2 a_pos;\r\n\r\nvarying vec2 v_extrude;\r\n\r\n// Effective \"0\" in the kernel density texture to adjust the kernel size to;\r\n// this empirically chosen number minimizes artifacts on overlapping kernels\r\n// for typical heatmap cases (assuming clustered source)\r\nconst highp float ZERO = 1.0 / 255.0 / 16.0;\r\n\r\n// Gaussian kernel coefficient: 1 / sqrt(2 * PI)\r\n#define GAUSS_COEF 0.3989422804014327\r\n\r\nvoid main(void) {\r\n    #pragma minemap: initialize highp float weight\r\n    #pragma minemap: initialize mediump float radius\r\n\r\n    // unencode the extrusion vector that we snuck into the a_pos vector\r\n    vec2 unscaled_extrude = vec2(mod(a_pos, 2.0) * 2.0 - 1.0);\r\n\r\n    // This 'extrude' comes in ranging from [-1, -1], to [1, 1].  We'll use\r\n    // it to produce the vertices of a square mesh framing the point feature\r\n    // we're adding to the kernel density texture.  We'll also pass it as\r\n    // a varying, so that the fragment shader can determine the distance of\r\n    // each fragment from the point feature.\r\n    // Before we do so, we need to scale it up sufficiently so that the\r\n    // kernel falls effectively to zero at the edge of the mesh.\r\n    // That is, we want to know S such that\r\n    // weight * u_intensity * GAUSS_COEF * exp(-0.5 * 3.0^2 * S^2) == ZERO\r\n    // Which solves to:\r\n    // S = sqrt(-2.0 * log(ZERO / (weight * u_intensity * GAUSS_COEF))) / 3.0\r\n    float S = sqrt(-2.0 * log(ZERO / weight / u_intensity / GAUSS_COEF)) / 3.0;\r\n\r\n    // Pass the varying in units of radius\r\n    v_extrude = S * unscaled_extrude;\r\n\r\n    // Scale by radius and the zoom-based scale factor to produce actual\r\n    // mesh position\r\n    vec2 extrude = v_extrude * radius * u_extrude_scale;\r\n\r\n    // multiply a_pos by 0.5, since we had it * 2 in order to sneak\r\n    // in extrusion data\r\n    vec4 pos = vec4(floor(a_pos * 0.5) + extrude, 0, 1);\r\n\r\n    gl_Position = u_matrix * pos;\r\n}\r\n"},heatmapTexture:{fragmentSource:"uniform sampler2D u_image;\r\nuniform sampler2D u_color_ramp;\r\nuniform float u_opacity;\r\nvarying vec2 v_pos;\r\n\r\nvoid main() {\r\n    float t = texture2D(u_image, v_pos).r;\r\n    vec4 color = texture2D(u_color_ramp, vec2(t, 0.5));\r\n    gl_FragColor = color * u_opacity;\r\n\r\n#ifdef OVERDRAW_INSPECTOR\r\n    gl_FragColor = vec4(0.0);\r\n#endif\r\n}\r\n",vertexSource:"uniform mat4 u_matrix;\r\nuniform vec2 u_world;\r\nattribute vec2 a_pos;\r\nvarying vec2 v_pos;\r\n\r\nvoid main() {\r\n    gl_Position = u_matrix * vec4(a_pos * u_world, 0, 1);\r\n\r\n    v_pos.x = a_pos.x;\r\n    v_pos.y = 1.0 - a_pos.y;\r\n}\r\n"},collisionBox:{fragmentSource:"\r\nvarying float v_placed;\r\nvarying float v_notUsed;\r\n\r\nvoid main() {\r\n\r\n    float alpha = 0.5;\r\n\r\n    // Red = collision, hide label\r\n    gl_FragColor = vec4(1.0, 0.0, 0.0, 1.0) * alpha;\r\n\r\n    // Blue = no collision, label is showing\r\n    if (v_placed > 0.5) {\r\n        gl_FragColor = vec4(0.0, 0.0, 1.0, 0.5) * alpha;\r\n    }\r\n\r\n    if (v_notUsed > 0.5) {\r\n        // This box not used, fade it out\r\n        gl_FragColor *= .1;\r\n    }\r\n}",vertexSource:"attribute vec2 a_pos;\r\nattribute vec2 a_anchor_pos;\r\nattribute vec2 a_extrude;\r\nattribute vec2 a_placed;\r\n\r\nuniform mat4 u_matrix;\r\nuniform vec2 u_extrude_scale;\r\nuniform float u_camera_to_center_distance;\r\n\r\nvarying float v_placed;\r\nvarying float v_notUsed;\r\n\r\nvoid main() {\r\n    vec4 projectedPoint = u_matrix * vec4(a_anchor_pos, 0, 1);\r\n    highp float camera_to_anchor_distance = projectedPoint.w;\r\n    highp float collision_perspective_ratio = 0.5 + 0.5 * (u_camera_to_center_distance / camera_to_anchor_distance);\r\n\r\n    gl_Position = u_matrix * vec4(a_pos, 0.0, 1.0);\r\n    gl_Position.xy += a_extrude * u_extrude_scale * gl_Position.w * collision_perspective_ratio;\r\n\r\n    v_placed = a_placed.x;\r\n    v_notUsed = a_placed.y;\r\n}\r\n"},collisionCircle:{fragmentSource:"\r\nvarying float v_placed;\r\nvarying float v_notUsed;\r\nvarying float v_radius;\r\nvarying vec2 v_extrude;\r\nvarying vec2 v_extrude_scale;\r\n\r\nvoid main() {\r\n    float alpha = 0.5;\r\n\r\n    // Red = collision, hide label\r\n    vec4 color = vec4(1.0, 0.0, 0.0, 1.0) * alpha;\r\n\r\n    // Blue = no collision, label is showing\r\n    if (v_placed > 0.5) {\r\n        color = vec4(0.0, 0.0, 1.0, 0.5) * alpha;\r\n    }\r\n\r\n    if (v_notUsed > 0.5) {\r\n        // This box not used, fade it out\r\n        color *= .2;\r\n    }\r\n\r\n    float extrude_scale_length = length(v_extrude_scale);\r\n    float extrude_length = length(v_extrude) * extrude_scale_length;\r\n    float stroke_width = 15.0 * extrude_scale_length;\r\n    float radius = v_radius * extrude_scale_length;\r\n\r\n    float distance_to_edge = abs(extrude_length - radius);\r\n    float opacity_t = smoothstep(-stroke_width, 0.0, -distance_to_edge);\r\n\r\n    gl_FragColor = opacity_t * color;\r\n}\r\n",vertexSource:"attribute vec2 a_pos;\r\nattribute vec2 a_anchor_pos;\r\nattribute vec2 a_extrude;\r\nattribute vec2 a_placed;\r\n\r\nuniform mat4 u_matrix;\r\nuniform vec2 u_extrude_scale;\r\nuniform float u_camera_to_center_distance;\r\n\r\nvarying float v_placed;\r\nvarying float v_notUsed;\r\nvarying float v_radius;\r\n\r\nvarying vec2 v_extrude;\r\nvarying vec2 v_extrude_scale;\r\n\r\nvoid main() {\r\n    vec4 projectedPoint = u_matrix * vec4(a_anchor_pos, 0, 1);\r\n    highp float camera_to_anchor_distance = projectedPoint.w;\r\n    highp float collision_perspective_ratio = 0.5 + 0.5 * (u_camera_to_center_distance / camera_to_anchor_distance);\r\n\r\n    gl_Position = u_matrix * vec4(a_pos, 0.0, 1.0);\r\n\r\n    highp float padding_factor = 1.2; // Pad the vertices slightly to make room for anti-alias blur\r\n    gl_Position.xy += a_extrude * u_extrude_scale * padding_factor * gl_Position.w * collision_perspective_ratio;\r\n\r\n    v_placed = a_placed.x;\r\n    v_notUsed = a_placed.y;\r\n    v_radius = abs(a_extrude.y); // We don't pitch the circles, so both units of the extrusion vector are equal in magnitude to the radius\r\n\r\n    v_extrude = a_extrude * padding_factor;\r\n    v_extrude_scale = u_extrude_scale * u_camera_to_center_distance * collision_perspective_ratio;\r\n}\r\n"},debug:{fragmentSource:"uniform highp vec4 u_color;\r\n\r\nvoid main() {\r\n    gl_FragColor = u_color;\r\n}\r\n",vertexSource:"attribute vec2 a_pos;\r\n\r\nuniform mat4 u_matrix;\r\n\r\nvoid main() {\r\n    gl_Position = u_matrix * vec4(a_pos, 0, 1);\r\n}\r\n"},fill:{fragmentSource:"#pragma minemap: define highp vec4 color\r\n#pragma minemap: define lowp float opacity\r\n\r\nvoid main() {\r\n    #pragma minemap: initialize highp vec4 color\r\n    #pragma minemap: initialize lowp float opacity\r\n\r\n    gl_FragColor = color * opacity;\r\n\r\n#ifdef OVERDRAW_INSPECTOR\r\n    gl_FragColor = vec4(1.0);\r\n#endif\r\n}\r\n",vertexSource:"attribute vec3 a_pos;\r\n\r\nuniform mat4 u_matrix;\r\n\r\n#pragma minemap: define highp vec4 color\r\n#pragma minemap: define lowp float opacity\r\n\r\nvoid main() {\r\n    #pragma minemap: initialize highp vec4 color\r\n    #pragma minemap: initialize lowp float opacity\r\n\r\n    gl_Position = u_matrix * vec4(a_pos.xy,0.0, 1);\r\n}\r\n"},fill3d:{fragmentSource:"#pragma minemap: define highp vec4 color\r\n#pragma minemap: define lowp float opacity\r\nvarying vec4 v_color;\r\nvoid main() {\r\n    #pragma minemap: initialize highp vec4 color\r\n    #pragma minemap: initialize lowp float opacity\r\n\r\n    gl_FragColor = v_color * opacity;\r\n\r\n#ifdef OVERDRAW_INSPECTOR\r\n    gl_FragColor = vec4(1.0);\r\n#endif\r\n}\r\n",vertexSource:"attribute vec3 a_pos;\r\n\r\nuniform mat4 u_matrix;\r\n\r\nuniform vec3 u_lightcolor;\r\nuniform lowp vec3 u_lightpos;\r\nuniform lowp float u_lightintensity;\r\n\r\n#pragma minemap: define highp vec4 color\r\n#pragma minemap: define lowp float opacity\r\nvarying vec4 v_color;\r\nvoid main() {\r\n    #pragma minemap: initialize highp vec4 color\r\n    #pragma minemap: initialize lowp float opacity\r\n\r\n    gl_Position = u_matrix * vec4(a_pos.xy,a_pos.z/10.0, 1);\r\n\r\n\r\n    vec3 normal = a_pos;\r\n    // Relative luminance (how dark/bright is the surface color?)\r\n        float colorvalue = color.r * 0.2126 + color.g * 0.7152 + color.b * 0.0722;\r\n\r\n        v_color = vec4(0.0, 0.0, 0.0, 1.0);\r\n\r\n        // Add slight ambient lighting so no extrusions are totally black\r\n        vec4 ambientlight = vec4(0.03, 0.03, 0.03, 1.0);\r\n        color += ambientlight;\r\n\r\n        // Calculate cos(theta), where theta is the angle between surface normal and diffuse light ray\r\n        float directional = clamp(dot(normal / 16384.0, u_lightpos), 0.0, 1.0);\r\n\r\n        // Adjust directional so that\r\n        // the range of values for highlight/shading is narrower\r\n        // with lower light intensity\r\n        // and with lighter/brighter surface colors\r\n        directional = mix((1.0 - u_lightintensity), max((1.0 - colorvalue + u_lightintensity), 1.0), directional);\r\n\r\n        // Add gradient along z axis of side surfaces\r\n        if (normal.y != 0.0) {\r\n            directional *= clamp((a_pos.z + 0.0) * pow(a_pos.z / 150.0, 0.5), mix(0.7, 0.98, 1.0 - u_lightintensity), 1.0);\r\n        }\r\n\r\n        // Assign final color based on surface + ambient light color, diffuse light directional, and light color\r\n        // with lower bounds adjusted to hue of light\r\n        // so that shading is tinted with the complementary (opposite) color to the light color\r\n        v_color.r += clamp(color.r * directional * u_lightcolor.r, mix(0.0, 0.3, 1.0 - u_lightcolor.r), 1.0);\r\n        v_color.g += clamp(color.g * directional * u_lightcolor.g, mix(0.0, 0.3, 1.0 - u_lightcolor.g), 1.0);\r\n        v_color.b += clamp(color.b * directional * u_lightcolor.b, mix(0.0, 0.3, 1.0 - u_lightcolor.b), 1.0);\r\n}\r\n"},fillOutline:{fragmentSource:"#pragma minemap: define highp vec4 outline_color\r\n#pragma minemap: define lowp float opacity\r\n\r\nvarying vec2 v_pos;\r\n\r\nvoid main() {\r\n    #pragma minemap: initialize highp vec4 outline_color\r\n    #pragma minemap: initialize lowp float opacity\r\n\r\n    float dist = length(v_pos - gl_FragCoord.xy);\r\n    float alpha = 1.0 - smoothstep(0.0, 1.0, dist);\r\n    gl_FragColor = outline_color * (alpha * opacity);\r\n\r\n#ifdef OVERDRAW_INSPECTOR\r\n    gl_FragColor = vec4(1.0);\r\n#endif\r\n}\r\n",vertexSource:"attribute vec2 a_pos;\r\n\r\nuniform mat4 u_matrix;\r\nuniform vec2 u_world;\r\n\r\nvarying vec2 v_pos;\r\n\r\n#pragma minemap: define highp vec4 outline_color\r\n#pragma minemap: define lowp float opacity\r\n\r\nvoid main() {\r\n    #pragma minemap: initialize highp vec4 outline_color\r\n    #pragma minemap: initialize lowp float opacity\r\n\r\n    gl_Position = u_matrix * vec4(a_pos, 0, 1);\r\n    v_pos = (gl_Position.xy / gl_Position.w + 1.0) / 2.0 * u_world;\r\n}\r\n"},fillOutlinePattern:{fragmentSource:"uniform vec2 u_pattern_tl_a;\r\nuniform vec2 u_pattern_br_a;\r\nuniform vec2 u_pattern_tl_b;\r\nuniform vec2 u_pattern_br_b;\r\nuniform vec2 u_texsize;\r\nuniform float u_mix;\r\n\r\nuniform sampler2D u_image;\r\n\r\nvarying vec2 v_pos_a;\r\nvarying vec2 v_pos_b;\r\nvarying vec2 v_pos;\r\n\r\n#pragma minemap: define lowp float opacity\r\n\r\nvoid main() {\r\n    #pragma minemap: initialize lowp float opacity\r\n\r\n    vec2 imagecoord = mod(v_pos_a, 1.0);\r\n    vec2 pos = mix(u_pattern_tl_a / u_texsize, u_pattern_br_a / u_texsize, imagecoord);\r\n    vec4 color1 = texture2D(u_image, pos);\r\n\r\n    vec2 imagecoord_b = mod(v_pos_b, 1.0);\r\n    vec2 pos2 = mix(u_pattern_tl_b / u_texsize, u_pattern_br_b / u_texsize, imagecoord_b);\r\n    vec4 color2 = texture2D(u_image, pos2);\r\n\r\n    // find distance to outline for alpha interpolation\r\n\r\n    float dist = length(v_pos - gl_FragCoord.xy);\r\n    float alpha = 1.0 - smoothstep(0.0, 1.0, dist);\r\n\r\n\r\n    gl_FragColor = mix(color1, color2, u_mix) * alpha * opacity;\r\n\r\n#ifdef OVERDRAW_INSPECTOR\r\n    gl_FragColor = vec4(1.0);\r\n#endif\r\n}\r\n",vertexSource:"uniform mat4 u_matrix;\r\nuniform vec2 u_world;\r\nuniform vec2 u_pattern_size_a;\r\nuniform vec2 u_pattern_size_b;\r\nuniform vec2 u_pixel_coord_upper;\r\nuniform vec2 u_pixel_coord_lower;\r\nuniform float u_scale_a;\r\nuniform float u_scale_b;\r\nuniform float u_tile_units_to_pixels;\r\n\r\nattribute vec2 a_pos;\r\n\r\nvarying vec2 v_pos_a;\r\nvarying vec2 v_pos_b;\r\nvarying vec2 v_pos;\r\n\r\n#pragma minemap: define lowp float opacity\r\n\r\nvoid main() {\r\n    #pragma minemap: initialize lowp float opacity\r\n\r\n    gl_Position = u_matrix * vec4(a_pos, 0, 1);\r\n\r\n    v_pos_a = get_pattern_pos(u_pixel_coord_upper, u_pixel_coord_lower, u_scale_a * u_pattern_size_a, u_tile_units_to_pixels, a_pos);\r\n    v_pos_b = get_pattern_pos(u_pixel_coord_upper, u_pixel_coord_lower, u_scale_b * u_pattern_size_b, u_tile_units_to_pixels, a_pos);\r\n\r\n    v_pos = (gl_Position.xy / gl_Position.w + 1.0) / 2.0 * u_world;\r\n}\r\n"},fillPattern:{fragmentSource:"uniform vec2 u_pattern_tl_a;\r\nuniform vec2 u_pattern_br_a;\r\nuniform vec2 u_pattern_tl_b;\r\nuniform vec2 u_pattern_br_b;\r\nuniform vec2 u_texsize;\r\nuniform float u_mix;\r\n\r\nuniform sampler2D u_image;\r\n\r\nvarying vec2 v_pos_a;\r\nvarying vec2 v_pos_b;\r\n\r\n#pragma minemap: define lowp float opacity\r\n\r\nvoid main() {\r\n    #pragma minemap: initialize lowp float opacity\r\n\r\n    vec2 imagecoord = mod(v_pos_a, 1.0);\r\n    vec2 pos = mix(u_pattern_tl_a / u_texsize, u_pattern_br_a / u_texsize, imagecoord);\r\n    vec4 color1 = texture2D(u_image, pos);\r\n\r\n    vec2 imagecoord_b = mod(v_pos_b, 1.0);\r\n    vec2 pos2 = mix(u_pattern_tl_b / u_texsize, u_pattern_br_b / u_texsize, imagecoord_b);\r\n    vec4 color2 = texture2D(u_image, pos2);\r\n\r\n    gl_FragColor = mix(color1, color2, u_mix) * opacity;\r\n\r\n#ifdef OVERDRAW_INSPECTOR\r\n    gl_FragColor = vec4(1.0);\r\n#endif\r\n}\r\n",vertexSource:"uniform mat4 u_matrix;\r\nuniform vec2 u_pattern_size_a;\r\nuniform vec2 u_pattern_size_b;\r\nuniform vec2 u_pixel_coord_upper;\r\nuniform vec2 u_pixel_coord_lower;\r\nuniform float u_scale_a;\r\nuniform float u_scale_b;\r\nuniform float u_tile_units_to_pixels;\r\nuniform float u_zoom_factor;\r\n\r\nattribute vec3 a_pos;\r\n\r\nvarying vec2 v_pos_a;\r\nvarying vec2 v_pos_b;\r\n\r\n#pragma minemap: define lowp float opacity\r\n\r\nvoid main() {\r\n    #pragma minemap: initialize lowp float opacity\r\n\r\n    gl_Position = u_matrix * vec4(a_pos.xy,a_pos.z/10.0, 1);\r\n\r\n    v_pos_a = get_pattern_pos(u_pixel_coord_upper, u_pixel_coord_lower, u_scale_a * u_pattern_size_a, u_tile_units_to_pixels, a_pos.xy)* u_zoom_factor;\r\n    v_pos_b = get_pattern_pos(u_pixel_coord_upper, u_pixel_coord_lower, u_scale_b * u_pattern_size_b, u_tile_units_to_pixels, a_pos.xy)* u_zoom_factor;\r\n}\r\n"},fillWater:{fragmentSource:"#define TAU 6.28318530718\r\n#define MAX_ITER 5\r\n#define INTENSITY 0.004\r\n#define SCALE 1000.0\r\n\r\nuniform lowp float u_time;\r\n\r\nvoid main() {\r\n    vec2 uv = gl_FragCoord.xy / SCALE;\r\n    vec2 p = mod(uv * TAU, TAU) - 250.0;\r\n    vec2 i = vec2(p);\r\n    float c = 1.0;\r\n\r\n    for (int n = 0; n < MAX_ITER; n++) {\r\n        float t = 0.5 * u_time * (1.0 - (3.5 / float(n + 1)));\r\n        i = p + vec2(cos(t - i.x) + sin(t + i.y), sin(t - i.y) + cos(t + i.x));\r\n        c += 1.0 / length(vec2(p.x / (sin(i.x + t) / INTENSITY), p.y / (cos(i.y + t) / INTENSITY)));\r\n    }\r\n    c = 1.17 - pow(c / float(MAX_ITER), 1.4);\r\n\r\n    gl_FragColor = vec4(clamp(vec3(pow(abs(c), 8.0)) + vec3(0.0, 0.35, 0.5), 0.0, 1.0), 1.0);\r\n\r\n}\r\n",vertexSource:"attribute vec2 a_pos;\r\n\r\nuniform mat4 u_matrix;\r\n\r\n#pragma minemap: define lowp vec4 color\r\n#pragma minemap: define lowp float opacity\r\n\r\nvoid main() {\r\n    #pragma minemap: initialize lowp vec4 color\r\n    #pragma minemap: initialize lowp float opacity\r\n\r\n    gl_Position = u_matrix * vec4(a_pos, 0, 1);\r\n}\r\n"},fillExtrusion:{fragmentSource:"varying vec4 v_color;\r\n#pragma minemap: define lowp float base\r\n#pragma minemap: define lowp float height\r\n#pragma minemap: define highp vec4 color\r\n\r\nvoid main() {\r\n    #pragma minemap: initialize lowp float base\r\n    #pragma minemap: initialize lowp float height\r\n    #pragma minemap: initialize highp vec4 color\r\n\r\n    gl_FragColor = v_color;\r\n\r\n#ifdef OVERDRAW_INSPECTOR\r\n    gl_FragColor = vec4(1.0);\r\n#endif\r\n}\r\n",vertexSource:"uniform mat4 u_matrix;\r\nuniform vec3 u_lightcolor;\r\nuniform lowp vec3 u_lightpos;\r\nuniform lowp float u_lightintensity;\r\nuniform lowp float u_render_road;\r\n\r\nattribute vec3 a_pos;\r\nattribute vec4 a_normal_ed;\r\n\r\nvarying vec4 v_color;\r\n\r\n#pragma minemap: define lowp float base\r\n#pragma minemap: define lowp float height\r\n\r\n#pragma minemap: define highp vec4 color\r\n\r\nvoid main() {\r\n    #pragma minemap: initialize lowp float base\r\n    #pragma minemap: initialize lowp float height\r\n    #pragma minemap: initialize highp vec4 color\r\n\r\n    vec3 normal = a_normal_ed.xyz;\r\n\r\n    base = max(0.0, base);\r\n    height = max(0.0, height);\r\n\r\n    float t = mod(normal.x, 2.0);\r\n\r\n\r\n    if(u_render_road == 1.0){\r\n        gl_Position = u_matrix * vec4(a_pos.xy, t > 0.0 ? a_pos[2]/10.0 : (a_pos[2] - 10.0)/10.0, 1);\r\n    }else{\r\n        gl_Position = u_matrix * vec4(a_pos.xy, t > 0.0 ? height : base, 1);\r\n    }\r\n\r\n\r\n    // Relative luminance (how dark/bright is the surface color?)\r\n    float colorvalue = color.r * 0.2126 + color.g * 0.7152 + color.b * 0.0722;\r\n\r\n    v_color = vec4(0.0, 0.0, 0.0, 1.0);\r\n\r\n    // Add slight ambient lighting so no extrusions are totally black\r\n    vec4 ambientlight = vec4(0.03, 0.03, 0.03, 1.0);\r\n    color += ambientlight;\r\n\r\n    // Calculate cos(theta), where theta is the angle between surface normal and diffuse light ray\r\n    float directional = clamp(dot(normal / 16384.0, u_lightpos), 0.0, 1.0);\r\n\r\n    // Adjust directional so that\r\n    // the range of values for highlight/shading is narrower\r\n    // with lower light intensity\r\n    // and with lighter/brighter surface colors\r\n    directional = mix((1.0 - u_lightintensity), max((1.0 - colorvalue + u_lightintensity), 1.0), directional);\r\n\r\n    // Add gradient along z axis of side surfaces\r\n    if (normal.y != 0.0) {\r\n        directional *= clamp((t + base) * pow(height / 150.0, 0.5), mix(0.7, 0.98, 1.0 - u_lightintensity), 1.0);\r\n    }\r\n\r\n    // Assign final color based on surface + ambient light color, diffuse light directional, and light color\r\n    // with lower bounds adjusted to hue of light\r\n    // so that shading is tinted with the complementary (opposite) color to the light color\r\n    v_color.r += clamp(color.r * directional * u_lightcolor.r, mix(0.0, 0.3, 1.0 - u_lightcolor.r), 1.0);\r\n    v_color.g += clamp(color.g * directional * u_lightcolor.g, mix(0.0, 0.3, 1.0 - u_lightcolor.g), 1.0);\r\n    v_color.b += clamp(color.b * directional * u_lightcolor.b, mix(0.0, 0.3, 1.0 - u_lightcolor.b), 1.0);\r\n}\r\n"},fillExtrusionPattern:{fragmentSource:"uniform vec2 u_pattern_tl_a;\r\nuniform vec2 u_pattern_br_a;\r\nuniform vec2 u_pattern_tl_b;\r\nuniform vec2 u_pattern_br_b;\r\nuniform vec2 u_texsize;\r\nuniform float u_mix;\r\n\r\nuniform sampler2D u_image;\r\n\r\nvarying vec2 v_pos_a;\r\nvarying vec2 v_pos_b;\r\nvarying vec4 v_lighting;\r\nvarying float v_is_top;\r\n\r\n#pragma minemap: define lowp float base\r\n#pragma minemap: define lowp float height\r\n\r\nvoid main() {\r\n    #pragma minemap: initialize lowp float base\r\n    #pragma minemap: initialize lowp float height\r\n\r\n    //vec2 imagecoord = mod(v_pos_a, 1.0);\r\n    //if(v_is_top >= 100.0){\r\n    //    imagecoord = vec2(0.0,0.0);\r\n    //}\r\n    //vec2 pos = mix(u_pattern_tl_a / u_texsize, u_pattern_br_a / u_texsize, imagecoord);\r\n    //vec4 color1 = texture2D(u_image, pos);\r\n\r\n    vec2 imagecoord_b = mod(v_pos_b, 1.0);\r\n    if(v_is_top >= 100.0){\r\n            imagecoord_b = vec2(0.0,0.0);\r\n    }\r\n    vec2 pos2 = mix(u_pattern_tl_b / u_texsize, u_pattern_br_b / u_texsize, imagecoord_b);\r\n    vec4 color2 = texture2D(u_image, pos2);\r\n\r\n    //vec4 mixedColor = mix(color1, color2, u_mix);\r\n\r\n    if(v_is_top >= 100.0){\r\n    gl_FragColor = vec4(color2.rgb,1.) * v_lighting;\r\n\r\n    }else{\r\n    gl_FragColor = color2 * v_lighting;\r\n    }\r\n\r\n\r\n\r\n    //vec2 imagecoord_b = mod(v_pos_b, 1.0);\r\n      //  if(v_is_top >= 100.0){\r\n        //        imagecoord_b = vec2(0.0,0.0);\r\n          //      gl_FragColor = vec4(30.0/255.0,94.0/255.0,93.0/255.0,1.0)*v_lighting*1.5;\r\n        //}else{\r\n        //    vec2 pos2 = mix(u_pattern_tl_b / u_texsize, u_pattern_br_b / u_texsize, imagecoord_b);\r\n        //        vec4 color2 = texture2D(u_image, pos2);\r\n\r\n                //vec4 mixedColor = mix(color1, color2, u_mix);\r\n\r\n        //        gl_FragColor = color2 * v_lighting * 0.8;\r\n        //}\r\n\r\n#ifdef OVERDRAW_INSPECTOR\r\n    gl_FragColor = vec4(1.0);\r\n#endif\r\n}\r\n",
vertexSource:"uniform mat4 u_matrix;\r\nuniform vec2 u_pattern_size_a;\r\nuniform vec2 u_pattern_size_b;\r\nuniform vec2 u_pixel_coord_upper;\r\nuniform vec2 u_pixel_coord_lower;\r\nuniform float u_scale_a;\r\nuniform float u_scale_b;\r\nuniform float u_tile_units_to_pixels;\r\nuniform float u_height_factor;\r\n\r\nuniform vec3 u_lightcolor;\r\nuniform lowp vec3 u_lightpos;\r\nuniform lowp float u_lightintensity;\r\nuniform lowp float u_zoom_factor;\r\n\r\nattribute vec2 a_pos;\r\nattribute vec4 a_normal_ed;\r\n\r\nvarying vec2 v_pos_a;\r\nvarying vec2 v_pos_b;\r\nvarying vec4 v_lighting;\r\nvarying float v_is_top;\r\n\r\n#pragma minemap: define lowp float base\r\n#pragma minemap: define lowp float height\r\n\r\nvoid main() {\r\n    #pragma minemap: initialize lowp float base\r\n    #pragma minemap: initialize lowp float height\r\n\r\n    vec3 normal = a_normal_ed.xyz;\r\n    float edgedistance = a_normal_ed.w;\r\n\r\n    base = max(0.0, base);\r\n    height = max(0.0, height);\r\n\r\n    float t = mod(normal.x, 2.0);\r\n    float z = t > 0.0 ? height : base;\r\n\r\n    v_is_top = t > 0.0 ? 100.0 : -100.0;\r\n\r\n    gl_Position = u_matrix * vec4(a_pos, z, 1);\r\n\r\n    vec2 pos = normal.x == 1.0 && normal.y == 0.0 && normal.z == 16384.0\r\n        ? a_pos // extrusion top\r\n        : vec2(edgedistance, z * u_height_factor); // extrusion side\r\n\r\n    v_pos_a = get_pattern_pos(u_pixel_coord_upper, u_pixel_coord_lower, u_scale_a * u_pattern_size_a, u_tile_units_to_pixels, pos) * u_zoom_factor;\r\n    v_pos_b = get_pattern_pos(u_pixel_coord_upper, u_pixel_coord_lower, u_scale_b * u_pattern_size_b, u_tile_units_to_pixels, pos) * u_zoom_factor;\r\n\r\n    v_lighting = vec4(0.0, 0.0, 0.0, 1.0);\r\n    float directional = clamp(dot(normal / 16383.0, u_lightpos), 0.0, 1.0);\r\n    directional = mix((1.0 - u_lightintensity), max((0.5 + u_lightintensity), 1.0), directional);\r\n\r\n    if (normal.y != 0.0) {\r\n        directional *= clamp((t + base) * pow(height / 150.0, 0.5), mix(0.7, 0.98, 1.0 - u_lightintensity), 1.0);\r\n    }\r\n\r\n    v_lighting.rgb += clamp(directional * u_lightcolor, mix(vec3(0.0), vec3(0.3), 1.0 - u_lightcolor), vec3(1.0));\r\n}\r\n"},extrusionTexture:{fragmentSource:"uniform sampler2D u_image;\r\nuniform float u_opacity;\r\nvarying vec2 v_pos;\r\n\r\nvoid main() {\r\n    gl_FragColor = texture2D(u_image, v_pos) * u_opacity;\r\n\r\n#ifdef OVERDRAW_INSPECTOR\r\n    gl_FragColor = vec4(0.0);\r\n#endif\r\n}\r\n",vertexSource:"uniform mat4 u_matrix;\r\nuniform vec2 u_world;\r\nattribute vec2 a_pos;\r\nvarying vec2 v_pos;\r\n\r\nvoid main() {\r\n    gl_Position = u_matrix * vec4(a_pos * u_world, 0, 1);\r\n\r\n    v_pos.x = a_pos.x;\r\n    v_pos.y = 1.0 - a_pos.y;\r\n}\r\n"},hillshadePrepare:{fragmentSource:"#ifdef GL_ES\r\nprecision highp float;\r\n#endif\r\n\r\nuniform sampler2D u_image;\r\nvarying vec2 v_pos;\r\nuniform vec2 u_dimension;\r\nuniform float u_zoom;\r\n\r\nfloat getElevation(vec2 coord, float bias) {\r\n    // Convert encoded elevation value to meters\r\n    vec4 data = texture2D(u_image, coord) * 255.0;\r\n    return (data.r + data.g * 256.0 + data.b * 256.0 * 256.0) / 4.0;\r\n}\r\n\r\nvoid main() {\r\n    vec2 epsilon = 1.0 / u_dimension;\r\n\r\n    // queried pixels:\r\n    // +-----------+\r\n    // |   |   |   |\r\n    // | a | b | c |\r\n    // |   |   |   |\r\n    // +-----------+\r\n    // |   |   |   |\r\n    // | d | e | f |\r\n    // |   |   |   |\r\n    // +-----------+\r\n    // |   |   |   |\r\n    // | g | h | i |\r\n    // |   |   |   |\r\n    // +-----------+\r\n\r\n    float a = getElevation(v_pos + vec2(-epsilon.x, -epsilon.y), 0.0);\r\n    float b = getElevation(v_pos + vec2(0, -epsilon.y), 0.0);\r\n    float c = getElevation(v_pos + vec2(epsilon.x, -epsilon.y), 0.0);\r\n    float d = getElevation(v_pos + vec2(-epsilon.x, 0), 0.0);\r\n    float e = getElevation(v_pos, 0.0);\r\n    float f = getElevation(v_pos + vec2(epsilon.x, 0), 0.0);\r\n    float g = getElevation(v_pos + vec2(-epsilon.x, epsilon.y), 0.0);\r\n    float h = getElevation(v_pos + vec2(0, epsilon.y), 0.0);\r\n    float i = getElevation(v_pos + vec2(epsilon.x, epsilon.y), 0.0);\r\n\r\n    // here we divide the x and y slopes by 8 * pixel size\r\n    // where pixel size (aka meters/pixel) is:\r\n    // circumference of the world / (pixels per tile * number of tiles)\r\n    // which is equivalent to: 8 * 40075016.6855785 / (512 * pow(2, u_zoom))\r\n    // which can be reduced to: pow(2, 19.25619978527 - u_zoom)\r\n    // we want to vertically exaggerate the hillshading though, because otherwise\r\n    // it is barely noticeable at low zooms. to do this, we multiply this by some\r\n    // scale factor pow(2, (u_zoom - 14) * a) where a is an arbitrary value and 14 is the\r\n    // maxzoom of the tile source. here we use a=0.3 which works out to the\r\n    // expression below. see nickidlugash's awesome breakdown for more info\r\n    float exaggeration = u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;\r\n\r\n    vec2 deriv = vec2(\r\n        (c + f + f + i) - (a + d + d + g),\r\n        (g + h + h + i) - (a + b + b + c)\r\n    ) /  pow(2.0, (u_zoom - 14.0) * exaggeration + 19.2562 - u_zoom);\r\n\r\n    gl_FragColor = clamp(vec4(\r\n        deriv.x / 2.0 + 0.5,\r\n        deriv.y / 2.0 + 0.5,\r\n        1.0,\r\n        1.0), 0.0, 1.0);\r\n\r\n#ifdef OVERDRAW_INSPECTOR\r\n    gl_FragColor = vec4(1.0);\r\n#endif\r\n}\r\n",vertexSource:"uniform mat4 u_matrix;\r\n\r\nattribute vec2 a_pos;\r\nattribute vec2 a_texture_pos;\r\n\r\nvarying vec2 v_pos;\r\n\r\nvoid main() {\r\n    gl_Position = u_matrix * vec4(a_pos, 0, 1);\r\n    v_pos = (a_texture_pos / 8192.0) / 2.0 + 0.25;\r\n}\r\n"},hillshade:{fragmentSource:"uniform sampler2D u_image;\r\nvarying vec2 v_pos;\r\n\r\nuniform vec2 u_latrange;\r\nuniform vec2 u_light;\r\nuniform vec4 u_shadow;\r\nuniform vec4 u_highlight;\r\nuniform vec4 u_accent;\r\n\r\n#define PI 3.141592653589793\r\n\r\nvoid main() {\r\n    vec4 pixel = texture2D(u_image, v_pos);\r\n\r\n    vec2 deriv = ((pixel.rg * 2.0) - 1.0);\r\n\r\n    // We divide the slope by a scale factor based on the cosin of the pixel's approximate latitude\r\n    // to account for mercator projection distortion. see #4807 for details\r\n    float scaleFactor = cos(radians((u_latrange[0] - u_latrange[1]) * (1.0 - v_pos.y) + u_latrange[1]));\r\n    // We also multiply the slope by an arbitrary z-factor of 1.25\r\n    float slope = atan(1.25 * length(deriv) / scaleFactor);\r\n    float aspect = deriv.x != 0.0 ? atan(deriv.y, -deriv.x) : PI / 2.0 * (deriv.y > 0.0 ? 1.0 : -1.0);\r\n\r\n    float intensity = u_light.x;\r\n    // We add PI to make this property match the global light object, which adds PI/2 to the light's azimuthal\r\n    // position property to account for 0deg corresponding to north/the top of the viewport in the style spec\r\n    // and the original shader was written to accept (-illuminationDirection - 90) as the azimuthal.\r\n    float azimuth = u_light.y + PI;\r\n\r\n    // We scale the slope exponentially based on intensity, using a calculation similar to\r\n    // the exponential interpolation function in the style spec:\r\n    // so that higher intensity values create more opaque hillshading.\r\n    float base = 1.875 - intensity * 1.75;\r\n    float maxValue = 0.5 * PI;\r\n    float scaledSlope = intensity != 0.5 ? ((pow(base, slope) - 1.0) / (pow(base, maxValue) - 1.0)) * maxValue : slope;\r\n\r\n    // The accent color is calculated with the cosine of the slope while the shade color is calculated with the sine\r\n    // so that the accent color's rate of change eases in while the shade color's eases out.\r\n    float accent = cos(scaledSlope);\r\n    // We multiply both the accent and shade color by a clamped intensity value\r\n    // so that intensities >= 0.5 do not additionally affect the color values\r\n    // while intensity values < 0.5 make the overall color more transparent.\r\n    vec4 accent_color = (1.0 - accent) * u_accent * clamp(intensity * 2.0, 0.0, 1.0);\r\n    float shade = abs(mod((aspect + azimuth) / PI + 0.5, 2.0) - 1.0);\r\n    vec4 shade_color = mix(u_shadow, u_highlight, shade) * sin(scaledSlope) * clamp(intensity * 2.0, 0.0, 1.0);\r\n    gl_FragColor = accent_color * (1.0 - shade_color.a) + shade_color;\r\n\r\n#ifdef OVERDRAW_INSPECTOR\r\n    gl_FragColor = vec4(1.0);\r\n#endif\r\n}\r\n",vertexSource:"uniform mat4 u_matrix;\r\n\r\nattribute vec2 a_pos;\r\nattribute vec2 a_texture_pos;\r\n\r\nvarying vec2 v_pos;\r\n\r\nvoid main() {\r\n    gl_Position = u_matrix * vec4(a_pos, 0, 1);\r\n    v_pos = a_texture_pos / 8192.0;\r\n}\r\n"},line:{fragmentSource:"#pragma minemap: define highp vec4 color\r\n#pragma minemap: define lowp float blur\r\n#pragma minemap: define lowp float opacity\r\n\r\nuniform mediump float u_interpolate;\r\n\r\nvarying vec2 v_width2;\r\nvarying vec2 v_normal;\r\nvarying float v_gamma_scale;\r\nvarying float v_float;\r\nvarying vec3 v_color;\r\n\r\nvoid main() {\r\n    #pragma minemap: initialize highp vec4 color\r\n    #pragma minemap: initialize lowp float blur\r\n    #pragma minemap: initialize lowp float opacity\r\n\r\n    // Calculate the distance of the pixel from the line in pixels.\r\n    float dist = length(v_normal) * v_width2.s;\r\n\r\n    // Calculate the antialiasing fade factor. This is either when fading in\r\n    // the line in case of an offset line (v_width2.t) or when fading out\r\n    // (v_width2.s)\r\n    float blur2 = (blur + 1.0 / DEVICE_PIXEL_RATIO) * v_gamma_scale;\r\n    float alpha = clamp(min(dist - (v_width2.t - blur2), v_width2.s - dist) / blur2, 0.0, 1.0);\r\n\r\n    if(u_interpolate != 1.0){\r\n        gl_FragColor = color * (alpha * opacity);\r\n    }else{\r\n        gl_FragColor = vec4(v_color,1.0) * (alpha * opacity);\r\n    }\r\n\r\n#ifdef OVERDRAW_INSPECTOR\r\n    gl_FragColor = vec4(1.0);\r\n#endif\r\n}\r\n",vertexSource:"\r\n\r\n// the distance over which the line edge fades out.\r\n// Retina devices need a smaller distance to avoid aliasing.\r\n#define ANTIALIASING 1.0 / DEVICE_PIXEL_RATIO / 2.0\r\n\r\n// floor(127 / 2) == 63.0\r\n// the maximum allowed miter limit is 2.0 at the moment. the extrude normal is\r\n// stored in a byte (-128..127). we scale regular normals up to length 63, but\r\n// there are also \"special\" normals that have a bigger length (of up to 126 in\r\n// this case).\r\n// #define scale 63.0\r\n#define scale 0.015873016\r\n\r\nattribute vec4 a_pos_normal;\r\nattribute vec4 a_data;\r\nattribute vec2 a_ext;   // 0 a_h    1 interpolate \r\n\r\nuniform mat4 u_matrix;\r\nuniform mediump float u_ratio;\r\nuniform vec2 u_gl_units_to_pixels;\r\nuniform mediump float u_interpolate;\r\nuniform mediump float u_half_render;\r\n\r\nvarying vec2 v_normal;\r\nvarying vec2 v_width2;\r\nvarying float v_gamma_scale;\r\nvarying float v_float;\r\nvarying vec3 v_color;\r\n\r\n#pragma minemap: define highp vec4 color\r\n#pragma minemap: define lowp float blur\r\n#pragma minemap: define lowp float opacity\r\n#pragma minemap: define mediump float gapwidth\r\n#pragma minemap: define lowp float offset\r\n#pragma minemap: define mediump float width\r\n#pragma minemap: define lowp float instatus\r\n#pragma minemap: define lowp float status\r\n\r\nvec3 my_colors[3];\r\n\r\nvoid main() {\r\n    #pragma minemap: initialize highp vec4 color\r\n    #pragma minemap: initialize lowp float blur\r\n    #pragma minemap: initialize lowp float opacity\r\n    #pragma minemap: initialize mediump float gapwidth\r\n    #pragma minemap: initialize lowp float offset\r\n    #pragma minemap: initialize mediump float width\r\n    #pragma minemap: initialize lowp float instatus\r\n    #pragma minemap: initialize lowp float status\r\n\r\n    my_colors[0] = vec3(52,151,162);\r\n    my_colors[1] = vec3(171,182,26);\r\n    my_colors[2] = vec3(175,95,29);\r\n\r\n    if(u_interpolate == 1.0){\r\n\r\n        vec3 inColor;\r\n        vec3 myColor;\r\n        if(instatus == 1.0){\r\n            inColor = my_colors[0];\r\n        }else if(instatus == 2.0){\r\n            inColor = my_colors[1];\r\n        }else if(instatus == 3.0){\r\n            inColor = my_colors[2];\r\n        }\r\n\r\n        if(status == 1.0){\r\n            myColor  = my_colors[0];\r\n        }else if(status == 2.0){\r\n            myColor = my_colors[1];\r\n        }else if(status == 3.0){\r\n            myColor = my_colors[2];\r\n        }\r\n\r\n        v_color = get_interp_color(inColor, myColor, a_ext[1]/1000.0);\r\n    }\r\n\r\n    vec2 a_extrude = a_data.xy - 128.0;\r\n    float a_direction = mod(a_data.z, 4.0) - 1.0;\r\n\r\n    vec2 pos = a_pos_normal.xy;\r\n\r\n    // x is 1 if it's a round cap, 0 otherwise\r\n    // y is 1 if the normal points up, and -1 if it points down\r\n    mediump vec2 normal = a_pos_normal.zw;\r\n    v_normal = normal;\r\n\r\n    // these transformations used to be applied in the JS and native code bases.\r\n    // moved them into the shader for clarity and simplicity.\r\n    gapwidth = gapwidth / 2.0;\r\n    float halfwidth = width / 2.0;\r\n    offset = -1.0 * offset;\r\n\r\n    float inset = gapwidth + (gapwidth > 0.0 ? ANTIALIASING : 0.0);\r\n    float outset = gapwidth + halfwidth * (gapwidth > 0.0 ? 2.0 : 1.0) + ANTIALIASING;\r\n    if(u_half_render == 1.){\r\n        outset = gapwidth + (normal.y>0.?halfwidth:0.) * (gapwidth > 0.0 ? 2.0 : 1.0) + ANTIALIASING;\r\n    }\r\n\r\n    // Scale the extrusion vector down to a normal and then up by the line width\r\n    // of this vertex.\r\n    mediump vec2 dist = outset * a_extrude * scale;\r\n\r\n    // Calculate the offset when drawing a line that is to the side of the actual line.\r\n    // We do this by creating a vector that points towards the extrude, but rotate\r\n    // it when we're drawing round end points (a_direction = -1 or 1) since their\r\n    // extrude vector points in another direction.\r\n    mediump float u = 0.5 * a_direction;\r\n    mediump float t = 1.0 - abs(u);\r\n    mediump vec2 offset2 = offset * a_extrude * scale * normal.y * mat2(t, -u, u, t);\r\n\r\n    vec4 projected_extrude = u_matrix * vec4(dist / u_ratio, 0.0, 0.0);\r\n    gl_Position = u_matrix * vec4(pos + offset2 / u_ratio, 0.0, 1.0) + projected_extrude;\r\n\r\n    // calculate how much the perspective view squishes or stretches the extrude\r\n    float extrude_length_without_perspective = length(dist);\r\n    float extrude_length_with_perspective = length(projected_extrude.xy / gl_Position.w * u_gl_units_to_pixels);\r\n    v_gamma_scale = extrude_length_without_perspective / extrude_length_with_perspective;\r\n\r\n    v_width2 = vec2(outset, inset);\r\n}\r\n"},line3d:{fragmentSource:"#pragma minemap: define highp vec4 color\r\n#pragma minemap: define lowp float blur\r\n#pragma minemap: define lowp float opacity\r\n\r\nuniform vec4 u_color_a;\r\nuniform vec4 u_color_b;\r\nuniform vec4 u_color_c;\r\nuniform vec4 u_color_d;\r\nuniform vec4 u_color_e;\r\nuniform float u_max_height;\r\nuniform float u_is_contour;\r\nuniform mediump float u_interpolate;\r\n\r\nuniform float u_shine_height; //this is used to make the line splash\r\n\r\nvarying vec2 v_width2;\r\nvarying vec2 v_normal;\r\nvarying float v_gamma_scale;\r\nvarying float v_h;\r\nvarying vec3 v_color;\r\n\r\n#define Interval 70.0\r\nvoid main() {\r\n    #pragma minemap: initialize highp vec4 color\r\n    #pragma minemap: initialize lowp float blur\r\n    #pragma minemap: initialize lowp float opacity\r\n\r\n    if(u_is_contour == 1.0){\r\n\r\n        // Calculate the distance of the pixel from the line in pixels.\r\n            float dist = length(v_normal) * v_width2.s;\r\n\r\n        float m_opacity = 1.0;\r\n\r\n        float loop_count = mod(u_shine_height ,u_max_height);\r\n\r\n        if(v_h >= loop_count - Interval && v_h <= loop_count + Interval){\r\n            m_opacity = 1.0 + (1.0 - abs(v_h - loop_count)/Interval) * 3.0;\r\n        }\r\n\r\n        // Calculate the antialiasing fade factor. This is either when fading in\r\n        // the line in case of an offset line (v_width2.t) or when fading out\r\n        // (v_width2.s)\r\n        float blur2 = (blur + 1.0 / DEVICE_PIXEL_RATIO) * v_gamma_scale;\r\n        float alpha = clamp(min(dist - (v_width2.t - blur2), v_width2.s - dist) / blur2, 0.0, 1.0);\r\n\r\n\r\n        if (v_h < 0.25 * u_max_height) {\r\n\r\n            vec4 real = mix(u_color_a,u_color_b,v_h/0.25/u_max_height) * (alpha * opacity);\r\n            gl_FragColor = real * m_opacity;\r\n\r\n        } else if (v_h < 0.5 * u_max_height) {\r\n\r\n            vec4 real = mix(u_color_b,u_color_c,v_h/0.5/u_max_height) * (alpha * opacity);\r\n            gl_FragColor = real * m_opacity;\r\n\r\n        } else if (v_h < 0.75 * u_max_height) {\r\n\r\n            vec4 real = mix(u_color_c,u_color_d,v_h/0.75/u_max_height) * (alpha * opacity);\r\n            gl_FragColor = real * m_opacity;\r\n\r\n        } else if (v_h < 0.8 * u_max_height){\r\n\r\n            vec4 real = mix(u_color_d,u_color_e,v_h/0.8/u_max_height) * (alpha * opacity);\r\n            gl_FragColor = real * m_opacity;\r\n\r\n        } else{\r\n            gl_FragColor = u_color_e * (alpha * opacity) * m_opacity;\r\n        }\r\n    }else if(u_interpolate == 1.0){\r\n        // Calculate the distance of the pixel from the line in pixels.\r\n        float dist = length(v_normal) * v_width2.s;\r\n\r\n        // Calculate the antialiasing fade factor. This is either when fading in\r\n        // the line in case of an offset line (v_width2.t) or when fading out\r\n        // (v_width2.s)\r\n        float blur2 = (blur + 1.0 / DEVICE_PIXEL_RATIO) * v_gamma_scale;\r\n        float alpha = clamp(min(dist - (v_width2.t - blur2), v_width2.s - dist) / blur2, 0.0, 1.0);\r\n\r\n        gl_FragColor = vec4(v_color,1.0) * (alpha * opacity);\r\n\r\n    }else{\r\n        // Calculate the distance of the pixel from the line in pixels.\r\n        float dist = length(v_normal) * v_width2.s;\r\n\r\n        // Calculate the antialiasing fade factor. This is either when fading in\r\n        // the line in case of an offset line (v_width2.t) or when fading out\r\n        // (v_width2.s)\r\n        float blur2 = (blur + 1.0 / DEVICE_PIXEL_RATIO) * v_gamma_scale;\r\n        float alpha = clamp(min(dist - (v_width2.t - blur2), v_width2.s - dist) / blur2, 0.0, 1.0);\r\n\r\n        gl_FragColor = color * (alpha * opacity);\r\n    }\r\n\r\n\r\n\r\n\r\n\r\n#ifdef OVERDRAW_INSPECTOR\r\n    gl_FragColor = vec4(1.0);\r\n#endif\r\n}\r\n",vertexSource:"\r\n\r\n// the distance over which the line edge fades out.\r\n// Retina devices need a smaller distance to avoid aliasing.\r\n#define ANTIALIASING 1.0 / DEVICE_PIXEL_RATIO / 2.0\r\n\r\n// floor(127 / 2) == 63.0\r\n// the maximum allowed miter limit is 2.0 at the moment. the extrude normal is\r\n// stored in a byte (-128..127). we scale regular normals up to length 63, but\r\n// there are also \"special\" normals that have a bigger length (of up to 126 in\r\n// this case).\r\n// #define scale 63.0\r\n#define scale 0.015873016\r\n\r\nattribute vec4 a_pos_normal;\r\nattribute vec4 a_data;\r\nattribute vec2 a_ext;   // 0 a_h    1 interpolate \r\n\r\nuniform mat4 u_matrix;\r\nuniform mediump float u_ratio;\r\nuniform vec2 u_gl_units_to_pixels;\r\nuniform mediump float u_interpolate;\r\nuniform mat4 u_interp_colors;\r\nuniform float u_height_offset;\r\n\r\nvarying vec2 v_normal;\r\nvarying vec2 v_width2;\r\nvarying float v_gamma_scale;\r\nvarying float v_h;\r\nvarying vec3 v_color;\r\n\r\n#pragma minemap: define highp vec4 color\r\n#pragma minemap: define lowp float blur\r\n#pragma minemap: define lowp float opacity\r\n#pragma minemap: define mediump float gapwidth\r\n#pragma minemap: define lowp float offset\r\n#pragma minemap: define mediump float width\r\n#pragma minemap: define lowp float instatus\r\n#pragma minemap: define lowp float status\r\n\r\nvec3 my_colors[3];\r\n\r\nvoid main() {\r\n    #pragma minemap: initialize highp vec4 color\r\n    #pragma minemap: initialize lowp float blur\r\n    #pragma minemap: initialize lowp float opacity\r\n    #pragma minemap: initialize mediump float gapwidth\r\n    #pragma minemap: initialize lowp float offset\r\n    #pragma minemap: initialize mediump float width\r\n    #pragma minemap: initialize lowp float instatus\r\n    #pragma minemap: initialize lowp float status\r\n\r\n my_colors[0] = vec3(52,151,162);\r\n my_colors[1] = vec3(171,182,26);\r\n my_colors[2] = vec3(175,95,29);\r\n\r\n    if(u_interpolate == 1.0){\r\n\r\n        vec3 inColor;\r\n        vec3 myColor;\r\n        if(instatus == 1.0){\r\n            inColor = my_colors[0];\r\n        }else if(instatus == 2.0){\r\n            inColor = my_colors[1];\r\n        }else if(instatus == 3.0){\r\n            inColor = my_colors[2];\r\n        }\r\n\r\n        if(status == 1.0){\r\n            myColor  = my_colors[0];\r\n        }else if(status == 2.0){\r\n            myColor = my_colors[1];\r\n        }else if(status == 3.0){\r\n            myColor = my_colors[2];\r\n        }\r\n\r\n        v_color = get_interp_color(inColor, myColor, a_ext[1]/1000.0);\r\n    }\r\n\r\n\r\n    v_h = a_ext[0] / 10.0;\r\n    vec2 a_extrude = a_data.xy - 128.0;\r\n    float a_direction = mod(a_data.z, 4.0) - 1.0;\r\n\r\n    vec2 pos = a_pos_normal.xy;\r\n\r\n    // x is 1 if it's a round cap, 0 otherwise\r\n    // y is 1 if the normal points up, and -1 if it points down\r\n    mediump vec2 normal = a_pos_normal.zw;\r\n    v_normal = normal;\r\n\r\n    // these transformations used to be applied in the JS and native code bases.\r\n    // moved them into the shader for clarity and simplicity.\r\n    gapwidth = gapwidth / 2.0;\r\n    float halfwidth = width / 2.0;\r\n    offset = -1.0 * offset;\r\n\r\n    float inset = gapwidth + (gapwidth > 0.0 ? ANTIALIASING : 0.0);\r\n    float outset = gapwidth + halfwidth * (gapwidth > 0.0 ? 2.0 : 1.0) + ANTIALIASING;\r\n\r\n    // Scale the extrusion vector down to a normal and then up by the line width\r\n    // of this vertex.\r\n    mediump vec2 dist = outset * a_extrude * scale;\r\n\r\n    // Calculate the offset when drawing a line that is to the side of the actual line.\r\n    // We do this by creating a vector that points towards the extrude, but rotate\r\n    // it when we're drawing round end points (a_direction = -1 or 1) since their\r\n    // extrude vector points in another direction.\r\n    mediump float u = 0.5 * a_direction;\r\n    mediump float t = 1.0 - abs(u);\r\n    mediump vec2 offset2 = offset * a_extrude * scale * normal.y * mat2(t, -u, u, t);\r\n\r\n    vec4 projected_extrude = u_matrix * vec4(dist / u_ratio, 0.0, 0.0);\r\n    gl_Position = u_matrix * vec4(pos + offset2 / u_ratio, a_ext[0]/10.0 + u_height_offset / 10.0, 1.0) + projected_extrude;\r\n\r\n    // calculate how much the perspective view squishes or stretches the extrude\r\n    float extrude_length_without_perspective = length(dist);\r\n    float extrude_length_with_perspective = length(projected_extrude.xy / gl_Position.w * u_gl_units_to_pixels);\r\n    v_gamma_scale = extrude_length_without_perspective / extrude_length_with_perspective;\r\n\r\n    v_width2 = vec2(outset, inset);\r\n}\r\n"},linePattern:{fragmentSource:"uniform vec2 u_pattern_size_a;\r\nuniform vec2 u_pattern_size_b;\r\nuniform vec2 u_pattern_tl_a;\r\nuniform vec2 u_pattern_br_a;\r\nuniform vec2 u_pattern_tl_b;\r\nuniform vec2 u_pattern_br_b;\r\nuniform vec2 u_texsize;\r\nuniform float u_fade;\r\n\r\nuniform sampler2D u_image;\r\n\r\nvarying vec2 v_normal;\r\nvarying vec2 v_width2;\r\nvarying float v_linesofar;\r\nvarying float v_gamma_scale;\r\n\r\n#pragma minemap: define lowp float blur\r\n#pragma minemap: define lowp float opacity\r\n\r\nvoid main() {\r\n    #pragma minemap: initialize lowp float blur\r\n    #pragma minemap: initialize lowp float opacity\r\n\r\n    // Calculate the distance of the pixel from the line in pixels.\r\n    float dist = length(v_normal) * v_width2.s;\r\n\r\n    // Calculate the antialiasing fade factor. This is either when fading in\r\n    // the line in case of an offset line (v_width2.t) or when fading out\r\n    // (v_width2.s)\r\n    float blur2 = (blur + 1.0 / DEVICE_PIXEL_RATIO) * v_gamma_scale;\r\n    float alpha = clamp(min(dist - (v_width2.t - blur2), v_width2.s - dist) / blur2, 0.0, 1.0);\r\n\r\n    float x_a = mod(v_linesofar / u_pattern_size_a.x, 1.0);\r\n    float x_b = mod(v_linesofar / u_pattern_size_b.x, 1.0);\r\n    float y_a = 0.5 + (v_normal.y * v_width2.s / u_pattern_size_a.y);\r\n    float y_b = 0.5 + (v_normal.y * v_width2.s / u_pattern_size_b.y);\r\n    vec2 pos_a = mix(u_pattern_tl_a / u_texsize, u_pattern_br_a / u_texsize, vec2(x_a, y_a));\r\n    vec2 pos_b = mix(u_pattern_tl_b / u_texsize, u_pattern_br_b / u_texsize, vec2(x_b, y_b));\r\n\r\n    vec4 color = mix(texture2D(u_image, pos_a), texture2D(u_image, pos_b), u_fade);\r\n\r\n    gl_FragColor = color * alpha * opacity;\r\n\r\n#ifdef OVERDRAW_INSPECTOR\r\n    gl_FragColor = vec4(1.0);\r\n#endif\r\n}\r\n",vertexSource:"// floor(127 / 2) == 63.0\r\n// the maximum allowed miter limit is 2.0 at the moment. the extrude normal is\r\n// stored in a byte (-128..127). we scale regular normals up to length 63, but\r\n// there are also \"special\" normals that have a bigger length (of up to 126 in\r\n// this case).\r\n// #define scale 63.0\r\n#define scale 0.015873016\r\n\r\n// We scale the distance before adding it to the buffers so that we can store\r\n// long distances for long segments. Use this value to unscale the distance.\r\n#define LINE_DISTANCE_SCALE 2.0\r\n\r\n// the distance over which the line edge fades out.\r\n// Retina devices need a smaller distance to avoid aliasing.\r\n#define ANTIALIASING 1.0 / DEVICE_PIXEL_RATIO / 2.0\r\n\r\nattribute vec4 a_pos_normal;\r\nattribute vec4 a_data;\r\n\r\nuniform mat4 u_matrix;\r\nuniform mediump float u_ratio;\r\nuniform vec2 u_gl_units_to_pixels;\r\n\r\nvarying vec2 v_normal;\r\nvarying vec2 v_width2;\r\nvarying float v_linesofar;\r\nvarying float v_gamma_scale;\r\n\r\n#pragma minemap: define lowp float blur\r\n#pragma minemap: define lowp float opacity\r\n#pragma minemap: define lowp float offset\r\n#pragma minemap: define mediump float gapwidth\r\n#pragma minemap: define mediump float width\r\n\r\nvoid main() {\r\n    #pragma minemap: initialize lowp float blur\r\n    #pragma minemap: initialize lowp float opacity\r\n    #pragma minemap: initialize lowp float offset\r\n    #pragma minemap: initialize mediump float gapwidth\r\n    #pragma minemap: initialize mediump float width\r\n\r\n    vec2 a_extrude = a_data.xy - 128.0;\r\n    float a_direction = mod(a_data.z, 4.0) - 1.0;\r\n    float a_linesofar = (floor(a_data.z / 4.0) + a_data.w * 64.0) * LINE_DISTANCE_SCALE;\r\n\r\n    vec2 pos = a_pos_normal.xy;\r\n\r\n    // x is 1 if it's a round cap, 0 otherwise\r\n    // y is 1 if the normal points up, and -1 if it points down\r\n    mediump vec2 normal = a_pos_normal.zw;\r\n    v_normal = normal;\r\n\r\n    // these transformations used to be applied in the JS and native code bases.\r\n    // moved them into the shader for clarity and simplicity.\r\n    gapwidth = gapwidth / 2.0;\r\n    float halfwidth = width / 2.0;\r\n    offset = -1.0 * offset;\r\n\r\n    float inset = gapwidth + (gapwidth > 0.0 ? ANTIALIASING : 0.0);\r\n    float outset = gapwidth + halfwidth * (gapwidth > 0.0 ? 2.0 : 1.0) + ANTIALIASING;\r\n\r\n    // Scale the extrusion vector down to a normal and then up by the line width\r\n    // of this vertex.\r\n    mediump vec2 dist = outset * a_extrude * scale;\r\n\r\n    // Calculate the offset when drawing a line that is to the side of the actual line.\r\n    // We do this by creating a vector that points towards the extrude, but rotate\r\n    // it when we're drawing round end points (a_direction = -1 or 1) since their\r\n    // extrude vector points in another direction.\r\n    mediump float u = 0.5 * a_direction;\r\n    mediump float t = 1.0 - abs(u);\r\n    mediump vec2 offset2 = offset * a_extrude * scale * normal.y * mat2(t, -u, u, t);\r\n\r\n    vec4 projected_extrude = u_matrix * vec4(dist / u_ratio, 0.0, 0.0);\r\n    gl_Position = u_matrix * vec4(pos + offset2 / u_ratio, 0.0, 1.0) + projected_extrude;\r\n\r\n    // calculate how much the perspective view squishes or stretches the extrude\r\n    float extrude_length_without_perspective = length(dist);\r\n    float extrude_length_with_perspective = length(projected_extrude.xy / gl_Position.w * u_gl_units_to_pixels);\r\n    v_gamma_scale = extrude_length_without_perspective / extrude_length_with_perspective;\r\n\r\n    v_linesofar = a_linesofar;\r\n    v_width2 = vec2(outset, inset);\r\n}\r\n"},linePattern3d:{fragmentSource:"uniform vec2 u_pattern_size_a;\r\nuniform vec2 u_pattern_size_b;\r\nuniform vec2 u_pattern_tl_a;\r\nuniform vec2 u_pattern_br_a;\r\nuniform vec2 u_pattern_tl_b;\r\nuniform vec2 u_pattern_br_b;\r\nuniform vec2 u_texsize;\r\nuniform float u_fade;\r\n\r\nuniform sampler2D u_image;\r\n\r\nvarying vec2 v_normal;\r\nvarying vec2 v_width2;\r\nvarying float v_linesofar;\r\nvarying float v_gamma_scale;\r\n\r\n#pragma minemap: define lowp float blur\r\n#pragma minemap: define lowp float opacity\r\n\r\nvoid main() {\r\n    #pragma minemap: initialize lowp float blur\r\n    #pragma minemap: initialize lowp float opacity\r\n\r\n    // Calculate the distance of the pixel from the line in pixels.\r\n    float dist = length(v_normal) * v_width2.s;\r\n\r\n    // Calculate the antialiasing fade factor. This is either when fading in\r\n    // the line in case of an offset line (v_width2.t) or when fading out\r\n    // (v_width2.s)\r\n    float blur2 = (blur + 1.0 / DEVICE_PIXEL_RATIO) * v_gamma_scale;\r\n    float alpha = clamp(min(dist - (v_width2.t - blur2), v_width2.s - dist) / blur2, 0.0, 1.0);\r\n\r\n    float x_a = mod(v_linesofar / u_pattern_size_a.x, 1.0);\r\n    float x_b = mod(v_linesofar / u_pattern_size_b.x, 1.0);\r\n    float y_a = 0.5 + (v_normal.y * v_width2.s / u_pattern_size_a.y);\r\n    float y_b = 0.5 + (v_normal.y * v_width2.s / u_pattern_size_b.y);\r\n    vec2 pos_a = mix(u_pattern_tl_a / u_texsize, u_pattern_br_a / u_texsize, vec2(x_a, y_a));\r\n    vec2 pos_b = mix(u_pattern_tl_b / u_texsize, u_pattern_br_b / u_texsize, vec2(x_b, y_b));\r\n\r\n    vec4 color = mix(texture2D(u_image, pos_a), texture2D(u_image, pos_b), u_fade);\r\n\r\n    gl_FragColor = color * alpha * opacity;\r\n\r\n#ifdef OVERDRAW_INSPECTOR\r\n    gl_FragColor = vec4(1.0);\r\n#endif\r\n}\r\n",
vertexSource:"// floor(127 / 2) == 63.0\r\n// the maximum allowed miter limit is 2.0 at the moment. the extrude normal is\r\n// stored in a byte (-128..127). we scale regular normals up to length 63, but\r\n// there are also \"special\" normals that have a bigger length (of up to 126 in\r\n// this case).\r\n// #define scale 63.0\r\n#define scale 0.015873016\r\n\r\n// We scale the distance before adding it to the buffers so that we can store\r\n// long distances for long segments. Use this value to unscale the distance.\r\n#define LINE_DISTANCE_SCALE 2.0\r\n\r\n// the distance over which the line edge fades out.\r\n// Retina devices need a smaller distance to avoid aliasing.\r\n#define ANTIALIASING 1.0 / DEVICE_PIXEL_RATIO / 2.0\r\n\r\nattribute vec4 a_pos_normal;\r\nattribute vec4 a_data;\r\nattribute vec2 a_ext;   // 0 a_h    1 interpolate \r\n\r\nuniform mat4 u_matrix;\r\nuniform mediump float u_ratio;\r\nuniform vec2 u_gl_units_to_pixels;\r\n\r\nvarying vec2 v_normal;\r\nvarying vec2 v_width2;\r\nvarying float v_linesofar;\r\nvarying float v_gamma_scale;\r\n\r\n#pragma minemap: define lowp float blur\r\n#pragma minemap: define lowp float opacity\r\n#pragma minemap: define lowp float offset\r\n#pragma minemap: define mediump float gapwidth\r\n#pragma minemap: define mediump float width\r\n\r\nvoid main() {\r\n    #pragma minemap: initialize lowp float blur\r\n    #pragma minemap: initialize lowp float opacity\r\n    #pragma minemap: initialize lowp float offset\r\n    #pragma minemap: initialize mediump float gapwidth\r\n    #pragma minemap: initialize mediump float width\r\n\r\n    vec2 a_extrude = a_data.xy - 128.0;\r\n    float a_direction = mod(a_data.z, 4.0) - 1.0;\r\n    float a_linesofar = (floor(a_data.z / 4.0) + a_data.w * 64.0) * LINE_DISTANCE_SCALE;\r\n\r\n    vec2 pos = a_pos_normal.xy;\r\n\r\n    // x is 1 if it's a round cap, 0 otherwise\r\n    // y is 1 if the normal points up, and -1 if it points down\r\n    mediump vec2 normal = a_pos_normal.zw;\r\n    v_normal = normal;\r\n\r\n    // these transformations used to be applied in the JS and native code bases.\r\n    // moved them into the shader for clarity and simplicity.\r\n    gapwidth = gapwidth / 2.0;\r\n    float halfwidth = width / 2.0;\r\n    offset = -1.0 * offset;\r\n\r\n    float inset = gapwidth + (gapwidth > 0.0 ? ANTIALIASING : 0.0);\r\n    float outset = gapwidth + halfwidth * (gapwidth > 0.0 ? 2.0 : 1.0) + ANTIALIASING;\r\n\r\n    // Scale the extrusion vector down to a normal and then up by the line width\r\n    // of this vertex.\r\n    mediump vec2 dist = outset * a_extrude * scale;\r\n\r\n    // Calculate the offset when drawing a line that is to the side of the actual line.\r\n    // We do this by creating a vector that points towards the extrude, but rotate\r\n    // it when we're drawing round end points (a_direction = -1 or 1) since their\r\n    // extrude vector points in another direction.\r\n    mediump float u = 0.5 * a_direction;\r\n    mediump float t = 1.0 - abs(u);\r\n    mediump vec2 offset2 = offset * a_extrude * scale * normal.y * mat2(t, -u, u, t);\r\n\r\n    vec4 projected_extrude = u_matrix * vec4(dist / u_ratio, 0.0, 0.0);\r\n    gl_Position = u_matrix * vec4(pos + offset2 / u_ratio, a_ext[0]/10.0 + 0.5, 1.0) + projected_extrude;\r\n\r\n    // calculate how much the perspective view squishes or stretches the extrude\r\n    float extrude_length_without_perspective = length(dist);\r\n    float extrude_length_with_perspective = length(projected_extrude.xy / gl_Position.w * u_gl_units_to_pixels);\r\n    v_gamma_scale = extrude_length_without_perspective / extrude_length_with_perspective;\r\n\r\n    v_linesofar = a_linesofar;\r\n    v_width2 = vec2(outset, inset);\r\n}\r\n"},lineSDF:{fragmentSource:"\r\nuniform sampler2D u_image;\r\nuniform float u_sdfgamma;\r\nuniform float u_mix;\r\n\r\nvarying vec2 v_normal;\r\nvarying vec2 v_width2;\r\nvarying vec2 v_tex_a;\r\nvarying vec2 v_tex_b;\r\nvarying float v_gamma_scale;\r\n\r\n#pragma minemap: define highp vec4 color\r\n#pragma minemap: define lowp float blur\r\n#pragma minemap: define lowp float opacity\r\n#pragma minemap: define mediump float width\r\n#pragma minemap: define lowp float floorwidth\r\n\r\nvoid main() {\r\n    #pragma minemap: initialize highp vec4 color\r\n    #pragma minemap: initialize lowp float blur\r\n    #pragma minemap: initialize lowp float opacity\r\n    #pragma minemap: initialize mediump float width\r\n    #pragma minemap: initialize lowp float floorwidth\r\n\r\n    // Calculate the distance of the pixel from the line in pixels.\r\n    float dist = length(v_normal) * v_width2.s;\r\n\r\n    // Calculate the antialiasing fade factor. This is either when fading in\r\n    // the line in case of an offset line (v_width2.t) or when fading out\r\n    // (v_width2.s)\r\n    float blur2 = (blur + 1.0 / DEVICE_PIXEL_RATIO) * v_gamma_scale;\r\n    float alpha = clamp(min(dist - (v_width2.t - blur2), v_width2.s - dist) / blur2, 0.0, 1.0);\r\n\r\n    float sdfdist_a = texture2D(u_image, v_tex_a).a;\r\n    float sdfdist_b = texture2D(u_image, v_tex_b).a;\r\n    float sdfdist = mix(sdfdist_a, sdfdist_b, u_mix);\r\n    alpha *= smoothstep(0.5 - u_sdfgamma / floorwidth, 0.5 + u_sdfgamma / floorwidth, sdfdist);\r\n\r\n    gl_FragColor = color * (alpha * opacity);\r\n\r\n#ifdef OVERDRAW_INSPECTOR\r\n    gl_FragColor = vec4(1.0);\r\n#endif\r\n}\r\n",vertexSource:"// floor(127 / 2) == 63.0\r\n// the maximum allowed miter limit is 2.0 at the moment. the extrude normal is\r\n// stored in a byte (-128..127). we scale regular normals up to length 63, but\r\n// there are also \"special\" normals that have a bigger length (of up to 126 in\r\n// this case).\r\n// #define scale 63.0\r\n#define scale 0.015873016\r\n\r\n// We scale the distance before adding it to the buffers so that we can store\r\n// long distances for long segments. Use this value to unscale the distance.\r\n#define LINE_DISTANCE_SCALE 2.0\r\n\r\n// the distance over which the line edge fades out.\r\n// Retina devices need a smaller distance to avoid aliasing.\r\n#define ANTIALIASING 1.0 / DEVICE_PIXEL_RATIO / 2.0\r\n\r\nattribute vec4 a_pos_normal;\r\nattribute vec4 a_data;\r\n\r\nuniform mat4 u_matrix;\r\nuniform mediump float u_ratio;\r\nuniform vec2 u_patternscale_a;\r\nuniform float u_tex_y_a;\r\nuniform vec2 u_patternscale_b;\r\nuniform float u_tex_y_b;\r\nuniform vec2 u_gl_units_to_pixels;\r\n\r\nvarying vec2 v_normal;\r\nvarying vec2 v_width2;\r\nvarying vec2 v_tex_a;\r\nvarying vec2 v_tex_b;\r\nvarying float v_gamma_scale;\r\n\r\n#pragma minemap: define highp vec4 color\r\n#pragma minemap: define lowp float blur\r\n#pragma minemap: define lowp float opacity\r\n#pragma minemap: define mediump float gapwidth\r\n#pragma minemap: define lowp float offset\r\n#pragma minemap: define mediump float width\r\n#pragma minemap: define lowp float floorwidth\r\n\r\nvoid main() {\r\n    #pragma minemap: initialize highp vec4 color\r\n    #pragma minemap: initialize lowp float blur\r\n    #pragma minemap: initialize lowp float opacity\r\n    #pragma minemap: initialize mediump float gapwidth\r\n    #pragma minemap: initialize lowp float offset\r\n    #pragma minemap: initialize mediump float width\r\n    #pragma minemap: initialize lowp float floorwidth\r\n\r\n    vec2 a_extrude = a_data.xy - 128.0;\r\n    float a_direction = mod(a_data.z, 4.0) - 1.0;\r\n    float a_linesofar = (floor(a_data.z / 4.0) + a_data.w * 64.0) * LINE_DISTANCE_SCALE;\r\n\r\n    vec2 pos = a_pos_normal.xy;\r\n\r\n    // x is 1 if it's a round cap, 0 otherwise\r\n    // y is 1 if the normal points up, and -1 if it points down\r\n    mediump vec2 normal = a_pos_normal.zw;\r\n    v_normal = normal;\r\n\r\n    // these transformations used to be applied in the JS and native code bases.\r\n    // moved them into the shader for clarity and simplicity.\r\n    gapwidth = gapwidth / 2.0;\r\n    float halfwidth = width / 2.0;\r\n    offset = -1.0 * offset;\r\n\r\n    float inset = gapwidth + (gapwidth > 0.0 ? ANTIALIASING : 0.0);\r\n    float outset = gapwidth + halfwidth * (gapwidth > 0.0 ? 2.0 : 1.0) + ANTIALIASING;\r\n\r\n    // Scale the extrusion vector down to a normal and then up by the line width\r\n    // of this vertex.\r\n    mediump vec2 dist =outset * a_extrude * scale;\r\n\r\n    // Calculate the offset when drawing a line that is to the side of the actual line.\r\n    // We do this by creating a vector that points towards the extrude, but rotate\r\n    // it when we're drawing round end points (a_direction = -1 or 1) since their\r\n    // extrude vector points in another direction.\r\n    mediump float u = 0.5 * a_direction;\r\n    mediump float t = 1.0 - abs(u);\r\n    mediump vec2 offset2 = offset * a_extrude * scale * normal.y * mat2(t, -u, u, t);\r\n\r\n    vec4 projected_extrude = u_matrix * vec4(dist / u_ratio, 0.0, 0.0);\r\n    gl_Position = u_matrix * vec4(pos + offset2 / u_ratio, 0.0, 1.0) + projected_extrude;\r\n\r\n    // calculate how much the perspective view squishes or stretches the extrude\r\n    float extrude_length_without_perspective = length(dist);\r\n    float extrude_length_with_perspective = length(projected_extrude.xy / gl_Position.w * u_gl_units_to_pixels);\r\n    v_gamma_scale = extrude_length_without_perspective / extrude_length_with_perspective;\r\n\r\n    v_tex_a = vec2(a_linesofar * u_patternscale_a.x / floorwidth, normal.y * u_patternscale_a.y + u_tex_y_a);\r\n    v_tex_b = vec2(a_linesofar * u_patternscale_b.x / floorwidth, normal.y * u_patternscale_b.y + u_tex_y_b);\r\n\r\n    v_width2 = vec2(outset, inset);\r\n}\r\n"},lineSDF3d:{fragmentSource:"\r\nuniform sampler2D u_image;\r\nuniform float u_sdfgamma;\r\nuniform float u_mix;\r\n\r\nvarying vec2 v_normal;\r\nvarying vec2 v_width2;\r\nvarying vec2 v_tex_a;\r\nvarying vec2 v_tex_b;\r\nvarying float v_gamma_scale;\r\n\r\n#pragma minemap: define highp vec4 color\r\n#pragma minemap: define lowp float blur\r\n#pragma minemap: define lowp float opacity\r\n#pragma minemap: define mediump float width\r\n#pragma minemap: define lowp float floorwidth\r\n\r\nvoid main() {\r\n    #pragma minemap: initialize highp vec4 color\r\n    #pragma minemap: initialize lowp float blur\r\n    #pragma minemap: initialize lowp float opacity\r\n    #pragma minemap: initialize mediump float width\r\n    #pragma minemap: initialize lowp float floorwidth\r\n\r\n    // Calculate the distance of the pixel from the line in pixels.\r\n    float dist = length(v_normal) * v_width2.s;\r\n\r\n    // Calculate the antialiasing fade factor. This is either when fading in\r\n    // the line in case of an offset line (v_width2.t) or when fading out\r\n    // (v_width2.s)\r\n    float blur2 = (blur + 1.0 / DEVICE_PIXEL_RATIO) * v_gamma_scale;\r\n    float alpha = clamp(min(dist - (v_width2.t - blur2), v_width2.s - dist) / blur2, 0.0, 1.0);\r\n\r\n    float sdfdist_a = texture2D(u_image, v_tex_a).a;\r\n    float sdfdist_b = texture2D(u_image, v_tex_b).a;\r\n    float sdfdist = mix(sdfdist_a, sdfdist_b, u_mix);\r\n    alpha *= smoothstep(0.5 - u_sdfgamma / floorwidth, 0.5 + u_sdfgamma / floorwidth, sdfdist);\r\n\r\n    if(alpha*opacity == 0.0){\r\n        discard;\r\n    }\r\n\r\n    gl_FragColor = color * (alpha * opacity);\r\n\r\n#ifdef OVERDRAW_INSPECTOR\r\n    gl_FragColor = vec4(1.0);\r\n#endif\r\n}\r\n",vertexSource:"// floor(127 / 2) == 63.0\r\n// the maximum allowed miter limit is 2.0 at the moment. the extrude normal is\r\n// stored in a byte (-128..127). we scale regular normals up to length 63, but\r\n// there are also \"special\" normals that have a bigger length (of up to 126 in\r\n// this case).\r\n// #define scale 63.0\r\n#define scale 0.015873016\r\n\r\n// We scale the distance before adding it to the buffers so that we can store\r\n// long distances for long segments. Use this value to unscale the distance.\r\n#define LINE_DISTANCE_SCALE 2.0\r\n\r\n// the distance over which the line edge fades out.\r\n// Retina devices need a smaller distance to avoid aliasing.\r\n#define ANTIALIASING 1.0 / DEVICE_PIXEL_RATIO / 2.0\r\n\r\nattribute vec4 a_pos_normal;\r\nattribute vec4 a_data;\r\nattribute vec2 a_ext;   // 0 a_h    1 interpolate \r\n\r\nuniform mat4 u_matrix;\r\nuniform mediump float u_ratio;\r\nuniform vec2 u_patternscale_a;\r\nuniform float u_tex_y_a;\r\nuniform vec2 u_patternscale_b;\r\nuniform float u_tex_y_b;\r\nuniform vec2 u_gl_units_to_pixels;\r\n\r\nvarying vec2 v_normal;\r\nvarying vec2 v_width2;\r\nvarying vec2 v_tex_a;\r\nvarying vec2 v_tex_b;\r\nvarying float v_gamma_scale;\r\n\r\n#pragma minemap: define highp vec4 color\r\n#pragma minemap: define lowp float blur\r\n#pragma minemap: define lowp float opacity\r\n#pragma minemap: define mediump float gapwidth\r\n#pragma minemap: define lowp float offset\r\n#pragma minemap: define mediump float width\r\n#pragma minemap: define lowp float floorwidth\r\n\r\nvoid main() {\r\n    #pragma minemap: initialize highp vec4 color\r\n    #pragma minemap: initialize lowp float blur\r\n    #pragma minemap: initialize lowp float opacity\r\n    #pragma minemap: initialize mediump float gapwidth\r\n    #pragma minemap: initialize lowp float offset\r\n    #pragma minemap: initialize mediump float width\r\n    #pragma minemap: initialize lowp float floorwidth\r\n\r\n    vec2 a_extrude = a_data.xy - 128.0;\r\n    float a_direction = mod(a_data.z, 4.0) - 1.0;\r\n    float a_linesofar = (floor(a_data.z / 4.0) + a_data.w * 64.0) * LINE_DISTANCE_SCALE;\r\n\r\n    vec2 pos = a_pos_normal.xy;\r\n\r\n    // x is 1 if it's a round cap, 0 otherwise\r\n    // y is 1 if the normal points up, and -1 if it points down\r\n    mediump vec2 normal = a_pos_normal.zw;\r\n    v_normal = normal;\r\n\r\n    // these transformations used to be applied in the JS and native code bases.\r\n    // moved them into the shader for clarity and simplicity.\r\n    gapwidth = gapwidth / 2.0;\r\n    float halfwidth = width / 2.0;\r\n    offset = -1.0 * offset;\r\n\r\n    float inset = gapwidth + (gapwidth > 0.0 ? ANTIALIASING : 0.0);\r\n    float outset = gapwidth + halfwidth * (gapwidth > 0.0 ? 2.0 : 1.0) + ANTIALIASING;\r\n\r\n    // Scale the extrusion vector down to a normal and then up by the line width\r\n    // of this vertex.\r\n    mediump vec2 dist =outset * a_extrude * scale;\r\n\r\n    // Calculate the offset when drawing a line that is to the side of the actual line.\r\n    // We do this by creating a vector that points towards the extrude, but rotate\r\n    // it when we're drawing round end points (a_direction = -1 or 1) since their\r\n    // extrude vector points in another direction.\r\n    mediump float u = 0.5 * a_direction;\r\n    mediump float t = 1.0 - abs(u);\r\n    mediump vec2 offset2 = offset * a_extrude * scale * normal.y * mat2(t, -u, u, t);\r\n\r\n    vec4 projected_extrude = u_matrix * vec4(dist / u_ratio, 0.0, 0.0);\r\n    gl_Position = u_matrix * vec4(pos + offset2 / u_ratio, a_ext[0]/10.0 + 0.5, 1.0) + projected_extrude;\r\n\r\n    // calculate how much the perspective view squishes or stretches the extrude\r\n    float extrude_length_without_perspective = length(dist);\r\n    float extrude_length_with_perspective = length(projected_extrude.xy / gl_Position.w * u_gl_units_to_pixels);\r\n    v_gamma_scale = extrude_length_without_perspective / extrude_length_with_perspective;\r\n\r\n    v_tex_a = vec2(a_linesofar * u_patternscale_a.x / floorwidth, normal.y * u_patternscale_a.y + u_tex_y_a);\r\n    v_tex_b = vec2(a_linesofar * u_patternscale_b.x / floorwidth, normal.y * u_patternscale_b.y + u_tex_y_b);\r\n\r\n    v_width2 = vec2(outset, inset);\r\n}\r\n"},raster:{fragmentSource:"uniform float u_fade_t;\r\nuniform float u_opacity;\r\nuniform sampler2D u_image0;\r\nuniform sampler2D u_image1;\r\nvarying vec2 v_pos0;\r\nvarying vec2 v_pos1;\r\n\r\nuniform float u_brightness_low;\r\nuniform float u_brightness_high;\r\n\r\nuniform float u_saturation_factor;\r\nuniform float u_contrast_factor;\r\nuniform vec3 u_spin_weights;\r\n\r\nvoid main() {\r\n\r\n    // read and cross-fade colors from the main and parent tiles\r\n    vec4 color0 = texture2D(u_image0, v_pos0);\r\n    vec4 color1 = texture2D(u_image1, v_pos1);\r\n    if (color0.a > 0.0) {\r\n        color0.rgb = color0.rgb / color0.a;\r\n    }\r\n    if (color1.a > 0.0) {\r\n        color1.rgb = color1.rgb / color1.a;\r\n    }\r\n    vec4 color = mix(color0, color1, u_fade_t);\r\n    color.a *= u_opacity;\r\n    vec3 rgb = color.rgb;\r\n\r\n    // spin\r\n    rgb = vec3(\r\n        dot(rgb, u_spin_weights.xyz),\r\n        dot(rgb, u_spin_weights.zxy),\r\n        dot(rgb, u_spin_weights.yzx));\r\n\r\n    // saturation\r\n    float average = (color.r + color.g + color.b) / 3.0;\r\n    rgb += (average - rgb) * u_saturation_factor;\r\n\r\n    // contrast\r\n    rgb = (rgb - 0.5) * u_contrast_factor + 0.5;\r\n\r\n    // brightness\r\n    vec3 u_high_vec = vec3(u_brightness_low, u_brightness_low, u_brightness_low);\r\n    vec3 u_low_vec = vec3(u_brightness_high, u_brightness_high, u_brightness_high);\r\n\r\n    gl_FragColor = vec4(mix(u_high_vec, u_low_vec, rgb) * color.a, color.a);\r\n\r\n#ifdef OVERDRAW_INSPECTOR\r\n    gl_FragColor = vec4(1.0);\r\n#endif\r\n}\r\n",vertexSource:"uniform mat4 u_matrix;\r\nuniform vec2 u_tl_parent;\r\nuniform float u_scale_parent;\r\nuniform float u_buffer_scale;\r\n\r\nattribute vec2 a_pos;\r\nattribute vec2 a_texture_pos;\r\n\r\nvarying vec2 v_pos0;\r\nvarying vec2 v_pos1;\r\n\r\nvoid main() {\r\n    gl_Position = u_matrix * vec4(a_pos, 0, 1);\r\n    // We are using Int16 for texture position coordinates to give us enough precision for\r\n    // fractional coordinates. We use 8192 to scale the texture coordinates in the buffer\r\n    // as an arbitrarily high number to preserve adequate precision when rendering.\r\n    // This is also the same value as the EXTENT we are using for our tile buffer pos coordinates,\r\n    // so math for modifying either is consistent.\r\n    v_pos0 = (((a_texture_pos / 8192.0) - 0.5) / u_buffer_scale ) + 0.5;\r\n    v_pos1 = (v_pos0 * u_scale_parent) + u_tl_parent;\r\n}\r\n"},symbolIcon:{fragmentSource:"uniform sampler2D u_texture;\r\n\r\n#pragma minemap: define lowp float opacity\r\n\r\nvarying vec2 v_tex;\r\nvarying float v_fade_opacity;\r\n\r\nvoid main() {\r\n    #pragma minemap: initialize lowp float opacity\r\n\r\n    lowp float alpha = opacity * v_fade_opacity;\r\n    gl_FragColor = texture2D(u_texture, v_tex) * alpha;\r\n\r\n#ifdef OVERDRAW_INSPECTOR\r\n    gl_FragColor = vec4(1.0);\r\n#endif\r\n}\r\n",vertexSource:"const float PI = 3.141592653589793;\r\n\r\nattribute vec4 a_pos_offset;\r\nattribute vec4 a_data;\r\nattribute vec3 a_projected_pos;\r\nattribute float a_fade_opacity;\r\nattribute float a_height;\r\n\r\nuniform bool u_is_size_zoom_constant;\r\nuniform bool u_is_size_feature_constant;\r\nuniform highp float u_size_t; // used to interpolate between zoom stops when size is a composite function\r\nuniform highp float u_size; // used when size is both zoom and feature constant\r\nuniform highp float u_camera_to_center_distance;\r\nuniform highp float u_pitch;\r\nuniform bool u_rotate_symbol;\r\nuniform highp float u_aspect_ratio;\r\nuniform float u_fade_change;\r\nuniform mediump float u_render_3d;\r\nuniform mediump float u_height_offset;\r\n\r\n#pragma minemap: define lowp float opacity\r\n\r\nuniform mat4 u_matrix;\r\nuniform mat4 u_label_plane_matrix;\r\nuniform mat4 u_gl_coord_matrix;\r\n\r\nuniform bool u_is_text;\r\nuniform bool u_pitch_with_map;\r\n\r\nuniform vec2 u_texsize;\r\n\r\nvarying vec2 v_tex;\r\nvarying float v_fade_opacity;\r\n\r\nvoid main() {\r\n    #pragma minemap: initialize lowp float opacity\r\n\r\n    vec2 a_pos = a_pos_offset.xy;\r\n    vec2 a_offset = a_pos_offset.zw;\r\n\r\n    vec2 a_tex = a_data.xy;\r\n    vec2 a_size = a_data.zw;\r\n\r\n    highp float segment_angle = -a_projected_pos[2];\r\n\r\n    float size;\r\n    if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {\r\n        size = mix(a_size[0], a_size[1], u_size_t) / 10.0;\r\n    } else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {\r\n        size = a_size[0] / 10.0;\r\n    } else if (!u_is_size_zoom_constant && u_is_size_feature_constant) {\r\n        size = u_size;\r\n    } else {\r\n        size = u_size;\r\n    }\r\n\r\n    vec4 projectedPoint = u_matrix * vec4(a_pos, 0, 1);\r\n    highp float camera_to_anchor_distance = projectedPoint.w;\r\n    // See comments in symbol_sdf.vertex\r\n    highp float distance_ratio = u_pitch_with_map ?\r\n        camera_to_anchor_distance / u_camera_to_center_distance :\r\n        u_camera_to_center_distance / camera_to_anchor_distance;\r\n    highp float perspective_ratio = clamp(\r\n            0.5 + 0.5 * distance_ratio,\r\n            0.0, // Prevents oversized near-field symbols in pitched/overzoomed tiles\r\n            4.0);\r\n\r\n    size *= perspective_ratio;\r\n\r\n    float fontScale = u_is_text ? size / 24.0 : size;\r\n\r\n    highp float symbol_rotation = 0.0;\r\n    if (u_rotate_symbol) {\r\n        // See comments in symbol_sdf.vertex\r\n        vec4 offsetProjectedPoint = u_matrix * vec4(a_pos + vec2(1, 0), 0, 1);\r\n\r\n        vec2 a = projectedPoint.xy / projectedPoint.w;\r\n        vec2 b = offsetProjectedPoint.xy / offsetProjectedPoint.w;\r\n\r\n        symbol_rotation = atan((b.y - a.y) / u_aspect_ratio, b.x - a.x);\r\n    }\r\n\r\n    highp float angle_sin = sin(segment_angle + symbol_rotation);\r\n    highp float angle_cos = cos(segment_angle + symbol_rotation);\r\n    mat2 rotation_matrix = mat2(angle_cos, -1.0 * angle_sin, angle_sin, angle_cos);\r\n\r\n    vec4 projected_pos = u_label_plane_matrix * vec4(a_projected_pos.xy, u_render_3d == 1.0? a_height + u_height_offset : 0., 1.0);\r\n    gl_Position = u_gl_coord_matrix * vec4(projected_pos.xy / projected_pos.w + rotation_matrix * (a_offset / 32.0 * fontScale), projected_pos.z/ projected_pos.w, 1.0);\r\n\r\n    v_tex = a_tex / u_texsize;\r\n    vec2 fade_opacity = unpack_opacity(a_fade_opacity);\r\n    float fade_change = fade_opacity[1] > 0.5 ? u_fade_change : -u_fade_change;\r\n    v_fade_opacity = max(0.0, min(1.0, fade_opacity[0] + fade_change));\r\n}\r\n"},symbolSDF:{fragmentSource:"#define SDF_PX 8.0\r\n#define EDGE_GAMMA 0.105/DEVICE_PIXEL_RATIO\r\n\r\nuniform bool u_is_halo;\r\n#pragma minemap: define highp vec4 fill_color\r\n#pragma minemap: define highp vec4 halo_color\r\n#pragma minemap: define lowp float opacity\r\n#pragma minemap: define lowp float halo_width\r\n#pragma minemap: define lowp float halo_blur\r\n\r\nuniform sampler2D u_texture;\r\nuniform highp float u_gamma_scale;\r\nuniform bool u_is_text;\r\n\r\nvarying vec2 v_data0;\r\nvarying vec3 v_data1;\r\n\r\nvoid main() {\r\n    #pragma minemap: initialize highp vec4 fill_color\r\n    #pragma minemap: initialize highp vec4 halo_color\r\n    #pragma minemap: initialize lowp float opacity\r\n    #pragma minemap: initialize lowp float halo_width\r\n    #pragma minemap: initialize lowp float halo_blur\r\n\r\n    vec2 tex = v_data0.xy;\r\n    float gamma_scale = v_data1.x;\r\n    float size = v_data1.y;\r\n    float fade_opacity = v_data1[2];\r\n\r\n    float fontScale = u_is_text ? size / 24.0 : size;\r\n\r\n    lowp vec4 color = fill_color;\r\n    highp float gamma = EDGE_GAMMA / (fontScale * u_gamma_scale);\r\n    lowp float buff = (256.0 - 64.0) / 256.0;\r\n    if (u_is_halo) {\r\n        color = halo_color;\r\n        gamma = (halo_blur * 1.19 / SDF_PX + EDGE_GAMMA) / (fontScale * u_gamma_scale);\r\n        buff = (6.0 - halo_width / fontScale) / SDF_PX;\r\n    }\r\n\r\n    lowp float dist = texture2D(u_texture, tex).a;\r\n    highp float gamma_scaled = gamma * gamma_scale;\r\n    highp float alpha = smoothstep(buff - gamma_scaled, buff + gamma_scaled, dist);\r\n\r\n    gl_FragColor = color * (alpha * opacity * fade_opacity);\r\n\r\n#ifdef OVERDRAW_INSPECTOR\r\n    gl_FragColor = vec4(1.0);\r\n#endif\r\n}\r\n",vertexSource:"const float PI = 3.141592653589793;\r\n\r\nattribute vec4 a_pos_offset;\r\nattribute vec4 a_data;\r\nattribute vec3 a_projected_pos;\r\nattribute float a_fade_opacity;\r\nattribute float a_height;\r\n\r\n// contents of a_size vary based on the type of property value\r\n// used for {text,icon}-size.\r\n// For constants, a_size is disabled.\r\n// For source functions, we bind only one value per vertex: the value of {text,icon}-size evaluated for the current feature.\r\n// For composite functions:\r\n// [ text-size(lowerZoomStop, feature),\r\n//   text-size(upperZoomStop, feature) ]\r\nuniform bool u_is_size_zoom_constant;\r\nuniform bool u_is_size_feature_constant;\r\nuniform highp float u_size_t; // used to interpolate between zoom stops when size is a composite function\r\nuniform highp float u_size; // used when size is both zoom and feature constant\r\n\r\n#pragma minemap: define highp vec4 fill_color\r\n#pragma minemap: define highp vec4 halo_color\r\n#pragma minemap: define lowp float opacity\r\n#pragma minemap: define lowp float halo_width\r\n#pragma minemap: define lowp float halo_blur\r\n\r\nuniform mat4 u_matrix;\r\nuniform mat4 u_label_plane_matrix;\r\nuniform mat4 u_gl_coord_matrix;\r\n\r\nuniform bool u_is_text;\r\nuniform bool u_pitch_with_map;\r\nuniform highp float u_pitch;\r\nuniform bool u_rotate_symbol;\r\nuniform highp float u_aspect_ratio;\r\nuniform highp float u_camera_to_center_distance;\r\nuniform float u_fade_change;\r\nuniform mediump float u_render_3d;\r\nuniform mediump float u_height_offset;\r\n\r\n\r\nuniform vec2 u_texsize;\r\n\r\nvarying vec2 v_data0;\r\nvarying vec3 v_data1;\r\n\r\nvoid main() {\r\n    #pragma minemap: initialize highp vec4 fill_color\r\n    #pragma minemap: initialize highp vec4 halo_color\r\n    #pragma minemap: initialize lowp float opacity\r\n    #pragma minemap: initialize lowp float halo_width\r\n    #pragma minemap: initialize lowp float halo_blur\r\n\r\n    vec2 a_pos = a_pos_offset.xy;\r\n    vec2 a_offset = a_pos_offset.zw;\r\n\r\n    vec2 a_tex = a_data.xy;\r\n    vec2 a_size = a_data.zw;\r\n\r\n    highp float segment_angle = -a_projected_pos[2];\r\n    float size;\r\n\r\n    if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {\r\n        size = mix(a_size[0], a_size[1], u_size_t) / 10.0;\r\n    } else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {\r\n        size = a_size[0] / 10.0;\r\n    } else if (!u_is_size_zoom_constant && u_is_size_feature_constant) {\r\n        size = u_size;\r\n    } else {\r\n        size = u_size;\r\n    }\r\n\r\n    vec4 projectedPoint = u_matrix * vec4(a_pos, 0, 1);\r\n    highp float camera_to_anchor_distance = projectedPoint.w;\r\n    // If the label is pitched with the map, layout is done in pitched space,\r\n    // which makes labels in the distance smaller relative to viewport space.\r\n    // We counteract part of that effect by multiplying by the perspective ratio.\r\n    // If the label isn't pitched with the map, we do layout in viewport space,\r\n    // which makes labels in the distance larger relative to the features around\r\n    // them. We counteract part of that effect by dividing by the perspective ratio.\r\n    highp float distance_ratio = u_pitch_with_map ?\r\n        camera_to_anchor_distance / u_camera_to_center_distance :\r\n        u_camera_to_center_distance / camera_to_anchor_distance;\r\n    highp float perspective_ratio = clamp(\r\n        0.5 + 0.5 * distance_ratio,\r\n        0.0, // Prevents oversized near-field symbols in pitched/overzoomed tiles\r\n        4.0);\r\n\r\n    size *= perspective_ratio;\r\n\r\n    float fontScale = u_is_text ? size / 24.0 : size;\r\n\r\n    highp float symbol_rotation = 0.0;\r\n    if (u_rotate_symbol) {\r\n        // Point labels with 'rotation-alignment: map' are horizontal with respect to tile units\r\n        // To figure out that angle in projected space, we draw a short horizontal line in tile\r\n        // space, project it, and measure its angle in projected space.\r\n        vec4 offsetProjectedPoint = u_matrix * vec4(a_pos + vec2(1, 0), 0, 1);\r\n\r\n        vec2 a = projectedPoint.xy / projectedPoint.w;\r\n        vec2 b = offsetProjectedPoint.xy / offsetProjectedPoint.w;\r\n\r\n        symbol_rotation = atan((b.y - a.y) / u_aspect_ratio, b.x - a.x);\r\n    }\r\n\r\n    highp float angle_sin = sin(segment_angle + symbol_rotation);\r\n    highp float angle_cos = cos(segment_angle + symbol_rotation);\r\n    mat2 rotation_matrix = mat2(angle_cos, -1.0 * angle_sin, angle_sin, angle_cos);\r\n\r\n    vec4 projected_pos = u_label_plane_matrix * vec4(a_projected_pos.xy, u_render_3d == 1.0? a_height + u_height_offset : 0., 1.0);\r\n    gl_Position = u_gl_coord_matrix * vec4(projected_pos.xy / projected_pos.w + rotation_matrix * (a_offset / 32.0 * fontScale), projected_pos.z/ projected_pos.w, 1.0);\r\n    float gamma_scale = gl_Position.w;\r\n\r\n    vec2 tex = a_tex / u_texsize;\r\n    vec2 fade_opacity = unpack_opacity(a_fade_opacity);\r\n    float fade_change = fade_opacity[1] > 0.5 ? u_fade_change : -u_fade_change;\r\n    float interpolated_fade_opacity = max(0.0, min(1.0, fade_opacity[0] + fade_change));\r\n\r\n    v_data0 = vec2(tex.x, tex.y);\r\n    v_data1 = vec3(gamma_scale, size, interpolated_fade_opacity);\r\n}\r\n"},sprite:{fragmentSource:"#pragma minemap: define highp vec4 color\r\n#pragma minemap: define lowp float blur\r\n#pragma minemap: define lowp float opacity\r\n\r\nvarying vec2 v_width2;\r\nvarying vec2 v_normal;\r\nvarying float v_gamma_scale;\r\nvarying float v_opacity;\r\nvarying float v_discard;\r\n\r\nvoid main() {\r\n    #pragma minemap: initialize highp vec4 color\r\n    #pragma minemap: initialize lowp float blur\r\n    #pragma minemap: initialize lowp float opacity\r\n\r\n    if(v_discard<0.0){\r\n        discard;\r\n    }\r\n\r\n    float opacity_m = v_opacity;\r\n    // Calculate the distance of the pixel from the line in pixels.\r\n    float dist = length(v_normal) * v_width2.s;\r\n\r\n    // Calculate the antialiasing fade factor. This is either when fading in\r\n    // the line in case of an offset line (v_width2.t) or when fading out\r\n    // (v_width2.s)\r\n    float blur2 = (blur + 1.0 / DEVICE_PIXEL_RATIO) * v_gamma_scale;\r\n    float alpha = clamp(min(dist - (v_width2.t - blur2), v_width2.s - dist) / blur2, 0.0, 1.0);\r\n\r\n    gl_FragColor = color * (alpha * opacity) * opacity_m;\r\n\r\n\r\n#ifdef OVERDRAW_INSPECTOR\r\n    gl_FragColor = vec4(1.0);\r\n#endif\r\n}\r\n",
vertexSource:"\r\n\r\n// the distance over which the line edge fades out.\r\n// Retina devices need a smaller distance to avoid aliasing.\r\n#define ANTIALIASING 1.0 / DEVICE_PIXEL_RATIO / 2.0\r\n\r\n// floor(127 / 2) == 63.0\r\n// the maximum allowed miter limit is 2.0 at the moment. the extrude normal is\r\n// stored in a byte (-128..127). we scale regular normals up to length 63, but\r\n// there are also \"special\" normals that have a bigger length (of up to 126 in\r\n// this case).\r\n// #define scale 63.0\r\n#define scale 0.015873016\r\n\r\nattribute vec4 a_pos_normal;\r\nattribute vec4 a_data;\r\nattribute vec3 a_extra_m;\r\n\r\nuniform mat4 u_matrix;\r\nuniform mediump float u_ratio;\r\nuniform vec2 u_gl_units_to_pixels;\r\nuniform vec4 u_speed_mat;\r\n\r\nvarying vec2 v_normal;\r\nvarying vec2 v_width2;\r\nvarying float v_gamma_scale;\r\nvarying float v_opacity;\r\nvarying float v_discard;\r\n\r\n#pragma minemap: define highp vec4 color\r\n#pragma minemap: define lowp float blur\r\n#pragma minemap: define lowp float opacity\r\n#pragma minemap: define mediump float gapwidth\r\n#pragma minemap: define lowp float offset\r\n#pragma minemap: define mediump float width\r\n\r\nvoid main() {\r\n    #pragma minemap: initialize highp vec4 color\r\n    #pragma minemap: initialize lowp float blur\r\n    #pragma minemap: initialize lowp float opacity\r\n    #pragma minemap: initialize mediump float gapwidth\r\n    #pragma minemap: initialize lowp float offset\r\n    #pragma minemap: initialize mediump float width\r\n\r\n    //\r\n        vec3 f_extra_m = vec3(a_extra_m[0] * 3.0 / 255.0,a_extra_m[1], a_extra_m[2]);\r\n        float status = f_extra_m[2];\r\n        float link_seq = f_extra_m[1];\r\n        v_opacity = f_extra_m[0];\r\n\r\n        float speed1 = u_speed_mat[0];\r\n        float speed2 = u_speed_mat[1];\r\n        float speed3 = u_speed_mat[2];\r\n        float speed4 = u_speed_mat[3];\r\n\r\n        if(status ==1.0){\r\n            if(link_seq!=speed1){\r\n                 v_discard = -100.0;\r\n            }else{\r\n                v_discard = 100.0;\r\n            }\r\n        }else if(status == 2.0){\r\n            if(link_seq!=speed2){\r\n                 v_discard = -100.0;\r\n            }else{\r\n                v_discard = 100.0;\r\n            }\r\n        }else if(status == 3.0){\r\n            if(link_seq!=speed3){\r\n                 v_discard = -100.0;\r\n            }else{\r\n                v_discard = 100.0;\r\n            }\r\n        }else if(status == 4.0){\r\n            if(link_seq!=speed4){\r\n                 v_discard = -100.0;\r\n            }else{\r\n                v_discard = 100.0;\r\n            }\r\n        }\r\n\r\n    vec2 a_extrude = a_data.xy - 128.0;\r\n    float a_direction = mod(a_data.z, 4.0) - 1.0;\r\n\r\n    vec2 pos = a_pos_normal.xy;\r\n\r\n    // x is 1 if it's a round cap, 0 otherwise\r\n    // y is 1 if the normal points up, and -1 if it points down\r\n    mediump vec2 normal = a_pos_normal.zw;\r\n    v_normal = normal;\r\n\r\n    // these transformations used to be applied in the JS and native code bases.\r\n    // moved them into the shader for clarity and simplicity.\r\n    gapwidth = gapwidth / 2.0;\r\n    float halfwidth = width / 2.0;\r\n    offset = -1.0 * offset;\r\n\r\n    float inset = gapwidth + (gapwidth > 0.0 ? ANTIALIASING : 0.0);\r\n    float outset = gapwidth + halfwidth * (gapwidth > 0.0 ? 2.0 : 1.0) + ANTIALIASING;\r\n\r\n    // Scale the extrusion vector down to a normal and then up by the line width\r\n    // of this vertex.\r\n    mediump vec2 dist = outset * a_extrude * scale;\r\n\r\n    // Calculate the offset when drawing a line that is to the side of the actual line.\r\n    // We do this by creating a vector that points towards the extrude, but rotate\r\n    // it when we're drawing round end points (a_direction = -1 or 1) since their\r\n    // extrude vector points in another direction.\r\n    mediump float u = 0.5 * a_direction;\r\n    mediump float t = 1.0 - abs(u);\r\n    mediump vec2 offset2 = offset * a_extrude * scale * normal.y * mat2(t, -u, u, t);\r\n\r\n    vec4 projected_extrude = u_matrix * vec4(dist / u_ratio, 0.0, 0.0);\r\n    gl_Position = u_matrix * vec4(pos + offset2 / u_ratio, 0.0, 1.0) + projected_extrude;\r\n\r\n    // calculate how much the perspective view squishes or stretches the extrude\r\n    float extrude_length_without_perspective = length(dist);\r\n    float extrude_length_with_perspective = length(projected_extrude.xy / gl_Position.w * u_gl_units_to_pixels);\r\n    v_gamma_scale = extrude_length_without_perspective / extrude_length_with_perspective;\r\n\r\n    v_width2 = vec2(outset, inset);\r\n}\r\n"},sprite3d:{fragmentSource:"#pragma minemap: define highp vec4 color\r\n#pragma minemap: define lowp float blur\r\n#pragma minemap: define lowp float opacity\r\n\r\nuniform mediump float u_interpolate;\r\n\r\nvarying vec2 v_width2;\r\nvarying vec2 v_normal;\r\nvarying float v_gamma_scale;\r\nvarying float v_opacity;\r\nvarying float v_discard;\r\nvarying vec3 v_color;\r\n\r\nvoid main() {\r\n    #pragma minemap: initialize highp vec4 color\r\n    #pragma minemap: initialize lowp float blur\r\n    #pragma minemap: initialize lowp float opacity\r\n\r\n    if(v_discard<0.0){\r\n        discard;\r\n    }\r\n\r\n    float opacity_m = v_opacity;\r\n    // Calculate the distance of the pixel from the line in pixels.\r\n    float dist = length(v_normal) * v_width2.s;\r\n\r\n    // Calculate the antialiasing fade factor. This is either when fading in\r\n    // the line in case of an offset line (v_width2.t) or when fading out\r\n    // (v_width2.s)\r\n    float blur2 = (blur + 1.0 / DEVICE_PIXEL_RATIO) * v_gamma_scale;\r\n    float alpha = clamp(min(dist - (v_width2.t - blur2), v_width2.s - dist) / blur2, 0.0, 1.0);\r\n\r\n    if(u_interpolate == 1.0){\r\n        gl_FragColor = vec4(v_color,1.0) * (alpha * opacity) * opacity_m ;\r\n    }else{\r\n        gl_FragColor = color * (alpha * opacity) * opacity_m ;\r\n    }\r\n\r\n#ifdef OVERDRAW_INSPECTOR\r\n    gl_FragColor = vec4(1.0);\r\n#endif\r\n}\r\n",vertexSource:"\r\n\r\n// the distance over which the line edge fades out.\r\n// Retina devices need a smaller distance to avoid aliasing.\r\n#define ANTIALIASING 1.0 / DEVICE_PIXEL_RATIO / 2.0\r\n\r\n// floor(127 / 2) == 63.0\r\n// the maximum allowed miter limit is 2.0 at the moment. the extrude normal is\r\n// stored in a byte (-128..127). we scale regular normals up to length 63, but\r\n// there are also \"special\" normals that have a bigger length (of up to 126 in\r\n// this case).\r\n// #define scale 63.0\r\n#define scale 0.015873016\r\n\r\nattribute vec4 a_pos_normal;\r\nattribute vec4 a_data;\r\nattribute vec3 a_extra_m;\r\nattribute vec2 a_i_p_e;\r\n\r\nuniform mat4 u_matrix;\r\nuniform mediump float u_ratio;\r\nuniform vec2 u_gl_units_to_pixels;\r\nuniform vec4 u_speed_mat;\r\nuniform mediump float u_interpolate;\r\nuniform mat4 u_interp_colors;\r\nuniform float u_height_offset;\r\n\r\nvarying vec2 v_normal;\r\nvarying vec2 v_width2;\r\nvarying float v_gamma_scale;\r\nvarying float v_opacity;\r\nvarying float v_discard;\r\nvarying vec3 v_color;\r\n\r\nvec3 my_colors[3];\r\n\r\n#pragma minemap: define highp vec4 color\r\n#pragma minemap: define lowp float blur\r\n#pragma minemap: define lowp float opacity\r\n#pragma minemap: define mediump float gapwidth\r\n#pragma minemap: define lowp float offset\r\n#pragma minemap: define mediump float width\r\n#pragma minemap: define lowp float instatus\r\n#pragma minemap: define lowp float status\r\n\r\nvoid main() {\r\n    #pragma minemap: initialize highp vec4 color\r\n    #pragma minemap: initialize lowp float blur\r\n    #pragma minemap: initialize lowp float opacity\r\n    #pragma minemap: initialize mediump float gapwidth\r\n    #pragma minemap: initialize lowp float offset\r\n    #pragma minemap: initialize mediump float width\r\n    #pragma minemap: initialize lowp float instatus\r\n    #pragma minemap: initialize lowp float status\r\n\r\n my_colors[0] = vec3(63,180,193);\r\n my_colors[1] = vec3(210,239,37);\r\n my_colors[2] = vec3(250,119,46);\r\n    if(u_interpolate == 1.0){\r\n\r\n        vec3 inColor;\r\n        vec3 myColor;\r\n        if(instatus == 1.0){\r\n            inColor = my_colors[0];\r\n        }else if(instatus == 2.0){\r\n            inColor = my_colors[1];\r\n        }else if(instatus == 3.0){\r\n            inColor = my_colors[2];\r\n        }else{\r\n            inColor = my_colors[2];\r\n        }\r\n\r\n        if(status == 1.0){\r\n            myColor  = my_colors[0];\r\n        }else if(status == 2.0){\r\n            myColor = my_colors[1];\r\n        }else if(status == 3.0){\r\n            myColor = my_colors[2];\r\n        }else{\r\n            myColor = my_colors[2];\r\n        }\r\n\r\n        v_color = get_interp_color(inColor, myColor, a_i_p_e[1]/100.0);\r\n    }\r\n\r\n    //\r\n        vec3 f_extra_m = vec3(a_extra_m[0] * 3.0 / 255.0,a_extra_m[1], a_extra_m[2]);\r\n        float status1 = f_extra_m[2];\r\n        float link_seq = f_extra_m[1];\r\n        v_opacity = f_extra_m[0];\r\n\r\n        float speed1 = u_speed_mat[0];\r\n        float speed2 = u_speed_mat[1];\r\n        float speed3 = u_speed_mat[2];\r\n        float speed4 = u_speed_mat[3];\r\n\r\n        if(status1 ==1.0){\r\n            if(link_seq!=speed1){\r\n                 v_discard = -100.0;\r\n            }else{\r\n                v_discard = 100.0;\r\n            }\r\n        }else if(status1 == 2.0){\r\n            if(link_seq!=speed2){\r\n                 v_discard = -100.0;\r\n            }else{\r\n                v_discard = 100.0;\r\n            }\r\n        }else if(status1 == 3.0){\r\n            if(link_seq!=speed3){\r\n                 v_discard = -100.0;\r\n            }else{\r\n                v_discard = 100.0;\r\n            }\r\n        }else if(status1 == 4.0){\r\n            if(link_seq!=speed4){\r\n                 v_discard = -100.0;\r\n            }else{\r\n                v_discard = 100.0;\r\n            }\r\n        }\r\n\r\n    vec2 a_extrude = a_data.xy - 128.0;\r\n    float a_direction = mod(a_data.z, 4.0) - 1.0;\r\n\r\n    vec2 pos = a_pos_normal.xy;\r\n\r\n    // x is 1 if it's a round cap, 0 otherwise\r\n    // y is 1 if the normal points up, and -1 if it points down\r\n    mediump vec2 normal = a_pos_normal.zw;\r\n    v_normal = normal;\r\n\r\n    // these transformations used to be applied in the JS and native code bases.\r\n    // moved them into the shader for clarity and simplicity.\r\n    gapwidth = gapwidth / 2.0;\r\n    float halfwidth = width / 2.0;\r\n    offset = -1.0 * offset;\r\n\r\n    float inset = gapwidth + (gapwidth > 0.0 ? ANTIALIASING : 0.0);\r\n    float outset = gapwidth + halfwidth * (gapwidth > 0.0 ? 2.0 : 1.0) + ANTIALIASING;\r\n\r\n    // Scale the extrusion vector down to a normal and then up by the line width\r\n    // of this vertex.\r\n    mediump vec2 dist = outset * a_extrude * scale;\r\n\r\n    // Calculate the offset when drawing a line that is to the side of the actual line.\r\n    // We do this by creating a vector that points towards the extrude, but rotate\r\n    // it when we're drawing round end points (a_direction = -1 or 1) since their\r\n    // extrude vector points in another direction.\r\n    mediump float u = 0.5 * a_direction;\r\n    mediump float t = 1.0 - abs(u);\r\n    mediump vec2 offset2 = offset * a_extrude * scale * normal.y * mat2(t, -u, u, t);\r\n\r\n    vec4 projected_extrude = u_matrix * vec4(dist / u_ratio, 0.0, 0.0);\r\n    gl_Position = u_matrix * vec4(pos + offset2 / u_ratio, a_i_p_e[0] / 10.0 + u_height_offset / 10.0, 1.0) + projected_extrude;\r\n\r\n    // calculate how much the perspective view squishes or stretches the extrude\r\n    float extrude_length_without_perspective = length(dist);\r\n    float extrude_length_with_perspective = length(projected_extrude.xy / gl_Position.w * u_gl_units_to_pixels);\r\n    v_gamma_scale = extrude_length_without_perspective / extrude_length_with_perspective;\r\n\r\n    v_width2 = vec2(outset, inset);\r\n}\r\n"},histogram:{fragmentSource:"varying vec4 v_color;\r\n#pragma minemap: define lowp float base\r\n#pragma minemap: define lowp float height\r\n#pragma minemap: define highp vec4 color\r\nvarying float v_opacity;\r\nvoid main() {\r\n    #pragma minemap: initialize lowp float base\r\n    #pragma minemap: initialize lowp float height\r\n    #pragma minemap: initialize highp vec4 color\r\n\r\n    gl_FragColor = v_color * v_opacity;\r\n\r\n#ifdef OVERDRAW_INSPECTOR\r\n    gl_FragColor = vec4(1.0);\r\n#endif\r\n}\r\n",vertexSource:"uniform mat4 u_matrix;\r\nuniform vec3 u_lightcolor;\r\nuniform lowp vec3 u_lightpos;\r\nuniform lowp float u_lightintensity;\r\nuniform float u_is_max_length;  // \r\nuniform float u_fluorescent;\r\n\r\nattribute vec2 a_pos;\r\nattribute vec4 a_normal_ed;\r\n\r\nvarying vec4 v_color;\r\n\r\n#pragma minemap: define lowp float base\r\n#pragma minemap: define lowp float height\r\n\r\n#pragma minemap: define highp vec4 color\r\n\r\nvarying float v_opacity;\r\n\r\nvoid main() {\r\n    #pragma minemap: initialize lowp float base\r\n    #pragma minemap: initialize lowp float height\r\n    #pragma minemap: initialize highp vec4 color\r\n\r\n    vec3 normal = a_normal_ed.xyz;\r\n\r\n    base = max(0.0, base);\r\n    height = max(0.0, height);\r\n\r\n    float t = mod(normal.x, 2.0);\r\n\r\n    gl_Position = u_matrix * vec4(a_pos, t > 0.0 ? ( u_is_max_length == 1.0 ? height * 100.0 : height ) : base * 100.0, 1);\r\n    if(t > 0.0){\r\n        v_opacity = 1.2;\r\n    }else{\r\n        v_opacity = 0.1;\r\n    }\r\n\r\n    // Relative luminance (how dark/bright is the surface color?)\r\n    float colorvalue = color.r * 0.2126 + color.g * 0.7152 + color.b * 0.0722;\r\n\r\n    v_color = vec4(0.0, 0.0, 0.0, 1.0);\r\n\r\n    // Add slight ambient lighting so no extrusions are totally black\r\n    vec4 ambientlight = vec4(0.03, 0.03, 0.03, 1.0);\r\n    color += ambientlight;\r\n\r\n    // Calculate cos(theta), where theta is the angle between surface normal and diffuse light ray\r\n    float directional = clamp(dot(normal / 16384.0, u_lightpos), 0.0, 1.0);\r\n\r\n    // Adjust directional so that\r\n    // the range of values for highlight/shading is narrower\r\n    // with lower light intensity\r\n    // and with lighter/brighter surface colors\r\n    directional = mix((1.0 - u_lightintensity), max((1.0 - colorvalue + u_lightintensity), 1.0), directional);\r\n\r\n    // Add gradient along z axis of side surfaces\r\n    if (normal.y != 0.0) {\r\n        directional *= clamp((t + base) * pow(height / 150.0, 0.5), mix(0.7, 0.98, 1.0 - u_lightintensity), 1.0);\r\n    }\r\n\r\n    // Assign final color based on surface + ambient light color, diffuse light directional, and light color\r\n    // with lower bounds adjusted to hue of light\r\n    // so that shading is tinted with the complementary (opposite) color to the light color\r\n    v_color.r += clamp(color.r * directional * u_lightcolor.r, mix(0.0, 0.3, 1.0 - u_lightcolor.r), 1.0);\r\n    v_color.g += clamp(color.g * directional * u_lightcolor.g, mix(0.0, 0.3, 1.0 - u_lightcolor.g), 1.0);\r\n    v_color.b += clamp(color.b * directional * u_lightcolor.b, mix(0.0, 0.3, 1.0 - u_lightcolor.b), 1.0);\r\n\r\n}\r\n"},histogramColor:{fragmentSource:"uniform vec4 u_color_a;\r\nuniform vec4 u_color_b;\r\nuniform vec4 u_color_c;\r\nuniform vec4 u_color_d;\r\nuniform vec4 u_color_e;\r\nuniform float u_max_height;\r\n#pragma minemap: define lowp float base\r\n#pragma minemap: define lowp float height\r\n#pragma minemap: define highp vec4 color\r\nvarying float v_opacity;\r\nvarying float v_height;\r\nvarying float v_directional;\r\nvoid main() {\r\n    #pragma minemap: initialize lowp float base\r\n    #pragma minemap: initialize lowp float height\r\n    #pragma minemap: initialize highp vec4 color\r\n\r\n    if (v_height < 0.25 * u_max_height) {\r\n        vec4 tmp = u_color_b - u_color_a;\r\n        vec4 real = tmp * ((v_height) / 0.25 / u_max_height) + u_color_a;\r\n        gl_FragColor = vec4(real.rgb * v_directional, 1.0);\r\n    } else if (v_height < 0.5 * u_max_height) {\r\n        vec4 tmp = u_color_c - u_color_b;\r\n        vec4 real = tmp * ((v_height - 0.25 * u_max_height) / 0.25 / u_max_height) + u_color_b;\r\n        gl_FragColor = vec4(real.rgb * v_directional, 1.0);\r\n    } else if (v_height < 0.75 * u_max_height) {\r\n        vec4 tmp = u_color_d - u_color_c;\r\n        vec4 real = tmp * ((v_height - 0.5 * u_max_height) / 0.25 / u_max_height) + u_color_c;\r\n        gl_FragColor = vec4(real.rgb * v_directional, 1.0);\r\n    } else if (v_height < 0.8 * u_max_height){\r\n        vec4 tmp = u_color_e - u_color_d;\r\n        vec4 real = tmp * ((v_height - 0.75 * u_max_height) / 0.25 / u_max_height) + u_color_d;\r\n        gl_FragColor = vec4(real.rgb * v_directional, 1.0);\r\n    } else{\r\n        gl_FragColor = vec4(u_color_e.rgb * v_directional, 1.0);\r\n    }\r\n\r\n#ifdef OVERDRAW_INSPECTOR\r\n    gl_FragColor = vec4(1.0);\r\n#endif\r\n}\r\n",vertexSource:"uniform mat4 u_matrix;\r\nuniform vec3 u_lightcolor;\r\nuniform lowp vec3 u_lightpos;\r\nuniform lowp float u_lightintensity;\r\nuniform float u_is_max_length;  // \r\n\r\nuniform float u_fluorescent;\r\n\r\nattribute vec2 a_pos;\r\nattribute vec4 a_normal_ed;\r\n\r\nvarying vec4 v_color;\r\n\r\n#pragma minemap: define lowp float base\r\n#pragma minemap: define lowp float height\r\n\r\n#pragma minemap: define highp vec4 color\r\n\r\nvarying float v_opacity;\r\nvarying float v_height;\r\nvarying float v_directional;\r\nvoid main() {\r\n    #pragma minemap: initialize lowp float base\r\n    #pragma minemap: initialize lowp float height\r\n    #pragma minemap: initialize highp vec4 color\r\n\r\n    vec3 normal = a_normal_ed.xyz;\r\n\r\n    base = max(0.0, base);\r\n    height = max(0.0, height);\r\n\r\n    float t = mod(normal.x, 2.0);\r\n\r\n    gl_Position = u_matrix * vec4(a_pos, t > 0.0 ? ( u_is_max_length == 1.0 ? height * 100.0 : height ) : base * 100.0, 1);\r\n    if(t > 0.0){\r\n        v_opacity = 1.2;\r\n        v_height = height*3.0;\r\n    }else{\r\n        v_opacity = 0.1;\r\n        v_height = 0.0;\r\n    }\r\n\r\n    // Relative luminance (how dark/bright is the surface color?)\r\n    float colorvalue = color.r * 0.2126 + color.g * 0.7152 + color.b * 0.0722;\r\n\r\n    v_color = vec4(0.0, 0.0, 0.0, 1.0);\r\n\r\n    // Add slight ambient lighting so no extrusions are totally black\r\n    vec4 ambientlight = vec4(0.03, 0.03, 0.03, 1.0);\r\n    color += ambientlight;\r\n\r\n    // Calculate cos(theta), where theta is the angle between surface normal and diffuse light ray\r\n    float directional = clamp(dot(normal / 16384.0, u_lightpos), 0.0, 1.0);\r\n\r\n    // Adjust directional so that\r\n    // the range of values for highlight/shading is narrower\r\n    // with lower light intensity\r\n    // and with lighter/brighter surface colors\r\n    directional = mix((1.0 - u_lightintensity), max((1.0 - colorvalue + u_lightintensity), 1.0), directional);\r\n\r\n    // Add gradient along z axis of side surfaces\r\n    if (normal.y != 0.0) {\r\n        directional *= clamp((t + base) * pow(height / 150.0, 0.5), mix(0.7, 0.98, 1.0 - u_lightintensity), 1.0);\r\n    }\r\n\r\n    // Assign final color based on surface + ambient light color, diffuse light directional, and light color\r\n    // with lower bounds adjusted to hue of light\r\n    // so that shading is tinted with the complementary (opposite) color to the light color\r\n    v_color.r += clamp(color.r * directional * u_lightcolor.r, mix(0.0, 0.3, 1.0 - u_lightcolor.r), 1.0);\r\n    v_color.g += clamp(color.g * directional * u_lightcolor.g, mix(0.0, 0.3, 1.0 - u_lightcolor.g), 1.0);\r\n    v_color.b += clamp(color.b * directional * u_lightcolor.b, mix(0.0, 0.3, 1.0 - u_lightcolor.b), 1.0);\r\n\r\n    if(u_fluorescent <= 0.0){\r\n        v_directional = directional;\r\n    }else{\r\n        v_directional = 1.0;\r\n    }\r\n\r\n\r\n}\r\n"},histogramDynamic:{fragmentSource:"varying vec4 v_color;\r\nuniform vec4 u_color_a;\r\nuniform vec4 u_color_b;\r\nuniform vec4 u_color_c;\r\nuniform vec4 u_color_d;\r\nuniform vec4 u_color_e;\r\nuniform float u_max_height;\r\n\r\n#pragma minemap: define lowp float base\r\n#pragma minemap: define lowp float height\r\n#pragma minemap: define highp vec4 color\r\n\r\nvarying float v_opacity;\r\nvarying float v_height;\r\nvarying float v_directional;\r\n\r\nvoid main() {\r\n    #pragma minemap: initialize lowp float base\r\n    #pragma minemap: initialize lowp float height\r\n    #pragma minemap: initialize highp vec4 color\r\n\r\n    if (v_height < 0.2 * u_max_height) {\r\n        vec4 tmp = u_color_b - u_color_a;\r\n        vec4 real = tmp * ((v_height) / 0.2 / u_max_height) + u_color_a;\r\n        gl_FragColor = vec4(real.rgb * v_directional, 1.0);\r\n    } else if (v_height < 0.4 * u_max_height) {\r\n        vec4 tmp = u_color_c - u_color_b;\r\n        vec4 real = tmp * ((v_height - 0.2 * u_max_height) / 0.2 / u_max_height) + u_color_b;\r\n        gl_FragColor = vec4(real.rgb * v_directional, 1.0);\r\n    } else if (v_height < 0.6 * u_max_height) {\r\n        vec4 tmp = u_color_d - u_color_c;\r\n        vec4 real = tmp * ((v_height - 0.4 * u_max_height) / 0.2 / u_max_height) + u_color_c;\r\n        gl_FragColor = vec4(real.rgb * v_directional, 1.0);\r\n    } else if (v_height < 0.8 * u_max_height){\r\n        vec4 tmp = u_color_e - u_color_d;\r\n        vec4 real = tmp * ((v_height - 0.6 * u_max_height) / 0.2 / u_max_height) + u_color_d;\r\n        gl_FragColor = vec4(real.rgb * v_directional, 1.0);\r\n    } else{\r\n        gl_FragColor = vec4(u_color_e.rgb * v_directional, 1.0);\r\n    }\r\n\r\n#ifdef OVERDRAW_INSPECTOR\r\n    gl_FragColor = vec4(1.0);\r\n#endif\r\n}\r\n",vertexSource:"uniform mat4 u_matrix;\r\nuniform vec3 u_lightcolor;\r\nuniform lowp vec3 u_lightpos;\r\nuniform lowp float u_lightintensity;\r\nuniform lowp float u_dyn_count;\r\nuniform float u_fluorescent;\r\n\r\nattribute vec2 a_pos;\r\nattribute vec4 a_normal_ed;\r\n\r\nvarying vec4 v_color;\r\nvarying float v_opacity;\r\nvarying float v_height;\r\nvarying float v_directional;\r\n\r\n#pragma minemap: define lowp float base\r\n#pragma minemap: define lowp float height\r\n\r\n#pragma minemap: define highp vec4 color\r\n#pragma minemap: define lowp vec4 heightArr1\r\n#pragma minemap: define lowp vec4 heightArr2\r\n#pragma minemap: define lowp vec4 heightArr3\r\n\r\nvoid main() {\r\n    #pragma minemap: initialize lowp float base\r\n    #pragma minemap: initialize lowp float height\r\n    #pragma minemap: initialize highp vec4 color\r\n    #pragma minemap: initialize lowp vec4 heightArr1\r\n    #pragma minemap: initialize lowp vec4 heightArr2\r\n    #pragma minemap: initialize lowp vec4 heightArr3\r\n\r\n        //  u_count /  \r\n\r\n        // float loops = mod(floor(u_dyn_count / height), 2.0);\r\n        // float _height = 0.0;\r\n        // if(loops == 0.0){\r\n        //     _height = mod(abs(u_dyn_count), abs(height));\r\n        // }else{\r\n        //     _height = abs(height) - mod(abs(u_dyn_count), abs(height));\r\n        // }\r\n\r\n        float _height = 0.0;\r\n        float _num = 0.0;\r\n        float _height1 = 0.0;\r\n        float _height2 = 0.0;\r\n        _num = abs(u_dyn_count) / 500.0;\r\n        if(_num < 1.0){\r\n            _height1 = abs(height);\r\n            _height2 = abs(heightArr1[0])*255.0;\r\n        }else if(_num < 2.0){\r\n            _height1 = abs(heightArr1[0])*255.0;\r\n            _height2 = abs(heightArr1[1])*255.0;\r\n        }else if(_num < 3.0){\r\n            _height1 = abs(heightArr1[1])*255.0;\r\n            _height2 = abs(heightArr1[2])*255.0;\r\n        }else if(_num < 4.0){\r\n            _height1 = abs(heightArr1[2])*255.0;\r\n            _height2 = abs(heightArr1[3])*255.0;\r\n        }else if(_num < 5.0){\r\n            _height1 = abs(heightArr1[3])*255.0;\r\n            _height2 = abs(heightArr2[0])*255.0;\r\n        }else if(_num < 6.0){\r\n            _height1 = abs(heightArr2[0])*255.0;\r\n            _height2 = abs(heightArr2[1])*255.0;\r\n        }else if(_num < 7.0){\r\n            _height1 = abs(heightArr2[1])*255.0;\r\n            _height2 = abs(heightArr2[2])*255.0;\r\n        }else if(_num < 8.0){\r\n            _height1 = abs(heightArr2[2])*255.0;\r\n            _height2 = abs(heightArr2[3])*255.0;\r\n        }else if(_num < 9.0){\r\n            _height1 = abs(heightArr2[3])*255.0;\r\n            _height2 = abs(heightArr3[0])*255.0;\r\n        }else if(_num < 10.0){\r\n            _height1 = abs(heightArr3[0])*255.0;\r\n            _height2 = abs(heightArr3[1])*255.0;\r\n        }else if(_num < 11.0){\r\n            _height1 = abs(heightArr3[1])*255.0;\r\n            _height2 = abs(heightArr3[2])*255.0;\r\n        }else if(_num < 12.0){\r\n            _height1 = abs(heightArr3[2])*255.0;\r\n            _height2 = abs(heightArr3[3])*255.0;\r\n        }\r\n\r\n        _height = 20.0 + (_height1 + (_height2 - _height1) / 500.0 * mod(abs(u_dyn_count), 500.0)) * 1.0;\r\n\r\n\r\n    vec3 normal = a_normal_ed.xyz;\r\n\r\n    base = max(0.0, base);\r\n    height = max(0.0, height);\r\n\r\n    float t = mod(normal.x, 2.0);\r\n\r\n    gl_Position = u_matrix * vec4(a_pos, t > 0.0 ? _height : base, 1);\r\n\r\n    if(t > 0.0){\r\n        v_opacity = 1.2;\r\n        v_height = _height*3.0;\r\n    }else{\r\n        v_opacity = 0.1;\r\n        v_height = 0.0;\r\n    }\r\n\r\n    // Relative luminance (how dark/bright is the surface color?)\r\n    float colorvalue = color.r * 0.2126 + color.g * 0.7152 + color.b * 0.0722;\r\n\r\n    v_color = vec4(0.0, 0.0, 0.0, 1.0);\r\n\r\n    // Add slight ambient lighting so no extrusions are totally black\r\n    vec4 ambientlight = vec4(0.03, 0.03, 0.03, 1.0);\r\n    color += ambientlight;\r\n\r\n    // Calculate cos(theta), where theta is the angle between surface normal and diffuse light ray\r\n    float directional = clamp(dot(normal / 16384.0, u_lightpos), 0.0, 1.0);\r\n\r\n    // Adjust directional so that\r\n    // the range of values for highlight/shading is narrower\r\n    // with lower light intensity\r\n    // and with lighter/brighter surface colors\r\n    directional = mix((1.0 - u_lightintensity), max((1.0 - colorvalue + u_lightintensity), 1.0), directional);\r\n\r\n    // Add gradient along z axis of side surfaces\r\n    if (normal.y != 0.0) {\r\n        directional *= clamp((t + base) * pow(height / 150.0, 0.5), mix(0.7, 0.98, 1.0 - u_lightintensity), 1.0);\r\n    }\r\n\r\n    // Assign final color based on surface + ambient light color, diffuse light directional, and light color\r\n    // with lower bounds adjusted to hue of light\r\n    // so that shading is tinted with the complementary (opposite) color to the light color\r\n    v_color.r += clamp(color.r * directional * u_lightcolor.r, mix(0.0, 0.3, 1.0 - u_lightcolor.r), 1.0);\r\n    v_color.g += clamp(color.g * directional * u_lightcolor.g, mix(0.0, 0.3, 1.0 - u_lightcolor.g), 1.0);\r\n    v_color.b += clamp(color.b * directional * u_lightcolor.b, mix(0.0, 0.3, 1.0 - u_lightcolor.b), 1.0);\r\n\r\n    v_directional = directional;\r\n}\r\n"},symtrackingIcon:{fragmentSource:"uniform sampler2D u_texture;\r\n\r\n#pragma minemap: define lowp float opacity\r\n\r\nvarying vec2 v_tex;\r\nvarying float v_fade_opacity;\r\nvarying float v_seq;\r\n\r\nvoid main() {\r\n    #pragma minemap: initialize lowp float opacity\r\n\r\n    if(v_seq<0.0){\r\n        discard;\r\n    }\r\n    lowp float alpha = opacity * v_fade_opacity;\r\n    gl_FragColor = texture2D(u_texture, v_tex) * opacity;\r\n\r\n#ifdef OVERDRAW_INSPECTOR\r\n    gl_FragColor = vec4(1.0);\r\n#endif\r\n}\r\n",vertexSource:"const float PI = 3.141592653589793;\r\n\r\nattribute vec4 a_pos_offset;\r\nattribute vec4 a_data;\r\nattribute vec3 a_projected_pos;\r\nattribute vec2 a_extra;\r\nattribute float a_fade_opacity;\r\n\r\nuniform bool u_is_size_zoom_constant;\r\nuniform bool u_is_size_feature_constant;\r\nuniform highp float u_size_t; // used to interpolate between zoom stops when size is a composite function\r\nuniform highp float u_size; // used when size is both zoom and feature constant\r\nuniform highp float u_camera_to_center_distance;\r\nuniform highp float u_pitch;\r\nuniform bool u_rotate_symbol;\r\nuniform highp float u_aspect_ratio;\r\nuniform float u_fade_change;\r\nuniform mediump float u_render_3d;\r\nuniform mediump float u_height_offset;\r\n\r\n#pragma minemap: define lowp float opacity\r\n\r\nuniform mat4 u_matrix;\r\nuniform mat4 u_label_plane_matrix;\r\nuniform mat4 u_gl_coord_matrix;\r\n\r\nuniform bool u_is_text;\r\nuniform bool u_pitch_with_map;\r\n\r\nuniform vec2 u_texsize;\r\n\r\nuniform float u_seq;\r\n\r\nvarying vec2 v_tex;\r\nvarying float v_fade_opacity;\r\nvarying float v_seq;\r\n\r\nvoid main() {\r\n    #pragma minemap: initialize lowp float opacity\r\n\r\n    float a_seq = a_extra[0];\r\n    if(a_seq!=u_seq){\r\n        v_seq = -100.0;\r\n    }else{\r\n        v_seq = 100.0;\r\n    }\r\n\r\n    vec2 a_pos = a_pos_offset.xy;\r\n    vec2 a_offset = a_pos_offset.zw;\r\n\r\n    vec2 a_tex = a_data.xy;\r\n    vec2 a_size = a_data.zw;\r\n\r\n    highp float segment_angle = -a_projected_pos[2];\r\n\r\n    float size;\r\n    if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {\r\n        size = mix(a_size[0], a_size[1], u_size_t) / 10.0;\r\n    } else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {\r\n        size = a_size[0] / 10.0;\r\n    } else if (!u_is_size_zoom_constant && u_is_size_feature_constant) {\r\n        size = u_size;\r\n    } else {\r\n        size = u_size;\r\n    }\r\n\r\n    vec4 projectedPoint = u_matrix * vec4(a_pos, 0, 1);\r\n    highp float camera_to_anchor_distance = projectedPoint.w;\r\n    // See comments in symbol_sdf.vertex\r\n    highp float distance_ratio = u_pitch_with_map ?\r\n        camera_to_anchor_distance / u_camera_to_center_distance :\r\n        u_camera_to_center_distance / camera_to_anchor_distance;\r\n    highp float perspective_ratio = clamp(\r\n            0.5 + 0.5 * distance_ratio,\r\n            0.0, // Prevents oversized near-field symbols in pitched/overzoomed tiles\r\n            4.0);\r\n\r\n    size *= perspective_ratio;\r\n\r\n    float fontScale = u_is_text ? size / 24.0 : size;\r\n\r\n    highp float symbol_rotation = 0.0;\r\n    if (u_rotate_symbol) {\r\n        // See comments in symbol_sdf.vertex\r\n        vec4 offsetProjectedPoint = u_matrix * vec4(a_pos + vec2(1, 0), 0, 1);\r\n\r\n        vec2 a = projectedPoint.xy / projectedPoint.w;\r\n        vec2 b = offsetProjectedPoint.xy / offsetProjectedPoint.w;\r\n\r\n        symbol_rotation = atan((b.y - a.y) / u_aspect_ratio, b.x - a.x);\r\n    }\r\n\r\n    highp float angle_sin = sin(segment_angle + symbol_rotation);\r\n    highp float angle_cos = cos(segment_angle + symbol_rotation);\r\n    mat2 rotation_matrix = mat2(angle_cos, -1.0 * angle_sin, angle_sin, angle_cos);\r\n\r\n    vec4 projected_pos = u_label_plane_matrix * vec4(a_projected_pos.xy, a_extra[1]/10.0+u_height_offset/10.0, 1.0);\r\n//    if(u_render_3d != 1.0){\r\n//        projected_pos = u_label_plane_matrix * vec4(a_projected_pos.xy, 0, 1.0);\r\n//    }\r\n    gl_Position = u_gl_coord_matrix * vec4(projected_pos.xy / projected_pos.w + rotation_matrix * (a_offset / 32.0 * fontScale), projected_pos.z/projected_pos.w, 1.0);\r\n\r\n    v_tex = a_tex / u_texsize;\r\n    vec2 fade_opacity = unpack_opacity(a_fade_opacity);\r\n    float fade_change = fade_opacity[1] > 0.5 ? u_fade_change : -u_fade_change;\r\n    v_fade_opacity = max(0.0, min(1.0, fade_opacity[0] + fade_change));\r\n}\r\n"},symtrackingSDF:{
fragmentSource:"#define SDF_PX 8.0\r\n#define EDGE_GAMMA 0.105/DEVICE_PIXEL_RATIO\r\n\r\nuniform bool u_is_halo;\r\n#pragma minemap: define highp vec4 fill_color\r\n#pragma minemap: define highp vec4 halo_color\r\n#pragma minemap: define lowp float opacity\r\n#pragma minemap: define lowp float halo_width\r\n#pragma minemap: define lowp float halo_blur\r\n\r\nuniform sampler2D u_texture;\r\nuniform highp float u_gamma_scale;\r\nuniform bool u_is_text;\r\n\r\nvarying vec2 v_data0;\r\nvarying vec3 v_data1;\r\nvarying float v_seq;\r\n\r\nvoid main() {\r\n    #pragma minemap: initialize highp vec4 fill_color\r\n    #pragma minemap: initialize highp vec4 halo_color\r\n    #pragma minemap: initialize lowp float opacity\r\n    #pragma minemap: initialize lowp float halo_width\r\n    #pragma minemap: initialize lowp float halo_blur\r\n\r\n    if(v_seq<0.0){\r\n        discard;\r\n    }\r\n\r\n    vec2 tex = v_data0.xy;\r\n    float gamma_scale = v_data1.x;\r\n    float size = v_data1.y;\r\n    float fade_opacity = v_data1[2];\r\n\r\n    float fontScale = u_is_text ? size / 24.0 : size;\r\n\r\n    lowp vec4 color = fill_color;\r\n    highp float gamma = EDGE_GAMMA / (fontScale * u_gamma_scale);\r\n    lowp float buff = (256.0 - 64.0) / 256.0;\r\n    if (u_is_halo) {\r\n        color = halo_color;\r\n        gamma = (halo_blur * 1.19 / SDF_PX + EDGE_GAMMA) / (fontScale * u_gamma_scale);\r\n        buff = (6.0 - halo_width / fontScale) / SDF_PX;\r\n    }\r\n\r\n    lowp float dist = texture2D(u_texture, tex).a;\r\n    highp float gamma_scaled = gamma * gamma_scale;\r\n    highp float alpha = smoothstep(buff - gamma_scaled, buff + gamma_scaled, dist);\r\n\r\n    gl_FragColor = color * (alpha * opacity);\r\n\r\n#ifdef OVERDRAW_INSPECTOR\r\n    gl_FragColor = vec4(1.0);\r\n#endif\r\n}\r\n",vertexSource:"const float PI = 3.141592653589793;\r\n\r\nattribute vec4 a_pos_offset;\r\nattribute vec4 a_data;\r\nattribute vec3 a_projected_pos;\r\nattribute float a_fade_opacity;\r\nattribute vec2 a_extra;\r\n\r\n// contents of a_size vary based on the type of property value\r\n// used for {text,icon}-size.\r\n// For constants, a_size is disabled.\r\n// For source functions, we bind only one value per vertex: the value of {text,icon}-size evaluated for the current feature.\r\n// For composite functions:\r\n// [ text-size(lowerZoomStop, feature),\r\n//   text-size(upperZoomStop, feature) ]\r\nuniform bool u_is_size_zoom_constant;\r\nuniform bool u_is_size_feature_constant;\r\nuniform highp float u_size_t; // used to interpolate between zoom stops when size is a composite function\r\nuniform highp float u_size; // used when size is both zoom and feature constant\r\nuniform mediump float u_render_3d;\r\nuniform mediump float u_height_offset;\r\n\r\n\r\n#pragma minemap: define highp vec4 fill_color\r\n#pragma minemap: define highp vec4 halo_color\r\n#pragma minemap: define lowp float opacity\r\n#pragma minemap: define lowp float halo_width\r\n#pragma minemap: define lowp float halo_blur\r\n\r\nuniform mat4 u_matrix;\r\nuniform mat4 u_label_plane_matrix;\r\nuniform mat4 u_gl_coord_matrix;\r\n\r\nuniform bool u_is_text;\r\nuniform bool u_pitch_with_map;\r\nuniform highp float u_pitch;\r\nuniform bool u_rotate_symbol;\r\nuniform highp float u_aspect_ratio;\r\nuniform highp float u_camera_to_center_distance;\r\nuniform float u_fade_change;\r\n\r\nuniform vec2 u_texsize;\r\n\r\nuniform float u_seq;\r\nvarying vec2 v_data0;\r\nvarying vec3 v_data1;\r\nvarying float v_seq;\r\n\r\nvoid main() {\r\n    #pragma minemap: initialize highp vec4 fill_color\r\n    #pragma minemap: initialize highp vec4 halo_color\r\n    #pragma minemap: initialize lowp float opacity\r\n    #pragma minemap: initialize lowp float halo_width\r\n    #pragma minemap: initialize lowp float halo_blur\r\n\r\n    float a_seq = a_extra[0];\r\n    if(a_seq!=u_seq){\r\n        v_seq = -100.0;\r\n    }else{\r\n        v_seq = 100.0;\r\n    }\r\n\r\n    vec2 a_pos = a_pos_offset.xy;\r\n    vec2 a_offset = a_pos_offset.zw;\r\n\r\n    vec2 a_tex = a_data.xy;\r\n    vec2 a_size = a_data.zw;\r\n\r\n    highp float segment_angle = -a_projected_pos[2];\r\n    float size;\r\n\r\n    if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {\r\n        size = mix(a_size[0], a_size[1], u_size_t) / 10.0;\r\n    } else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {\r\n        size = a_size[0] / 10.0;\r\n    } else if (!u_is_size_zoom_constant && u_is_size_feature_constant) {\r\n        size = u_size;\r\n    } else {\r\n        size = u_size;\r\n    }\r\n\r\n    vec4 projectedPoint = u_matrix * vec4(a_pos, 0, 1);\r\n    highp float camera_to_anchor_distance = projectedPoint.w;\r\n    // If the label is pitched with the map, layout is done in pitched space,\r\n    // which makes labels in the distance smaller relative to viewport space.\r\n    // We counteract part of that effect by multiplying by the perspective ratio.\r\n    // If the label isn't pitched with the map, we do layout in viewport space,\r\n    // which makes labels in the distance larger relative to the features around\r\n    // them. We counteract part of that effect by dividing by the perspective ratio.\r\n    highp float distance_ratio = u_pitch_with_map ?\r\n        camera_to_anchor_distance / u_camera_to_center_distance :\r\n        u_camera_to_center_distance / camera_to_anchor_distance;\r\n    highp float perspective_ratio = clamp(\r\n        0.5 + 0.5 * distance_ratio,\r\n        0.0, // Prevents oversized near-field symbols in pitched/overzoomed tiles\r\n        4.0);\r\n\r\n    size *= perspective_ratio;\r\n\r\n    float fontScale = u_is_text ? size / 24.0 : size;\r\n\r\n    highp float symbol_rotation = 0.0;\r\n    if (u_rotate_symbol) {\r\n        // Point labels with 'rotation-alignment: map' are horizontal with respect to tile units\r\n        // To figure out that angle in projected space, we draw a short horizontal line in tile\r\n        // space, project it, and measure its angle in projected space.\r\n        vec4 offsetProjectedPoint = u_matrix * vec4(a_pos + vec2(1, 0), 0, 1);\r\n\r\n        vec2 a = projectedPoint.xy / projectedPoint.w;\r\n        vec2 b = offsetProjectedPoint.xy / offsetProjectedPoint.w;\r\n\r\n        symbol_rotation = atan((b.y - a.y) / u_aspect_ratio, b.x - a.x);\r\n    }\r\n\r\n    highp float angle_sin = sin(segment_angle + symbol_rotation);\r\n    highp float angle_cos = cos(segment_angle + symbol_rotation);\r\n    mat2 rotation_matrix = mat2(angle_cos, -1.0 * angle_sin, angle_sin, angle_cos);\r\n\r\n    vec4 projected_pos = u_label_plane_matrix * vec4(a_projected_pos.xy, a_extra[1]/10.0+u_height_offset/10.0, 1.0);\r\n//    if(u_render_3d != 1.0){\r\n//        projected_pos = u_label_plane_matrix * vec4(a_projected_pos.xy, 0, 1.0);\r\n//    }\r\n    gl_Position = u_gl_coord_matrix * vec4(projected_pos.xy / projected_pos.w + rotation_matrix * (a_offset / 32.0 * fontScale), projected_pos.z/ projected_pos.w, 1.0);\r\n    float gamma_scale = gl_Position.w;\r\n\r\n    vec2 tex = a_tex / u_texsize;\r\n    vec2 fade_opacity = unpack_opacity(a_fade_opacity);\r\n    float fade_change = fade_opacity[1] > 0.5 ? u_fade_change : -u_fade_change;\r\n    float interpolated_fade_opacity = max(0.0, min(1.0, fade_opacity[0] + fade_change));\r\n\r\n    v_data0 = vec2(tex.x, tex.y);\r\n    v_data1 = vec3(gamma_scale, size, interpolated_fade_opacity);\r\n}\r\n"},tracking:{fragmentSource:"#pragma minemap: define highp vec4 color\r\n#pragma minemap: define lowp float blur\r\n#pragma minemap: define lowp float opacity\r\n\r\n//hack me\r\nuniform float u_start;\r\nuniform float u_end;\r\nuniform float u_segments;\r\nuniform float u_reverse;\r\nuniform float u_reserve;\r\n\r\nvarying vec2 v_width2;\r\nvarying vec2 v_normal;\r\nvarying float v_gamma_scale;\r\nvarying float v_seq;\r\n\r\nvoid main() {\r\n    #pragma minemap: initialize highp vec4 color\r\n    #pragma minemap: initialize lowp float blur\r\n    #pragma minemap: initialize lowp float opacity\r\n\r\n    mediump float drive_opacity = 1.0;\r\n    if(u_reserve == 1.0){\r\n        if(v_seq>u_end){\r\n            discard;\r\n        }\r\n    }else{\r\n        if(v_seq<u_start || v_seq>u_end){\r\n            discard;\r\n        }\r\n\r\n        drive_opacity = (v_seq - u_start) / u_segments;\r\n        if(u_reverse == 1.0){\r\n            drive_opacity = 1.0 - drive_opacity;\r\n        }\r\n    }\r\n\r\n    // Calculate the distance of the pixel from the line in pixels.\r\n    float dist = length(v_normal) * v_width2.s;\r\n\r\n    // Calculate the antialiasing fade factor. This is either when fading in\r\n    // the line in case of an offset line (v_width2.t) or when fading out\r\n    // (v_width2.s)\r\n    float blur2 = (blur + 1.0 / DEVICE_PIXEL_RATIO) * v_gamma_scale;\r\n    float alpha = clamp(min(dist - (v_width2.t - blur2), v_width2.s - dist) / blur2, 0.0, 1.0);\r\n\r\n    vec4 tmpColor = vec4(color.xyz,0.25);\r\n    gl_FragColor = tmpColor * (alpha * opacity) * drive_opacity;\r\n\r\n#ifdef OVERDRAW_INSPECTOR\r\n    gl_FragColor = vec4(1.0);\r\n#endif\r\n}\r\n",vertexSource:"\r\n\r\n// the distance over which the line edge fades out.\r\n// Retina devices need a smaller distance to avoid aliasing.\r\n#define ANTIALIASING 1.0 / DEVICE_PIXEL_RATIO / 2.0\r\n\r\n// floor(127 / 2) == 63.0\r\n// the maximum allowed miter limit is 2.0 at the moment. the extrude normal is\r\n// stored in a byte (-128..127). we scale regular normals up to length 63, but\r\n// there are also \"special\" normals that have a bigger length (of up to 126 in\r\n// this case).\r\n// #define scale 63.0\r\n#define scale 0.015873016\r\n\r\nattribute vec4 a_pos_normal;\r\nattribute vec4 a_data;\r\nattribute float a_seq;  //hack me\r\n\r\nuniform mat4 u_matrix;\r\nuniform mediump float u_ratio;\r\nuniform vec2 u_gl_units_to_pixels;\r\n\r\nvarying vec2 v_normal;\r\nvarying vec2 v_width2;\r\nvarying float v_gamma_scale;\r\nvarying float v_seq;\r\n\r\n#pragma minemap: define highp vec4 color\r\n#pragma minemap: define lowp float blur\r\n#pragma minemap: define lowp float opacity\r\n#pragma minemap: define mediump float gapwidth\r\n#pragma minemap: define lowp float offset\r\n#pragma minemap: define mediump float width\r\n\r\nvoid main() {\r\n    #pragma minemap: initialize highp vec4 color\r\n    #pragma minemap: initialize lowp float blur\r\n    #pragma minemap: initialize lowp float opacity\r\n    #pragma minemap: initialize mediump float gapwidth\r\n    #pragma minemap: initialize lowp float offset\r\n    #pragma minemap: initialize mediump float width\r\n\r\n    v_seq = a_seq;\r\n\r\n    vec2 a_extrude = a_data.xy - 128.0;\r\n    float a_direction = mod(a_data.z, 4.0) - 1.0;\r\n\r\n    vec2 pos = a_pos_normal.xy;\r\n\r\n    // x is 1 if it's a round cap, 0 otherwise\r\n    // y is 1 if the normal points up, and -1 if it points down\r\n    mediump vec2 normal = a_pos_normal.zw;\r\n    v_normal = normal;\r\n\r\n    // these transformations used to be applied in the JS and native code bases.\r\n    // moved them into the shader for clarity and simplicity.\r\n    gapwidth = gapwidth / 2.0;\r\n    float halfwidth = width / 2.0;\r\n    offset = -1.0 * offset;\r\n\r\n    float inset = gapwidth + (gapwidth > 0.0 ? ANTIALIASING : 0.0);\r\n    float outset = gapwidth + halfwidth * (gapwidth > 0.0 ? 2.0 : 1.0) + ANTIALIASING;\r\n\r\n    // Scale the extrusion vector down to a normal and then up by the line width\r\n    // of this vertex.\r\n    mediump vec2 dist = outset * a_extrude * scale;\r\n\r\n    // Calculate the offset when drawing a line that is to the side of the actual line.\r\n    // We do this by creating a vector that points towards the extrude, but rotate\r\n    // it when we're drawing round end points (a_direction = -1 or 1) since their\r\n    // extrude vector points in another direction.\r\n    mediump float u = 0.5 * a_direction;\r\n    mediump float t = 1.0 - abs(u);\r\n    mediump vec2 offset2 = offset * a_extrude * scale * normal.y * mat2(t, -u, u, t);\r\n\r\n    vec4 projected_extrude = u_matrix * vec4(dist / u_ratio, 0.0, 0.0);\r\n    gl_Position = u_matrix * vec4(pos + offset2 / u_ratio, 0.0, 1.0) + projected_extrude;\r\n\r\n    // calculate how much the perspective view squishes or stretches the extrude\r\n    float extrude_length_without_perspective = length(dist);\r\n    float extrude_length_with_perspective = length(projected_extrude.xy / gl_Position.w * u_gl_units_to_pixels);\r\n    v_gamma_scale = extrude_length_without_perspective / extrude_length_with_perspective;\r\n\r\n    v_width2 = vec2(outset, inset);\r\n}\r\n"},dynamicLine:{fragmentSource:"#pragma minemap: define highp vec4 color\r\n#pragma minemap: define lowp float blur\r\n#pragma minemap: define lowp float opacity\r\n\r\nuniform float u_count;\r\nuniform float u_segments;\r\n\r\nvarying vec2 v_width2;\r\nvarying vec2 v_normal;\r\nvarying float v_gamma_scale;\r\n\r\nvarying float v_seq;\r\nvarying vec2 v_info;\r\n\r\nvoid main() {\r\n    #pragma minemap: initialize highp vec4 color\r\n    #pragma minemap: initialize lowp float blur\r\n    #pragma minemap: initialize lowp float opacity\r\n\r\n    float total_count = v_info[0];\r\n    float offset_count = v_info[1];\r\n    // v_seq2,\r\n    float actualSeq = v_seq - 2.0;\r\n    float actualCount = u_count + offset_count;\r\n    float quotient = floor(actualCount / (total_count + u_segments));\r\n    float mod1 = mod(quotient, 2.0);\r\n    float count = mod(actualCount, total_count + u_segments);\r\n    if(mod1 != 0.0){\r\n        count = total_count + u_segments - count;\r\n    }\r\n\r\n    float start = count - u_segments;\r\n    float end = count;\r\n\r\n    if(actualSeq<start || actualSeq>end){\r\n         discard;\r\n     }\r\n\r\n     mediump float drive_opacity = (actualSeq - start) / u_segments;\r\n     if(mod1 != 0.0){\r\n         drive_opacity = 1.0 - drive_opacity;\r\n     }\r\n\r\n    // Calculate the distance of the pixel from the line in pixels.\r\n    float dist = length(v_normal) * v_width2.s;\r\n\r\n    // Calculate the antialiasing fade factor. This is either when fading in\r\n    // the line in case of an offset line (v_width2.t) or when fading out\r\n    // (v_width2.s)\r\n    float blur2 = (blur + 1.0 / DEVICE_PIXEL_RATIO) * v_gamma_scale;\r\n    float alpha = clamp(min(dist - (v_width2.t - blur2), v_width2.s - dist) / blur2, 0.0, 1.0);\r\n\r\n    vec4 tmpColor = vec4(color.xyz, 0.25);\r\n    gl_FragColor = tmpColor * (alpha * opacity) * drive_opacity;\r\n\r\n#ifdef OVERDRAW_INSPECTOR\r\n    gl_FragColor = vec4(1.0);\r\n#endif\r\n}\r\n",vertexSource:"\r\n\r\n// the distance over which the line edge fades out.\r\n// Retina devices need a smaller distance to avoid aliasing.\r\n#define ANTIALIASING 1.0 / DEVICE_PIXEL_RATIO / 2.0\r\n\r\n// floor(127 / 2) == 63.0\r\n// the maximum allowed miter limit is 2.0 at the moment. the extrude normal is\r\n// stored in a byte (-128..127). we scale regular normals up to length 63, but\r\n// there are also \"special\" normals that have a bigger length (of up to 126 in\r\n// this case).\r\n// #define scale 63.0\r\n#define scale 0.015873016\r\n\r\nattribute vec4 a_pos_normal;\r\nattribute vec4 a_data;\r\nattribute float a_seq;\r\nattribute vec2 a_info;\r\n\r\nuniform mat4 u_matrix;\r\nuniform mediump float u_ratio;\r\nuniform vec2 u_gl_units_to_pixels;\r\n\r\nvarying vec2 v_normal;\r\nvarying vec2 v_width2;\r\nvarying float v_gamma_scale;\r\n\r\nvarying float v_seq;\r\nvarying vec2 v_info;\r\n\r\n#pragma minemap: define highp vec4 color\r\n#pragma minemap: define lowp float blur\r\n#pragma minemap: define lowp float opacity\r\n#pragma minemap: define mediump float gapwidth\r\n#pragma minemap: define lowp float offset\r\n#pragma minemap: define mediump float width\r\n\r\nvoid main() {\r\n    #pragma minemap: initialize highp vec4 color\r\n    #pragma minemap: initialize lowp float blur\r\n    #pragma minemap: initialize lowp float opacity\r\n    #pragma minemap: initialize mediump float gapwidth\r\n    #pragma minemap: initialize lowp float offset\r\n    #pragma minemap: initialize mediump float width\r\n\r\n    v_seq = a_seq;\r\n    v_info = a_info;\r\n\r\n    vec2 a_extrude = a_data.xy - 128.0;\r\n    float a_direction = mod(a_data.z, 4.0) - 1.0;\r\n\r\n    vec2 pos = a_pos_normal.xy;\r\n\r\n    // x is 1 if it's a round cap, 0 otherwise\r\n    // y is 1 if the normal points up, and -1 if it points down\r\n    mediump vec2 normal = a_pos_normal.zw;\r\n    v_normal = normal;\r\n\r\n    // these transformations used to be applied in the JS and native code bases.\r\n    // moved them into the shader for clarity and simplicity.\r\n    gapwidth = gapwidth / 2.0;\r\n    float halfwidth = width / 2.0;\r\n    offset = -1.0 * offset;\r\n\r\n    float inset = gapwidth + (gapwidth > 0.0 ? ANTIALIASING : 0.0);\r\n    float outset = gapwidth + halfwidth * (gapwidth > 0.0 ? 2.0 : 1.0) + ANTIALIASING;\r\n\r\n    // Scale the extrusion vector down to a normal and then up by the line width\r\n    // of this vertex.\r\n    mediump vec2 dist = outset * a_extrude * scale;\r\n\r\n    // Calculate the offset when drawing a line that is to the side of the actual line.\r\n    // We do this by creating a vector that points towards the extrude, but rotate\r\n    // it when we're drawing round end points (a_direction = -1 or 1) since their\r\n    // extrude vector points in another direction.\r\n    mediump float u = 0.5 * a_direction;\r\n    mediump float t = 1.0 - abs(u);\r\n    mediump vec2 offset2 = offset * a_extrude * scale * normal.y * mat2(t, -u, u, t);\r\n\r\n    vec4 projected_extrude = u_matrix * vec4(dist / u_ratio, 0.0, 0.0);\r\n    gl_Position = u_matrix * vec4(pos + offset2 / u_ratio, 0.0, 1.0) + projected_extrude;\r\n\r\n    // calculate how much the perspective view squishes or stretches the extrude\r\n    float extrude_length_without_perspective = length(dist);\r\n    float extrude_length_with_perspective = length(projected_extrude.xy / gl_Position.w * u_gl_units_to_pixels);\r\n    v_gamma_scale = extrude_length_without_perspective / extrude_length_with_perspective;\r\n\r\n    v_width2 = vec2(outset, inset);\r\n}\r\n"},airline:{fragmentSource:"#pragma minemap: define highp vec4 color\r\n#pragma minemap: define lowp float blur\r\n#pragma minemap: define lowp float opacity\r\n\r\nvarying vec2 v_width2;\r\nvarying vec2 v_normal;\r\nvarying float v_gamma_scale;\r\n\r\nvarying float _is_discard;\r\n\r\nvoid main() {\r\n    #pragma minemap: initialize highp vec4 color\r\n    #pragma minemap: initialize lowp float blur\r\n    #pragma minemap: initialize lowp float opacity\r\n    if(_is_discard<0.0) discard;\r\n    // Calculate the distance of the pixel from the line in pixels.\r\n    float dist = length(v_normal) * v_width2.s;\r\n\r\n    // Calculate the antialiasing fade factor. This is either when fading in\r\n    // the line in case of an offset line (v_width2.t) or when fading out\r\n    // (v_width2.s)\r\n    float blur2 = (blur + 1.0 / DEVICE_PIXEL_RATIO) * v_gamma_scale;\r\n    float alpha = clamp(min(dist - (v_width2.t - blur2), v_width2.s - dist) / blur2, 0.0, 1.0);\r\n\r\n    gl_FragColor = color * (alpha * opacity);\r\n\r\n#ifdef OVERDRAW_INSPECTOR\r\n    gl_FragColor = vec4(1.0);\r\n#endif\r\n}\r\n",vertexSource:"\r\n\r\n// the distance over which the line edge fades out.\r\n// Retina devices need a smaller distance to avoid aliasing.\r\n#define ANTIALIASING 1.0 / DEVICE_PIXEL_RATIO / 2.0\r\n\r\n// floor(127 / 2) == 63.0\r\n// the maximum allowed miter limit is 2.0 at the moment. the extrude normal is\r\n// stored in a byte (-128..127). we scale regular normals up to length 63, but\r\n// there are also \"special\" normals that have a bigger length (of up to 126 in\r\n// this case).\r\n// #define scale 63.0\r\n#define scale 0.015873016\r\n\r\nattribute vec4 a_pos_normal;\r\nattribute vec4 a_data;\r\nattribute float a_height;\r\nattribute vec2 a_seq;  //hack me\r\n\r\nuniform mat4 u_matrix;\r\nuniform mediump float u_ratio;\r\nuniform vec2 u_gl_units_to_pixels;\r\n\r\n//hack me\r\nuniform float u_start;\r\nuniform float u_segments;\r\nuniform float u_discard;\r\n\r\nvarying vec2 v_normal;\r\nvarying vec2 v_width2;\r\nvarying float v_gamma_scale;\r\n\r\nvarying float _is_discard;\r\n\r\n#pragma minemap: define highp vec4 color\r\n#pragma minemap: define lowp float blur\r\n#pragma minemap: define lowp float opacity\r\n#pragma minemap: define mediump float gapwidth\r\n#pragma minemap: define lowp float offset\r\n#pragma minemap: define mediump float width\r\n\r\nvoid main() {\r\n    #pragma minemap: initialize highp vec4 color\r\n    #pragma minemap: initialize lowp float blur\r\n    #pragma minemap: initialize lowp float opacity\r\n    #pragma minemap: initialize mediump float gapwidth\r\n    #pragma minemap: initialize lowp float offset\r\n    #pragma minemap: initialize mediump float width\r\n\r\n    float count = mod(u_start,a_seq[1]);\r\n\r\n    _is_discard = 100.0;\r\n     //hack me\r\n    if(u_discard == 1.0){\r\n        if((count+u_segments)<=a_seq[1] && (a_seq[0]<(count) || a_seq[0]>(count+u_segments))){\r\n             _is_discard = -100.0;\r\n        }else if((count+u_segments)>a_seq[1] && (a_seq[0]> (count+u_segments-a_seq[1]) && a_seq[0]<count)){\r\n             _is_discard = -100.0;\r\n        }\r\n    }\r\n\r\n    vec2 a_extrude = a_data.xy - 128.0;\r\n    float a_direction = mod(a_data.z, 4.0) - 1.0;\r\n\r\n    vec2 pos = a_pos_normal.xy;\r\n\r\n    // x is 1 if it's a round cap, 0 otherwise\r\n    // y is 1 if the normal points up, and -1 if it points down\r\n    mediump vec2 normal = a_pos_normal.zw;\r\n    v_normal = normal;\r\n\r\n    // these transformations used to be applied in the JS and native code bases.\r\n    // moved them into the shader for clarity and simplicity.\r\n    gapwidth = gapwidth / 2.0;\r\n    float halfwidth = width / 2.0;\r\n    offset = -1.0 * offset;\r\n\r\n    float inset = gapwidth + (gapwidth > 0.0 ? ANTIALIASING : 0.0);\r\n    float outset = gapwidth + halfwidth * (gapwidth > 0.0 ? 2.0 : 1.0) + ANTIALIASING;\r\n\r\n    // Scale the extrusion vector down to a normal and then up by the line width\r\n    // of this vertex.\r\n    mediump vec2 dist = outset * a_extrude * scale;\r\n\r\n    // Calculate the offset when drawing a line that is to the side of the actual line.\r\n    // We do this by creating a vector that points towards the extrude, but rotate\r\n    // it when we're drawing round end points (a_direction = -1 or 1) since their\r\n    // extrude vector points in another direction.\r\n    mediump float u = 0.5 * a_direction;\r\n    mediump float t = 1.0 - abs(u);\r\n    mediump vec2 offset2 = offset * a_extrude * scale * normal.y * mat2(t, -u, u, t);\r\n\r\n    vec4 projected_extrude = u_matrix * vec4(dist / u_ratio, 0.0, 0.0);\r\n    gl_Position = u_matrix * vec4(pos + offset2 / u_ratio, a_height * 10.0, 1.0) + projected_extrude;\r\n\r\n    // calculate how much the perspective view squishes or stretches the extrude\r\n    float extrude_length_without_perspective = length(dist);\r\n    float extrude_length_with_perspective = length(projected_extrude.xy / gl_Position.w * u_gl_units_to_pixels);\r\n    v_gamma_scale = extrude_length_without_perspective / extrude_length_with_perspective;\r\n\r\n    v_width2 = vec2(outset, inset);\r\n}\r\n"}},re=/#pragma minemap: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,loop=function(r){var e=shaders[r],n={};e.fragmentSource=e.fragmentSource.replace(re,function(r,e,a,t,i){return n[i]=!0,"define"===e?"\n#ifndef HAS_UNIFORM_u_"+i+"\nvarying "+a+" "+t+" "+i+";\n#else\nuniform "+a+" "+t+" u_"+i+";\n#endif\n":"\n#ifdef HAS_UNIFORM_u_"+i+"\n    "+a+" "+t+" "+i+" = u_"+i+";\n#endif\n"}),e.vertexSource=e.vertexSource.replace(re,function(r,e,a,t,i){var o="float"===t?"vec2":"vec4";return n[i]?"define"===e?"\n#ifndef HAS_UNIFORM_u_"+i+"\nuniform lowp float a_"+i+"_t;\nattribute "+a+" "+o+" a_"+i+";\nvarying "+a+" "+t+" "+i+";\n#else\nuniform "+a+" "+t+" u_"+i+";\n#endif\n":"\n#ifndef HAS_UNIFORM_u_"+i+"\n    "+i+" = unpack_mix_"+o+"(a_"+i+", a_"+i+"_t);\n#else\n    "+a+" "+t+" "+i+" = u_"+i+";\n#endif\n":"define"===e?"\n#ifndef HAS_UNIFORM_u_"+i+"\nuniform lowp float a_"+i+"_t;\nattribute "+a+" "+o+" a_"+i+";\n#else\nuniform "+a+" "+t+" u_"+i+";\n#endif\n":"\n#ifndef HAS_UNIFORM_u_"+i+"\n    "+a+" "+t+" "+i+" = unpack_mix_"+o+"(a_"+i+", a_"+i+"_t);\n#else\n    "+a+" "+t+" "+i+" = u_"+i+";\n#endif\n"})};for(var programName in shaders)loop(programName);module.exports=shaders;
},{}],119:[function(_dereq_,module,exports){
"use strict";var ImageSource=_dereq_("./image_source"),window=_dereq_("../util/window"),rasterBoundsAttributes=_dereq_("../data/raster_bounds_attributes"),VertexArrayObject=_dereq_("../render/vertex_array_object"),Texture=_dereq_("../render/texture"),ErrorEvent=_dereq_("../util/evented").ErrorEvent,CanvasSource=function(t){function e(e,i,s,r){t.call(this,e,i,s,r),this.options=i,this.animate=void 0===i.animate||i.animate}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.load=function(){if(this.canvas=this.canvas||window.document.getElementById(this.options.canvas),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions())return void this.fire(new ErrorEvent(new Error("Canvas dimensions cannot be less than or equal to zero.")));this.play=function(){this._playing=!0,this.map._rerender()},this.pause=function(){this._playing=!1},this._finishLoading()},e.prototype.getCanvas=function(){return this.canvas},e.prototype.onAdd=function(t){this.map=t,this.load(),this.canvas&&this.animate&&this.play()},e.prototype.onRemove=function(){this.pause()},e.prototype.prepare=function(){var t=this,e=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,e=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,e=!0),!this._hasInvalidDimensions()&&0!==Object.keys(this.tiles).length){var i=this.map.painter.context,s=i.gl;this.boundsBuffer||(this.boundsBuffer=i.createVertexBuffer(this._boundsArray,rasterBoundsAttributes.members)),this.boundsVAO||(this.boundsVAO=new VertexArrayObject),this.texture?e?this.texture.update(this.canvas):this._playing&&(this.texture.bind(s.LINEAR,s.CLAMP_TO_EDGE),s.texSubImage2D(s.TEXTURE_2D,0,0,0,s.RGBA,s.UNSIGNED_BYTE,this.canvas)):(this.texture=new Texture(i,this.canvas,s.RGBA),this.texture.bind(s.LINEAR,s.CLAMP_TO_EDGE));for(var r in t.tiles){var n=t.tiles[r];"loaded"!==n.state&&(n.state="loaded",n.texture=t.texture)}}},e.prototype.serialize=function(){return{type:"canvas",canvas:this.canvas,coordinates:this.coordinates}},e.prototype.hasTransition=function(){return this._playing},e.prototype._hasInvalidDimensions=function(){for(var t=this,e=0,i=[t.canvas.width,t.canvas.height];e<i.length;e+=1){var s=i[e];if(isNaN(s)||s<=0)return!0}return!1},e}(ImageSource);module.exports=CanvasSource;
},{"../data/raster_bounds_attributes":73,"../render/texture":114,"../render/vertex_array_object":116,"../util/evented":295,"../util/window":288,"./image_source":123}],120:[function(_dereq_,module,exports){
"use strict";function resolveURL(e){var t=window.document.createElement("a");return t.href=e,t.href}var Evented=_dereq_("../util/evented").Evented,Event=_dereq_("../util/evented").Event,ErrorEvent=_dereq_("../util/evented").ErrorEvent,util=_dereq_("../util/util"),window=_dereq_("../util/window"),EXTENT=_dereq_("../data/extent"),ResourceType=_dereq_("../util/ajax").ResourceType,browser=_dereq_("../util/browser"),GeoJSONSource=function(e){function t(t,i,r,o){e.call(this),this.id=t,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this.dispatcher=r,this.setEventedParent(o),this._data=i.data,this._options=util.extend({},i),this._collectResourceTiming=i.collectResourceTiming,this._resourceTiming=[],void 0!==i.maxzoom&&(this.maxzoom=i.maxzoom),i.type&&(this.type=i.type);var s=EXTENT/this.tileSize;this.workerOptions=util.extend({source:this.id,cluster:i.cluster||!1,geojsonVtOptions:{buffer:(void 0!==i.buffer?i.buffer:128)*s,tolerance:(void 0!==i.tolerance?i.tolerance:.375)*s,extent:EXTENT,maxZoom:this.maxzoom},superclusterOptions:{maxZoom:void 0!==i.clusterMaxZoom?Math.min(i.clusterMaxZoom,this.maxzoom-1):this.maxzoom-1,extent:EXTENT,radius:(i.clusterRadius||50)*s,log:!1,enableQueryChildren:i.enableQueryChildren}},i.workerOptions)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.load=function(){var e=this;this.fire(new Event("dataloading",{dataType:"source"})),this._updateWorkerData(function(t){if(t)return void e.fire(new ErrorEvent(t));var i={dataType:"source",sourceDataType:"metadata"};e._collectResourceTiming&&e._resourceTiming&&e._resourceTiming.length>0&&(i.resourceTiming=e._resourceTiming,e._resourceTiming=[]),e.fire(new Event("data",i))})},t.prototype.onAdd=function(e){this.map=e,this.load()},t.prototype.setData=function(e){var t=this;return this._data=e,this.fire(new Event("dataloading",{dataType:"source"})),this._updateWorkerData(function(e){if(e)return t.fire(new ErrorEvent(e));var i={dataType:"source",sourceDataType:"content"};t._collectResourceTiming&&t._resourceTiming&&t._resourceTiming.length>0&&(i.resourceTiming=t._resourceTiming,t._resourceTiming=[]),t.fire(new Event("data",i))}),this},t.prototype._updateWorkerData=function(e){var t=this,i=util.extend({},this.workerOptions),r=this._data;"string"==typeof r?(i.request=this.map._transformRequest(resolveURL(r),ResourceType.Source),i.request.collectResourceTiming=this._collectResourceTiming):i.data=JSON.stringify(r),this.workerID=this.dispatcher.send(this.type+"."+i.source+".loadData",i,function(r,o){t._removed||o&&o.abandoned||(t._loaded=!0,o&&o.resourceTiming&&o.resourceTiming[t.id]&&(t._resourceTiming=o.resourceTiming[t.id].slice(0)),t.dispatcher.send(t.type+"."+i.source+".coalesce",null,null,t.workerID),e(r))},this.workerID)},t.prototype.loadTile=function(e,t){var i=this,r=void 0===e.workerID?"loadTile":"reloadTile",o={type:this.type,uid:e.uid,tileID:e.tileID,zoom:e.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:browser.devicePixelRatio,overscaling:e.tileID.overscaleFactor(),showCollisionBoxes:this.map.showCollisionBoxes};e.workerID=this.dispatcher.send(r,o,function(o,s){return e.unloadVectorData(),e.aborted?t(null):o?t(o):(e.loadVectorData(s,i.map.painter,"reloadTile"===r),t(null))},this.workerID)},t.prototype.abortTile=function(e){e.aborted=!0},t.prototype.unloadTile=function(e){e.unloadVectorData(),this.dispatcher.send("removeTile",{uid:e.uid,type:this.type,source:this.id},null,e.workerID)},t.prototype.onRemove=function(){this._removed=!0,this.dispatcher.send("removeSource",{type:this.type,source:this.id},null,this.workerID)},t.prototype.serialize=function(){return util.extend({},this._options,{type:this.type,data:this._data})},t.prototype.hasTransition=function(){return!1},t}(Evented);module.exports=GeoJSONSource;
},{"../data/extent":67,"../util/ajax":285,"../util/browser":286,"../util/evented":295,"../util/util":315,"../util/window":288}],121:[function(_dereq_,module,exports){
"use strict";function loadGeoJSONTile(e,t){var r=e.tileID.canonical;if(!this._geoJSONIndex)return t(null,null);var a=this._geoJSONIndex.getTile(r.z,r.x,r.y);if(!a)return t(null,null);var o=new GeoJSONWrapper(a.features),i=vtpbf(o);0===i.byteOffset&&i.byteLength===i.buffer.byteLength||(i=new Uint8Array(i)),t(null,{vectorTile:o,rawData:i.buffer})}var ajax=_dereq_("../util/ajax"),rewind=_dereq_("../_minemap_/geojson-rewind"),GeoJSONWrapper=_dereq_("./geojson_wrapper"),vtpbf=_dereq_("../_minemap_/vt-pbf"),supercluster=_dereq_("../_minemap_/supercluster"),geojsonvt=_dereq_("../_minemap_/geojson-vt"),VectorTileWorkerSource=_dereq_("./vector_tile_worker_source"),GeoJSONWorkerSource=function(e){function t(t,r,a){e.call(this,t,r,loadGeoJSONTile),a&&(this.loadGeoJSON=a)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.loadData=function(e,t){this._pendingCallback&&this._pendingCallback(null,{abandoned:!0}),this._pendingCallback=t,this._pendingLoadDataParams=e,this._state&&"Idle"!==this._state?this._state="NeedsLoadData":(this._state="Coalescing",this._loadData())},t.prototype._loadData=function(){var e=this;if(this._pendingCallback&&this._pendingLoadDataParams){var t=this._pendingCallback,r=this._pendingLoadDataParams;delete this._pendingCallback,delete this._pendingLoadDataParams,this.loadGeoJSON(r,function(a,o){if(a||!o)return t(a);if("object"!=typeof o)return t(new Error("Input data is not a valid GeoJSON object."));rewind(o,!0);try{e._geoJSONIndex=r.cluster?supercluster(r.superclusterOptions).load(o.features):geojsonvt(o,r.geojsonVtOptions)}catch(a){return t(a)}e.loaded={};var i={};if(r.request&&r.request.collectResourceTiming){var n=perf.getEntriesByName(r.request.url);n&&(i.resourceTiming={},i.resourceTiming[r.source]=JSON.parse(JSON.stringify(n)))}t(null,i)})}},t.prototype.coalesce=function(){"Coalescing"===this._state?this._state="Idle":"NeedsLoadData"===this._state&&(this._state="Coalescing",this._loadData())},t.prototype.reloadTile=function(t,r){var a=this.loaded,o=t.uid;return a&&a[o]?e.prototype.reloadTile.call(this,t,r):this.loadTile(t,r)},t.prototype.loadGeoJSON=function(e,t){if(e.request)ajax.getJSON(e.request,t);else{if("string"!=typeof e.data)return t(new Error("Input data is not a valid GeoJSON object."));try{return t(null,JSON.parse(e.data))}catch(e){return t(new Error("Input data is not a valid GeoJSON object."))}}},t.prototype.removeSource=function(e,t){this._pendingCallback&&this._pendingCallback(null,{abandoned:!0}),t()},t}(VectorTileWorkerSource);module.exports=GeoJSONWorkerSource;
},{"../_minemap_/geojson-rewind":18,"../_minemap_/geojson-vt":22,"../_minemap_/supercluster":31,"../_minemap_/vt-pbf":38,"../util/ajax":285,"./geojson_wrapper":122,"./vector_tile_worker_source":136}],122:[function(_dereq_,module,exports){
"use strict";var Point=_dereq_("../_minemap_/point-geometry"),toGeoJSON=_dereq_("../_minemap_/vector-tile").VectorTileFeature.prototype.toGeoJSON,EXTENT=_dereq_("../data/extent"),FeatureWrapper=function(e){this._feature=e,this.extent=EXTENT,this.type=e.type,this.properties=e.tags,"id"in e&&!isNaN(e.id)&&(this.id=parseInt(e.id,10))};FeatureWrapper.prototype.loadGeometry=function(){var e=this;if(1===this._feature.type){for(var t=[],r=0,o=e._feature.geometry;r<o.length;r+=1){var i=o[r];t.push([new(Function.prototype.bind.apply(Point,[null].concat(i)))])}return t}for(var n=[],a=0,p=e._feature.geometry;a<p.length;a+=1){for(var u=p[a],s=[],h=0,l=u;h<l.length;h+=1){var y=l[h];s.push(new(Function.prototype.bind.apply(Point,[null].concat(y))))}n.push(s)}return n},FeatureWrapper.prototype.toGeoJSON=function(e,t,r){return toGeoJSON.call(this,e,t,r)};var GeoJSONWrapper=function(e){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=EXTENT,this.length=e.length,this._features=e};GeoJSONWrapper.prototype.feature=function(e){return new FeatureWrapper(this._features[e])},module.exports=GeoJSONWrapper;
},{"../_minemap_/point-geometry":29,"../_minemap_/vector-tile":34,"../data/extent":67}],123:[function(_dereq_,module,exports){
"use strict";var util=_dereq_("../util/util"),ref=_dereq_("./tile_id"),CanonicalTileID=ref.CanonicalTileID,LngLat=_dereq_("../geo/lng_lat"),Point=_dereq_("../_minemap_/point-geometry"),Evented=_dereq_("../util/evented").Evented,Event=_dereq_("../util/evented").Event,ErrorEvent=_dereq_("../util/evented").ErrorEvent,ajax=_dereq_("../util/ajax"),browser=_dereq_("../util/browser"),EXTENT=_dereq_("../data/extent"),ref$1=_dereq_("../data/array_types"),RasterBoundsArray=ref$1.RasterBoundsArray,rasterBoundsAttributes=_dereq_("../data/raster_bounds_attributes"),VertexArrayObject=_dereq_("../render/vertex_array_object"),Texture=_dereq_("../render/texture"),ImageSource=function(t){function e(e,r,o,i){t.call(this),this.id=e,this.dispatcher=o,this.coordinates=r.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this.setEventedParent(i),this.options=r}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.load=function(){var t=this;this.fire(new Event("dataloading",{dataType:"source"})),this.url=this.options.url,ajax.getImage(this.map._transformRequest(this.url,ajax.ResourceType.Image),function(e,r){e?t.fire(new ErrorEvent(e)):r&&(t.image=browser.getImageData(r),t._finishLoading())})},e.prototype._finishLoading=function(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new Event("data",{dataType:"source",sourceDataType:"metadata"})))},e.prototype.onAdd=function(t){this.map=t,this.load()},e.prototype.setCoordinates=function(t){this.coordinates=t;var e=this.map,r=t.map(function(t){return e.transform.locationCoordinate(LngLat.convert(t)).zoomTo(0)}),o=this.centerCoord=util.getCoordinatesCenter(r);o.column=Math.floor(o.column),o.row=Math.floor(o.row),this.tileID=new CanonicalTileID(o.zoom,o.column,o.row),this.minzoom=this.maxzoom=o.zoom;var i=r.map(function(t){var e=t.zoomTo(o.zoom);return new Point(Math.round((e.column-o.column)*EXTENT),Math.round((e.row-o.row)*EXTENT))});return this._boundsArray=new RasterBoundsArray,this._boundsArray.emplaceBack(i[0].x,i[0].y,0,0),this._boundsArray.emplaceBack(i[1].x,i[1].y,EXTENT,0),this._boundsArray.emplaceBack(i[3].x,i[3].y,0,EXTENT),this._boundsArray.emplaceBack(i[2].x,i[2].y,EXTENT,EXTENT),this.boundsBuffer&&(this.boundsBuffer.destroy(),delete this.boundsBuffer),this.fire(new Event("data",{dataType:"source",sourceDataType:"content"})),this},e.prototype.prepare=function(){var t=this;if(0!==Object.keys(this.tiles).length&&this.image){var e=this.map.painter.context,r=e.gl;this.boundsBuffer||(this.boundsBuffer=e.createVertexBuffer(this._boundsArray,rasterBoundsAttributes.members)),this.boundsVAO||(this.boundsVAO=new VertexArrayObject),this.texture||(this.texture=new Texture(e,this.image,r.RGBA),this.texture.bind(r.LINEAR,r.CLAMP_TO_EDGE));for(var o in t.tiles){var i=t.tiles[o];"loaded"!==i.state&&(i.state="loaded",i.texture=t.texture)}}},e.prototype.loadTile=function(t,e){this.tileID&&this.tileID.equals(t.tileID.canonical)?(this.tiles[String(t.tileID.wrap)]=t,t.buckets={},e(null)):(t.state="errored",e(null))},e.prototype.serialize=function(){return{type:"image",url:this.options.url,coordinates:this.coordinates}},e.prototype.hasTransition=function(){return!1},e}(Evented);module.exports=ImageSource;
},{"../_minemap_/point-geometry":29,"../data/array_types":41,"../data/extent":67,"../data/raster_bounds_attributes":73,"../geo/lng_lat":76,"../render/texture":114,"../render/vertex_array_object":116,"../util/ajax":285,"../util/browser":286,"../util/evented":295,"../util/util":315,"./tile_id":134}],124:[function(_dereq_,module,exports){
"use strict";var util=_dereq_("../util/util"),ajax=_dereq_("../util/ajax"),browser=_dereq_("../util/browser"),normalizeURL=_dereq_("../util/minemap").normalizeSourceURL;module.exports=function(r,e,i){var u=function(r,e){if(r)return i(r);if(e){var u=util.pick(e,["tiles","minzoom","maxzoom","attribution","minemap_logo","bounds"]);e.vector_layers&&(u.vectorLayers=e.vector_layers,u.vectorLayerIds=u.vectorLayers.map(function(r){return r.id})),i(null,u)}};r.url?ajax.getJSON(e(normalizeURL(r.url),ajax.ResourceType.Source),u):browser.frame(function(){return u(null,r)})};
},{"../util/ajax":285,"../util/browser":286,"../util/minemap":304,"../util/util":315}],125:[function(_dereq_,module,exports){
"use strict";var EXTENT=_dereq_("../data/extent");module.exports=function(e,t,r){return t*(EXTENT/(e.tileSize*Math.pow(2,r-e.tileID.overscaledZ)))};
},{"../data/extent":67}],126:[function(_dereq_,module,exports){
"use strict";function sortTilesIn(e,r){var a=e.tileID,t=r.tileID;return a.overscaledZ-t.overscaledZ||a.canonical.y-t.canonical.y||a.wrap-t.wrap||a.canonical.x-t.canonical.x}function mergeRenderedFeatureLayers(e){for(var r={},a={},t=0,n=e;t<n.length;t+=1){var u=n[t],l=u.queryResults,o=u.wrappedTileID,s=a[o]=a[o]||{};for(var i in l)for(var c=l[i],d=s[i]=s[i]||{},p=r[i]=r[i]||[],y=0,f=c;y<f.length;y+=1){var I=f[y];d[I.featureIndex]||(d[I.featureIndex]=!0,p.push(I.feature))}}return r}exports.queryRenderedFeatures=function(e,r,a,t,n,u){var l=n.maxPitchScaleFactor(),o=e.tilesIn(a,l);o.sort(sortTilesIn);for(var s=[],i=0,c=o;i<c.length;i+=1){var d=c[i];s.push({wrappedTileID:d.tileID.wrapped().key,queryResults:d.tile.queryRenderedFeatures(r,d.queryGeometry,d.scale,t,n,l,e.transform.calculatePosMatrix(d.tileID.toUnwrapped()),e.id,u)})}return mergeRenderedFeatureLayers(s)},exports.querySourceFeatures=function(e,r){for(var a=e.getRenderableIds().map(function(r){return e.getTileByID(r)}),t=[],n={},u=0;u<a.length;u++){var l=a[u],o=l.tileID.canonical.key;n[o]||(n[o]=!0,l.querySourceFeatures(t,r))}return t};
},{}],127:[function(_dereq_,module,exports){
"use strict";var ajax=_dereq_("../util/ajax"),util=_dereq_("../util/util"),Evented=_dereq_("../util/evented").Evented,Event=_dereq_("../util/evented").Event,ErrorEvent=_dereq_("../util/evented").ErrorEvent,normalizeURL=_dereq_("../util/minemap").normalizeTileURL,browser=_dereq_("../util/browser"),ref=_dereq_("./tile_id"),OverscaledTileID=ref.OverscaledTileID,RasterTileSource=_dereq_("./raster_tile_source"),RasterDEMTileSource=function(e){function i(i,r,t,l){e.call(this,i,r,t,l),this.type="raster-dem",this.maxzoom=22,this._options=extend({},r),this.encoding=r.encoding||"minemap"}return e&&(i.__proto__=e),i.prototype=Object.create(e&&e.prototype),i.prototype.constructor=i,i.prototype.serialize=function(){return{type:"raster-dem",url:this.url,tileSize:this.tileSize,tiles:this.tiles,bounds:this.bounds,encoding:this.encoding}},i.prototype.loadTile=function(e,i){function r(r,l){if(delete e.request,e.aborted)e.state="unloaded",i(null);else if(r)e.state="errored",i(r);else if(l){this.map._refreshExpiredTiles&&e.setExpiryData(l),delete l.cacheControl,delete l.expires;var s=browser.getImageData(l),a={uid:e.uid,coord:e.tileID,source:this.id,rawImageData:s,encoding:this.encoding};e.workerID&&"expired"!==e.state||(e.workerID=this.dispatcher.send("loadDEMTile",a,t.bind(this)))}}function t(r,t){r&&(e.state="errored",i(r)),t&&(e.dem=t,e.needsHillshadePrepare=!0,e.state="loaded",i(null))}var l=normalizeURL(e.tileID.canonical.url(this.tiles,this.scheme),this.url,this.tileSize);e.request=getImage(this.map._transformRequest(l,ResourceType.Tile),r.bind(this)),e.neighboringTiles=this._getNeighboringTiles(e.tileID)},i.prototype._getNeighboringTiles=function(e){var i=e.canonical,r=Math.pow(2,i.z),t=(i.x-1+r)%r,l=0===i.x?e.wrap-1:e.wrap,s=(i.x+1+r)%r,a=i.x+1===r?e.wrap+1:e.wrap,o={};return o[new OverscaledTileID(e.overscaledZ,l,i.z,t,i.y).key]={backfilled:!1},o[new OverscaledTileID(e.overscaledZ,a,i.z,s,i.y).key]={backfilled:!1},i.y>0&&(o[new OverscaledTileID(e.overscaledZ,l,i.z,t,i.y-1).key]={backfilled:!1},o[new OverscaledTileID(e.overscaledZ,e.wrap,i.z,i.x,i.y-1).key]={backfilled:!1},o[new OverscaledTileID(e.overscaledZ,a,i.z,s,i.y-1).key]={backfilled:!1}),i.y+1<r&&(o[new OverscaledTileID(e.overscaledZ,l,i.z,t,i.y+1).key]={backfilled:!1},o[new OverscaledTileID(e.overscaledZ,e.wrap,i.z,i.x,i.y+1).key]={backfilled:!1},o[new OverscaledTileID(e.overscaledZ,a,i.z,s,i.y+1).key]={backfilled:!1}),o},i.prototype.unloadTile=function(e){e.demTexture&&this.map.painter.saveTileTexture(e.demTexture),e.fbo&&(e.fbo.destroy(),delete e.fbo),e.dem&&delete e.dem,delete e.neighboringTiles,e.state="unloaded",this.dispatcher.send("removeDEMTile",{uid:e.uid,source:this.id},void 0,e.workerID)},i}(RasterTileSource);module.exports=RasterDEMTileSource;
},{"../util/ajax":285,"../util/browser":286,"../util/evented":295,"../util/minemap":304,"../util/util":315,"./raster_tile_source":129,"./tile_id":134}],128:[function(_dereq_,module,exports){
"use strict";var ref=_dereq_("../data/dem_data"),DEMData=ref.DEMData,RasterDEMTileWorkerSource=function(){this.loading={},this.loaded={}};RasterDEMTileWorkerSource.prototype.loadTile=function(e,a){var o=e.uid,r=e.encoding,t=new DEMData(o);this.loading[o]=t,t.loadFromImage(e.rawImageData,r),delete this.loading[o],this.loaded=this.loaded||{},this.loaded[o]=t,a(null,t)},RasterDEMTileWorkerSource.prototype.removeTile=function(e){var a=this.loaded,o=e.uid;a&&a[o]&&delete a[o]},module.exports=RasterDEMTileWorkerSource;
},{"../data/dem_data":66}],129:[function(_dereq_,module,exports){
"use strict";var util=_dereq_("../util/util"),ajax=_dereq_("../util/ajax"),Evented=_dereq_("../util/evented").Evented,Event=_dereq_("../util/evented").Event,ErrorEvent=_dereq_("../util/evented").ErrorEvent,loadTileJSON=_dereq_("./load_tilejson"),normalizeURL=_dereq_("../util/minemap").normalizeTileURL,TileBounds=_dereq_("./tile_bounds"),Texture=_dereq_("../render/texture"),RasterTileSource=function(e){function t(t,i,r,o){e.call(this),this.id=t,this.dispatcher=r,this.setEventedParent(o),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=util.extend({},i),util.extend(this,util.pick(i,["url","scheme","tileSize"]))}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.load=function(){var e=this;this.fire(new Event("dataloading",{dataType:"source"})),loadTileJSON(this._options,this.map._transformRequest,function(t,i){t?e.fire(new ErrorEvent(t)):i&&(util.extend(e,i),i.bounds&&(e.tileBounds=new TileBounds(i.bounds,e.minzoom,e.maxzoom)),e.fire(new Event("data",{dataType:"source",sourceDataType:"metadata"})),e.fire(new Event("data",{dataType:"source",sourceDataType:"content"})))})},t.prototype.onAdd=function(e){this.map=e,this.load()},t.prototype.serialize=function(){return util.extend({},this._options)},t.prototype.hasTile=function(e){return!this.tileBounds||this.tileBounds.contains(e.canonical)},t.prototype.loadTile=function(e,t){var i=this,r=normalizeURL(e.tileID.canonical.url(this.tiles,this.scheme),this.url,this.tileSize);e.request=ajax.getImage(this.map._transformRequest(r,ajax.ResourceType.Tile),function(r,o){if(delete e.request,e.aborted)e.state="unloaded",t(null);else if(r)e.state="errored",t(r);else if(o){i.map._refreshExpiredTiles&&e.setExpiryData(o),delete o.cacheControl,delete o.expires;var n=i.map.painter.context,a=n.gl;e.texture=i.map.painter.getTileTexture(o.width),e.texture?(e.texture.bind(a.LINEAR,a.CLAMP_TO_EDGE,a.LINEAR_MIPMAP_NEAREST),a.texSubImage2D(a.TEXTURE_2D,0,0,0,a.RGBA,a.UNSIGNED_BYTE,o)):(e.texture=new Texture(n,o,a.RGBA),e.texture.bind(a.LINEAR,a.CLAMP_TO_EDGE,a.LINEAR_MIPMAP_NEAREST),n.extTextureFilterAnisotropic&&a.texParameterf(a.TEXTURE_2D,n.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,n.extTextureFilterAnisotropicMax)),a.generateMipmap(a.TEXTURE_2D),e.state="loaded",t(null)}})},t.prototype.abortTile=function(e,t){e.request&&(e.request.abort(),delete e.request),t()},t.prototype.unloadTile=function(e,t){e.texture&&this.map.painter.saveTileTexture(e.texture),t()},t.prototype.hasTransition=function(){return!1},t}(Evented);module.exports=RasterTileSource;
},{"../render/texture":114,"../util/ajax":285,"../util/evented":295,"../util/minemap":304,"../util/util":315,"./load_tilejson":124,"./tile_bounds":133}],130:[function(_dereq_,module,exports){
"use strict";var util=_dereq_("../util/util"),sourceTypes={vector:_dereq_("../source/vector_tile_source"),raster:_dereq_("../source/raster_tile_source"),"raster-dem":_dereq_("../source/raster_dem_tile_source"),geojson:_dereq_("../source/geojson_source"),video:_dereq_("../source/video_source"),image:_dereq_("../source/image_source"),canvas:_dereq_("../source/canvas_source")};exports.create=function(e,r,o,s){var u=new sourceTypes[r.type](e,r,o,s);if(u.id!==e)throw new Error("Expected Source id to be "+e+" instead of "+u.id);return util.bindAll(["load","abort","unload","serialize","prepare"],u),u},exports.getType=function(e){return sourceTypes[e]},exports.setType=function(e,r){sourceTypes[e]=r};
},{"../source/canvas_source":119,"../source/geojson_source":120,"../source/image_source":123,"../source/raster_dem_tile_source":127,"../source/raster_tile_source":129,"../source/vector_tile_source":135,"../source/video_source":137,"../util/util":315}],131:[function(_dereq_,module,exports){
"use strict";function coordinateToTilePoint(e,t){var i=t.zoomTo(e.canonical.z);return new Point((i.column-(e.canonical.x+e.wrap*Math.pow(2,e.canonical.z)))*EXTENT,(i.row-e.canonical.y)*EXTENT)}function isRasterType(e){return"raster"===e||"image"===e||"video"===e}var createSource=_dereq_("./source").create,Tile=_dereq_("./tile"),Evented=_dereq_("../util/evented").Evented,Event=_dereq_("../util/evented").Event,ErrorEvent=_dereq_("../util/evented").ErrorEvent,Cache=_dereq_("../util/lru_cache"),Coordinate=_dereq_("../geo/coordinate"),util=_dereq_("../util/util"),EXTENT=_dereq_("../data/extent"),Context=_dereq_("../gl/context"),Point=_dereq_("../_minemap_/point-geometry"),browser=_dereq_("../util/browser"),ref=_dereq_("./tile_id"),OverscaledTileID=ref.OverscaledTileID,SourceCache=function(e){function t(t,i,r){var o=this;e.call(this),this.id=t,this.dispatcher=r,this.on("data",function(e){"source"===e.dataType&&"metadata"===e.sourceDataType&&(o._sourceLoaded=!0),o._sourceLoaded&&!o._paused&&"source"===e.dataType&&"content"===e.sourceDataType&&(o.reload(),o.transform&&o.update(o.transform))}),this.on("error",function(){o._sourceErrored=!0}),this._source=createSource(t,i,r,this),this._tiles={},this._cache=new Cache(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._isIdRenderable=this._isIdRenderable.bind(this),this._coveredTiles={}}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.onAdd=function(e){this.map=e,this._maxTileCacheSize=e?e._maxTileCacheSize:null,this._source&&this._source.onAdd&&this._source.onAdd(e)},t.prototype.onRemove=function(e){this._source&&this._source.onRemove&&this._source.onRemove(e)},t.prototype.loaded=function(){var e=this;if(this._sourceErrored)return!0;if(!this._sourceLoaded)return!1;for(var t in e._tiles){var i=e._tiles[t];if("loaded"!==i.state&&"errored"!==i.state)return!1}return!0},t.prototype.getSource=function(){return this._source},t.prototype.pause=function(){this._paused=!0},t.prototype.resume=function(){if(this._paused){var e=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,e&&this.reload(),this.transform&&this.update(this.transform)}},t.prototype._loadTile=function(e,t){return this._source.loadTile(e,t)},t.prototype._unloadTile=function(e){if(this._source.unloadTile)return this._source.unloadTile(e,function(){})},t.prototype._abortTile=function(e){if(this._source.abortTile)return this._source.abortTile(e,function(){})},t.prototype.serialize=function(){return this._source.serialize()},t.prototype.prepare=function(e){var t=this;this._source.prepare&&this._source.prepare();for(var i in t._tiles)t._tiles[i].upload(e)},t.prototype.getIds=function(){var e=this,t=function(t,i){var r=e._tiles[t].tileID,o=e._tiles[i].tileID,a=new Point(r.canonical.x,r.canonical.y).rotate(e.transform.angle),s=new Point(o.canonical.x,o.canonical.y).rotate(e.transform.angle);return r.overscaledZ-o.overscaledZ||s.y-a.y||s.x-a.x};return Object.keys(this._tiles).map(Number).sort(t)},t.prototype.getRenderableIds=function(){return this.getIds().filter(this._isIdRenderable)},t.prototype.hasRenderableParent=function(e){var t=this.findLoadedParent(e,0,{});return!!t&&this._isIdRenderable(t.tileID.key)},t.prototype._isIdRenderable=function(e){return this._tiles[e]&&this._tiles[e].hasData()&&!this._coveredTiles[e]},t.prototype.reload=function(){var e=this;if(this._paused)return void(this._shouldReloadOnResume=!0);if(this._resetCache(),this._source._options&&this._source._options.traffic)for(var t in e._tiles)e._reloadTile(t,"expired");else for(var i in e._tiles)e._reloadTile(i,"reloading")},t.prototype._reloadTile=function(e,t){var i=this._tiles[e];i&&("loading"!==i.state&&(i.state=t),this._loadTile(i,this._tileLoaded.bind(this,i,e,t)))},t.prototype._tileLoaded=function(e,t,i,r){if(r)return e.state="errored",void(404!==r.status?this._source.fire(new ErrorEvent(r,{tile:e})):this.update(this.transform));e.timeAdded=browser.now(),"expired"===i&&(e.refreshedUponExpiration=!0),this._setTileReloadTimer(t,e),"raster-dem"===this.getSource().type&&e.dem&&this._backfillDEM(e),this._source.fire(new Event("data",{dataType:"source",tile:e,coord:e.tileID})),this.map&&(this.map.painter.tileExtentVAO.vao=null)},t.prototype._backfillDEM=function(e){function t(e,t){e.needsHillshadePrepare=!0;var i=t.tileID.canonical.x-e.tileID.canonical.x,r=t.tileID.canonical.y-e.tileID.canonical.y,o=Math.pow(2,e.tileID.canonical.z),a=t.tileID.key;0===i&&0===r||Math.abs(r)>1||(Math.abs(i)>1&&(1===Math.abs(i+o)?i+=o:1===Math.abs(i-o)&&(i-=o)),t.dem&&e.dem&&(e.dem.backfillBorder(t.dem,i,r),e.neighboringTiles&&e.neighboringTiles[a]&&(e.neighboringTiles[a].backfilled=!0)))}for(var i=this,r=this.getRenderableIds(),o=0;o<r.length;o++){var a=r[o];if(e.neighboringTiles&&e.neighboringTiles[a]){var s=i.getTileByID(a);t(e,s),t(s,e)}}},t.prototype.getTile=function(e){return this.getTileByID(e.key)},t.prototype.getTileByID=function(e){return this._tiles[e]},t.prototype.getZoom=function(e){return e.zoom+e.scaleZoom(e.tileSize/this._source.tileSize)},t.prototype._findLoadedChildren=function(e,t,i){var r=this,o=!1;for(var a in r._tiles){var s=r._tiles[a];if(!(i[a]||!s.hasData()||s.tileID.overscaledZ<=e.overscaledZ||s.tileID.overscaledZ>t)){var n=Math.pow(2,s.tileID.canonical.z-e.canonical.z);if(Math.floor(s.tileID.canonical.x/n)===e.canonical.x&&Math.floor(s.tileID.canonical.y/n)===e.canonical.y)for(i[a]=s.tileID,o=!0;s&&s.tileID.overscaledZ-1>e.overscaledZ;){var l=s.tileID.scaledTo(s.tileID.overscaledZ-1);if(!l)break;s=r._tiles[l.key],s&&s.hasData()&&(delete i[a],i[l.key]=l)}}}return o},t.prototype.findLoadedParent=function(e,t,i){for(var r=this,o=e.overscaledZ-1;o>=t;o--){var a=e.scaledTo(o);if(!a)return;var s=String(a.key),n=r._tiles[s];if(n&&n.hasData())return i[s]=a,n;if(r._cache.has(s))return i[s]=a,r._cache.get(s)}},t.prototype.updateCacheSize=function(e){var t=Math.ceil(e.width/this._source.tileSize)+1,i=Math.ceil(e.height/this._source.tileSize)+1,r=t*i,o=Math.floor(5*r),a="number"==typeof this._maxTileCacheSize?Math.min(this._maxTileCacheSize,o):o;this._cache.setMaxSize(a)},t.prototype.update=function(e){var i=this;if(this.transform=e,this._sourceLoaded&&!this._paused){this.updateCacheSize(e),this._coveredTiles={};var r;this.used?this._source.tileID?r=e.getVisibleUnwrappedCoordinates(this._source.tileID).map(function(e){return new OverscaledTileID(e.canonical.z,e.wrap,e.canonical.z,e.canonical.x,e.canonical.y)}):(r=e.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}),this._source.hasTile&&(r=r.filter(function(e){return i._source.hasTile(e)}))):r=[];var o=(this._source.roundZoom?Math.round:Math.floor)(this.getZoom(e)),a=Math.max(o-t.maxOverzooming,this._source.minzoom),s=Math.max(o+t.maxUnderzooming,this._source.minzoom),n=this._updateRetainedTiles(r,o),l={};if(isRasterType(this._source.type))for(var c=Object.keys(n),h=0;h<c.length;h++){var d=c[h],u=n[d],_=i._tiles[d];if(_&&(void 0===_.fadeEndTime||_.fadeEndTime>=browser.now())){i._findLoadedChildren(u,s,n)&&(n[d]=u);var p=i.findLoadedParent(u,a,l);p&&i._addTile(p.tileID)}}var f;for(f in l)n[f]||(i._coveredTiles[f]=!0);for(f in l)n[f]=l[f];for(var m=util.keysDifference(this._tiles,n),T=0;T<m.length;T++)i._removeTile(m[T])}},t.prototype._updateRetainedTiles=function(e,i){for(var r=this,o={},a={},s=Math.max(i-t.maxOverzooming,this._source.minzoom),n=Math.max(i+t.maxUnderzooming,this._source.minzoom),l=0;l<e.length;l++){var c=e[l],h=r._addTile(c),d=!1;if(h.hasData())o[c.key]=c;else{d=h.wasRequested(),o[c.key]=c;var u=!0;if(i+1>r._source.maxzoom){var _=c.children(r._source.maxzoom)[0],p=r.getTile(_);p&&p.hasData()?o[_.key]=_:u=!1}else{r._findLoadedChildren(c,n,o);for(var f=c.children(r._source.maxzoom),m=0;m<f.length;m++)if(!o[f[m].key]){u=!1;break}}if(!u)for(var T=c.overscaledZ-1;T>=s;--T){var v=c.scaledTo(T);if(a[v.key])break;if(a[v.key]=!0,h=r.getTile(v),!h&&d&&(h=r._addTile(v)),h&&(o[v.key]=v,d=h.wasRequested(),h.hasData()))break}}}return o},t.prototype._addTile=function(e){var t=this._tiles[e.key];if(t)return t;(t=this._cache.getAndRemove(e.key))&&this._cacheTimers[e.key]&&(clearTimeout(this._cacheTimers[e.key]),delete this._cacheTimers[e.key],this._setTileReloadTimer(e.key,t));var i=Boolean(t);return i||(t=new Tile(e,this._source.tileSize*e.overscaleFactor()),this._loadTile(t,this._tileLoaded.bind(this,t,e.key,t.state))),t?(t.uses++,this._tiles[e.key]=t,i||this._source.fire(new Event("dataloading",{tile:t,coord:t.tileID,dataType:"source"})),t):null},t.prototype._setTileReloadTimer=function(e,t){var i=this;e in this._timers&&(clearTimeout(this._timers[e]),delete this._timers[e]);var r=t.getExpiryTimeout();r&&(this._timers[e]=setTimeout(function(){i._reloadTile(e,"expired"),delete i._timers[e]},r))},t.prototype._setCacheInvalidationTimer=function(e,t){var i=this;e in this._cacheTimers&&(clearTimeout(this._cacheTimers[e]),delete this._cacheTimers[e]);var r=t.getExpiryTimeout();r&&(this._cacheTimers[e]=setTimeout(function(){i._cache.remove(e),delete i._cacheTimers[e]},r))},t.prototype._removeTile=function(e){var t=this._tiles[e];if(t&&(t.uses--,delete this._tiles[e],this._timers[e]&&(clearTimeout(this._timers[e]),delete this._timers[e]),!(t.uses>0)))if(t.hasData()){t.tileID=t.tileID.wrapped();var i=t.tileID.key;this._cache.add(i,t),this._setCacheInvalidationTimer(i,t)}else t.aborted=!0,this._abortTile(t),this._unloadTile(t)},t.prototype.clearTiles=function(){var e=this;this._shouldReloadOnResume=!1,this._paused=!1;for(var t in e._tiles)e._removeTile(t);this._resetCache()},t.prototype._resetCache=function(){var e=this;for(var t in e._cacheTimers)clearTimeout(e._cacheTimers[t]);this._cacheTimers={},this._cache.reset()},t.prototype.tilesIn=function(e){for(var t=this,i=[],r=this.getIds(),o=1/0,a=1/0,s=-1/0,n=-1/0,l=e[0].zoom,c=0;c<e.length;c++){var h=e[c];o=Math.min(o,h.column),a=Math.min(a,h.row),s=Math.max(s,h.column),n=Math.max(n,h.row)}for(var d=0;d<r.length;d++){var u=t._tiles[r[d]],_=u.tileID,p=Math.pow(2,t.transform.zoom-u.tileID.overscaledZ),f=t.transform.maxPitchScaleFactor()*u.queryPadding*EXTENT/u.tileSize/p,m=[coordinateToTilePoint(_,new Coordinate(o,a,l)),coordinateToTilePoint(_,new Coordinate(s,n,l))];if(m[0].x-f<EXTENT&&m[0].y-f<EXTENT&&m[1].x+f>=0&&m[1].y+f>=0){for(var T=[],v=0;v<e.length;v++)T.push(coordinateToTilePoint(_,e[v]));i.push({tile:u,tileID:_,queryGeometry:[T],scale:p})}}return i},t.prototype.getVisibleCoordinates=function(){for(var e=this,t=this.getRenderableIds().map(function(t){return e._tiles[t].tileID}),i=0,r=t;i<r.length;i+=1){var o=r[i];o.posMatrix=e.transform.calculatePosMatrix(o.toUnwrapped())}return t},t.prototype.hasTransition=function(){var e=this;if(this._source.hasTransition())return!0;if(isRasterType(this._source.type))for(var t in e._tiles){var i=e._tiles[t];if(void 0!==i.fadeEndTime&&i.fadeEndTime>=browser.now())return!0}return!1},t}(Evented);SourceCache.maxOverzooming=10,SourceCache.maxUnderzooming=3,module.exports=SourceCache;
},{"../_minemap_/point-geometry":29,"../data/extent":67,"../geo/coordinate":75,"../gl/context":80,"../util/browser":286,"../util/evented":295,"../util/lru_cache":303,"../util/util":315,"./source":130,"./tile":132,"./tile_id":134}],132:[function(_dereq_,module,exports){
"use strict";var util=_dereq_("../util/util"),deserializeBucket=_dereq_("../data/bucket").deserialize,FeatureIndex=_dereq_("../data/feature_index"),vt=_dereq_("../_minemap_/vector-tile"),Protobuf=_dereq_("pbf"),GeoJSONFeature=_dereq_("../util/vectortile_to_geojson"),featureFilter=_dereq_("../style-spec/feature_filter"),CollisionIndex=_dereq_("../symbol/collision_index"),SymbolBucket=_dereq_("../data/bucket/symbol_bucket"),SymtrackingBucket=_dereq_("../data/bucket/symtracking_bucket"),ref=_dereq_("../data/array_types"),RasterBoundsArray=ref.RasterBoundsArray,CollisionBoxArray=ref.CollisionBoxArray,rasterBoundsAttributes=_dereq_("../data/raster_bounds_attributes"),EXTENT=_dereq_("../data/extent"),Point=_dereq_("../_minemap_/point-geometry"),Texture=_dereq_("../render/texture"),ref$1=_dereq_("../data/segment"),SegmentVector=ref$1.SegmentVector,ref$2=_dereq_("../data/index_array_type"),TriangleIndexArray=ref$2.TriangleIndexArray,browser=_dereq_("../util/browser"),CLOCK_SKEW_RETRY_TIMEOUT=3e4,Tile=function(e,t){this.tileID=e,this.uid=util.uniqueId(),this.uses=0,this.tileSize=t,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.expiredRequestCount=0,this.state="loading",this.eTag=null};Tile.prototype.registerFadeDuration=function(e){var t=e+this.timeAdded;t<browser.now()||this.fadeEndTime&&t<this.fadeEndTime||(this.fadeEndTime=t)},Tile.prototype.wasRequested=function(){return"errored"===this.state||"loaded"===this.state||"reloading"===this.state},Tile.prototype.loadVectorData=function(e,t,i){var r=this;if(this.hasData()&&this.unloadVectorData(),this.state="loaded",!e)return void(this.collisionBoxArray=new CollisionBoxArray);if(e.rawTileData&&(this.rawTileData=e.rawTileData),this.eTag=e.eTag||null,this.collisionBoxArray=e.collisionBoxArray,this.featureIndex=e.featureIndex,this.featureIndex.rawTileData=this.rawTileData,this.buckets=deserializeBucket(e.buckets,t.style),i)for(var a in r.buckets){var s=r.buckets[a];(s instanceof SymbolBucket||s instanceof SymtrackingBucket)&&(s.justReloaded=!0)}this.queryPadding=0;for(var n in r.buckets){var o=r.buckets[n];r.queryPadding=Math.max(r.queryPadding,t.style.getLayer(o.layerIds[0]).queryRadius(o))}e.iconAtlasImage&&(this.iconAtlasImage=e.iconAtlasImage),e.glyphAtlasImage&&(this.glyphAtlasImage=e.glyphAtlasImage)},Tile.prototype.unloadVectorData=function(){var e=this;for(var t in e.buckets)e.buckets[t].destroy();this.buckets={},this.iconAtlasTexture&&this.iconAtlasTexture.destroy(),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.collisionBoxArray=null,this.featureIndex=null,this.state="unloaded",this.eTag=null},Tile.prototype.unloadDEMData=function(){this.dem=null,this.neighboringTiles=null,this.state="unloaded"},Tile.prototype.getBucket=function(e){return this.buckets[e.id]},Tile.prototype.upload=function(e){var t=this;for(var i in t.buckets){var r=t.buckets[i];r.uploaded||(r.upload(e),r.uploaded=!0)}var a=e.gl;this.iconAtlasImage&&(this.iconAtlasTexture=new Texture(e,this.iconAtlasImage,a.RGBA),this.iconAtlasImage=null),this.glyphAtlasImage&&(this.glyphAtlasTexture=new Texture(e,this.glyphAtlasImage,a.ALPHA),this.glyphAtlasImage=null)},Tile.prototype.queryRenderedFeatures=function(e,t,i,r,a,s,n,o,u){var l=this;if(!this.featureIndex||!this.collisionBoxArray)return{};var d={};for(var h in e){var c=l.getBucket(e[h]);c&&(c instanceof SymbolBucket||c instanceof SymtrackingBucket)&&void 0!==c.bucketInstanceId&&(d[c.bucketInstanceId]=!0)}return this.featureIndex.query({queryGeometry:t,scale:i,tileSize:this.tileSize,posMatrix:n,transform:a,params:r,queryPadding:this.queryPadding*s,collisionBoxArray:this.collisionBoxArray,sourceID:o,collisionIndex:u,bucketInstanceIds:d},e)},Tile.prototype.querySourceFeatures=function(e,t){var i=this;if(this.rawTileData){this.vtLayers||(this.vtLayers=new vt.VectorTile(new Protobuf(this.rawTileData)).layers);var r=t?t.sourceLayer:"",a=this.vtLayers._geojsonTileLayer||this.vtLayers[r];if(a)for(var s=featureFilter(t&&t.filter),n={z:this.tileID.overscaledZ,x:this.tileID.canonical.x,y:this.tileID.canonical.y},o=0;o<a.length;o++){var u=a.feature(o);if(s({zoom:i.tileID.overscaledZ},u)){var l=new GeoJSONFeature(u,n.z,n.x,n.y);l.tile=n,e.push(l)}}}},Tile.prototype.clearMask=function(){this.segments&&(this.segments.destroy(),delete this.segments),this.maskedBoundsBuffer&&(this.maskedBoundsBuffer.destroy(),delete this.maskedBoundsBuffer),this.maskedIndexBuffer&&(this.maskedIndexBuffer.destroy(),delete this.maskedIndexBuffer)},Tile.prototype.setMask=function(e,t){var i=this;if(!util.deepEqual(this.mask,e)&&(this.mask=e,this.clearMask(),!util.deepEqual(e,{0:!0}))){var r=new RasterBoundsArray,a=new TriangleIndexArray;this.segments=new SegmentVector,this.segments.prepareSegment(0,r,a);for(var s=Object.keys(e),n=0;n<s.length;n++){var o=e[s[n]],u=EXTENT>>o.z,l=new Point(o.x*u,o.y*u),d=new Point(l.x+u,l.y+u),h=i.segments.prepareSegment(4,r,a);r.emplaceBack(l.x,l.y,l.x,l.y),r.emplaceBack(d.x,l.y,d.x,l.y),r.emplaceBack(l.x,d.y,l.x,d.y),r.emplaceBack(d.x,d.y,d.x,d.y);var c=h.vertexLength;a.emplaceBack(c,c+1,c+2),a.emplaceBack(c+1,c+2,c+3),h.vertexLength+=4,h.primitiveLength+=2}this.maskedBoundsBuffer=t.createVertexBuffer(r,rasterBoundsAttributes.members),this.maskedIndexBuffer=t.createIndexBuffer(a)}},Tile.prototype.hasData=function(){return"loaded"===this.state||"reloading"===this.state||"expired"===this.state},Tile.prototype.setExpiryData=function(e){var t=this.expirationTime;if(e.cacheControl){var i=util.parseCacheControl(e.cacheControl);i["max-age"]&&(this.expirationTime=Date.now()+1e3*i["max-age"])}else e.expires&&(this.expirationTime=new Date(e.expires).getTime());if(this.expirationTime){var r=Date.now(),a=!1;if(this.expirationTime>r)a=!1;else if(t)if(this.expirationTime<t)a=!0;else{var s=this.expirationTime-t;s?this.expirationTime=r+Math.max(s,CLOCK_SKEW_RETRY_TIMEOUT):a=!0}else a=!0;a?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}},Tile.prototype.getExpiryTimeout=function(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-(new Date).getTime(),Math.pow(2,31)-1)},module.exports=Tile;
},{"../_minemap_/point-geometry":29,"../_minemap_/vector-tile":34,"../data/array_types":41,"../data/bucket":42,"../data/bucket/symbol_bucket":61,"../data/bucket/symtracking_bucket":63,"../data/extent":67,"../data/feature_index":68,"../data/index_array_type":69,"../data/raster_bounds_attributes":73,"../data/segment":74,"../render/texture":114,"../style-spec/feature_filter":168,"../symbol/collision_index":249,"../util/browser":286,"../util/util":315,"../util/vectortile_to_geojson":316,"pbf":10}],133:[function(_dereq_,module,exports){
"use strict";var LngLatBounds=_dereq_("../geo/lng_lat_bounds"),clamp=_dereq_("../util/util").clamp,TileBounds=function(t,n,o){this.bounds=LngLatBounds.convert(this.validateBounds(t)),this.minzoom=n||0,this.maxzoom=o||24};TileBounds.prototype.validateBounds=function(t){return Array.isArray(t)&&4===t.length?[Math.max(-180,t[0]),Math.max(-90,t[1]),Math.min(180,t[2]),Math.min(90,t[3])]:[-180,-90,180,90]},TileBounds.prototype.contains=function(t){var n={minX:Math.floor(this.lngX(this.bounds.getWest(),t.z)),minY:Math.floor(this.latY(this.bounds.getNorth(),t.z)),maxX:Math.ceil(this.lngX(this.bounds.getEast(),t.z)),maxY:Math.ceil(this.latY(this.bounds.getSouth(),t.z))};return t.x>=n.minX&&t.x<n.maxX&&t.y>=n.minY&&t.y<n.maxY},TileBounds.prototype.lngX=function(t,n){return(t+180)*(Math.pow(2,n)/360)},TileBounds.prototype.latY=function(t,n){var o=clamp(Math.sin(Math.PI/180*t),-.9999,.9999),a=Math.pow(2,n)/(2*Math.PI);return Math.pow(2,n-1)+.5*Math.log((1+o)/(1-o))*-a},module.exports=TileBounds;
},{"../geo/lng_lat_bounds":77,"../util/util":315}],134:[function(_dereq_,module,exports){
"use strict";function calculateKey(e,i,a,t){(e*=2)<0&&(e=-1*e-1);var n=1<<i;return 32*(n*n*e+n*t+a)+i}function getQuadkey(e,i,a){for(var t,n="",c=e;c>0;c--)t=1<<c-1,n+=(i&t?1:0)+(a&t?2:0);return n}var WhooTS=_dereq_("../_minemap_/whoots-js"),ref=_dereq_("../util/web_worker_transfer"),register=ref.register,Coordinate=_dereq_("../geo/coordinate"),CanonicalTileID=function(e,i,a){this.z=e,this.x=i,this.y=a,this.key=calculateKey(0,e,i,a)};CanonicalTileID.prototype.equals=function(e){return this.z===e.z&&this.x===e.x&&this.y===e.y},CanonicalTileID.prototype.url=function(e,i){var a=WhooTS.getTileBBox(this.x,this.y,this.z),t=getQuadkey(this.z,this.x,this.y),n="tms"===i?Math.pow(2,this.z)-this.y-1:this.y;return e[(this.x+this.y)%e.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace("{z}",String(this.z)).replace("{x}",String(this.x)).replace("{y}",String(n)).replace("{m}",Math.floor(this.x/16)).replace("{n}",Math.floor(n/16)).replace("{quadkey}",t).replace("{bbox-epsg-3857}",a)},CanonicalTileID.prototype.toRealCoord=function(e){var i="tms"===e?Math.pow(2,this.z)-this.y-1:this.y;return{x:this.x,y:i,z:this.z}};var UnwrappedTileID=function(e,i){this.wrap=e,this.canonical=i,this.key=calculateKey(e,i.z,i.x,i.y)},OverscaledTileID=function(e,i,a,t,n){this.overscaledZ=e,this.wrap=i,this.canonical=new CanonicalTileID(a,+t,+n),this.key=calculateKey(i,e,t,n)};OverscaledTileID.prototype.scaledTo=function(e){var i=this.canonical.z-e;return e>this.canonical.z?new OverscaledTileID(e,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new OverscaledTileID(e,this.wrap,e,this.canonical.x>>i,this.canonical.y>>i)},OverscaledTileID.prototype.isChildOf=function(e){var i=this.canonical.z-e.canonical.z;return 0===e.overscaledZ||e.overscaledZ<this.overscaledZ&&e.canonical.x===this.canonical.x>>i&&e.canonical.y===this.canonical.y>>i},OverscaledTileID.prototype.children=function(e){if(this.overscaledZ>=e)return[new OverscaledTileID(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];var i=this.canonical.z+1,a=2*this.canonical.x,t=2*this.canonical.y;return[new OverscaledTileID(i,this.wrap,i,a,t),new OverscaledTileID(i,this.wrap,i,a+1,t),new OverscaledTileID(i,this.wrap,i,a,t+1),new OverscaledTileID(i,this.wrap,i,a+1,t+1)]},OverscaledTileID.prototype.isLessThan=function(e){return this.wrap<e.wrap||!(this.wrap>e.wrap)&&(this.overscaledZ<e.overscaledZ||!(this.overscaledZ>e.overscaledZ)&&(this.canonical.x<e.canonical.x||!(this.canonical.x>e.canonical.x)&&this.canonical.y<e.canonical.y))},OverscaledTileID.prototype.wrapped=function(){return new OverscaledTileID(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)},OverscaledTileID.prototype.overscaleFactor=function(){return Math.pow(2,this.overscaledZ-this.canonical.z)},OverscaledTileID.prototype.toUnwrapped=function(){return new UnwrappedTileID(this.wrap,this.canonical)},OverscaledTileID.prototype.toString=function(){return this.overscaledZ+"/"+this.canonical.x+"/"+this.canonical.y},OverscaledTileID.prototype.toCoordinate=function(){return new Coordinate(this.canonical.x+Math.pow(2,this.wrap),this.canonical.y,this.canonical.z)},register("CanonicalTileID",CanonicalTileID),register("OverscaledTileID",OverscaledTileID,{omit:["posMatrix"]}),module.exports={CanonicalTileID:CanonicalTileID,OverscaledTileID:OverscaledTileID,UnwrappedTileID:UnwrappedTileID};
},{"../_minemap_/whoots-js":40,"../geo/coordinate":75,"../util/web_worker_transfer":318}],135:[function(_dereq_,module,exports){
"use strict";var Evented=_dereq_("../util/evented").Evented,Event=_dereq_("../util/evented").Event,ErrorEvent=_dereq_("../util/evented").ErrorEvent,util=_dereq_("../util/util"),loadTileJSON=_dereq_("./load_tilejson"),normalizeURL=_dereq_("../util/minemap").normalizeTileURL,TileBounds=_dereq_("./tile_bounds"),ResourceType=_dereq_("../util/ajax").ResourceType,browser=_dereq_("../util/browser"),VectorTileSource=function(e){function t(t,i,o,r){if(e.call(this),this.id=t,this.dispatcher=o,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,util.extend(this,util.pick(i,["url","scheme","tileSize"])),this._options=util.extend({type:"vector"},i),this._collectResourceTiming=i.collectResourceTiming,512!==this.tileSize)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(r)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.load=function(){var e=this;this.fire(new Event("dataloading",{dataType:"source"})),loadTileJSON(this._options,this.map._transformRequest,function(t,i){t?e.fire(new ErrorEvent(t)):i&&(util.extend(e,i),i.bounds&&(e.tileBounds=new TileBounds(i.bounds,e.minzoom,e.maxzoom)),e.fire(new Event("data",{dataType:"source",sourceDataType:"metadata"})),e.fire(new Event("data",{dataType:"source",sourceDataType:"content"})))})},t.prototype.hasTile=function(e){return!this.tileBounds||this.tileBounds.contains(e.canonical)},t.prototype.onAdd=function(e){this.map=e,this.load()},t.prototype.serialize=function(){return util.extend({},this._options)},t.prototype.loadTile=function(e,t){function i(i,o){return e.aborted?t(null):i?t(i):(o&&o.resourceTiming&&(e.resourceTiming=o.resourceTiming),this.map._refreshExpiredTiles&&e.setExpiryData(o),e.loadVectorData(o,this.map.painter),t(null),void(e.reloadCallback&&(this.loadTile(e,e.reloadCallback),e.reloadCallback=null)))}var o=e.tileID.overscaleFactor(),r=normalizeURL(e.tileID.canonical.url(this.tiles,this.scheme),this.url),s=this._options||{},l=s.separate||{};if(l.isRitcSeparate){var a=l.valueUrl||"",n=e.tileID.canonical.toRealCoord(this.scheme),u=a.replace("{z}",n.z).replace("{x}",n.x).replace("{y}",n.y);l.accessUrl=normalizeURL(u),s.separate=l}var c={request:this.map._transformRequest(r,ResourceType.Tile),uid:e.uid,tileID:e.tileID,zoom:e.tileID.overscaledZ,tileSize:this.tileSize*o,type:this.type,source:this.id,eTag:e.eTag||null,sourceOptions:s,pixelRatio:browser.devicePixelRatio,overscaling:o,showCollisionBoxes:this.map.showCollisionBoxes};c.request.collectResourceTiming=this._collectResourceTiming,void 0===e.workerID||"expired"===e.state?e.workerID=this.dispatcher.send("loadTile",c,i.bind(this)):"loading"===e.state?e.reloadCallback=t:this.dispatcher.send("reloadTile",c,i.bind(this),e.workerID)},t.prototype.abortTile=function(e){this.dispatcher.send("abortTile",{uid:e.uid,type:this.type,source:this.id},void 0,e.workerID)},t.prototype.unloadTile=function(e){e.unloadVectorData(),this.dispatcher.send("removeTile",{uid:e.uid,type:this.type,source:this.id},void 0,e.workerID)},t.prototype.hasTransition=function(){return!1},t}(Evented);module.exports=VectorTileSource;
},{"../util/ajax":285,"../util/browser":286,"../util/evented":295,"../util/minemap":304,"../util/util":315,"./load_tilejson":124,"./tile_bounds":133}],136:[function(_dereq_,module,exports){
"use strict";function loadVectorTile(e,r){var a=e.request,t=e.sourceOptions||{},o=t.separate||{},i=ajax.getArrayBuffer;t.traffic&&(e.eTag&&(a.headers?a.headers["If-None-Match"]=e.eTag:a.headers={"If-None-Match":e.eTag}),i=ajax.getTrafficArrayBuffer);var l=i(a,function(e,a){if(e)r(e);else if(a){var i=null;i=t.traffic&&o.isPbfSeparate&&a.eTag&&a.eTag.endsWith("_status")?null:new vt.VectorTile(new Protobuf(a.data)),r(null,{vectorTile:i,rawData:a.data,cacheControl:a.cacheControl,expires:a.expires,eTag:a.eTag||null})}});return function(){l.abort(),r()}}var ajax=_dereq_("../util/ajax"),vt=_dereq_("../_minemap_/vector-tile"),Protobuf=_dereq_("pbf"),WorkerTile=_dereq_("./worker_tile"),util=_dereq_("../util/util"),perf=_dereq_("../util/performance"),VectorTileWorkerSource=function(e,r,a){this.actor=e,this.layerIndex=r,this.loadVectorData=a||loadVectorTile,this.loading={},this.loaded={}};VectorTileWorkerSource.prototype.loadTile=function(e,r){var a=this,t=e.uid;this.loading||(this.loading={});var o=this.loading[t]=new WorkerTile(e),i=e.sourceOptions||{},l=i.separate||{};if(i.traffic&&l.isPbfSeparate){var c=this.loaded[t];c&&c.vectorTile&&c.vectorTile.layers?o.vectorTile=c.vectorTile:e.eTag="99999999_9999999999999_all"}o.abort=this.loadVectorData(e,function(c,s){if(delete a.loading[t],c||!s){if(!(e.sourceOptions||{}).traffic||!c||304!==c.status)return r(c);a.reloadTile(e,r)}else{var n=s.rawData,u={};s.expires&&(u.expires=s.expires),s.cacheControl&&(u.cacheControl=s.cacheControl);var d={eTag:s.eTag},f={};if(e.request&&e.request.collectResourceTiming){var T=perf.getEntriesByName(e.request.url);T&&(f.resourceTiming=JSON.parse(JSON.stringify(T)))}i.traffic&&l.isPbfSeparate&&s.eTag&&s.eTag.endsWith("_status")||(o.vectorTile=s.vectorTile),o.parse(o.vectorTile,a.layerIndex,a.actor,function(e,a){if(e||!a)return r(e);r(null,util.extend({rawTileData:n.slice(0)},a,u,d,f))},n),a.loaded=a.loaded||{},a.loaded[t]=o}})},VectorTileWorkerSource.prototype.reloadTile=function(e,r){var a=this.loaded,t=e.uid,o=this;if(a&&a[t]){var i=a[t];i.showCollisionBoxes=e.showCollisionBoxes;var l=function(e,a){var t=i.reloadCallback;t&&(delete i.reloadCallback,i.parse(i.vectorTile,o.layerIndex,o.actor,t)),r(e,a)};"parsing"===i.status?i.reloadCallback=l:"done"===i.status&&(i.eTag=null,i.parse(i.vectorTile,this.layerIndex,this.actor,l))}},VectorTileWorkerSource.prototype.abortTile=function(e,r){var a=this.loading,t=e.uid;a&&a[t]&&a[t].abort&&(a[t].abort(),delete a[t]),r()},VectorTileWorkerSource.prototype.removeTile=function(e,r){var a=this.loaded,t=e.uid;a&&a[t]&&delete a[t],r()},module.exports=VectorTileWorkerSource;
},{"../_minemap_/vector-tile":34,"../util/ajax":285,"../util/performance":306,"../util/util":315,"./worker_tile":139,"pbf":10}],137:[function(_dereq_,module,exports){
"use strict";var ajax=_dereq_("../util/ajax"),ImageSource=_dereq_("./image_source"),rasterBoundsAttributes=_dereq_("../data/raster_bounds_attributes"),VertexArrayObject=_dereq_("../render/vertex_array_object"),Texture=_dereq_("../render/texture"),Evented=_dereq_("../util/evented").Evented,Event=_dereq_("../util/evented").Event,ErrorEvent=_dereq_("../util/evented").ErrorEvent,VideoSource=function(e){function t(t,r,i,o){e.call(this,t,r,i,o),this.roundZoom=!0,this.type="video",this.options=r}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.load=function(){var e=this,t=this.options;this.urls=[];for(var r=0,i=t.urls;r<i.length;r+=1){var o=i[r];e.urls.push(e.map._transformRequest(o,ajax.ResourceType.Source).url)}ajax.getVideo(this.urls,function(t,r){t?e.fire(new ErrorEvent(t)):r&&(e.video=r,e.video.loop=!0,e.video.addEventListener("playing",function(){e.map._rerender()}),e.map&&e.video.play(),e._finishLoading())})},t.prototype.getVideo=function(){return this.video},t.prototype.onAdd=function(e){this.map||(this.map=e,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))},t.prototype.prepare=function(){var e=this;if(!(0===Object.keys(this.tiles).length||this.video.readyState<2)){var t=this.map.painter.context,r=t.gl;this.boundsBuffer||(this.boundsBuffer=t.createVertexBuffer(this._boundsArray,rasterBoundsAttributes.members)),this.boundsVAO||(this.boundsVAO=new VertexArrayObject),this.texture?this.video.paused||(this.texture.bind(r.LINEAR,r.CLAMP_TO_EDGE),r.texSubImage2D(r.TEXTURE_2D,0,0,0,r.RGBA,r.UNSIGNED_BYTE,this.video)):(this.texture=new Texture(t,this.video,r.RGBA),this.texture.bind(r.LINEAR,r.CLAMP_TO_EDGE));for(var i in e.tiles){var o=e.tiles[i];"loaded"!==o.state&&(o.state="loaded",o.texture=e.texture)}}},t.prototype.serialize=function(){return{type:"video",urls:this.urls,coordinates:this.coordinates}},t.prototype.hasTransition=function(){return this.video&&!this.video.paused},t}(ImageSource);module.exports=VideoSource;
},{"../data/raster_bounds_attributes":73,"../render/texture":114,"../render/vertex_array_object":116,"../util/ajax":285,"../util/evented":295,"./image_source":123}],138:[function(_dereq_,module,exports){
"use strict";var Actor=_dereq_("../util/actor"),StyleLayerIndex=_dereq_("../style/style_layer_index"),VectorTileWorkerSource=_dereq_("./vector_tile_worker_source"),RasterDEMTileWorkerSource=_dereq_("./raster_dem_tile_worker_source"),GeoJSONWorkerSource=_dereq_("./geojson_worker_source"),Worker=function(e){var r=this;this.self=e,this.actor=new Actor(e,this),this.layerIndexes={},this.workerSourceTypes={vector:VectorTileWorkerSource,geojson:GeoJSONWorkerSource},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=function(e,o){if(r.workerSourceTypes[e])throw new Error('Worker source with name "'+e+'" already registered.');r.workerSourceTypes[e]=o}};Worker.prototype.setLayers=function(e,r,o){this.getLayerIndex(e).replace(r),o()},Worker.prototype.updateLayers=function(e,r,o){this.getLayerIndex(e).update(r.layers,r.removedIds),o()},Worker.prototype.loadTile=function(e,r,o){this.getWorkerSource(e,r.type,r.source).loadTile(r,o)},Worker.prototype.loadDEMTile=function(e,r,o){this.getDEMWorkerSource(e,r.source).loadTile(r,o)},Worker.prototype.reloadTile=function(e,r,o){this.getWorkerSource(e,r.type,r.source).reloadTile(r,o)},Worker.prototype.abortTile=function(e,r,o){this.getWorkerSource(e,r.type,r.source).abortTile(r,o)},Worker.prototype.removeTile=function(e,r,o){this.getWorkerSource(e,r.type,r.source).removeTile(r,o)},Worker.prototype.removeDEMTile=function(e,r){this.getDEMWorkerSource(e,r.source).removeTile(r)},Worker.prototype.removeSource=function(e,r,o){if(this.workerSources[e]&&this.workerSources[e][r.type]&&this.workerSources[e][r.type][r.source]){var t=this.workerSources[e][r.type][r.source];delete this.workerSources[e][r.type][r.source],void 0!==t.removeSource?t.removeSource(r,o):o()}},Worker.prototype.loadWorkerSource=function(e,r,o){try{this.self.importScripts(r.url),o()}catch(e){o(e)}},Worker.prototype.loadRTLTextPlugin=function(e,r,o){o("none")},Worker.prototype.getLayerIndex=function(e){var r=this.layerIndexes[e];return r||(r=this.layerIndexes[e]=new StyleLayerIndex),r},Worker.prototype.getWorkerSource=function(e,r,o){var t=this;if(this.workerSources[e]||(this.workerSources[e]={}),this.workerSources[e][r]||(this.workerSources[e][r]={}),!this.workerSources[e][r][o]){var s={send:function(r,o,s){t.actor.send(r,o,s,e)}};this.workerSources[e][r][o]=new this.workerSourceTypes[r](s,this.getLayerIndex(e))}return this.workerSources[e][r][o]},Worker.prototype.getDEMWorkerSource=function(e,r){return this.demWorkerSources[e]||(this.demWorkerSources[e]={}),this.demWorkerSources[e][r]||(this.demWorkerSources[e][r]=new RasterDEMTileWorkerSource),this.demWorkerSources[e][r]},module.exports=function(e){return new Worker(e)};
},{"../style/style_layer_index":242,"../util/actor":284,"./geojson_worker_source":121,"./raster_dem_tile_worker_source":128,"./vector_tile_worker_source":136}],139:[function(_dereq_,module,exports){
"use strict";function recalculateLayers(e,t){for(var i=new EvaluationParameters(t),r=0,a=e;r<a.length;r+=1){a[r].recalculate(i)}}var FeatureIndex=_dereq_("../data/feature_index"),ref=_dereq_("../symbol/symbol_layout"),performSymbolLayout=ref.performSymbolLayout,ref$1=_dereq_("../data/array_types"),CollisionBoxArray=ref$1.CollisionBoxArray,DictionaryCoder=_dereq_("../util/dictionary_coder"),SymbolBucket=_dereq_("../data/bucket/symbol_bucket"),SymtrackingBucket=_dereq_("../data/bucket/symtracking_bucket"),util=_dereq_("../util/util"),ajax=_dereq_("../util/ajax"),ref$2=_dereq_("../render/image_atlas"),makeImageAtlas=ref$2.makeImageAtlas,ref$3=_dereq_("../render/glyph_atlas"),makeGlyphAtlas=ref$3.makeGlyphAtlas,EvaluationParameters=_dereq_("../style/evaluation_parameters"),ref$4=_dereq_("./tile_id"),OverscaledTileID=ref$4.OverscaledTileID,WorkerTile=function(e){this.tileID=new OverscaledTileID(e.tileID.overscaledZ,e.tileID.wrap,e.tileID.canonical.z,e.tileID.canonical.x,e.tileID.canonical.y),this.uid=e.uid,this.zoom=e.zoom,this.pixelRatio=e.pixelRatio,this.tileSize=e.tileSize,this.source=e.source,this.overscaling=e.overscaling,this.showCollisionBoxes=e.showCollisionBoxes,this.collectResourceTiming=!!e.collectResourceTiming,this.sourceOptions=e.sourceOptions};WorkerTile.prototype.parse=function(e,t,i,r,a){var s=this;this.status="parsing",this.data=e;var o=this.sourceOptions||{},l=o.separate||{},n=l.accessUrl||"",u=l.separateSource||"";if(o.traffic&&l.isRitcSeparate&&u===this.source&&n.length>0)ajax.getJSON(n,function(a,l){a?s.parsing(e,t,i,o,null,r):s.parsing(e,t,i,o,l,r)});else if(o.traffic&&l.isPbfSeparate&&u===this.source&&this.eTag&&this.eTag.endsWith("_status")){var c=String.fromCharCode.apply(null,new Uint8Array(a));this.parsing(e,t,i,o,c.length>0?JSON.parse(c):null,r)}else this.parsing(e,t,i,o,null,r)},WorkerTile.prototype.parsing=function(e,t,i,r,a,s){function o(){var e=this;if(T)return s(T);if(O&&q){var t=makeGlyphAtlas(O),i=makeImageAtlas(q);for(var r in p){var a=p[r];(a instanceof SymbolBucket||a instanceof SymtrackingBucket)&&(recalculateLayers(a.layers,e.zoom),performSymbolLayout(a,O,t.positions,q,i.positions,e.showCollisionBoxes))}this.status="done",s(null,{buckets:util.values(p).filter(function(e){return!e.isEmpty()}),featureIndex:c,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:t.image,iconAtlasImage:i.image})}}var l=this,n=r.separate||{};this.collisionBoxArray=new CollisionBoxArray;var u=new DictionaryCoder(Object.keys(e.layers).sort()),c=new FeatureIndex(this.tileID,this.overscaling);c.bucketLayerIDs=[];var p={},f={featureIndex:c,iconDependencies:{},glyphDependencies:{}},h=function(e,t){var i=a||{},r=i[e[0]]||[],s=i[e[1]]||[],o=i[e[2]]||[],l=i[e[3]]||[];t.push(r),t.push(s),t.push(o),t.push(l)},y=function(e,t,i){i||(e.properties.status=1),t[0].includes(i)?e.properties.status=0:t[1].includes(i)?e.properties.status=2:t[2].includes(i)?e.properties.status=3:t[3].includes(i)?e.properties.status=4:e.properties.status=1},m=[];if(r.traffic&&n.isRitcSeparate&&n.separateSource===this.source){h(["status_0","status_2","status_3","status_4"],m)}else if(r.traffic&&n.isPbfSeparate&&n.separateSource===this.source&&this.eTag&&this.eTag.endsWith("_status")){var d=["0","2","3","4"];h(d,m)}var g=t.familiesBySource[this.source];for(var v in g){var k=e.layers[v];if(k){for(var x=u.encode(v),b=[],I=0;I<k.length;I++){var S=k.feature(I);if(r.traffic&&n.isRitcSeparate&&n.separateLayer===v){y(S,m,S.properties.rtic_key)}else if(r.traffic&&n.isPbfSeparate&&n.separateLayer===v&&l.eTag&&l.eTag.endsWith("_status")){var D=S.properties.linkid;y(S,m,D)}b.push({feature:S,index:I,sourceLayerIndex:x})}for(var _=0,A=g[v];_<A.length;_+=1){var B=A[_],z=B[0];if(!(z.minzoom&&l.zoom<Math.floor(z.minzoom))&&(!(z.maxzoom&&l.zoom>=z.maxzoom)&&"none"!==z.visibility)){recalculateLayers(B,l.zoom);(p[z.id]=z.createBucket({index:c.bucketLayerIDs.length,layers:B,zoom:l.zoom,pixelRatio:l.pixelRatio,overscaling:l.overscaling,collisionBoxArray:l.collisionBoxArray})).populate(b,f),c.bucketLayerIDs.push(B.map(function(e){return e.id}))}}}}var T,O,q,L=util.mapObject(f.glyphDependencies,function(e){return Object.keys(e).map(Number)});Object.keys(L).length?i.send("getGlyphs",{uid:this.uid,stacks:L},function(e,t){T||(T=e,O=t,o.call(l))}):O={};var w=Object.keys(f.iconDependencies);w.length?i.send("getImages",{icons:w},function(e,t){T||(T=e,q=t,o.call(l))}):q={},o.call(this)},module.exports=WorkerTile;
},{"../data/array_types":41,"../data/bucket/symbol_bucket":61,"../data/bucket/symtracking_bucket":63,"../data/feature_index":68,"../render/glyph_atlas":106,"../render/image_atlas":108,"../style/evaluation_parameters":202,"../symbol/symbol_layout":259,"../util/ajax":285,"../util/dictionary_coder":291,"../util/util":315,"./tile_id":134}],140:[function(_dereq_,module,exports){
"use strict";function deref(r,e){var f={};for(var t in r)"ref"!==t&&(f[t]=r[t]);return refProperties.forEach(function(r){r in e&&(f[r]=e[r])}),f}function derefLayers(r){r=r.slice();for(var e=Object.create(null),f=0;f<r.length;f++)e[r[f].id]=r[f];for(var t=0;t<r.length;t++)"ref"in r[t]&&(r[t]=deref(r[t],e[r[t].ref]));return r}var refProperties=_dereq_("./util/ref_properties");module.exports=derefLayers;
},{"./util/ref_properties":179}],141:[function(_dereq_,module,exports){
"use strict";function addSource(e,r,o){o.push({command:operations.addSource,args:[e,r[e]]})}function removeSource(e,r,o){r.push({command:operations.removeSource,args:[e]}),o[e]=!0}function updateSource(e,r,o,a){removeSource(e,o,a),addSource(e,r,o)}function canUpdateGeoJSON(e,r,o){var a;for(a in e[o])if(e[o].hasOwnProperty(a)&&"data"!==a&&!isEqual(e[o][a],r[o][a]))return!1;for(a in r[o])if(r[o].hasOwnProperty(a)&&"data"!==a&&!isEqual(e[o][a],r[o][a]))return!1;return!0}function diffSources(e,r,o,a){e=e||{},r=r||{};var t;for(t in e)e.hasOwnProperty(t)&&(r.hasOwnProperty(t)||removeSource(t,o,a));for(t in r)r.hasOwnProperty(t)&&(e.hasOwnProperty(t)?isEqual(e[t],r[t])||("geojson"===e[t].type&&"geojson"===r[t].type&&canUpdateGeoJSON(e,r,t)?o.push({command:operations.setGeoJSONSourceData,args:[t,r[t].data]}):updateSource(t,r,o,a)):addSource(t,r,o))}function diffLayerPropertyChanges(e,r,o,a,t,s){e=e||{},r=r||{};var n;for(n in e)e.hasOwnProperty(n)&&(isEqual(e[n],r[n])||o.push({command:s,args:[a,n,r[n],t]}));for(n in r)r.hasOwnProperty(n)&&!e.hasOwnProperty(n)&&(isEqual(e[n],r[n])||o.push({command:s,args:[a,n,r[n],t]}))}function pluckId(e){return e.id}function indexById(e,r){return e[r.id]=r,e}function diffLayers(e,r,o){e=e||[],r=r||[];var a,t,s,n,i,p,u,m=e.map(pluckId),c=r.map(pluckId),d=e.reduce(indexById,{}),y=r.reduce(indexById,{}),l=m.slice(),h=Object.create(null);for(a=0,t=0;a<m.length;a++)s=m[a],y.hasOwnProperty(s)?t++:(o.push({command:operations.removeLayer,args:[s]}),l.splice(l.indexOf(s,t),1));for(a=0,t=0;a<c.length;a++)s=c[c.length-1-a],l[l.length-1-a]!==s&&(d.hasOwnProperty(s)?(o.push({command:operations.removeLayer,args:[s]}),l.splice(l.lastIndexOf(s,l.length-t),1)):t++,p=l[l.length-a],o.push({command:operations.addLayer,args:[y[s],p]}),l.splice(l.length-a,0,s),h[s]=!0);for(a=0;a<c.length;a++)if(s=c[a],n=d[s],i=y[s],!h[s]&&!isEqual(n,i))if(isEqual(n.source,i.source)&&isEqual(n["source-layer"],i["source-layer"])&&isEqual(n.type,i.type)){diffLayerPropertyChanges(n.layout,i.layout,o,s,null,operations.setLayoutProperty),diffLayerPropertyChanges(n.paint,i.paint,o,s,null,operations.setPaintProperty),isEqual(n.filter,i.filter)||o.push({command:operations.setFilter,args:[s,i.filter]}),isEqual(n.minzoom,i.minzoom)&&isEqual(n.maxzoom,i.maxzoom)||o.push({command:operations.setLayerZoomRange,args:[s,i.minzoom,i.maxzoom]});for(u in n)n.hasOwnProperty(u)&&"layout"!==u&&"paint"!==u&&"filter"!==u&&"metadata"!==u&&"minzoom"!==u&&"maxzoom"!==u&&(0===u.indexOf("paint.")?diffLayerPropertyChanges(n[u],i[u],o,s,u.slice(6),operations.setPaintProperty):isEqual(n[u],i[u])||o.push({command:operations.setLayerProperty,args:[s,u,i[u]]}));for(u in i)i.hasOwnProperty(u)&&!n.hasOwnProperty(u)&&"layout"!==u&&"paint"!==u&&"filter"!==u&&"metadata"!==u&&"minzoom"!==u&&"maxzoom"!==u&&(0===u.indexOf("paint.")?diffLayerPropertyChanges(n[u],i[u],o,s,u.slice(6),operations.setPaintProperty):isEqual(n[u],i[u])||o.push({command:operations.setLayerProperty,args:[s,u,i[u]]}))}else o.push({command:operations.removeLayer,args:[s]}),p=l[l.lastIndexOf(s)+1],o.push({command:operations.addLayer,args:[i,p]})}function diffStyles(e,r){if(!e)return[{command:operations.setStyle,args:[r]}];var o=[];try{if(!isEqual(e.version,r.version))return[{command:operations.setStyle,args:[r]}];isEqual(e.center,r.center)||o.push({command:operations.setCenter,args:[r.center]}),isEqual(e.zoom,r.zoom)||o.push({command:operations.setZoom,args:[r.zoom]}),isEqual(e.bearing,r.bearing)||o.push({command:operations.setBearing,args:[r.bearing]}),isEqual(e.pitch,r.pitch)||o.push({command:operations.setPitch,args:[r.pitch]}),isEqual(e.sprite,r.sprite)||o.push({command:operations.setSprite,args:[r.sprite]}),isEqual(e.glyphs,r.glyphs)||o.push({command:operations.setGlyphs,args:[r.glyphs]}),isEqual(e.transition,r.transition)||o.push({command:operations.setTransition,args:[r.transition]}),isEqual(e.light,r.light)||o.push({command:operations.setLight,args:[r.light]});var a={},t=[];diffSources(e.sources,r.sources,t,a);var s=[];e.layers&&e.layers.forEach(function(e){a[e.source]?o.push({command:operations.removeLayer,args:[e.id]}):s.push(e)}),o=o.concat(t),diffLayers(s,r.layers,o)}catch(e){o=[{command:operations.setStyle,args:[r]}]}return o}var isEqual=_dereq_("./util/deep_equal"),operations={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight"};module.exports=diffStyles,module.exports.operations=operations;
},{"./util/deep_equal":175}],142:[function(_dereq_,module,exports){
"use strict";function ValidationError(i,e,l){this.message=(i?i+": ":"")+l,null!==e&&void 0!==e&&e.__line__&&(this.line=e.__line__)}module.exports=ValidationError;
},{}],143:[function(_dereq_,module,exports){
"use strict";function varargs(r){return{type:r}}function stringifySignature(r){return Array.isArray(r)?"("+r.map(toString).join(", ")+")":"("+toString(r.type)+"...)"}var ref=_dereq_("./types"),toString=ref.toString,ParsingContext=_dereq_("./parsing_context"),EvaluationContext=_dereq_("./evaluation_context"),CompoundExpression=function(r,e,n,t){this.name=r,this.type=e,this._evaluate=n,this.args=t};CompoundExpression.prototype.evaluate=function(r){return this._evaluate(r,this.args)},CompoundExpression.prototype.eachChild=function(r){this.args.forEach(r)},CompoundExpression.prototype.possibleOutputs=function(){return[void 0]},CompoundExpression.parse=function(r,e){var n=r[0],t=CompoundExpression.definitions[n];if(!t)return e.error('Unknown expression "'+n+'". If you wanted a literal array, use ["literal", [...]].',0);for(var o=Array.isArray(t)?t[0]:t.type,i=Array.isArray(t)?[[t[1],t[2]]]:t.overloads,s=i.filter(function(e){var n=e[0];return!Array.isArray(n)||n.length===r.length-1}),a=[],u=1;u<r.length;u++){var p=r[u],l=void 0;if(1===s.length){var g=s[0][0];l=Array.isArray(g)?g[u-1]:g.type}var y=e.parse(p,1+a.length,l);if(!y)return null;a.push(y)}for(var f=null,h=0,d=s;h<d.length;h+=1){var v=d[h],c=v[0],x=v[1];if(f=new ParsingContext(e.registry,e.path,null,e.scope),Array.isArray(c)&&c.length!==a.length)f.error("Expected "+c.length+" arguments, but found "+a.length+" instead.");else{for(var m=0;m<a.length;m++){var C=Array.isArray(c)?c[m]:c.type,E=a[m];f.concat(m+1).checkSubtype(C,E.type)}if(0===f.errors.length)return new CompoundExpression(n,o,x,a)}}if(1===s.length)e.errors.push.apply(e.errors,f.errors);else{var A=s.length?s:i,S=A.map(function(r){return stringifySignature(r[0])}).join(" | "),b=a.map(function(r){return toString(r.type)}).join(", ");e.error("Expected arguments of type "+S+", but found ("+b+") instead.")}return null},CompoundExpression.register=function(r,e){CompoundExpression.definitions=e;for(var n in e)r[n]=CompoundExpression},module.exports={CompoundExpression:CompoundExpression,varargs:varargs};
},{"./evaluation_context":158,"./parsing_context":161,"./types":166}],144:[function(_dereq_,module,exports){
"use strict";var ref=_dereq_("../types"),toString=ref.toString,array=ref.array,ValueType=ref.ValueType,StringType=ref.StringType,NumberType=ref.NumberType,BooleanType=ref.BooleanType,checkSubtype=ref.checkSubtype,ref$1=_dereq_("../values"),typeOf=ref$1.typeOf,RuntimeError=_dereq_("../runtime_error"),types={string:StringType,number:NumberType,boolean:BooleanType},ArrayAssertion=function(e,r){this.type=e,this.input=r};ArrayAssertion.parse=function(e,r){if(e.length<2||e.length>4)return r.error("Expected 1, 2, or 3 arguments, but found "+(e.length-1)+" instead.");var t,n;if(e.length>2){var i=e[1];if("string"!=typeof i||!(i in types))return r.error('The item type argument of "array" must be one of string, number, boolean',1);t=types[i]}else t=ValueType;if(e.length>3){if("number"!=typeof e[2]||e[2]<0||e[2]!==Math.floor(e[2]))return r.error('The length argument to "array" must be a positive integer literal',2);n=e[2]}var o=array(t,n),u=r.parse(e[e.length-1],e.length-1,ValueType);return u?new ArrayAssertion(o,u):null},ArrayAssertion.prototype.evaluate=function(e){var r=this.input.evaluate(e);if(checkSubtype(this.type,typeOf(r)))throw new RuntimeError("Expected value to be of type "+toString(this.type)+", but found "+toString(typeOf(r))+" instead.");return r},ArrayAssertion.prototype.eachChild=function(e){e(this.input)},ArrayAssertion.prototype.possibleOutputs=function(){return this.input.possibleOutputs()},module.exports=ArrayAssertion;
},{"../runtime_error":163,"../types":166,"../values":167}],145:[function(_dereq_,module,exports){
"use strict";var ref=_dereq_("../types"),ObjectType=ref.ObjectType,ValueType=ref.ValueType,StringType=ref.StringType,NumberType=ref.NumberType,BooleanType=ref.BooleanType,RuntimeError=_dereq_("../runtime_error"),ref$1=_dereq_("../types"),checkSubtype=ref$1.checkSubtype,toString=ref$1.toString,ref$2=_dereq_("../values"),typeOf=ref$2.typeOf,types={string:StringType,number:NumberType,boolean:BooleanType,object:ObjectType},Assertion=function(e,r){this.type=e,this.args=r};Assertion.parse=function(e,r){if(e.length<2)return r.error("Expected at least one argument.");for(var t=e[0],n=types[t],o=[],p=1;p<e.length;p++){var s=r.parse(e[p],p,ValueType);if(!s)return null;o.push(s)}return new Assertion(n,o)},Assertion.prototype.evaluate=function(e){for(var r=this,t=0;t<this.args.length;t++){var n=r.args[t].evaluate(e);if(!checkSubtype(r.type,typeOf(n)))return n;if(t===r.args.length-1)throw new RuntimeError("Expected value to be of type "+toString(r.type)+", but found "+toString(typeOf(n))+" instead.")}return null},Assertion.prototype.eachChild=function(e){this.args.forEach(e)},Assertion.prototype.possibleOutputs=function(){return(e=[]).concat.apply(e,this.args.map(function(e){return e.possibleOutputs()}));var e},module.exports=Assertion;
},{"../runtime_error":163,"../types":166,"../values":167}],146:[function(_dereq_,module,exports){
"use strict";var ref=_dereq_("../types"),array=ref.array,ValueType=ref.ValueType,NumberType=ref.NumberType,RuntimeError=_dereq_("../runtime_error"),At=function(e,t,r){this.type=e,this.index=t,this.input=r};At.parse=function(e,t){if(3!==e.length)return t.error("Expected 2 arguments, but found "+(e.length-1)+" instead.");var r=t.parse(e[1],1,NumberType),n=t.parse(e[2],2,array(t.expectedType||ValueType));if(!r||!n)return null;var u=n.type;return new At(u.itemType,r,n)},At.prototype.evaluate=function(e){var t=this.index.evaluate(e),r=this.input.evaluate(e);if(t<0||t>=r.length)throw new RuntimeError("Array index out of bounds: "+t+" > "+r.length+".");if(t!==Math.floor(t))throw new RuntimeError("Array index must be an integer, but found "+t+" instead.");return r[t]},At.prototype.eachChild=function(e){e(this.index),e(this.input)},At.prototype.possibleOutputs=function(){return[void 0]},module.exports=At;
},{"../runtime_error":163,"../types":166}],147:[function(_dereq_,module,exports){
"use strict";var ref=_dereq_("../types"),BooleanType=ref.BooleanType,Case=function(e,t,r){this.type=e,this.branches=t,this.otherwise=r};Case.parse=function(e,t){if(e.length<4)return t.error("Expected at least 3 arguments, but found only "+(e.length-1)+".");if(e.length%2!=0)return t.error("Expected an odd number of arguments.");var r;t.expectedType&&"value"!==t.expectedType.kind&&(r=t.expectedType);for(var n=[],a=1;a<e.length-1;a+=2){var s=t.parse(e[a],a,BooleanType);if(!s)return null;var o=t.parse(e[a+1],a+1,r);if(!o)return null;n.push([s,o]),r=r||o.type}var u=t.parse(e[e.length-1],e.length-1,r);return u?new Case(r,n,u):null},Case.prototype.evaluate=function(e){for(var t=this,r=0,n=t.branches;r<n.length;r+=1){var a=n[r],s=a[0],o=a[1];if(s.evaluate(e))return o.evaluate(e)}return this.otherwise.evaluate(e)},Case.prototype.eachChild=function(e){for(var t=this,r=0,n=t.branches;r<n.length;r+=1){var a=n[r],s=a[0],o=a[1];e(s),e(o)}e(this.otherwise)},Case.prototype.possibleOutputs=function(){return(e=[]).concat.apply(e,this.branches.map(function(e){e[0];return e[1].possibleOutputs()})).concat(this.otherwise.possibleOutputs());var e},module.exports=Case;
},{"../types":166}],148:[function(_dereq_,module,exports){
"use strict";var ref=_dereq_("../types"),checkSubtype=ref.checkSubtype,ValueType=ref.ValueType,Coalesce=function(e,t){this.type=e,this.args=t};Coalesce.parse=function(e,t){if(e.length<2)return t.error("Expectected at least one argument.");var r=null,a=t.expectedType;a&&"value"!==a.kind&&(r=a);for(var n=[],o=0,u=e.slice(1);o<u.length;o+=1){var s=u[o],l=t.parse(s,1+n.length,r,void 0,{omitTypeAnnotations:!0});if(!l)return null;r=r||l.type,n.push(l)}return a&&n.some(function(e){return checkSubtype(a,e.type)})?new Coalesce(ValueType,n):new Coalesce(r,n)},Coalesce.prototype.evaluate=function(e){for(var t=this,r=null,a=0,n=t.args;a<n.length;a+=1){if(null!==(r=n[a].evaluate(e)))break}return r},Coalesce.prototype.eachChild=function(e){this.args.forEach(e)},Coalesce.prototype.possibleOutputs=function(){return(e=[]).concat.apply(e,this.args.map(function(e){return e.possibleOutputs()}));var e},module.exports=Coalesce;
},{"../types":166}],149:[function(_dereq_,module,exports){
"use strict";var ref=_dereq_("../types"),ColorType=ref.ColorType,ValueType=ref.ValueType,NumberType=ref.NumberType,ref$1=_dereq_("../values"),Color=ref$1.Color,validateRGBA=ref$1.validateRGBA,RuntimeError=_dereq_("../runtime_error"),types={"to-number":NumberType,"to-color":ColorType},Coercion=function(r,e){this.type=r,this.args=e};Coercion.parse=function(r,e){if(r.length<2)return e.error("Expected at least one argument.");for(var t=r[0],o=types[t],n=[],i=1;i<r.length;i++){var a=e.parse(r[i],i,ValueType);if(!a)return null;n.push(a)}return new Coercion(o,n)},Coercion.prototype.evaluate=function(r){var e=this;if("color"===this.type.kind){for(var t,o,n=0,i=e.args;n<i.length;n+=1){if(t=i[n].evaluate(r),o=null,"string"==typeof t){var a=r.parseColor(t);if(a)return a}else if(Array.isArray(t)&&!(o=t.length<3||t.length>4?"Invalid rbga value "+JSON.stringify(t)+": expected an array containing either three or four numeric values.":validateRGBA(t[0],t[1],t[2],t[3])))return new Color(t[0]/255,t[1]/255,t[2]/255,t[3])}throw new RuntimeError(o||"Could not parse color from value '"+("string"==typeof t?t:JSON.stringify(t))+"'")}for(var u=null,l=0,s=e.args;l<s.length;l+=1){if(null!==(u=s[l].evaluate(r))){var p=Number(u);if(!isNaN(p))return p}}throw new RuntimeError("Could not convert "+JSON.stringify(u)+" to number.")},Coercion.prototype.eachChild=function(r){this.args.forEach(r)},Coercion.prototype.possibleOutputs=function(){return(r=[]).concat.apply(r,this.args.map(function(r){return r.possibleOutputs()}));var r},module.exports=Coercion;
},{"../runtime_error":163,"../types":166,"../values":167}],150:[function(_dereq_,module,exports){
"use strict";function isComparableType(e){return"string"===e.kind||"number"===e.kind||"boolean"===e.kind||"null"===e.kind}function makeComparison(e){return function(){function t(e,t){this.type=BooleanType,this.lhs=e,this.rhs=t}return t.parse=function(e,r){if(3!==e.length)return r.error("Expected two arguments.");var n=r.parse(e[1],1,ValueType);if(!n)return null;var o=r.parse(e[2],2,ValueType);return o?isComparableType(n.type)||isComparableType(o.type)?n.type.kind!==o.type.kind&&"value"!==n.type.kind&&"value"!==o.type.kind?r.error("Cannot compare "+toString(n.type)+" and "+toString(o.type)+"."):new t(n,o):r.error("Expected at least one argument to be a string, number, boolean, or null, but found ("+toString(n.type)+", "+toString(o.type)+") instead."):null},t.prototype.evaluate=function(t){return e(this.lhs.evaluate(t),this.rhs.evaluate(t))},t.prototype.eachChild=function(e){e(this.lhs),e(this.rhs)},t.prototype.possibleOutputs=function(){return[!0,!1]},t}()}var ref=_dereq_("../types"),ValueType=ref.ValueType,BooleanType=ref.BooleanType,ref$1=_dereq_("../types"),toString=ref$1.toString;module.exports={Equals:makeComparison(function(e,t){return e===t}),NotEquals:makeComparison(function(e,t){return e!==t})};
},{"../types":166}],151:[function(_dereq_,module,exports){
"use strict";function rgba(e,r){var t=r[0],a=r[1],n=r[2],u=r[3];t=t.evaluate(e),a=a.evaluate(e),n=n.evaluate(e);var o=u?u.evaluate(e):1,p=validateRGBA(t,a,n,o);if(p)throw new RuntimeError(p);return new Color(t/255*o,a/255*o,n/255*o,o)}function has(e,r){return e in r}function get(e,r){var t=r[e];return void 0===t?null:t}function length(e,r){return r[0].evaluate(e).length}function lt(e,r){var t=r[0],a=r[1];return t.evaluate(e)<a.evaluate(e)}function gt(e,r){var t=r[0],a=r[1];return t.evaluate(e)>a.evaluate(e)}function lteq(e,r){var t=r[0],a=r[1];return t.evaluate(e)<=a.evaluate(e)}function gteq(e,r){var t=r[0],a=r[1];return t.evaluate(e)>=a.evaluate(e)}function binarySearch(e,r,t,a){for(;t<=a;){var n=t+a>>1;if(r[n]===e)return!0;r[n]>e?a=n-1:t=n+1}return!1}function arrinSearch(e,r,t,a){for(;t<=a;){if(!e)return!1;if(e.split(",").indexOf(r[t])>-1)return!0;t+=1}return!1}var ref=_dereq_("../types"),NumberType=ref.NumberType,StringType=ref.StringType,BooleanType=ref.BooleanType,ColorType=ref.ColorType,ObjectType=ref.ObjectType,ValueType=ref.ValueType,ErrorType=ref.ErrorType,array=ref.array,toString=ref.toString,ref$1=_dereq_("../values"),typeOf=ref$1.typeOf,Color=ref$1.Color,validateRGBA=ref$1.validateRGBA,ref$2=_dereq_("../compound_expression"),CompoundExpression=ref$2.CompoundExpression,varargs=ref$2.varargs,RuntimeError=_dereq_("../runtime_error"),Let=_dereq_("./let"),Var=_dereq_("./var"),Literal=_dereq_("./literal"),Assertion=_dereq_("./assertion"),ArrayAssertion=_dereq_("./array"),Coercion=_dereq_("./coercion"),At=_dereq_("./at"),Match=_dereq_("./match"),Case=_dereq_("./case"),Step=_dereq_("./step"),Interpolate=_dereq_("./interpolate"),Coalesce=_dereq_("./coalesce"),ref$3=_dereq_("./equals"),Equals=ref$3.Equals,NotEquals=ref$3.NotEquals,expressions={"==":Equals,"!=":NotEquals,array:ArrayAssertion,at:At,boolean:Assertion,case:Case,coalesce:Coalesce,interpolate:Interpolate,let:Let,literal:Literal,match:Match,number:Assertion,object:Assertion,step:Step,string:Assertion,"to-color":Coercion,"to-number":Coercion,var:Var};CompoundExpression.register(expressions,{error:[ErrorType,[StringType],function(e,r){var t=r[0];throw new RuntimeError(t.evaluate(e))}],typeof:[StringType,[ValueType],function(e,r){var t=r[0];return toString(typeOf(t.evaluate(e)))}],"to-string":[StringType,[ValueType],function(e,r){var t=r[0];t=t.evaluate(e);var a=typeof t;return null===t||"string"===a||"number"===a||"boolean"===a?String(t):t instanceof Color?t.toString():JSON.stringify(t)}],"to-boolean":[BooleanType,[ValueType],function(e,r){var t=r[0];return Boolean(t.evaluate(e))}],"to-rgba":[array(NumberType,4),[ColorType],function(e,r){var t=r[0],a=t.evaluate(e),n=a.r,u=a.g,o=a.b,p=a.a;return[255*n/p,255*u/p,255*o/p,p]}],rgb:[ColorType,[NumberType,NumberType,NumberType],rgba],rgba:[ColorType,[NumberType,NumberType,NumberType,NumberType],rgba],length:{type:NumberType,overloads:[[[StringType],length],[[array(ValueType)],length]]},has:{type:BooleanType,overloads:[[[StringType],function(e,r){return has(r[0].evaluate(e),e.properties())}],[[StringType,ObjectType],function(e,r){var t=r[0],a=r[1];return has(t.evaluate(e),a.evaluate(e))}]]},get:{type:ValueType,overloads:[[[StringType],function(e,r){return get(r[0].evaluate(e),e.properties())}],[[StringType,ObjectType],function(e,r){var t=r[0],a=r[1];return get(t.evaluate(e),a.evaluate(e))}]]},properties:[ObjectType,[],function(e){return e.properties()}],"geometry-type":[StringType,[],function(e){return e.geometryType()}],id:[ValueType,[],function(e){return e.id()}],zoom:[NumberType,[],function(e){return e.globals.zoom}],"heatmap-density":[NumberType,[],function(e){return e.globals.heatmapDensity||0}],"+":[NumberType,varargs(NumberType),function(e,r){for(var t=0,a=0,n=r;a<n.length;a+=1){t+=n[a].evaluate(e)}return t}],"*":[NumberType,varargs(NumberType),function(e,r){for(var t=1,a=0,n=r;a<n.length;a+=1){t*=n[a].evaluate(e)}return t}],"-":{type:NumberType,overloads:[[[NumberType,NumberType],function(e,r){var t=r[0],a=r[1];return t.evaluate(e)-a.evaluate(e)}],[[NumberType],function(e,r){return-r[0].evaluate(e)}]]},"/":[NumberType,[NumberType,NumberType],function(e,r){var t=r[0],a=r[1];return t.evaluate(e)/a.evaluate(e)}],"%":[NumberType,[NumberType,NumberType],function(e,r){var t=r[0],a=r[1];return t.evaluate(e)%a.evaluate(e)}],ln2:[NumberType,[],function(){return Math.LN2}],pi:[NumberType,[],function(){return Math.PI}],e:[NumberType,[],function(){return Math.E}],"^":[NumberType,[NumberType,NumberType],function(e,r){var t=r[0],a=r[1];return Math.pow(t.evaluate(e),a.evaluate(e))}],sqrt:[NumberType,[NumberType],function(e,r){var t=r[0];return Math.sqrt(t.evaluate(e))}],log10:[NumberType,[NumberType],function(e,r){var t=r[0];return Math.log10(t.evaluate(e))}],ln:[NumberType,[NumberType],function(e,r){var t=r[0];return Math.log(t.evaluate(e))}],log2:[NumberType,[NumberType],function(e,r){var t=r[0];return Math.log2(t.evaluate(e))}],sin:[NumberType,[NumberType],function(e,r){var t=r[0];return Math.sin(t.evaluate(e))}],cos:[NumberType,[NumberType],function(e,r){var t=r[0];return Math.cos(t.evaluate(e))}],tan:[NumberType,[NumberType],function(e,r){var t=r[0];return Math.tan(t.evaluate(e))}],asin:[NumberType,[NumberType],function(e,r){var t=r[0];return Math.asin(t.evaluate(e))}],acos:[NumberType,[NumberType],function(e,r){var t=r[0];return Math.acos(t.evaluate(e))}],atan:[NumberType,[NumberType],function(e,r){var t=r[0];return Math.atan(t.evaluate(e))}],min:[NumberType,varargs(NumberType),function(e,r){return Math.min.apply(Math,r.map(function(r){return r.evaluate(e)}))}],max:[NumberType,varargs(NumberType),function(e,r){return Math.max.apply(Math,r.map(function(r){return r.evaluate(e)}))}],"filter-==":[BooleanType,[StringType,ValueType],function(e,r){var t=r[0],a=r[1];return e.properties()[t.value]===a.value}],"filter-id-==":[BooleanType,[ValueType],function(e,r){var t=r[0];return e.id()===t.value}],"filter-type-==":[BooleanType,[StringType],function(e,r){var t=r[0];return e.geometryType()===t.value}],"filter-<":[BooleanType,[StringType,ValueType],function(e,r){var t=r[0],a=r[1],n=e.properties()[t.value],u=a.value;return typeof n==typeof u&&n<u}],"filter-id-<":[BooleanType,[ValueType],function(e,r){var t=r[0],a=e.id(),n=t.value;return typeof a==typeof n&&a<n}],"filter->":[BooleanType,[StringType,ValueType],function(e,r){var t=r[0],a=r[1],n=e.properties()[t.value],u=a.value;return typeof n==typeof u&&n>u}],"filter-id->":[BooleanType,[ValueType],function(e,r){var t=r[0],a=e.id(),n=t.value;return typeof a==typeof n&&a>n}],"filter-<=":[BooleanType,[StringType,ValueType],function(e,r){var t=r[0],a=r[1],n=e.properties()[t.value],u=a.value;return typeof n==typeof u&&n<=u}],"filter-id-<=":[BooleanType,[ValueType],function(e,r){var t=r[0],a=e.id(),n=t.value;return typeof a==typeof n&&a<=n}],"filter->=":[BooleanType,[StringType,ValueType],function(e,r){var t=r[0],a=r[1],n=e.properties()[t.value],u=a.value;return typeof n==typeof u&&n>=u}],"filter-id->=":[BooleanType,[ValueType],function(e,r){var t=r[0],a=e.id(),n=t.value;return typeof a==typeof n&&a>=n}],"filter-has":[BooleanType,[ValueType],function(e,r){return r[0].value in e.properties()}],"filter-has-id":[BooleanType,[],function(e){return null!==e.id()}],"filter-type-in":[BooleanType,[array(StringType)],function(e,r){return r[0].value.indexOf(e.geometryType())>=0}],"filter-type-arrin":[BooleanType,[array(StringType)],function(e,r){return r[0].value.indexOf(e.geometryType())>=0}],"filter-arrin":[BooleanType,[StringType,array(ValueType)],function(e,r){var t=r[0],a=r[1];return arrinSearch(e.properties()[t.value],a.value,0,a.value.length-1)}],"filter-id-in":[BooleanType,[array(ValueType)],function(e,r){return r[0].value.indexOf(e.id())>=0}],"filter-in-small":[BooleanType,[StringType,array(ValueType)],function(e,r){var t=r[0];return r[1].value.indexOf(e.properties()[t.value])>=0}],"filter-in-large":[BooleanType,[StringType,array(ValueType)],function(e,r){var t=r[0],a=r[1];return binarySearch(e.properties()[t.value],a.value,0,a.value.length-1)}],">":{type:BooleanType,overloads:[[[NumberType,NumberType],gt],[[StringType,StringType],gt]]},"<":{type:BooleanType,overloads:[[[NumberType,NumberType],lt],[[StringType,StringType],lt]]},">=":{type:BooleanType,overloads:[[[NumberType,NumberType],gteq],[[StringType,StringType],gteq]]},"<=":{type:BooleanType,overloads:[[[NumberType,NumberType],lteq],[[StringType,StringType],lteq]]},all:{type:BooleanType,overloads:[[[BooleanType,BooleanType],function(e,r){var t=r[0],a=r[1];return t.evaluate(e)&&a.evaluate(e)}],[varargs(BooleanType),function(e,r){for(var t=0,a=r;t<a.length;t+=1){if(!a[t].evaluate(e))return!1}return!0}]]},any:{type:BooleanType,overloads:[[[BooleanType,BooleanType],function(e,r){var t=r[0],a=r[1];return t.evaluate(e)||a.evaluate(e)}],[varargs(BooleanType),function(e,r){for(var t=0,a=r;t<a.length;t+=1){if(a[t].evaluate(e))return!0}return!1}]]},"!":[BooleanType,[BooleanType],function(e,r){return!r[0].evaluate(e)}],upcase:[StringType,[StringType],function(e,r){return r[0].evaluate(e).toUpperCase()}],downcase:[StringType,[StringType],function(e,r){return r[0].evaluate(e).toLowerCase()}],concat:[StringType,varargs(StringType),function(e,r){return r.map(function(r){return r.evaluate(e)}).join("")}]}),module.exports=expressions;
},{"../compound_expression":143,"../runtime_error":163,"../types":166,"../values":167,"./array":144,"./assertion":145,"./at":146,"./case":147,"./coalesce":148,"./coercion":149,"./equals":150,"./interpolate":152,"./let":153,"./literal":154,"./match":155,"./step":156,"./var":157}],152:[function(_dereq_,module,exports){
"use strict";function exponentialInterpolation(e,t,r,n){var i=n-r,o=e-r;return 0===i?0:1===t?o/i:(Math.pow(t,o)-1)/(Math.pow(t,i)-1)}var UnitBezier=_dereq_("../../../_minemap_/unitbezier"),interpolate=_dereq_("../../util/interpolate"),ref=_dereq_("../types"),toString=ref.toString,NumberType=ref.NumberType,ref$1=_dereq_("../stops"),findStopLessThanOrEqualTo=ref$1.findStopLessThanOrEqualTo,Interpolate=function(e,t,r,n){var i=this;this.type=e,this.interpolation=t,this.input=r,this.labels=[],this.outputs=[];for(var o=0,a=n;o<a.length;o+=1){var u=a[o],p=u[0],l=u[1];i.labels.push(p),i.outputs.push(l)}};Interpolate.interpolationFactor=function(e,t,r,n){var i=0;if("exponential"===e.name)i=exponentialInterpolation(t,e.base,r,n);else if("linear"===e.name)i=exponentialInterpolation(t,1,r,n);else if("cubic-bezier"===e.name){var o=e.controlPoints,a=new UnitBezier(o[0],o[1],o[2],o[3]);i=a.solve(exponentialInterpolation(t,1,r,n))}return i},Interpolate.parse=function(e,t){var r=e[1],n=e[2],i=e.slice(3);if(!Array.isArray(r)||0===r.length)return t.error("Expected an interpolation type expression.",1);if("linear"===r[0])r={name:"linear"};else if("exponential"===r[0]){var o=r[1];if("number"!=typeof o)return t.error("Exponential interpolation requires a numeric base.",1,1);r={name:"exponential",base:o}}else{if("cubic-bezier"!==r[0])return t.error("Unknown interpolation type "+String(r[0]),1,0);var a=r.slice(1);if(4!==a.length||a.some(function(e){return"number"!=typeof e||e<0||e>1}))return t.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);r={name:"cubic-bezier",controlPoints:a}}if(e.length-1<4)return t.error("Expected at least 4 arguments, but found only "+(e.length-1)+".");if((e.length-1)%2!=0)return t.error("Expected an even number of arguments.");if(!(n=t.parse(n,2,NumberType)))return null;var u=[],p=null;t.expectedType&&"value"!==t.expectedType.kind&&(p=t.expectedType);for(var l=0;l<i.length;l+=2){var s=i[l],f=i[l+1],c=l+3,h=l+4;if("number"!=typeof s)return t.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',c);if(u.length&&u[u.length-1][0]>=s)return t.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',c);var v=t.parse(f,h,p);if(!v)return null;p=p||v.type,u.push([s,v])}return"number"===p.kind||"color"===p.kind||"array"===p.kind&&"number"===p.itemType.kind&&"number"==typeof p.N?new Interpolate(p,r,n,u):t.error("Type "+toString(p)+" is not interpolatable.")},Interpolate.prototype.evaluate=function(e){var t=this.labels,r=this.outputs;if(1===t.length)return r[0].evaluate(e);var n=this.input.evaluate(e);if(n<=t[0])return r[0].evaluate(e);var i=t.length;if(n>=t[i-1])return r[i-1].evaluate(e);var o=findStopLessThanOrEqualTo(t,n),a=t[o],u=t[o+1],p=Interpolate.interpolationFactor(this.interpolation,n,a,u),l=r[o].evaluate(e),s=r[o+1].evaluate(e);return interpolate[this.type.kind.toLowerCase()](l,s,p)},Interpolate.prototype.eachChild=function(e){var t=this;e(this.input);for(var r=0,n=t.outputs;r<n.length;r+=1){e(n[r])}},Interpolate.prototype.possibleOutputs=function(){return(e=[]).concat.apply(e,this.outputs.map(function(e){return e.possibleOutputs()}));var e},module.exports=Interpolate;
},{"../../../_minemap_/unitbezier":33,"../../util/interpolate":178,"../stops":165,"../types":166}],153:[function(_dereq_,module,exports){
"use strict";var Let=function(t,e){this.type=e.type,this.bindings=[].concat(t),this.result=e};Let.prototype.evaluate=function(t){t.pushScope(this.bindings);var e=this.result.evaluate(t);return t.popScope(),e},Let.prototype.eachChild=function(t){for(var e=this,r=0,n=e.bindings;r<n.length;r+=1){t(n[r][1])}t(this.result)},Let.parse=function(t,e){if(t.length<4)return e.error("Expected at least 3 arguments, but found "+(t.length-1)+" instead.");for(var r=[],n=1;n<t.length-1;n+=2){var s=t[n];if("string"!=typeof s)return e.error("Expected string, but found "+typeof s+" instead.",n);if(/[^a-zA-Z0-9_]/.test(s))return e.error("Variable names must contain only alphanumeric characters or '_'.",n);var i=e.parse(t[n+1],n+1);if(!i)return null;r.push([s,i])}var u=e.parse(t[t.length-1],t.length-1,void 0,r);return u?new Let(r,u):null},Let.prototype.possibleOutputs=function(){return this.result.possibleOutputs()},module.exports=Let;
},{}],154:[function(_dereq_,module,exports){
"use strict";var ref=_dereq_("../values"),isValue=ref.isValue,typeOf=ref.typeOf,Literal=function(e,r){this.type=e,this.value=r};Literal.parse=function(e,r){if(2!==e.length)return r.error("'literal' expression requires exactly one argument, but found "+(e.length-1)+" instead.");if(!isValue(e[1]))return r.error("invalid value");var t=e[1],i=typeOf(t),a=r.expectedType;return"array"!==i.kind||0!==i.N||!a||"array"!==a.kind||"number"==typeof a.N&&0!==a.N||(i=a),new Literal(i,t)},Literal.prototype.evaluate=function(){return this.value},Literal.prototype.eachChild=function(){},Literal.prototype.possibleOutputs=function(){return[this.value]},module.exports=Literal;
},{"../values":167}],155:[function(_dereq_,module,exports){
"use strict";var ref=_dereq_("../values"),typeOf=ref.typeOf,Match=function(e,t,r,n,u,s){this.inputType=e,this.type=t,this.input=r,this.cases=n,this.outputs=u,this.otherwise=s};Match.parse=function(e,t){if(e.length<5)return t.error("Expected at least 4 arguments, but found only "+(e.length-1)+".");if(e.length%2!=1)return t.error("Expected an even number of arguments.");var r,n;t.expectedType&&"value"!==t.expectedType.kind&&(n=t.expectedType);for(var u={},s=[],a=2;a<e.length-1;a+=2){var i=e[a],o=e[a+1];Array.isArray(i)||(i=[i]);var p=t.concat(a);if(0===i.length)return p.error("Expected at least one branch label.");for(var h=0,l=i;h<l.length;h+=1){var c=l[h];if("number"!=typeof c&&"string"!=typeof c)return p.error("Branch labels must be numbers or strings.");if("number"==typeof c&&Math.abs(c)>Number.MAX_SAFE_INTEGER)return p.error("Branch labels must be integers no larger than "+Number.MAX_SAFE_INTEGER+".");if("number"==typeof c&&Math.floor(c)!==c)return p.error("Numeric branch labels must be integer values.");if(r){if(p.checkSubtype(r,typeOf(c)))return null}else r=typeOf(c);if(void 0!==u[String(c)])return p.error("Branch labels must be unique.");u[String(c)]=s.length}var f=t.parse(o,a,n);if(!f)return null;n=n||f.type,s.push(f)}var b=t.parse(e[1],1,r);if(!b)return null;var y=t.parse(e[e.length-1],e.length-1,n);return y?new Match(r,n,b,u,s,y):null},Match.prototype.evaluate=function(e){var t=this.input.evaluate(e);return(this.outputs[this.cases[t]]||this.otherwise).evaluate(e)},Match.prototype.eachChild=function(e){e(this.input),this.outputs.forEach(e),e(this.otherwise)},Match.prototype.possibleOutputs=function(){return(e=[]).concat.apply(e,this.outputs.map(function(e){return e.possibleOutputs()})).concat(this.otherwise.possibleOutputs());var e},module.exports=Match;
},{"../values":167}],156:[function(_dereq_,module,exports){
"use strict";var ref=_dereq_("../types"),NumberType=ref.NumberType,ref$1=_dereq_("../stops"),findStopLessThanOrEqualTo=ref$1.findStopLessThanOrEqualTo,Step=function(e,t,r){var u=this;this.type=e,this.input=t,this.labels=[],this.outputs=[];for(var n=0,s=r;n<s.length;n+=1){var p=s[n],a=p[0],i=p[1];u.labels.push(a),u.outputs.push(i)}};Step.parse=function(e,t){var r=e[1],u=e.slice(2);if(e.length-1<4)return t.error("Expected at least 4 arguments, but found only "+(e.length-1)+".");if((e.length-1)%2!=0)return t.error("Expected an even number of arguments.");if(!(r=t.parse(r,1,NumberType)))return null;var n=[],s=null;t.expectedType&&"value"!==t.expectedType.kind&&(s=t.expectedType),u.unshift(-1/0);for(var p=0;p<u.length;p+=2){var a=u[p],i=u[p+1],o=p+1,l=p+2;if("number"!=typeof a)return t.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',o);if(n.length&&n[n.length-1][0]>=a)return t.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',o);var f=t.parse(i,l,s);if(!f)return null;s=s||f.type,n.push([a,f])}return new Step(s,r,n)},Step.prototype.evaluate=function(e){var t=this.labels,r=this.outputs;if(1===t.length)return r[0].evaluate(e);var u=this.input.evaluate(e);if(u<=t[0])return r[0].evaluate(e);var n=t.length;return u>=t[n-1]?r[n-1].evaluate(e):r[findStopLessThanOrEqualTo(t,u)].evaluate(e)},Step.prototype.eachChild=function(e){var t=this;e(this.input);for(var r=0,u=t.outputs;r<u.length;r+=1){e(u[r])}},Step.prototype.possibleOutputs=function(){return(e=[]).concat.apply(e,this.outputs.map(function(e){return e.possibleOutputs()}));var e},module.exports=Step;
},{"../stops":165,"../types":166}],157:[function(_dereq_,module,exports){
"use strict";var Var=function(e,r){this.type=r,this.name=e};Var.parse=function(e,r){if(2!==e.length||"string"!=typeof e[1])return r.error("'var' expression requires exactly one string literal argument.");var t=e[1];return r.scope.has(t)?new Var(t,r.scope.get(t).type):r.error('Unknown variable "'+t+'". Make sure "'+t+'" has been bound in an enclosing "let" expression before using it.',1)},Var.prototype.evaluate=function(e){return e.scope.get(this.name).evaluate(e)},Var.prototype.eachChild=function(){},Var.prototype.possibleOutputs=function(){return[void 0]},module.exports=Var;
},{}],158:[function(_dereq_,module,exports){
"use strict";var Scope=_dereq_("./scope"),ref=_dereq_("./values"),Color=ref.Color,geometryTypes=["Unknown","Point","LineString","Polygon"],EvaluationContext=function(){this.scope=new Scope,this._parseColorCache={}};EvaluationContext.prototype.id=function(){return this.feature&&"id"in this.feature?this.feature.id:null},EvaluationContext.prototype.geometryType=function(){return this.feature?"number"==typeof this.feature.type?geometryTypes[this.feature.type]:this.feature.type:null},EvaluationContext.prototype.properties=function(){return this.feature&&this.feature.properties||{}},EvaluationContext.prototype.pushScope=function(t){this.scope=this.scope.concat(t)},EvaluationContext.prototype.popScope=function(){this.scope=this.scope.parent},EvaluationContext.prototype.parseColor=function(t){var e=this._parseColorCache[t];return e||(e=this._parseColorCache[t]=Color.parse(t)),e},module.exports=EvaluationContext;
},{"./scope":164,"./values":167}],159:[function(_dereq_,module,exports){
"use strict";function isExpression(e){return Array.isArray(e)&&e.length>0&&"string"==typeof e[0]&&e[0]in definitions}function createExpression(e,r,t){void 0===t&&(t={});var n=new ParsingContext(definitions,[],getExpectedType(r)),o=n.parse(e);return o?success(!1===t.handleErrors?new StyleExpression(o):new StyleExpressionWithErrorHandling(o,r)):error(n.errors)}function createPropertyExpression(e,r,t){if(void 0===t&&(t={}),e=createExpression(e,r,t),"error"===e.result)return e;var n=e.value.expression,o=isConstant.isFeatureConstant(n);if(!o&&!r["property-function"])return error([new ParsingError("","property expressions not supported")]);var i=isConstant.isGlobalPropertyConstant(n,["zoom"]);if(!i&&!1===r["zoom-function"])return error([new ParsingError("","zoom expressions not supported")]);var s=findZoomCurve(n);return s||i?s instanceof ParsingError?error([s]):s instanceof Interpolate&&"piecewise-constant"===r.function?error([new ParsingError("",'"interpolate" expressions cannot be used with this property')]):success(s?o?new ZoomDependentExpression("camera",e.value,s):new ZoomDependentExpression("composite",e.value,s):o?new ZoomConstantExpression("constant",e.value):new ZoomConstantExpression("source",e.value)):error([new ParsingError("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}function normalizePropertyExpression(e,r){if(isFunction(e))return new StylePropertyFunction(e,r);if(isExpression(e)){var t=createPropertyExpression(e,r);if("error"===t.result)throw new Error(t.value.map(function(e){return e.key+": "+e.message}).join(", "));return t.value}var n=e;return"string"==typeof e&&"color"===r.type&&(n=Color.parse(e)),{kind:"constant",evaluate:function(){return n}}}function findZoomCurve(e){var r=null;if(e instanceof Let)r=findZoomCurve(e.result);else if(e instanceof Coalesce)for(var t=0,n=e.args;t<n.length;t+=1){var o=n[t];if(r=findZoomCurve(o))break}else(e instanceof Step||e instanceof Interpolate)&&e.input instanceof CompoundExpression&&"zoom"===e.input.name&&(r=e);return r instanceof ParsingError?r:(e.eachChild(function(e){var t=findZoomCurve(e);t instanceof ParsingError?r=t:!r&&t?r=new ParsingError("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):r&&t&&r!==t&&(r=new ParsingError("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),r)}function getExpectedType(e){var r={color:ColorType,string:StringType,number:NumberType,enum:StringType,boolean:BooleanType};return"array"===e.type?array(r[e.value]||ValueType,e.length):r[e.type]||null}function getDefaultValue(e){return"color"===e.type&&isFunction(e.default)?new Color(0,0,0,0):"color"===e.type?Color.parse(e.default)||null:void 0===e.default?null:e.default}var extend=_dereq_("../util/extend"),ParsingError=_dereq_("./parsing_error"),ParsingContext=_dereq_("./parsing_context"),EvaluationContext=_dereq_("./evaluation_context"),ref=_dereq_("./compound_expression"),CompoundExpression=ref.CompoundExpression,Step=_dereq_("./definitions/step"),Interpolate=_dereq_("./definitions/interpolate"),Coalesce=_dereq_("./definitions/coalesce"),Let=_dereq_("./definitions/let"),definitions=_dereq_("./definitions"),isConstant=_dereq_("./is_constant"),RuntimeError=_dereq_("./runtime_error"),ref$1=_dereq_("../util/result"),success=ref$1.success,error=ref$1.error,StyleExpression=function(e){this.expression=e};StyleExpression.prototype.evaluate=function(e,r){return this._evaluator||(this._evaluator=new EvaluationContext),this._evaluator.globals=e,this._evaluator.feature=r,this.expression.evaluate(this._evaluator)};var StyleExpressionWithErrorHandling=function(e){function r(r,t){e.call(this,r),this._warningHistory={},this._defaultValue=getDefaultValue(t),"enum"===t.type&&(this._enumValues=t.values)}return e&&(r.__proto__=e),r.prototype=Object.create(e&&e.prototype),r.prototype.constructor=r,r.prototype.evaluate=function(e,r){this._evaluator||(this._evaluator=new EvaluationContext),this._evaluator.globals=e,this._evaluator.feature=r;try{var t=this.expression.evaluate(this._evaluator);if(null===t||void 0===t)return this._defaultValue;if(this._enumValues&&!(t in this._enumValues))throw new RuntimeError("Expected value to be one of "+Object.keys(this._enumValues).map(function(e){return JSON.stringify(e)}).join(", ")+", but found "+JSON.stringify(t)+" instead.");return t}catch(e){return this._warningHistory[e.message]||(this._warningHistory[e.message]=!0),this._defaultValue}},r}(StyleExpression),ZoomConstantExpression=function(e,r){this.kind=e,this._styleExpression=r};ZoomConstantExpression.prototype.evaluate=function(e,r){return this._styleExpression.evaluate(e,r)};var ZoomDependentExpression=function(e,r,t){this.kind=e,this.zoomStops=t.labels,this._styleExpression=r,t instanceof Interpolate&&(this._interpolationType=t.interpolation)};ZoomDependentExpression.prototype.evaluate=function(e,r){return this._styleExpression.evaluate(e,r)},ZoomDependentExpression.prototype.interpolationFactor=function(e,r,t){return this._interpolationType?Interpolate.interpolationFactor(this._interpolationType,e,r,t):0};var ref$2=_dereq_("../function"),isFunction=ref$2.isFunction,createFunction=ref$2.createFunction,ref$3=_dereq_("./values"),Color=ref$3.Color,StylePropertyFunction=function(e,r){this._parameters=e,this._specification=r,extend(this,createFunction(this._parameters,this._specification))};StylePropertyFunction.deserialize=function(e){return new StylePropertyFunction(e._parameters,e._specification)},StylePropertyFunction.serialize=function(e){return{_parameters:e._parameters,_specification:e._specification}},module.exports={StyleExpression:StyleExpression,StyleExpressionWithErrorHandling:StyleExpressionWithErrorHandling,isExpression:isExpression,createExpression:createExpression,createPropertyExpression:createPropertyExpression,normalizePropertyExpression:normalizePropertyExpression,ZoomConstantExpression:ZoomConstantExpression,ZoomDependentExpression:ZoomDependentExpression,StylePropertyFunction:StylePropertyFunction};var ref$4=_dereq_("./types"),ColorType=ref$4.ColorType,StringType=ref$4.StringType,NumberType=ref$4.NumberType,BooleanType=ref$4.BooleanType,ValueType=ref$4.ValueType,array=ref$4.array;
},{"../function":169,"../util/extend":176,"../util/result":180,"./compound_expression":143,"./definitions":151,"./definitions/coalesce":148,"./definitions/interpolate":152,"./definitions/let":153,"./definitions/step":156,"./evaluation_context":158,"./is_constant":160,"./parsing_context":161,"./parsing_error":162,"./runtime_error":163,"./types":166,"./values":167}],160:[function(_dereq_,module,exports){
"use strict";function isFeatureConstant(n){if(n instanceof CompoundExpression){if("get"===n.name&&1===n.args.length)return!1;if("has"===n.name&&1===n.args.length)return!1;if("properties"===n.name||"geometry-type"===n.name||"id"===n.name)return!1;if(0===n.name.indexOf("filter-"))return!1}var e=!0;return n.eachChild(function(n){e&&!isFeatureConstant(n)&&(e=!1)}),e}function isGlobalPropertyConstant(n,e){if(n instanceof CompoundExpression&&e.indexOf(n.name)>=0)return!1;var t=!0;return n.eachChild(function(n){t&&!isGlobalPropertyConstant(n,e)&&(t=!1)}),t}var ref=_dereq_("./compound_expression"),CompoundExpression=ref.CompoundExpression;module.exports={isFeatureConstant:isFeatureConstant,isGlobalPropertyConstant:isGlobalPropertyConstant};
},{"./compound_expression":143}],161:[function(_dereq_,module,exports){
"use strict";function isConstant(e){var r=_dereq_("./compound_expression"),t=r.CompoundExpression,n=_dereq_("./is_constant"),i=n.isGlobalPropertyConstant,o=n.isFeatureConstant;if(e instanceof _dereq_("./definitions/var"))return!1;if(e instanceof t&&"error"===e.name)return!1;var a=!0;return e.eachChild(function(e){e instanceof Literal||(a=!1)}),!!a&&(o(e)&&i(e,["zoom","heatmap-density"]))}var Scope=_dereq_("./scope"),ref=_dereq_("./types"),checkSubtype=ref.checkSubtype,ParsingError=_dereq_("./parsing_error"),Literal=_dereq_("./definitions/literal"),Assertion=_dereq_("./definitions/assertion"),ArrayAssertion=_dereq_("./definitions/array"),Coercion=_dereq_("./definitions/coercion"),ParsingContext=function(e,r,t,n,i){void 0===r&&(r=[]),void 0===n&&(n=new Scope),void 0===i&&(i=[]),this.registry=e,this.path=r,this.key=r.map(function(e){return"["+e+"]"}).join(""),this.scope=n,this.errors=i,this.expectedType=t};ParsingContext.prototype.parse=function(e,r,t,n,i){void 0===i&&(i={});var o=this;if(r&&(o=o.concat(r,t,n)),null!==e&&"string"!=typeof e&&"boolean"!=typeof e&&"number"!=typeof e||(e=["literal",e]),Array.isArray(e)){if(0===e.length)return o.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');var a=e[0];if("string"!=typeof a)return o.error("Expression name must be a string, but found "+typeof a+' instead. If you wanted a literal array, use ["literal", [...]].',0),null;var s=o.registry[a];if(s){var u=s.parse(e,o);if(!u)return null;if(o.expectedType){var p=o.expectedType,l=u.type;if("string"!==p.kind&&"number"!==p.kind&&"boolean"!==p.kind||"value"!==l.kind)if("array"===p.kind&&"value"===l.kind)i.omitTypeAnnotations||(u=new ArrayAssertion(p,u));else if("color"!==p.kind||"value"!==l.kind&&"string"!==l.kind){if(o.checkSubtype(o.expectedType,u.type))return null}else i.omitTypeAnnotations||(u=new Coercion(p,[u]));else i.omitTypeAnnotations||(u=new Assertion(p,[u]))}if(!(u instanceof Literal)&&isConstant(u)){var c=new(_dereq_("./evaluation_context"));try{u=new Literal(u.type,u.evaluate(c))}catch(e){return o.error(e.message),null}}return u}return o.error('Unknown expression "'+a+'". If you wanted a literal array, use ["literal", [...]].',0)}return void 0===e?o.error("'undefined' value invalid. Use null instead."):"object"==typeof e?o.error('Bare objects invalid. Use ["literal", {...}] instead.'):o.error("Expected an array, but found "+typeof e+" instead.")},ParsingContext.prototype.concat=function(e,r,t){var n="number"==typeof e?this.path.concat(e):this.path,i=t?this.scope.concat(t):this.scope;return new ParsingContext(this.registry,n,r||null,i,this.errors)},ParsingContext.prototype.error=function(e){for(var r=[],t=arguments.length-1;t-- >0;)r[t]=arguments[t+1];var n=""+this.key+r.map(function(e){return"["+e+"]"}).join("");this.errors.push(new ParsingError(n,e))},ParsingContext.prototype.checkSubtype=function(e,r){var t=checkSubtype(e,r);return t&&this.error(t),t},module.exports=ParsingContext;
},{"./compound_expression":143,"./definitions/array":144,"./definitions/assertion":145,"./definitions/coercion":149,"./definitions/literal":154,"./definitions/var":157,"./evaluation_context":158,"./is_constant":160,"./parsing_error":162,"./scope":164,"./types":166}],162:[function(_dereq_,module,exports){
"use strict";var ParsingError=function(r){function t(t,o){r.call(this,o),this.message=o,this.key=t}return r&&(t.__proto__=r),t.prototype=Object.create(r&&r.prototype),t.prototype.constructor=t,t}(Error);module.exports=ParsingError;
},{}],163:[function(_dereq_,module,exports){
"use strict";var RuntimeError=function(r){this.name="ExpressionEvaluationError",this.message=r};RuntimeError.prototype.toJSON=function(){return this.message},module.exports=RuntimeError;
},{}],164:[function(_dereq_,module,exports){
"use strict";var Scope=function(t,n){var i=this;void 0===n&&(n=[]),this.parent=t,this.bindings={};for(var e=0,r=n;e<r.length;e+=1){var o=r[e],s=o[0],p=o[1];i.bindings[s]=p}};Scope.prototype.concat=function(t){return new Scope(this,t)},Scope.prototype.get=function(t){if(this.bindings[t])return this.bindings[t];if(this.parent)return this.parent.get(t);throw new Error(t+" not found in scope.")},Scope.prototype.has=function(t){return!!this.bindings[t]||!!this.parent&&this.parent.has(t)},module.exports=Scope;
},{}],165:[function(_dereq_,module,exports){
"use strict";function findStopLessThanOrEqualTo(r,e){for(var n,t,o=r.length,u=0,i=o-1,a=0;u<=i;){if(a=Math.floor((u+i)/2),n=r[a],t=r[a+1],e===n||e>n&&e<t)return a;if(n<e)u=a+1;else{if(!(n>e))throw new RuntimeError("Input is not a number.");i=a-1}}return Math.max(a-1,0)}var RuntimeError=_dereq_("./runtime_error");module.exports={findStopLessThanOrEqualTo:findStopLessThanOrEqualTo};
},{"./runtime_error":163}],166:[function(_dereq_,module,exports){
"use strict";function array(e,r){return{kind:"array",itemType:e,N:r}}function toString(e){if("array"===e.kind){var r=toString(e.itemType);return"number"==typeof e.N?"array<"+r+", "+e.N+">":"value"===e.itemType.kind?"array":"array<"+r+">"}return e.kind}function checkSubtype(e,r){if("error"===r.kind)return null;if("array"===e.kind){if("array"===r.kind&&!checkSubtype(e.itemType,r.itemType)&&("number"!=typeof e.N||e.N===r.N))return null}else{if(e.kind===r.kind)return null;if("value"===e.kind)for(var n=0,y=valueMemberTypes;n<y.length;n+=1){var t=y[n];if(!checkSubtype(t,r))return null}}return"Expected "+toString(e)+" but found "+toString(r)+" instead."}var NullType={kind:"null"},NumberType={kind:"number"},StringType={kind:"string"},BooleanType={kind:"boolean"},ColorType={kind:"color"},ObjectType={kind:"object"},ValueType={kind:"value"},ErrorType={kind:"error"},valueMemberTypes=[NullType,NumberType,StringType,BooleanType,ColorType,ObjectType,array(ValueType)];module.exports={NullType:NullType,NumberType:NumberType,StringType:StringType,BooleanType:BooleanType,ColorType:ColorType,ObjectType:ObjectType,ValueType:ValueType,array:array,ErrorType:ErrorType,toString:toString,checkSubtype:checkSubtype};
},{}],167:[function(_dereq_,module,exports){
"use strict";function validateRGBA(e,r,t,n){if(!("number"==typeof e&&e>=0&&e<=255&&"number"==typeof r&&r>=0&&r<=255&&"number"==typeof t&&t>=0&&t<=255)){return"Invalid rgba value ["+("number"==typeof n?[e,r,t,n]:[e,r,t]).join(", ")+"]: 'r', 'g', and 'b' must be between 0 and 255."}return void 0===n||"number"==typeof n&&n>=0&&n<=1?null:"Invalid rgba value ["+[e,r,t,n].join(", ")+"]: 'a' must be between 0 and 1."}function isValue(e){if(null===e)return!0;if("string"==typeof e)return!0;if("boolean"==typeof e)return!0;if("number"==typeof e)return!0;if(e instanceof Color)return!0;if(Array.isArray(e)){for(var r=0,t=e;r<t.length;r+=1){if(!isValue(t[r]))return!1}return!0}if("object"==typeof e){for(var n in e)if(!isValue(e[n]))return!1;return!0}return!1}function typeOf(e){if(null===e)return NullType;if("string"==typeof e)return StringType;if("boolean"==typeof e)return BooleanType;if("number"==typeof e)return NumberType;if(e instanceof Color)return ColorType;if(Array.isArray(e)){for(var r,t=e.length,n=0,u=e;n<u.length;n+=1){var o=u[n],f=typeOf(o);if(r){if(r===f)continue;r=ValueType;break}r=f}return array(r||ValueType,t)}return ObjectType}var Color=_dereq_("../util/color"),ref=_dereq_("./types"),NullType=ref.NullType,NumberType=ref.NumberType,StringType=ref.StringType,BooleanType=ref.BooleanType,ColorType=ref.ColorType,ObjectType=ref.ObjectType,ValueType=ref.ValueType,array=ref.array;module.exports={Color:Color,validateRGBA:validateRGBA,isValue:isValue,typeOf:typeOf};
},{"../util/color":173,"./types":166}],168:[function(_dereq_,module,exports){
"use strict";function isExpressionFilter(e){if(!Array.isArray(e)||0===e.length)return!1;switch(e[0]){case"has":return e.length>=2&&"$id"!==e[1]&&"$type"!==e[1];case"in":case"!in":case"!has":case"none":case"!arrin":case"arrin":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return 3===e.length&&(Array.isArray(e[1])||Array.isArray(e[2]));case"any":case"all":for(var r=0,t=e.slice(1);r<t.length;r+=1){var n=t[r];if(!isExpressionFilter(n)&&"boolean"!=typeof n)return!1}return!0;default:return!0}}function createFilter(e){if(!e)return function(){return!0};isExpressionFilter(e)||(e=convertFilter(e));var r=createExpression(e,filterSpec);if("error"===r.result)throw new Error(r.value.map(function(e){return e.key+": "+e.message}).join(", "));return function(e,t){return r.value.evaluate(e,t)}}function compare(e,r){return e<r?-1:e>r?1:0}function convertFilter(e){if(!e)return!0;var r=e[0];return e.length<=1?"any"!==r:"=="===r?convertComparisonOp(e[1],e[2],"=="):"!="===r?convertNegation(convertComparisonOp(e[1],e[2],"==")):"<"===r||">"===r||"<="===r||">="===r?convertComparisonOp(e[1],e[2],r):"any"===r?convertDisjunctionOp(e.slice(1)):"all"===r?["all"].concat(e.slice(1).map(convertFilter)):"none"===r?["all"].concat(e.slice(1).map(convertFilter).map(convertNegation)):"in"===r?convertInOp(e[1],e.slice(2)):"!in"===r?convertNegation(convertInOp(e[1],e.slice(2))):"has"===r?convertHasOp(e[1]):"!has"===r?convertNegation(convertHasOp(e[1])):"arrin"===r?convertArrInOp(e[1],e.slice(2)):"!arrin"!==r||convertNegation(convertArrInOp(e[1],e.slice(2)))}function convertComparisonOp(e,r,t){switch(e){case"$type":return["filter-type-"+t,r];case"$id":return["filter-id-"+t,r];default:return["filter-"+t,e,r]}}function convertDisjunctionOp(e){return["any"].concat(e.map(convertFilter))}function convertInOp(e,r){if(0===r.length)return!1;switch(e){case"$type":return["filter-type-in",["literal",r]];case"$id":return["filter-id-in",["literal",r]];default:return r.length>200&&!r.some(function(e){return typeof e!=typeof r[0]})?["filter-in-large",e,["literal",r.sort(compare)]]:["filter-in-small",e,["literal",r]]}}function convertArrInOp(e,r){if(0===r.length)return!1;switch(e){case"$type":return["filter-type-arrin",["literal",r]];default:return["filter-arrin",e,["literal",r]]}}function convertHasOp(e){switch(e){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",e]}}function convertNegation(e){return["!",e]}var ref=_dereq_("../expression"),createExpression=ref.createExpression;module.exports=createFilter,module.exports.isExpressionFilter=isExpressionFilter;var filterSpec={type:"boolean",default:!1,function:!0,"property-function":!0,"zoom-function":!0};
},{"../expression":159}],169:[function(_dereq_,module,exports){
"use strict";function isFunction(e){return"object"==typeof e&&null!==e&&!Array.isArray(e)}function identityFunction(e){return e}function createFunction(e,t){var o="color"===t.type,r=e.stops&&"object"==typeof e.stops[0][0],n=r||void 0!==e.property,a=r||!n,i=e.type||("interpolated"===t.function?"exponential":"interval");if(o&&(e=extend({},e),e.stops&&(e.stops=e.stops.map(function(e){return[e[0],Color.parse(e[1])]})),e.default?e.default=Color.parse(e.default):e.default=Color.parse(t.default)),e.colorSpace&&"rgb"!==e.colorSpace&&!colorSpaces[e.colorSpace])throw new Error("Unknown color space: "+e.colorSpace);var u,p,l;if("exponential"===i)u=evaluateExponentialFunction;else if("interval"===i)u=evaluateIntervalFunction;else if("categorical"===i){u=evaluateCategoricalFunction,p=Object.create(null);for(var s=0,c=e.stops;s<c.length;s+=1){var f=c[s];p[f[0]]=f[1]}l=typeof e.stops[0][0]}else{if("identity"!==i)throw new Error('Unknown function type "'+i+'"');u=evaluateIdentityFunction}if(r){for(var v={},d=[],y=0;y<e.stops.length;y++){var F=e.stops[y],h=F[0].zoom;void 0===v[h]&&(v[h]={zoom:h,type:e.type,property:e.property,default:e.default,stops:[]},d.push(h)),v[h].stops.push([F[0].value,F[1]])}for(var m=[],g=0,b=d;g<b.length;g+=1){var S=b[g];m.push([v[S].zoom,createFunction(v[S],t)])}return{kind:"composite",interpolationFactor:Interpolate.interpolationFactor.bind(void 0,{name:"linear"}),zoomStops:m.map(function(e){return e[0]}),evaluate:function(o,r){var n=o.zoom;return evaluateExponentialFunction({stops:m,base:e.base},t,n).evaluate(n,r)}}}return a?{kind:"camera",interpolationFactor:"exponential"===i?Interpolate.interpolationFactor.bind(void 0,{name:"exponential",base:void 0!==e.base?e.base:1}):function(){return 0},zoomStops:e.stops.map(function(e){return e[0]}),evaluate:function(o){var r=o.zoom;return u(e,t,r,p,l)}}:{kind:"source",evaluate:function(o,r){var n=r&&r.properties?r.properties[e.property]:void 0;return void 0===n?coalesce(e.default,t.default):u(e,t,n,p,l)}}}function coalesce(e,t,o){return void 0!==e?e:void 0!==t?t:void 0!==o?o:void 0}function evaluateCategoricalFunction(e,t,o,r,n){return coalesce(typeof o===n?r[o]:void 0,e.default,t.default)}function evaluateIntervalFunction(e,t,o){if("number"!==getType(o))return coalesce(e.default,t.default);var r=e.stops.length;if(1===r)return e.stops[0][1];if(o<=e.stops[0][0])return e.stops[0][1];if(o>=e.stops[r-1][0])return e.stops[r-1][1];var n=findStopLessThanOrEqualTo(e.stops,o);return e.stops[n][1]}function evaluateExponentialFunction(e,t,o){var r=void 0!==e.base?e.base:1;if("number"!==getType(o))return coalesce(e.default,t.default);var n=e.stops.length;if(1===n)return e.stops[0][1];if(o<=e.stops[0][0])return e.stops[0][1];if(o>=e.stops[n-1][0])return e.stops[n-1][1];var a=findStopLessThanOrEqualTo(e.stops,o),i=interpolationFactor(o,r,e.stops[a][0],e.stops[a+1][0]),u=e.stops[a][1],p=e.stops[a+1][1],l=interpolate[t.type]||identityFunction;if(e.colorSpace&&"rgb"!==e.colorSpace){var s=colorSpaces[e.colorSpace];l=function(e,t){return s.reverse(s.interpolate(s.forward(e),s.forward(t),i))}}return"function"==typeof u.evaluate?{evaluate:function(){for(var e=[],t=arguments.length;t--;)e[t]=arguments[t];var o=u.evaluate.apply(void 0,e),r=p.evaluate.apply(void 0,e);if(void 0!==o&&void 0!==r)return l(o,r,i)}}:l(u,p,i)}function evaluateIdentityFunction(e,t,o){return"color"===t.type?"x-color"!==t.units&&(o=Color.parse(o)):getType(o)===t.type||"enum"===t.type&&t.values[o]||(o=void 0),coalesce(o,e.default,t.default)}function findStopLessThanOrEqualTo(e,t){for(var o,r,n=e.length,a=0,i=n-1,u=0;a<=i;){if(u=Math.floor((a+i)/2),o=e[u][0],r=e[u+1][0],t===o||t>o&&t<r)return u;o<t?a=u+1:o>t&&(i=u-1)}return Math.max(u-1,0)}function interpolationFactor(e,t,o,r){var n=r-o,a=e-o;return 0===n?0:1===t?a/n:(Math.pow(t,a)-1)/(Math.pow(t,n)-1)}var colorSpaces=_dereq_("../util/color_spaces"),Color=_dereq_("../util/color"),extend=_dereq_("../util/extend"),getType=_dereq_("../util/get_type"),interpolate=_dereq_("../util/interpolate"),Interpolate=_dereq_("../expression/definitions/interpolate");module.exports={createFunction:createFunction,isFunction:isFunction};
},{"../expression/definitions/interpolate":152,"../util/color":173,"../util/color_spaces":174,"../util/extend":176,"../util/get_type":177,"../util/interpolate":178}],170:[function(_dereq_,module,exports){
"use strict";function stringify(r){var t=typeof r;if("number"===t||"boolean"===t||"string"===t||void 0===r||null===r)return JSON.stringify(r);if(Array.isArray(r)){for(var e="[",i=0,n=r;i<n.length;i+=1){e+=stringify(n[i])+","}return e+"]"}for(var o=Object.keys(r).sort(),f="{",u=0;u<o.length;u++)f+=JSON.stringify(o[u])+":"+stringify(r[o[u]])+",";return f+"}"}function getKey(r){for(var t="",e=0,i=refProperties;e<i.length;e+=1){t+="/"+stringify(r[i[e]])}return t}function groupByLayout(r){for(var t={},e=0;e<r.length;e++){var i=getKey(r[e]),n=t[i];n||(n=t[i]=[]),n.push(r[e])}var o=[];for(var f in t)o.push(t[f]);return o}var refProperties=_dereq_("./util/ref_properties");module.exports=groupByLayout;
},{"./util/ref_properties":179}],171:[function(_dereq_,module,exports){
"use strict";module.exports=_dereq_("./v8.json");
},{"./v8.json":172}],172:[function(_dereq_,module,exports){
module.exports={"$version":8,"$root":{"version":{"required":true,"type":"enum","values":[8]},"name":{"type":"string"},"metadata":{"type":"*"},"center":{"type":"array","value":"number"},"zoom":{"type":"number"},"bearing":{"type":"number","default":0,"period":360,"units":"degrees"},"pitch":{"type":"number","default":0,"units":"degrees"},"light":{"type":"light"},"sources":{"required":true,"type":"sources"},"sprite":{"type":"string"},"glyphs":{"type":"string"},"transition":{"type":"transition"},"layers":{"required":true,"type":"array","value":"layer"}},"sources":{"*":{"type":"source"}},"source":["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image","source_canvas"],"source_vector":{"type":{"required":true,"type":"enum","values":{"vector":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.0511,180,85.0511]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"attribution":{"type":"string"},"*":{"type":"*"}},"source_raster":{"type":{"required":true,"type":"enum","values":{"raster":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.0511,180,85.0511]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512,"units":"pixels"},"scheme":{"type":"enum","values":{"xyz":{},"tms":{}},"default":"xyz"},"attribution":{"type":"string"},"*":{"type":"*"}},"source_raster_dem":{"type":{"required":true,"type":"enum","values":{"raster-dem":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.0511,180,85.0511]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512,"units":"pixels"},"attribution":{"type":"string"},"*":{"type":"*"}},"source_geojson":{"type":{"required":true,"type":"enum","values":{"geojson":{}}},"data":{"type":"*"},"maxzoom":{"type":"number","default":18},"buffer":{"type":"number","default":128,"maximum":512,"minimum":0},"tolerance":{"type":"number","default":0.375},"cluster":{"type":"boolean","default":false},"clusterRadius":{"type":"number","default":50,"minimum":0},"clusterMaxZoom":{"type":"number"},"enableQueryChildren":{"type":"boolean","default":false}},"source_video":{"type":{"required":true,"type":"enum","values":{"video":{}}},"urls":{"required":true,"type":"array","value":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_image":{"type":{"required":true,"type":"enum","values":{"image":{}}},"url":{"required":true,"type":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_canvas":{"type":{"required":true,"type":"enum","values":{"canvas":{}}},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}},"animate":{"type":"boolean","default":"true"},"canvas":{"type":"string","required":true}},"layer":{"id":{"type":"string","required":true},"type":{"type":"enum","values":{"fill":{},"line":{},"symbol":{},"circle":{},"heatmap":{},"extrusion":{},"raster":{},"hillshade":{},"background":{},"sprite":{},"histogram":{},"symtracking":{},"tracking":{},"dynamicLine":{},"airline":{}},"required":true},"metadata":{"type":"*"},"source":{"type":"string"},"source-layer":{"type":"string"},"minzoom":{"type":"number","minimum":0,"maximum":24},"maxzoom":{"type":"number","minimum":0,"maximum":24},"filter":{"type":"filter"},"layout":{"type":"layout"},"paint":{"type":"paint"}},"layout":["layout_fill","layout_line","layout_circle","layout_heatmap","layout_extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background","layout_sprite","layout_histogram","layout_symtracking","layout_tracking","layout_dynamicLine","layout_airline"],"layout_background":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible"}},"layout_fill":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible"}},"layout_circle":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible"}},"layout_heatmap":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible"}},"layout_extrusion":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible"}},"layout_line":{"line-cap":{"type":"enum","function":"piecewise-constant","zoom-function":true,"values":{"butt":{},"round":{},"square":{}},"default":"butt"},"line-join":{"type":"enum","function":"piecewise-constant","zoom-function":true,"property-function":true,"values":{"bevel":{},"round":{},"miter":{}},"default":"miter"},"line-miter-limit":{"type":"number","default":2,"function":"interpolated","zoom-function":true,"requires":[{"line-join":"miter"}]},"line-round-limit":{"type":"number","default":1.05,"function":"interpolated","zoom-function":true,"requires":[{"line-join":"round"}]},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible"}},"layout_symbol":{"symbol-placement":{"type":"enum","function":"piecewise-constant","zoom-function":true,"values":{"point":{},"line":{}},"default":"point"},"symbol-spacing":{"type":"number","default":250,"minimum":1,"function":"interpolated","zoom-function":true,"units":"pixels","requires":[{"symbol-placement":"line"}]},"symbol-avoid-edges":{"type":"boolean","function":"piecewise-constant","zoom-function":true,"default":false},"icon-allow-overlap":{"type":"boolean","function":"piecewise-constant","zoom-function":true,"default":false,"requires":["icon-image"]},"icon-ignore-placement":{"type":"boolean","function":"piecewise-constant","zoom-function":true,"default":false,"requires":["icon-image"]},"icon-optional":{"type":"boolean","function":"piecewise-constant","zoom-function":true,"default":false,"requires":["icon-image","text-field"]},"icon-rotation-alignment":{"type":"enum","function":"piecewise-constant","zoom-function":true,"values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["icon-image"]},"icon-size":{"type":"number","default":1,"minimum":0,"function":"interpolated","zoom-function":true,"property-function":true,"units":"factor of the original icon size","requires":["icon-image"]},"icon-text-fit":{"type":"enum","function":"piecewise-constant","zoom-function":true,"values":{"none":{},"width":{},"height":{},"both":{}},"default":"none","requires":["icon-image","text-field"]},"icon-text-fit-padding":{"type":"array","value":"number","length":4,"default":[0,0,0,0],"units":"pixels","function":"interpolated","zoom-function":true,"requires":["icon-image","text-field",{"icon-text-fit":["both","width","height"]}]},"icon-image":{"type":"string","function":"piecewise-constant","zoom-function":true,"property-function":true,"tokens":true},"icon-rotate":{"type":"number","default":0,"period":360,"function":"interpolated","zoom-function":true,"property-function":true,"units":"degrees","requires":["icon-image"]},"icon-padding":{"type":"number","default":2,"minimum":0,"function":"interpolated","zoom-function":true,"units":"pixels","requires":["icon-image"]},"icon-keep-upright":{"type":"boolean","function":"piecewise-constant","zoom-function":true,"default":false,"requires":["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":"line"}]},"icon-offset":{"type":"array","value":"number","length":2,"default":[0,0],"function":"interpolated","zoom-function":true,"property-function":true,"requires":["icon-image"]},"icon-anchor":{"type":"enum","function":"piecewise-constant","zoom-function":true,"property-function":true,"values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"default":"center","requires":["icon-image"]},"icon-pitch-alignment":{"type":"enum","function":"piecewise-constant","zoom-function":true,"values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["icon-image"]},"text-pitch-alignment":{"type":"enum","function":"piecewise-constant","zoom-function":true,"values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["text-field"]},"text-rotation-alignment":{"type":"enum","function":"piecewise-constant","zoom-function":true,"values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["text-field"]},"text-field":{"type":"string","function":"piecewise-constant","zoom-function":true,"property-function":true,"default":"","tokens":true},"text-font":{"type":"array","value":"string","function":"piecewise-constant","zoom-function":true,"property-function":true,"default":["Open Sans Regular","Arial Unicode MS Regular"],"requires":["text-field"]},"text-size":{"type":"number","default":16,"minimum":0,"units":"pixels","function":"interpolated","zoom-function":true,"property-function":true,"requires":["text-field"]},"text-max-width":{"type":"number","default":10,"minimum":0,"units":"ems","function":"interpolated","zoom-function":true,"property-function":true,"requires":["text-field"]},"text-line-height":{"type":"number","default":1.2,"units":"ems","function":"interpolated","zoom-function":true,"requires":["text-field"]},"text-letter-spacing":{"type":"number","default":0,"units":"ems","function":"interpolated","zoom-function":true,"property-function":true,"requires":["text-field"]},"text-justify":{"type":"enum","function":"piecewise-constant","zoom-function":true,"property-function":true,"values":{"left":{},"center":{},"right":{}},"default":"center","requires":["text-field"]},"text-anchor":{"type":"enum","function":"piecewise-constant","zoom-function":true,"property-function":true,"values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"default":"center","requires":["text-field"]},"text-max-angle":{"type":"number","default":45,"units":"degrees","function":"interpolated","zoom-function":true,"requires":["text-field",{"symbol-placement":"line"}]},"text-rotate":{"type":"number","default":0,"period":360,"units":"degrees","function":"interpolated","zoom-function":true,"property-function":true,"requires":["text-field"]},"text-padding":{"type":"number","default":2,"minimum":0,"units":"pixels","function":"interpolated","zoom-function":true,"requires":["text-field"]},"text-keep-upright":{"type":"boolean","function":"piecewise-constant","zoom-function":true,"default":true,"requires":["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":"line"}]},"text-transform":{"type":"enum","function":"piecewise-constant","zoom-function":true,"property-function":true,"values":{"none":{},"uppercase":{},"lowercase":{}},"default":"none","requires":["text-field"]},"text-offset":{"type":"array","value":"number","units":"ems","function":"interpolated","zoom-function":true,"property-function":true,"length":2,"default":[0,0],"requires":["text-field"]},"text-allow-overlap":{"type":"boolean","function":"piecewise-constant","zoom-function":true,"default":false,"requires":["text-field"]},"text-ignore-placement":{"type":"boolean","function":"piecewise-constant","zoom-function":true,"default":false,"requires":["text-field"]},"text-optional":{"type":"boolean","function":"piecewise-constant","zoom-function":true,"default":false,"requires":["text-field","icon-image"]},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible"}},"layout_raster":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible"}},"layout_hillshade":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible"}},"layout_sprite":{"sprite-cap":{"type":"enum","function":"piecewise-constant","zoom-function":true,"values":{"butt":{},"round":{},"square":{}},"default":"butt"},"sprite-join":{"type":"enum","function":"piecewise-constant","zoom-function":true,"property-function":true,"values":{"bevel":{},"round":{},"miter":{}},"default":"miter"},"sprite-miter-limit":{"type":"number","default":2,"function":"interpolated","zoom-function":true,"requires":[{"sprite-join":"miter"}]},"sprite-round-limit":{"type":"number","default":1.05,"function":"interpolated","zoom-function":true,"requires":[{"sprite-join":"round"}]},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible"}},"layout_histogram":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible"},"histogram-color-render":{"type":"boolean","function":"piecewise-constant","zoom-function":true,"default":false,"property-function":false},"histogram-max-height-render":{"type":"boolean","function":"piecewise-constant","zoom-function":true,"default":false,"property-function":false}},"layout_symtracking":{"symbol-placement":{"type":"enum","function":"piecewise-constant","zoom-function":true,"values":{"point":{},"line":{}},"default":"point"},"symbol-spacing":{"type":"number","default":250,"minimum":1,"function":"interpolated","zoom-function":true,"units":"pixels","requires":[{"symbol-placement":"line"}]},"symbol-avoid-edges":{"type":"boolean","function":"piecewise-constant","zoom-function":true,"default":false},"icon-allow-overlap":{"type":"boolean","function":"piecewise-constant","zoom-function":true,"default":false,"requires":["icon-image"]},"icon-ignore-placement":{"type":"boolean","function":"piecewise-constant","zoom-function":true,"default":false,"requires":["icon-image"]},"icon-optional":{"type":"boolean","function":"piecewise-constant","zoom-function":true,"default":false,"requires":["icon-image","text-field"]},"icon-rotation-alignment":{"type":"enum","function":"piecewise-constant","zoom-function":true,"values":{"map":{},"viewport":{},"auto":{}},"default":"map","requires":["icon-image"]},"icon-size":{"type":"number","default":1,"minimum":0,"function":"interpolated","zoom-function":true,"property-function":true,"units":"factor of the original icon size","requires":["icon-image"]},"icon-text-fit":{"type":"enum","function":"piecewise-constant","zoom-function":true,"values":{"none":{},"width":{},"height":{},"both":{}},"default":"none","requires":["icon-image","text-field"]},"icon-text-fit-padding":{"type":"array","value":"number","length":4,"default":[0,0,0,0],"units":"pixels","function":"interpolated","zoom-function":true,"requires":["icon-image","text-field",{"icon-text-fit":["both","width","height"]}]},"icon-image":{"type":"string","function":"piecewise-constant","zoom-function":true,"property-function":true,"tokens":true},"icon-rotate":{"type":"number","default":0,"period":360,"function":"interpolated","zoom-function":true,"property-function":true,"units":"degrees","requires":["icon-image"]},"icon-padding":{"type":"number","default":2,"minimum":0,"function":"interpolated","zoom-function":true,"units":"pixels","requires":["icon-image"]},"icon-keep-upright":{"type":"boolean","function":"piecewise-constant","zoom-function":true,"default":false,"requires":["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":"line"}]},"icon-offset":{"type":"array","value":"number","length":2,"default":[0,0],"function":"interpolated","zoom-function":true,"property-function":true,"requires":["icon-image"]},"icon-anchor":{"type":"enum","function":"piecewise-constant","zoom-function":true,"property-function":true,"values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"default":"center","requires":["icon-image"]},"icon-pitch-alignment":{"type":"enum","function":"piecewise-constant","zoom-function":true,"values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["icon-image"]},"text-pitch-alignment":{"type":"enum","function":"piecewise-constant","zoom-function":true,"values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["text-field"]},"text-rotation-alignment":{"type":"enum","function":"piecewise-constant","zoom-function":true,"values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["text-field"]},"text-field":{"type":"string","function":"piecewise-constant","zoom-function":true,"property-function":true,"default":"","tokens":true},"text-font":{"type":"array","value":"string","function":"piecewise-constant","zoom-function":true,"property-function":true,"default":["Open Sans Regular","Arial Unicode MS Regular"],"requires":["text-field"]},"text-size":{"type":"number","default":16,"minimum":0,"units":"pixels","function":"interpolated","zoom-function":true,"property-function":true,"requires":["text-field"]},"text-max-width":{"type":"number","default":10,"minimum":0,"units":"ems","function":"interpolated","zoom-function":true,"property-function":true,"requires":["text-field"]},"text-line-height":{"type":"number","default":1.2,"units":"ems","function":"interpolated","zoom-function":true,"requires":["text-field"]},"text-letter-spacing":{"type":"number","default":0,"units":"ems","function":"interpolated","zoom-function":true,"property-function":true,"requires":["text-field"]},"text-justify":{"type":"enum","function":"piecewise-constant","zoom-function":true,"property-function":true,"values":{"left":{},"center":{},"right":{}},"default":"center","requires":["text-field"]},"text-anchor":{"type":"enum","function":"piecewise-constant","zoom-function":true,"property-function":true,"values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"default":"center","requires":["text-field"]},"text-max-angle":{"type":"number","default":45,"units":"degrees","function":"interpolated","zoom-function":true,"requires":["text-field",{"symbol-placement":"line"}]},"text-rotate":{"type":"number","default":0,"period":360,"units":"degrees","function":"interpolated","zoom-function":true,"property-function":true,"requires":["text-field"]},"text-padding":{"type":"number","default":2,"minimum":0,"units":"pixels","function":"interpolated","zoom-function":true,"requires":["text-field"]},"text-keep-upright":{"type":"boolean","function":"piecewise-constant","zoom-function":true,"default":true,"requires":["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":"line"}]},"text-transform":{"type":"enum","function":"piecewise-constant","zoom-function":true,"property-function":true,"values":{"none":{},"uppercase":{},"lowercase":{}},"default":"none","requires":["text-field"]},"text-offset":{"type":"array","value":"number","units":"ems","function":"interpolated","zoom-function":true,"property-function":true,"length":2,"default":[0,0],"requires":["text-field"]},"text-allow-overlap":{"type":"boolean","function":"piecewise-constant","zoom-function":true,"default":false,"requires":["text-field"]},"text-ignore-placement":{"type":"boolean","function":"piecewise-constant","zoom-function":true,"default":false,"requires":["text-field"]},"text-optional":{"type":"boolean","function":"piecewise-constant","zoom-function":true,"default":false,"requires":["text-field","icon-image"]},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible"},"symtracking-time-segment":{"type":"number","function":"piecewise-constant","zoom-function":false,"default":20,"minimum":1},"symtracking-fps":{"type":"number","function":"piecewise-constant","zoom-function":false,"default":1,"minimum":1},"compatible-mode":{"type":"boolean","function":"piecewise-constant","zoom-function":true,"default":true}},"layout_tracking":{"tracking-cap":{"type":"enum","function":"piecewise-constant","zoom-function":true,"values":{"butt":{},"round":{},"square":{}},"default":"butt"},"tracking-join":{"type":"enum","function":"piecewise-constant","zoom-function":true,"property-function":true,"values":{"bevel":{},"round":{},"miter":{}},"default":"miter"},"tracking-miter-limit":{"type":"number","default":2,"function":"interpolated","zoom-function":true,"requires":[{"tracking-join":"miter"}]},"tracking-round-limit":{"type":"number","default":1.05,"function":"interpolated","zoom-function":true,"requires":[{"tracking-join":"round"}]},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible"},"tracking-display-mode":{"type":"enum","function":"piecewise-constant","values":["loop","reverse","loop-reserve","reverse-reserve"],"default":"loop"}},"layout_dynamicLine":{"dynamicLine-cap":{"type":"enum","function":"piecewise-constant","zoom-function":true,"values":{"butt":{},"round":{},"square":{}},"default":"butt"},"dynamicLine-join":{"type":"enum","function":"piecewise-constant","zoom-function":true,"property-function":true,"values":{"bevel":{},"round":{},"miter":{}},"default":"miter"},"dynamicLine-miter-limit":{"type":"number","default":2,"function":"interpolated","zoom-function":true,"requires":[{"dynamicLine-join":"miter"}]},"dynamicLine-round-limit":{"type":"number","default":1.05,"function":"interpolated","zoom-function":true,"requires":[{"dynamicLine-join":"round"}]},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible"},"dynamicLine-display-mode":{"type":"enum","function":"piecewise-constant","values":["loop","reverse","loop-reserve","reverse-reserve"],"default":"loop"}},"layout_airline":{"airline-cap":{"type":"enum","function":"piecewise-constant","zoom-function":true,"values":{"butt":{},"round":{},"square":{}},"default":"butt"},"airline-join":{"type":"enum","function":"piecewise-constant","zoom-function":true,"property-function":true,"values":{"bevel":{},"round":{},"miter":{}},"default":"miter"},"airline-miter-limit":{"type":"number","default":2,"function":"interpolated","zoom-function":true,"requires":[{"line-join":"miter"}]},"airline-round-limit":{"type":"number","default":1.05,"function":"interpolated","zoom-function":true,"requires":[{"line-join":"round"}]},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible"}},"filter":{"type":"array","value":"*"},"filter_operator":{"type":"enum","values":{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},"in":{},"!in":{},"arrin":{},"!arrin":{},"all":{},"any":{},"none":{},"has":{},"!has":{}}},"geometry_type":{"type":"enum","values":{"Point":{},"LineString":{},"Polygon":{}}},"function":{"expression":{"type":"expression"},"stops":{"type":"array","value":"function_stop"},"base":{"type":"number","default":1,"minimum":0},"property":{"type":"string","default":"$zoom"},"type":{"type":"enum","values":{"identity":{},"exponential":{},"interval":{},"categorical":{}},"default":"exponential"},"colorSpace":{"type":"enum","values":{"rgb":{},"lab":{},"hcl":{}},"default":"rgb"},"default":{"type":"*","required":false}},"function_stop":{"type":"array","minimum":0,"maximum":22,"value":["number","color"],"length":2},"expression":{"type":"array","value":"*","minimum":1},"expression_name":{"type":"enum","values":{"let":{"group":"Variable binding"},"var":{"group":"Variable binding"},"literal":{"group":"Types"},"array":{"group":"Types"},"at":{"group":"Lookup"},"case":{"group":"Decision"},"match":{"group":"Decision"},"coalesce":{"group":"Decision"},"step":{"group":"Ramps, scales, curves"},"interpolate":{"group":"Ramps, scales, curves"},"ln2":{"group":"Math"},"pi":{"group":"Math"},"e":{"group":"Math"},"typeof":{"group":"Types"},"string":{"group":"Types"},"number":{"group":"Types"},"boolean":{"group":"Types"},"object":{"group":"Types"},"to-string":{"group":"Types"},"to-number":{"group":"Types"},"to-boolean":{"group":"Types"},"to-rgba":{"group":"Color"},"to-color":{"group":"Types"},"rgb":{"group":"Color"},"rgba":{"group":"Color"},"get":{"group":"Lookup"},"has":{"group":"Lookup"},"length":{"group":"Lookup"},"properties":{"group":"Feature data"},"geometry-type":{"group":"Feature data"},"id":{"group":"Feature data"},"zoom":{"group":"Zoom"},"heatmap-density":{"group":"Heatmap"},"+":{"group":"Math"},"*":{"group":"Math"},"-":{"group":"Math"},"/":{"group":"Math"},"%":{"group":"Math"},"^":{"group":"Math"},"sqrt":{"group":"Math"},"log10":{"group":"Math"},"ln":{"group":"Math"},"log2":{"group":"Math"},"sin":{"group":"Math"},"cos":{"group":"Math"},"tan":{"group":"Math"},"asin":{"group":"Math"},"acos":{"group":"Math"},"atan":{"group":"Math"},"min":{"group":"Math"},"max":{"group":"Math"},"==":{"group":"Decision"},"!=":{"group":"Decision"},">":{"group":"Decision"},"<":{"group":"Decision"},">=":{"group":"Decision"},"<=":{"group":"Decision"},"all":{"group":"Decision"},"any":{"group":"Decision"},"!":{"group":"Decision"},"upcase":{"group":"String"},"downcase":{"group":"String"},"concat":{"group":"String"}}},"light":{"anchor":{"type":"enum","default":"viewport","values":{"map":{},"viewport":{}},"transition":false,"zoom-function":true,"property-function":false,"function":"piecewise-constant"},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","transition":true,"function":"interpolated","zoom-function":true,"property-function":false},"color":{"type":"color","default":"#ffffff","function":"interpolated","zoom-function":true,"property-function":false,"transition":true},"intensity":{"type":"number","default":0.5,"minimum":0,"maximum":1,"function":"interpolated","zoom-function":true,"property-function":false,"transition":true}},"paint":["paint_fill","paint_line","paint_circle","paint_heatmap","paint_extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background","paint_sprite","paint_histogram","paint_symtracking","paint_tracking","paint_dynamicLine","paint_airline"],"paint_fill":{"fill-antialias":{"type":"boolean","function":"piecewise-constant","zoom-function":true,"default":true},"fill-opacity":{"type":"number","function":"interpolated","zoom-function":true,"property-function":true,"default":1,"minimum":0,"maximum":1,"transition":true},"fill-color":{"type":"color","default":"#000000","function":"interpolated","zoom-function":true,"property-function":true,"transition":true,"requires":[{"!":"fill-pattern"}]},"fill-outline-color":{"type":"color","function":"interpolated","zoom-function":true,"property-function":true,"transition":true,"requires":[{"!":"fill-pattern"},{"fill-antialias":true}]},"fill-translate":{"type":"array","value":"number","length":2,"default":[0,0],"function":"interpolated","zoom-function":true,"transition":true,"units":"pixels"},"fill-translate-anchor":{"type":"enum","function":"piecewise-constant","zoom-function":true,"values":{"map":{},"viewport":{}},"default":"map","requires":["fill-translate"]},"fill-pattern":{"type":"string","function":"piecewise-constant","zoom-function":true,"transition":true},"fill-water":{"type":"enum","values":{"water":{},"none":{}},"default":"none"},"render-3d":{"type":"boolean","function":"piecewise-constant","zoom-function":true,"default":false}},"paint_extrusion":{"extrusion-opacity":{"type":"number","function":"interpolated","zoom-function":true,"property-function":false,"default":1,"minimum":0,"maximum":1,"transition":true},"extrusion-color":{"type":"color","default":"#000000","function":"interpolated","zoom-function":true,"property-function":true,"transition":true,"requires":[{"!":"extrusion-pattern"}]},"extrusion-translate":{"type":"array","value":"number","length":2,"default":[0,0],"function":"interpolated","zoom-function":true,"transition":true,"units":"pixels"},"extrusion-translate-anchor":{"type":"enum","function":"piecewise-constant","zoom-function":true,"values":{"map":{},"viewport":{}},"default":"map","requires":["extrusion-translate"]},"extrusion-pattern":{"type":"string","function":"piecewise-constant","zoom-function":true,"transition":true},"extrusion-height":{"type":"number","function":"interpolated","zoom-function":true,"property-function":true,"default":0,"minimum":0,"units":"meters","transition":true},"extrusion-base":{"type":"number","function":"interpolated","zoom-function":true,"property-function":true,"default":0,"minimum":0,"units":"meters","transition":true,"requires":["extrusion-height"]},"render-road":{"type":"boolean","function":"piecewise-constant","zoom-function":true,"default":false}},"paint_line":{"line-opacity":{"type":"number","function":"interpolated","zoom-function":true,"property-function":true,"default":1,"minimum":0,"maximum":1,"transition":true},"line-color":{"type":"color","default":"#000000","function":"interpolated","zoom-function":true,"property-function":true,"transition":true,"requires":[{"!":"line-pattern"}]},"line-translate":{"type":"array","value":"number","length":2,"default":[0,0],"function":"interpolated","zoom-function":true,"transition":true,"units":"pixels"},"line-translate-anchor":{"type":"enum","function":"piecewise-constant","zoom-function":true,"values":{"map":{},"viewport":{}},"default":"map","requires":["line-translate"]},"line-width":{"type":"number","default":1,"minimum":0,"function":"interpolated","zoom-function":true,"property-function":true,"transition":true,"units":"pixels"},"line-gap-width":{"type":"number","default":0,"minimum":0,"function":"interpolated","zoom-function":true,"property-function":true,"transition":true,"units":"pixels"},"line-offset":{"type":"number","default":0,"function":"interpolated","zoom-function":true,"property-function":true,"transition":true,"units":"pixels"},"line-blur":{"type":"number","default":0,"minimum":0,"function":"interpolated","zoom-function":true,"property-function":true,"transition":true,"units":"pixels"},"line-dasharray":{"type":"array","value":"number","function":"piecewise-constant","zoom-function":true,"minimum":0,"transition":true,"units":"line widths","requires":[{"!":"line-pattern"}]},"line-pattern":{"type":"string","function":"piecewise-constant","zoom-function":true,"transition":true},"render-3d":{"type":"boolean","function":"piecewise-constant","zoom-function":true,"default":false},"line-contour-colors":{"type":"array","value":"string","length":5,"default":["#ffc1e0","#bbffff","#00e3e3","#005757","#ea0000"],"function":"piecewise-constant","zoom-function":true,"transition":true},"line-max-contour-height":{"type":"number","function":"piecewise-constant","zoom-function":true,"property-function":false,"default":200,"minimum":0,"units":"meters","transition":true},"line-is-contour":{"type":"boolean","function":"piecewise-constant","zoom-function":true,"default":false},"line-interpolate":{"type":"boolean","function":"piecewise-constant","zoom-function":true,"default":false},"line-status":{"type":"number","function":"interpolated","zoom-function":true,"property-function":true,"default":1,"minimum":1,"maximum":5,"transition":true},"line-instatus":{"type":"number","function":"interpolated","zoom-function":true,"property-function":true,"default":1,"minimum":1,"maximum":5,"transition":true},"line-height-offset":{"type":"number","function":"piecewise-constant","default":0,"minimum":0,"maximum":100},"half-render":{"type":"boolean","function":"piecewise-constant","zoom-function":true,"default":false}},"paint_circle":{"circle-radius":{"type":"number","default":5,"minimum":0,"function":"interpolated","zoom-function":true,"property-function":true,"transition":true,"units":"pixels"},"circle-color":{"type":"color","default":"#000000","function":"interpolated","zoom-function":true,"property-function":true,"transition":true},"circle-blur":{"type":"number","default":0,"function":"interpolated","zoom-function":true,"property-function":true,"transition":true},"circle-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"function":"interpolated","zoom-function":true,"property-function":true,"transition":true},"circle-translate":{"type":"array","value":"number","length":2,"default":[0,0],"function":"interpolated","zoom-function":true,"transition":true,"units":"pixels"},"circle-translate-anchor":{"type":"enum","function":"piecewise-constant","zoom-function":true,"values":{"map":{},"viewport":{}},"default":"map","requires":["circle-translate"]},"circle-pitch-scale":{"type":"enum","function":"piecewise-constant","zoom-function":true,"values":{"map":{},"viewport":{}},"default":"map"},"circle-pitch-alignment":{"type":"enum","function":"piecewise-constant","zoom-function":true,"values":{"map":{},"viewport":{}},"default":"viewport"},"circle-stroke-width":{"type":"number","default":0,"minimum":0,"function":"interpolated","zoom-function":true,"property-function":true,"transition":true,"units":"pixels"},"circle-stroke-color":{"type":"color","default":"#000000","function":"interpolated","zoom-function":true,"property-function":true,"transition":true},"circle-stroke-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"function":"interpolated","zoom-function":true,"property-function":true,"transition":true}},"paint_heatmap":{"heatmap-radius":{"type":"number","default":30,"minimum":1,"function":"interpolated","zoom-function":true,"property-function":true,"transition":true,"units":"pixels"},"heatmap-weight":{"type":"number","default":1,"minimum":0,"function":"interpolated","zoom-function":true,"property-function":true,"transition":false},"heatmap-intensity":{"type":"number","default":1,"minimum":0,"function":"interpolated","zoom-function":true,"property-function":false,"transition":true},"heatmap-color":{"type":"color","default":["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",0.1,"royalblue",0.3,"cyan",0.5,"lime",0.7,"yellow",1,"red"],"function":"interpolated","zoom-function":false,"property-function":false,"transition":false},"heatmap-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"function":"interpolated","zoom-function":true,"property-function":false,"transition":true}},"paint_symbol":{"icon-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"function":"interpolated","zoom-function":true,"property-function":true,"transition":true,"requires":["icon-image"]},"icon-color":{"type":"color","default":"#000000","function":"interpolated","zoom-function":true,"property-function":true,"transition":true,"requires":["icon-image"]},"icon-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","function":"interpolated","zoom-function":true,"property-function":true,"transition":true,"requires":["icon-image"]},"icon-halo-width":{"type":"number","default":0,"minimum":0,"function":"interpolated","zoom-function":true,"property-function":true,"transition":true,"units":"pixels","requires":["icon-image"]},"icon-halo-blur":{"type":"number","default":0,"minimum":0,"function":"interpolated","zoom-function":true,"property-function":true,"transition":true,"units":"pixels","requires":["icon-image"]},"icon-translate":{"type":"array","value":"number","length":2,"default":[0,0],"function":"interpolated","zoom-function":true,"transition":true,"units":"pixels","requires":["icon-image"]},"icon-translate-anchor":{"type":"enum","function":"piecewise-constant","zoom-function":true,"values":{"map":{},"viewport":{}},"default":"map","requires":["icon-image","icon-translate"]},"text-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"function":"interpolated","zoom-function":true,"property-function":true,"transition":true,"requires":["text-field"]},"text-color":{"type":"color","default":"#000000","function":"interpolated","zoom-function":true,"property-function":true,"transition":true,"requires":["text-field"]},"text-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","function":"interpolated","zoom-function":true,"property-function":true,"transition":true,"requires":["text-field"]},"text-halo-width":{"type":"number","default":0,"minimum":0,"function":"interpolated","zoom-function":true,"property-function":true,"transition":true,"units":"pixels","requires":["text-field"]},"text-halo-blur":{"type":"number","default":0,"minimum":0,"function":"interpolated","zoom-function":true,"property-function":true,"transition":true,"units":"pixels","requires":["text-field"]},"text-translate":{"type":"array","value":"number","length":2,"default":[0,0],"function":"interpolated","zoom-function":true,"transition":true,"units":"pixels","requires":["text-field"]},"text-translate-anchor":{"type":"enum","function":"piecewise-constant","zoom-function":true,"values":{"map":{},"viewport":{}},"default":"map","requires":["text-field","text-translate"]},"render-3d":{"type":"boolean","function":"piecewise-constant","zoom-function":true,"default":false},"render-road-mark":{"type":"boolean","function":"piecewise-constant","zoom-function":true,"default":false},"symbol-height-offset":{"type":"number","function":"piecewise-constant","default":0,"minimum":0,"maximum":10000}},"paint_raster":{"raster-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"function":"interpolated","zoom-function":true,"transition":true},"raster-hue-rotate":{"type":"number","default":0,"period":360,"function":"interpolated","zoom-function":true,"transition":true,"units":"degrees"},"raster-brightness-min":{"type":"number","function":"interpolated","zoom-function":true,"default":0,"minimum":0,"maximum":1,"transition":true},"raster-brightness-max":{"type":"number","function":"interpolated","zoom-function":true,"default":1,"minimum":0,"maximum":1,"transition":true},"raster-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"function":"interpolated","zoom-function":true,"transition":true},"raster-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"function":"interpolated","zoom-function":true,"transition":true},"raster-fade-duration":{"type":"number","default":300,"minimum":0,"function":"interpolated","zoom-function":true,"transition":false,"units":"milliseconds"}},"paint_hillshade":{"hillshade-illumination-direction":{"type":"number","default":335,"minimum":0,"maximum":359,"function":"interpolated","zoom-function":true,"transition":false},"hillshade-illumination-anchor":{"type":"enum","function":"piecewise-constant","zoom-function":true,"values":{"map":{},"viewport":{}},"default":"viewport"},"hillshade-exaggeration":{"type":"number","default":0.5,"minimum":0,"maximum":1,"function":"interpolated","zoom-function":true,"transition":true},"hillshade-shadow-color":{"type":"color","default":"#000000","function":"interpolated","zoom-function":true,"transition":true},"hillshade-highlight-color":{"type":"color","default":"#FFFFFF","function":"interpolated","zoom-function":true,"transition":true},"hillshade-accent-color":{"type":"color","default":"#000000","function":"interpolated","zoom-function":true,"transition":true}},"paint_background":{"background-color":{"type":"color","default":"#000000","function":"interpolated","zoom-function":true,"transition":true,"requires":[{"!":"background-pattern"}]},"background-pattern":{"type":"string","function":"piecewise-constant","zoom-function":true,"transition":true},"background-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"function":"interpolated","zoom-function":true,"transition":true}},"paint_sprite":{"sprite-opacity":{"type":"number","function":"interpolated","zoom-function":true,"property-function":true,"default":1,"minimum":0,"maximum":1,"transition":true},"sprite-color":{"type":"color","default":"#000000","function":"interpolated","zoom-function":true,"property-function":true,"transition":true,"requires":[{"!":"sprite-pattern"}]},"sprite-translate":{"type":"array","value":"number","length":2,"default":[0,0],"function":"interpolated","zoom-function":true,"transition":true,"units":"pixels"},"sprite-translate-anchor":{"type":"enum","function":"piecewise-constant","zoom-function":true,"values":{"map":{},"viewport":{}},"default":"map","requires":["sprite-translate"]},"sprite-width":{"type":"number","default":1,"minimum":0,"function":"interpolated","zoom-function":true,"property-function":true,"transition":true,"units":"pixels"},"sprite-gap-width":{"type":"number","default":0,"minimum":0,"function":"interpolated","zoom-function":true,"property-function":true,"transition":true,"units":"pixels"},"sprite-offset":{"type":"number","default":0,"function":"interpolated","zoom-function":true,"property-function":true,"transition":true,"units":"pixels"},"sprite-blur":{"type":"number","default":0,"minimum":0,"function":"interpolated","zoom-function":true,"property-function":true,"transition":true,"units":"pixels"},"sprite-dasharray":{"type":"array","value":"number","function":"piecewise-constant","zoom-function":true,"minimum":0,"transition":true,"units":"line widths","requires":[{"!":"sprite-pattern"}]},"sprite-pattern":{"type":"string","function":"piecewise-constant","zoom-function":true,"transition":true},"sprite-speed-factor":{"type":"number","default":1,"minimum":0,"function":"interpolated","zoom-function":true,"property-function":false,"transition":true,"units":"pixels"},"render-3d":{"type":"boolean","function":"piecewise-constant","zoom-function":true,"default":false},"sprite-interpolate":{"type":"boolean","function":"piecewise-constant","zoom-function":true,"default":false},"sprite-status":{"type":"number","function":"interpolated","zoom-function":true,"property-function":true,"default":1,"minimum":1,"maximum":5,"transition":true},"sprite-instatus":{"type":"number","function":"interpolated","zoom-function":true,"property-function":true,"default":1,"minimum":1,"maximum":5,"transition":true},"sprite-height-offset":{"type":"number","function":"piecewise-constant","default":0,"minimum":0,"maximum":100}},"paint_histogram":{"histogram-opacity":{"type":"number","function":"interpolated","zoom-function":true,"property-function":false,"default":1,"minimum":0,"maximum":1,"transition":true},"histogram-color":{"type":"color","default":"#000000","function":"interpolated","zoom-function":true,"property-function":true,"transition":true,"requires":[{"!":"histogram-pattern"}]},"histogram-translate":{"type":"array","value":"number","length":2,"default":[0,0],"function":"interpolated","zoom-function":true,"transition":true,"units":"pixels"},"histogram-translate-anchor":{"type":"enum","function":"piecewise-constant","zoom-function":true,"values":{"map":{},"viewport":{}},"default":"map","requires":["histogram-translate"]},"histogram-pattern":{"type":"string","function":"piecewise-constant","zoom-function":true,"transition":true},"histogram-height":{"type":"number","function":"interpolated","zoom-function":true,"property-function":true,"default":0,"minimum":0,"units":"meters","transition":true},"histogram-base":{"type":"number","function":"interpolated","zoom-function":true,"property-function":true,"default":0,"minimum":0,"units":"meters","transition":true,"requires":["histogram-height"]},"histogram-dynamic":{"type":"boolean","function":"piecewise-constant","zoom-function":true,"property-function":false,"default":false},"histogram-heightArr1":{"type":"color","function":"interpolated","default":[0,0,0,0],"units":"x-color","zoom-function":true,"property-function":true,"transition":true},"histogram-heightArr2":{"type":"color","function":"interpolated","default":[0,0,0,0],"units":"x-color","zoom-function":true,"property-function":true,"transition":true},"histogram-heightArr3":{"type":"color","function":"interpolated","default":[0,0,0,0],"units":"x-color","zoom-function":true,"property-function":true,"transition":true},"histogram-time":{"type":"number","function":"piecewise-constant","zoom-function":true,"property-function":false,"default":1000,"minimum":0,"units":"millisecond","transition":true},"histogram-count":{"type":"number","function":"piecewise-constant","zoom-function":true,"property-function":false,"default":12,"minimum":1,"maximum":12,"units":"millisecond","transition":true},"histogram-colors":{"type":"array","value":"string","length":5,"default":["#ffc1e0","#bbffff","#00e3e3","#005757","#ea0000"],"function":"interpolated","zoom-function":true,"transition":true},"histogram-max-height":{"type":"number","function":"piecewise-constant","zoom-function":true,"property-function":false,"default":200,"minimum":0,"units":"meters","transition":true},"histogram-fluorescent":{"type":"boolean","function":"piecewise-constant","zoom-function":true,"default":false}},"paint_symtracking":{"icon-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"function":"interpolated","zoom-function":true,"property-function":true,"transition":true,"requires":["icon-image"]},"icon-color":{"type":"color","default":"#000000","function":"interpolated","zoom-function":true,"property-function":true,"transition":true,"requires":["icon-image"]},"icon-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","function":"interpolated","zoom-function":true,"property-function":true,"transition":true,"requires":["icon-image"]},"icon-halo-width":{"type":"number","default":0,"minimum":0,"function":"interpolated","zoom-function":true,"property-function":true,"transition":true,"units":"pixels","requires":["icon-image"]},"icon-halo-blur":{"type":"number","default":0,"minimum":0,"function":"interpolated","zoom-function":true,"property-function":true,"transition":true,"units":"pixels","requires":["icon-image"]},"icon-translate":{"type":"array","value":"number","length":2,"default":[0,0],"function":"interpolated","zoom-function":true,"transition":true,"units":"pixels","requires":["icon-image"]},"icon-translate-anchor":{"type":"enum","function":"piecewise-constant","zoom-function":true,"values":{"map":{},"viewport":{}},"default":"map","requires":["icon-image","icon-translate"]},"text-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"function":"interpolated","zoom-function":true,"property-function":true,"transition":true,"requires":["text-field"]},"text-color":{"type":"color","default":"#000000","function":"interpolated","zoom-function":true,"property-function":true,"transition":true,"requires":["text-field"]},"text-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","function":"interpolated","zoom-function":true,"property-function":true,"transition":true,"requires":["text-field"]},"text-halo-width":{"type":"number","default":0,"minimum":0,"function":"interpolated","zoom-function":true,"property-function":true,"transition":true,"units":"pixels","requires":["text-field"]},"text-halo-blur":{"type":"number","default":0,"minimum":0,"function":"interpolated","zoom-function":true,"property-function":true,"transition":true,"units":"pixels","requires":["text-field"]},"text-translate":{"type":"array","value":"number","length":2,"default":[0,0],"function":"interpolated","zoom-function":true,"transition":true,"units":"pixels","requires":["text-field"]},"text-translate-anchor":{"type":"enum","function":"piecewise-constant","zoom-function":true,"values":{"map":{},"viewport":{}},"default":"map","requires":["text-field","text-translate"]},"symtracking-delay":{"type":"number","function":"piecewise-constant","zoom-function":true,"default":10,"minimum":0,"maximum":120,"transition":true},"render-3d":{"type":"boolean","function":"piecewise-constant","zoom-function":true,"default":false},"symtracking-height-offset":{"type":"number","function":"piecewise-constant","default":0,"minimum":0,"maximum":100}},"paint_tracking":{"tracking-opacity":{"type":"number","function":"interpolated","zoom-function":true,"property-function":true,"default":1,"minimum":0,"maximum":1,"transition":true},"tracking-color":{"type":"color","default":"#000000","function":"interpolated","zoom-function":true,"property-function":true,"transition":true,"requires":[{"!":"tracking-pattern"}]},"tracking-translate":{"type":"array","value":"number","length":2,"default":[0,0],"function":"interpolated","zoom-function":true,"transition":true,"units":"pixels"},"tracking-translate-anchor":{"type":"enum","function":"piecewise-constant","zoom-function":true,"values":{"map":{},"viewport":{}},"default":"map","requires":["tracking-translate"]},"tracking-width":{"type":"number","default":1,"minimum":0,"function":"interpolated","zoom-function":true,"property-function":true,"transition":true,"units":"pixels"},"tracking-gap-width":{"type":"number","default":0,"minimum":0,"function":"interpolated","zoom-function":true,"property-function":true,"transition":true,"units":"pixels"},"tracking-offset":{"type":"number","default":0,"function":"interpolated","zoom-function":true,"property-function":true,"transition":true,"units":"pixels"},"tracking-blur":{"type":"number","default":0,"minimum":0,"function":"interpolated","zoom-function":true,"property-function":true,"transition":true,"units":"pixels"},"tracking-type":{"type":"enum","function":"piecewise-constant","zoom-function":true,"values":["real-time","history"],"default":"real-time"},"tracking-seg-count":{"type":"number","function":"interpolated","zoom-function":true,"default":700,"minimum":0,"maximum":10000,"transition":true},"tracking-seg-group":{"type":"number","function":"interpolated","zoom-function":true,"default":20,"minimum":1,"maximum":600,"transition":true},"tracking-speed":{"type":"number","function":"interpolated","zoom-function":true,"default":1,"minimum":1,"maximum":500,"transition":true},"tracking-delay":{"type":"number","zoom-function":true,"default":20,"minimum":0,"maximum":120,"transition":true},"tracking-speed-factor":{"type":"number","default":1,"minimum":0,"function":"interpolated","zoom-function":true,"transition":true,"units":"pixels"}},"paint_dynamicLine":{"dynamicLine-opacity":{"type":"number","function":"interpolated","zoom-function":true,"property-function":true,"default":1,"minimum":0,"maximum":1,"transition":true},"dynamicLine-color":{"type":"color","default":"#000000","function":"interpolated","zoom-function":true,"property-function":true,"transition":true,"requires":[{"!":"line-pattern"}]},"dynamicLine-translate":{"type":"array","value":"number","length":2,"default":[0,0],"function":"interpolated","zoom-function":true,"transition":true,"units":"pixels"},"dynamicLine-translate-anchor":{"type":"enum","function":"piecewise-constant","zoom-function":true,"values":{"map":{},"viewport":{}},"default":"map","requires":["line-translate"]},"dynamicLine-width":{"type":"number","default":1,"minimum":0,"function":"interpolated","zoom-function":true,"property-function":true,"transition":true,"units":"pixels"},"dynamicLine-gap-width":{"type":"number","default":0,"minimum":0,"function":"interpolated","zoom-function":true,"property-function":true,"transition":true,"units":"pixels"},"dynamicLine-offset":{"type":"number","default":0,"function":"interpolated","zoom-function":true,"property-function":true,"transition":true,"units":"pixels"},"dynamicLine-blur":{"type":"number","default":0,"minimum":0,"function":"interpolated","zoom-function":true,"property-function":true,"transition":true,"units":"pixels"},"dynamicLine-seg-count":{"type":"number","function":"piecewise-constant","zoom-function":true,"transition":true,"default":700,"minimum":0,"maximum":10000},"dynamicLine-seg-group":{"type":"number","function":"piecewise-constant","zoom-function":true,"transition":true,"default":20,"minimum":1,"maximum":600},"dynamicLine-speed":{"type":"number","function":"piecewise-constant","zoom-function":true,"transition":true,"default":1,"minimum":1,"maximum":500},"dynamicLine-speed-factor":{"type":"number","default":1,"minimum":0,"function":"piecewise-constant","zoom-function":true,"transition":true,"units":"pixels"}},"paint_airline":{"airline-opacity":{"type":"number","function":"interpolated","zoom-function":true,"property-function":true,"default":1,"minimum":0,"maximum":1,"transition":true},"airline-color":{"type":"color","default":"#000000","function":"interpolated","zoom-function":true,"property-function":true,"transition":true,"requires":[{"!":"line-pattern"}]},"airline-translate":{"type":"array","value":"number","length":2,"default":[0,0],"function":"interpolated","zoom-function":true,"transition":true,"units":"pixels"},"airline-translate-anchor":{"type":"enum","function":"piecewise-constant","zoom-function":true,"values":{"map":{},"viewport":{}},"default":"map","requires":["line-translate"]},"airline-width":{"type":"number","default":1,"minimum":0,"function":"interpolated","zoom-function":true,"property-function":true,"transition":true,"units":"pixels"},"airline-gap-width":{"type":"number","default":0,"minimum":0,"function":"interpolated","zoom-function":true,"property-function":true,"transition":true,"units":"pixels"},"airline-offset":{"type":"number","default":0,"function":"interpolated","zoom-function":true,"property-function":true,"transition":true,"units":"pixels"},"airline-blur":{"type":"number","default":0,"minimum":0,"function":"interpolated","zoom-function":true,"property-function":true,"transition":true,"units":"pixels"},"airline-dasharray":{"type":"array","value":"number","function":"piecewise-constant","zoom-function":true,"minimum":0,"transition":true,"units":"line widths","requires":[{"!":"line-pattern"}]},"airline-pattern":{"type":"string","function":"piecewise-constant","zoom-function":true,"transition":true},"airline-seg-count":{"type":"number","function":"interpolated","zoom-function":true,"default":700,"minimum":0,"maximum":10000,"transition":true},"airline-seg-group":{"type":"number","function":"interpolated","zoom-function":true,"default":20,"minimum":1,"maximum":600,"transition":true},"airline-speed":{"type":"number","function":"interpolated","zoom-function":true,"default":1,"minimum":1,"maximum":500,"transition":true},"airline-speed-factor":{"type":"number","default":1,"minimum":0,"function":"interpolated","zoom-function":true,"transition":true,"units":"pixels"},"airline-type":{"type":"enum","function":"piecewise-constant","zoom-function":true,"values":["real-time","history","none"],"default":"history"}},"transition":{"duration":{"type":"number","default":300,"minimum":0,"units":"milliseconds"},"delay":{"type":"number","default":0,"minimum":0,"units":"milliseconds"}}}
},{}],173:[function(_dereq_,module,exports){
"use strict";var ref=_dereq_("csscolorparser"),parseCSSColor=ref.parseCSSColor,Color=function(r,o,t,e){void 0===e&&(e=1),this.r=r,this.g=o,this.b=t,this.a=e};Color.parse=function(r){if(r){if(r instanceof Color)return r;if("string"==typeof r){var o=parseCSSColor(r);if(o)return new Color(o[0]/255*o[3],o[1]/255*o[3],o[2]/255*o[3],o[3])}}},Color.prototype.toString=function(){var r=this,o=function(o){return Math.round(255*o/r.a)};return"rgba("+[this.r,this.g,this.b].map(o).concat(this.a).join(",")+")"},Color.black=new Color(0,0,0,1),Color.white=new Color(1,1,1,1),Color.transparent=new Color(0,0,0,0),module.exports=Color;
},{"csscolorparser":2}],174:[function(_dereq_,module,exports){
"use strict";function xyz2lab(a){return a>t3?Math.pow(a,1/3):a/t2+t0}function lab2xyz(a){return a>t1?a*a*a:t2*(a-t0)}function xyz2rgb(a){return 255*(a<=.0031308?12.92*a:1.055*Math.pow(a,1/2.4)-.055)}function rgb2xyz(a){return a/=255,a<=.04045?a/12.92:Math.pow((a+.055)/1.055,2.4)}function rgbToLab(a){var r=rgb2xyz(a.r),t=rgb2xyz(a.g),e=rgb2xyz(a.b),n=xyz2lab((.4124564*r+.3575761*t+.1804375*e)/Xn),l=xyz2lab((.2126729*r+.7151522*t+.072175*e)/Yn);return{l:116*l-16,a:500*(n-l),b:200*(l-xyz2lab((.0193339*r+.119192*t+.9503041*e)/Zn)),alpha:a.a}}function labToRgb(a){var r=(a.l+16)/116,t=isNaN(a.a)?r:r+a.a/500,e=isNaN(a.b)?r:r-a.b/200;return r=Yn*lab2xyz(r),t=Xn*lab2xyz(t),e=Zn*lab2xyz(e),new Color(xyz2rgb(3.2404542*t-1.5371385*r-.4985314*e),xyz2rgb(-.969266*t+1.8760108*r+.041556*e),xyz2rgb(.0556434*t-.2040259*r+1.0572252*e),a.alpha)}function interpolateLab(a,r,t){return{l:interpolateNumber(a.l,r.l,t),a:interpolateNumber(a.a,r.a,t),b:interpolateNumber(a.b,r.b,t),alpha:interpolateNumber(a.alpha,r.alpha,t)}}function rgbToHcl(a){var r=rgbToLab(a),t=r.l,e=r.a,n=r.b,l=Math.atan2(n,e)*rad2deg;return{h:l<0?l+360:l,c:Math.sqrt(e*e+n*n),l:t,alpha:a.a}}function hclToRgb(a){var r=a.h*deg2rad,t=a.c;return labToRgb({l:a.l,a:Math.cos(r)*t,b:Math.sin(r)*t,alpha:a.alpha})}function interpolateHue(a,r,t){var e=r-a;return a+t*(e>180||e<-180?e-360*Math.round(e/360):e)}function interpolateHcl(a,r,t){return{h:interpolateHue(a.h,r.h,t),c:interpolateNumber(a.c,r.c,t),l:interpolateNumber(a.l,r.l,t),alpha:interpolateNumber(a.alpha,r.alpha,t)}}var Color=_dereq_("./color"),interpolateNumber=_dereq_("./interpolate").number,Xn=.95047,Yn=1,Zn=1.08883,t0=4/29,t1=6/29,t2=3*t1*t1,t3=t1*t1*t1,deg2rad=Math.PI/180,rad2deg=180/Math.PI;module.exports={lab:{forward:rgbToLab,reverse:labToRgb,interpolate:interpolateLab},hcl:{forward:rgbToHcl,reverse:hclToRgb,interpolate:interpolateHcl}};
},{"./color":173,"./interpolate":178}],175:[function(_dereq_,module,exports){
"use strict";function deepEqual(e,r){if(Array.isArray(e)){if(!Array.isArray(r)||e.length!==r.length)return!1;for(var t=0;t<e.length;t++)if(!deepEqual(e[t],r[t]))return!1;return!0}if("object"==typeof e&&null!==e&&null!==r){if("object"!=typeof r)return!1;if(Object.keys(e).length!==Object.keys(r).length)return!1;for(var n in e)if(!deepEqual(e[n],r[n]))return!1;return!0}return e===r}module.exports=deepEqual;
},{}],176:[function(_dereq_,module,exports){
"use strict";module.exports=function(r){for(var t=[],e=arguments.length-1;e-- >0;)t[e]=arguments[e+1];for(var n=0,o=t;n<o.length;n+=1){var a=o[n];for(var f in a)r[f]=a[f]}return r};
},{}],177:[function(_dereq_,module,exports){
"use strict";module.exports=function(n){return n instanceof Number?"number":n instanceof String?"string":n instanceof Boolean?"boolean":Array.isArray(n)?"array":null===n?"null":typeof n};
},{}],178:[function(_dereq_,module,exports){
"use strict";function number(r,n,u){return r*(1-u)+n*u}function color(r,n,u){return new Color(number(r.r,n.r,u),number(r.g,n.g,u),number(r.b,n.b,u),number(r.a,n.a,u))}function array(r,n,u){return r.map(function(r,e){return number(r,n[e],u)})}var Color=_dereq_("./color");module.exports={number:number,color:color,array:array};
},{"./color":173}],179:[function(_dereq_,module,exports){
"use strict";module.exports=["type","source","source-layer","minzoom","maxzoom","filter","layout"];
},{}],180:[function(_dereq_,module,exports){
"use strict";function success(r){return{result:"success",value:r}}function error(r){return{result:"error",value:r}}module.exports={success:success,error:error};
},{}],181:[function(_dereq_,module,exports){
"use strict";function unbundle(e){return e instanceof Number||e instanceof String||e instanceof Boolean?e.valueOf():e}function deepUnbundle(e){return Array.isArray(e)?e.map(deepUnbundle):unbundle(e)}module.exports=unbundle,module.exports.deep=deepUnbundle;
},{}],182:[function(_dereq_,module,exports){
"use strict";var extend=_dereq_("../util/extend"),unbundle=_dereq_("../util/unbundle_jsonlint"),ref=_dereq_("../expression"),isExpression=ref.isExpression,ref$1=_dereq_("../function"),isFunction=ref$1.isFunction;module.exports=function(e){var r=_dereq_("./validate_function"),i=_dereq_("./validate_expression"),t=_dereq_("./validate_object"),n={"*":function(){return[]},array:_dereq_("./validate_array"),boolean:_dereq_("./validate_boolean"),number:_dereq_("./validate_number"),color:_dereq_("./validate_color"),constants:_dereq_("./validate_constants"),enum:_dereq_("./validate_enum"),filter:_dereq_("./validate_filter"),function:_dereq_("./validate_function"),layer:_dereq_("./validate_layer"),object:_dereq_("./validate_object"),source:_dereq_("./validate_source"),light:_dereq_("./validate_light"),string:_dereq_("./validate_string")},u=e.value,a=e.valueSpec,l=e.styleSpec;return a.function&&isFunction(unbundle(u))?r(e):a.function&&isExpression(unbundle.deep(u))?i(e):a.type&&n[a.type]?n[a.type](e):t(extend({},e,{valueSpec:a.type?l[a.type]:a}))};
},{"../expression":159,"../function":169,"../util/extend":176,"../util/unbundle_jsonlint":181,"./validate_array":183,"./validate_boolean":184,"./validate_color":185,"./validate_constants":186,"./validate_enum":187,"./validate_expression":188,"./validate_filter":189,"./validate_function":190,"./validate_layer":192,"./validate_light":194,"./validate_number":195,"./validate_object":196,"./validate_source":199,"./validate_string":200}],183:[function(_dereq_,module,exports){
"use strict";var getType=_dereq_("../util/get_type"),validate=_dereq_("./validate"),ValidationError=_dereq_("../error/validation_error");module.exports=function(e){var r=e.value,t=e.valueSpec,a=e.style,n=e.styleSpec,l=e.key,i=e.arrayElementValidator||validate;if("array"!==getType(r))return[new ValidationError(l,r,"array expected, "+getType(r)+" found")];if(t.length&&r.length!==t.length)return[new ValidationError(l,r,"array length "+t.length+" expected, length "+r.length+" found")];if(t["min-length"]&&r.length<t["min-length"])return[new ValidationError(l,r,"array length at least "+t["min-length"]+" expected, length "+r.length+" found")];var o={type:t.value};n.$version<7&&(o.function=t.function),"object"===getType(t.value)&&(o=t.value);for(var u=[],g=0;g<r.length;g++)u=u.concat(i({array:r,arrayIndex:g,value:r[g],valueSpec:o,style:a,styleSpec:n,key:l+"["+g+"]"}));return u};
},{"../error/validation_error":142,"../util/get_type":177,"./validate":182}],184:[function(_dereq_,module,exports){
"use strict";var getType=_dereq_("../util/get_type"),ValidationError=_dereq_("../error/validation_error");module.exports=function(e){var r=e.value,o=e.key,t=getType(r);return"boolean"!==t?[new ValidationError(o,r,"boolean expected, "+t+" found")]:[]};
},{"../error/validation_error":142,"../util/get_type":177}],185:[function(_dereq_,module,exports){
"use strict";var ValidationError=_dereq_("../error/validation_error"),getType=_dereq_("../util/get_type"),parseCSSColor=_dereq_("csscolorparser").parseCSSColor;module.exports=function(r){var e=r.key,o=r.value,t=getType(o);return"string"!==t?[new ValidationError(e,o,"color expected, "+t+" found")]:null===parseCSSColor(o)?[new ValidationError(e,o,'color expected, "'+o+'" found')]:[]};
},{"../error/validation_error":142,"../util/get_type":177,"csscolorparser":2}],186:[function(_dereq_,module,exports){
"use strict";var ValidationError=_dereq_("../error/validation_error");module.exports=function(r){var e=r.key,a=r.value;return a?[new ValidationError(e,a,"constants have been deprecated as of v8")]:[]};
},{"../error/validation_error":142}],187:[function(_dereq_,module,exports){
"use strict";var ValidationError=_dereq_("../error/validation_error"),unbundle=_dereq_("../util/unbundle_jsonlint");module.exports=function(e){var r=e.key,n=e.value,u=e.valueSpec,i=[];return Array.isArray(u.values)?-1===u.values.indexOf(unbundle(n))&&i.push(new ValidationError(r,n,"expected one of ["+u.values.join(", ")+"], "+JSON.stringify(n)+" found")):-1===Object.keys(u.values).indexOf(unbundle(n))&&i.push(new ValidationError(r,n,"expected one of ["+Object.keys(u.values).join(", ")+"], "+JSON.stringify(n)+" found")),i};
},{"../error/validation_error":142,"../util/unbundle_jsonlint":181}],188:[function(_dereq_,module,exports){
"use strict";var ValidationError=_dereq_("../error/validation_error"),ref=_dereq_("../expression"),createExpression=ref.createExpression,createPropertyExpression=ref.createPropertyExpression,unbundle=_dereq_("../util/unbundle_jsonlint");module.exports=function(e){var r=("property"===e.expressionContext?createPropertyExpression:createExpression)(unbundle.deep(e.value),e.valueSpec);return"error"===r.result?r.value.map(function(r){return new ValidationError(""+e.key+r.key,e.value,r.message)}):"property"===e.expressionContext&&"text-font"===e.propertyKey&&-1!==r.value._styleExpression.expression.possibleOutputs().indexOf(void 0)?[new ValidationError(e.key,e.value,'Invalid data expression for "text-font". Output values must be contained as literals within the expression.')]:[]};
},{"../error/validation_error":142,"../expression":159,"../util/unbundle_jsonlint":181}],189:[function(_dereq_,module,exports){
"use strict";function validateNonExpressionFilter(e){var r=e.value,t=e.key;if("array"!==getType(r))return[new ValidationError(t,r,"array expected, "+getType(r)+" found")];var a,n=e.styleSpec,i=[];if(r.length<1)return[new ValidationError(t,r,"filter array must have at least 1 element")];switch(i=i.concat(validateEnum({key:t+"[0]",value:r[0],valueSpec:n.filter_operator,style:e.style,styleSpec:e.styleSpec})),unbundle(r[0])){case"<":case"<=":case">":case">=":r.length>=2&&"$type"===unbundle(r[1])&&i.push(new ValidationError(t,r,'"$type" cannot be use with operator "'+r[0]+'"'));case"==":case"!=":3!==r.length&&i.push(new ValidationError(t,r,'filter array for operator "'+r[0]+'" must have 3 elements'));case"in":case"!in":case"arrin":case"!arrin":r.length>=2&&"string"!==(a=getType(r[1]))&&i.push(new ValidationError(t+"[1]",r[1],"string expected, "+a+" found"));for(var l=2;l<r.length;l++)a=getType(r[l]),"$type"===unbundle(r[1])?i=i.concat(validateEnum({key:t+"["+l+"]",value:r[l],valueSpec:n.geometry_type,style:e.style,styleSpec:e.styleSpec})):"string"!==a&&"number"!==a&&"boolean"!==a&&i.push(new ValidationError(t+"["+l+"]",r[l],"string, number, or boolean expected, "+a+" found"));break;case"any":case"all":case"none":for(var s=1;s<r.length;s++)i=i.concat(validateNonExpressionFilter({key:t+"["+s+"]",value:r[s],style:e.style,styleSpec:e.styleSpec}));break;case"has":case"!has":a=getType(r[1]),2!==r.length?i.push(new ValidationError(t,r,'filter array for "'+r[0]+'" operator must have 2 elements')):"string"!==a&&i.push(new ValidationError(t+"[1]",r[1],"string expected, "+a+" found"))}return i}var ValidationError=_dereq_("../error/validation_error"),validateExpression=_dereq_("./validate_expression"),validateEnum=_dereq_("./validate_enum"),getType=_dereq_("../util/get_type"),unbundle=_dereq_("../util/unbundle_jsonlint"),extend=_dereq_("../util/extend"),ref=_dereq_("../feature_filter"),isExpressionFilter=ref.isExpressionFilter;module.exports=function(e){return isExpressionFilter(unbundle.deep(e.value))?validateExpression(extend({},e,{expressionContext:"filter",valueSpec:{value:"boolean"}})):validateNonExpressionFilter(e)};
},{"../error/validation_error":142,"../feature_filter":168,"../util/extend":176,"../util/get_type":177,"../util/unbundle_jsonlint":181,"./validate_enum":187,"./validate_expression":188}],190:[function(_dereq_,module,exports){
"use strict";var ValidationError=_dereq_("../error/validation_error"),getType=_dereq_("../util/get_type"),validate=_dereq_("./validate"),validateObject=_dereq_("./validate_object"),validateArray=_dereq_("./validate_array"),validateNumber=_dereq_("./validate_number"),unbundle=_dereq_("../util/unbundle_jsonlint");module.exports=function(e){function t(e){if("identity"===p)return[new ValidationError(e.key,e.value,'identity function may not have a "stops" property')];var t=[],a=e.value;return t=t.concat(validateArray({key:e.key,value:a,valueSpec:e.valueSpec,style:e.style,styleSpec:e.styleSpec,arrayElementValidator:r})),"array"===getType(a)&&0===a.length&&t.push(new ValidationError(e.key,a,"array must have at least one stop")),t}function r(e){var t=[],r=e.value,o=e.key;if("array"!==getType(r))return[new ValidationError(o,r,"array expected, "+getType(r)+" found")];if(2!==r.length)return[new ValidationError(o,r,"array length 2 expected, length "+r.length+" found")];if(d){if("object"!==getType(r[0]))return[new ValidationError(o,r,"object expected, "+getType(r[0])+" found")];if(void 0===r[0].zoom)return[new ValidationError(o,r,"object stop key must have zoom")];if(void 0===r[0].value)return[new ValidationError(o,r,"object stop key must have value")];if(l&&l>unbundle(r[0].zoom))return[new ValidationError(o,r[0].zoom,"stop zoom values must appear in ascending order")];unbundle(r[0].zoom)!==l&&(l=unbundle(r[0].zoom),i=void 0,s={}),t=t.concat(validateObject({key:o+"[0]",value:r[0],valueSpec:{zoom:{}},style:e.style,styleSpec:e.styleSpec,objectElementValidators:{zoom:validateNumber,value:a}}))}else t=t.concat(a({key:o+"[0]",value:r[0],valueSpec:{},style:e.style,styleSpec:e.styleSpec},r));return t.concat(validate({key:o+"[1]",value:r[1],valueSpec:u,style:e.style,styleSpec:e.styleSpec}))}function a(e,t){var r=getType(e.value),a=unbundle(e.value),o=null!==e.value?e.value:t;if(n){if(r!==n)return[new ValidationError(e.key,o,r+" stop domain type must match previous stop domain type "+n)]}else n=r;if("number"!==r&&"string"!==r&&"boolean"!==r)return[new ValidationError(e.key,o,"stop domain value must be a number, string, or boolean")];if("number"!==r&&"categorical"!==p){var l="number expected, "+r+" found";return u["property-function"]&&void 0===p&&(l+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new ValidationError(e.key,o,l)]}return"categorical"!==p||"number"!==r||isFinite(a)&&Math.floor(a)===a?"categorical"!==p&&"number"===r&&void 0!==i&&a<i?[new ValidationError(e.key,o,"stop domain values must appear in ascending order")]:(i=a,"categorical"===p&&a in s?[new ValidationError(e.key,o,"stop domain values must be unique")]:(s[a]=!0,[])):[new ValidationError(e.key,o,"integer expected, found "+a)]}function o(e){return validate({key:e.key,value:e.value,valueSpec:u,style:e.style,styleSpec:e.styleSpec})}var n,i,l,u=e.valueSpec,p=unbundle(e.value.type),s={},y="categorical"!==p&&void 0===e.value.property,c=!y,d="array"===getType(e.value.stops)&&"array"===getType(e.value.stops[0])&&"object"===getType(e.value.stops[0][0]),v=validateObject({key:e.key,value:e.value,valueSpec:e.styleSpec.function,style:e.style,styleSpec:e.styleSpec,objectElementValidators:{stops:t,default:o}});return"identity"===p&&y&&v.push(new ValidationError(e.key,e.value,'missing required property "property"')),"identity"===p||e.value.stops||v.push(new ValidationError(e.key,e.value,'missing required property "stops"')),"exponential"===p&&"piecewise-constant"===e.valueSpec.function&&v.push(new ValidationError(e.key,e.value,"exponential functions not supported")),e.styleSpec.$version>=8&&(c&&!e.valueSpec["property-function"]?v.push(new ValidationError(e.key,e.value,"property functions not supported")):y&&!e.valueSpec["zoom-function"]&&"heatmap-color"!==e.objectKey&&v.push(new ValidationError(e.key,e.value,"zoom functions not supported"))),"categorical"!==p&&!d||void 0!==e.value.property||v.push(new ValidationError(e.key,e.value,'"property" property is required')),v};
},{"../error/validation_error":142,"../util/get_type":177,"../util/unbundle_jsonlint":181,"./validate":182,"./validate_array":183,"./validate_number":195,"./validate_object":196}],191:[function(_dereq_,module,exports){
"use strict";var ValidationError=_dereq_("../error/validation_error"),validateString=_dereq_("./validate_string");module.exports=function(r){var e=r.value,t=r.key,a=validateString(r);return a.length?a:(-1===e.indexOf("{fontstack}")&&a.push(new ValidationError(t,e,'"glyphs" url must include a "{fontstack}" token')),-1===e.indexOf("{range}")&&a.push(new ValidationError(t,e,'"glyphs" url must include a "{range}" token')),a)};
},{"../error/validation_error":142,"./validate_string":200}],192:[function(_dereq_,module,exports){
"use strict";var ValidationError=_dereq_("../error/validation_error"),unbundle=_dereq_("../util/unbundle_jsonlint"),validateObject=_dereq_("./validate_object"),validateFilter=_dereq_("./validate_filter"),validatePaintProperty=_dereq_("./validate_paint_property"),validateLayoutProperty=_dereq_("./validate_layout_property"),validateSpec=_dereq_("./validate"),extend=_dereq_("../util/extend");module.exports=function(e){var r=[],t=e.value,a=e.key,l=e.style,i=e.styleSpec;t.type||t.ref||r.push(new ValidationError(a,t,'either "type" or "ref" is required'));var u=unbundle(t.type),n=unbundle(t.ref);if(t.id)for(var o=unbundle(t.id),s=0;s<e.arrayIndex;s++){var y=l.layers[s];unbundle(y.id)===o&&r.push(new ValidationError(a,t.id,'duplicate layer id "'+t.id+'", previously used at line '+y.id.__line__))}if("ref"in t){["type","source","source-layer","filter","layout"].forEach(function(e){e in t&&r.push(new ValidationError(a,t[e],'"'+e+'" is prohibited for ref layers'))});var d;l.layers.forEach(function(e){unbundle(e.id)===n&&(d=e)}),d?d.ref?r.push(new ValidationError(a,t.ref,"ref cannot reference another ref layer")):u=unbundle(d.type):r.push(new ValidationError(a,t.ref,'ref layer "'+n+'" not found'))}else if("background"!==u)if(t.source){var c=l.sources&&l.sources[t.source],p=c&&unbundle(c.type);c?"vector"===p&&"raster"===u?r.push(new ValidationError(a,t.source,'layer "'+t.id+'" requires a raster source')):"raster"===p&&"raster"!==u?r.push(new ValidationError(a,t.source,'layer "'+t.id+'" requires a vector source')):"vector"!==p||t["source-layer"]?"raster-dem"===p&&"hillshade"!==u&&r.push(new ValidationError(a,t.source,"raster-dem source can only be used with layer type 'hillshade'.")):r.push(new ValidationError(a,t,'layer "'+t.id+'" must specify a "source-layer"')):r.push(new ValidationError(a,t.source,'source "'+t.source+'" not found'))}else r.push(new ValidationError(a,t,'missing required property "source"'));return r=r.concat(validateObject({key:a,value:t,valueSpec:i.layer,style:e.style,styleSpec:e.styleSpec,objectElementValidators:{"*":function(){return[]},type:function(){return validateSpec({key:a+".type",value:t.type,valueSpec:i.layer.type,style:e.style,styleSpec:e.styleSpec,object:t,objectKey:"type"})},filter:validateFilter,layout:function(e){return validateObject({layer:t,key:e.key,value:e.value,style:e.style,styleSpec:e.styleSpec,objectElementValidators:{"*":function(e){return validateLayoutProperty(extend({layerType:u},e))}}})},paint:function(e){return validateObject({layer:t,key:e.key,value:e.value,style:e.style,styleSpec:e.styleSpec,objectElementValidators:{"*":function(e){return validatePaintProperty(extend({layerType:u},e))}}})}}}))};
},{"../error/validation_error":142,"../util/extend":176,"../util/unbundle_jsonlint":181,"./validate":182,"./validate_filter":189,"./validate_layout_property":193,"./validate_object":196,"./validate_paint_property":197}],193:[function(_dereq_,module,exports){
"use strict";var validateProperty=_dereq_("./validate_property");module.exports=function(r){return validateProperty(r,"layout")};
},{"./validate_property":198}],194:[function(_dereq_,module,exports){
"use strict";var ValidationError=_dereq_("../error/validation_error"),getType=_dereq_("../util/get_type"),validate=_dereq_("./validate");module.exports=function(e){var t=e.value,r=e.styleSpec,a=r.light,i=e.style,n=[],o=getType(t);if(void 0===t)return n;if("object"!==o)return n=n.concat([new ValidationError("light",t,"object expected, "+o+" found")]);for(var l in t){var c=l.match(/^(.*)-transition$/);n=c&&a[c[1]]&&a[c[1]].transition?n.concat(validate({key:l,value:t[l],valueSpec:r.transition,style:i,styleSpec:r})):a[l]?n.concat(validate({key:l,value:t[l],valueSpec:a[l],style:i,styleSpec:r})):n.concat([new ValidationError(l,t[l],'unknown property "'+l+'"')])}return n};
},{"../error/validation_error":142,"../util/get_type":177,"./validate":182}],195:[function(_dereq_,module,exports){
"use strict";var getType=_dereq_("../util/get_type"),ValidationError=_dereq_("../error/validation_error");module.exports=function(e){var r=e.key,i=e.value,m=e.valueSpec,a=getType(i);return"number"!==a?[new ValidationError(r,i,"number expected, "+a+" found")]:"minimum"in m&&i<m.minimum?[new ValidationError(r,i,i+" is less than the minimum value "+m.minimum)]:"maximum"in m&&i>m.maximum?[new ValidationError(r,i,i+" is greater than the maximum value "+m.maximum)]:[]};
},{"../error/validation_error":142,"../util/get_type":177}],196:[function(_dereq_,module,exports){
"use strict";var ValidationError=_dereq_("../error/validation_error"),getType=_dereq_("../util/get_type"),validateSpec=_dereq_("./validate");module.exports=function(e){var r=e.key,t=e.value,i=e.valueSpec||{},a=e.objectElementValidators||{},o=e.style,l=e.styleSpec,n=[],u=getType(t);if("object"!==u)return[new ValidationError(r,t,"object expected, "+u+" found")];for(var d in t){var p=d.split(".")[0],c=i[p]||i["*"],v=void 0;if(a[p])v=a[p];else if(i[p])v=validateSpec;else if(a["*"])v=a["*"];else{if(!i["*"]){n.push(new ValidationError(r,t[d],'unknown property "'+d+'"'));continue}v=validateSpec}n=n.concat(v({key:(r?r+".":r)+d,value:t[d],valueSpec:c,style:o,styleSpec:l,object:t,objectKey:d},t))}for(var s in i)a[s]||i[s].required&&void 0===i[s].default&&void 0===t[s]&&n.push(new ValidationError(r,t,'missing required property "'+s+'"'));return n};
},{"../error/validation_error":142,"../util/get_type":177,"./validate":182}],197:[function(_dereq_,module,exports){
"use strict";var validateProperty=_dereq_("./validate_property");module.exports=function(r){return validateProperty(r,"paint")};
},{"./validate_property":198}],198:[function(_dereq_,module,exports){
"use strict";var validate=_dereq_("./validate"),ValidationError=_dereq_("../error/validation_error"),getType=_dereq_("../util/get_type"),ref=_dereq_("../function"),isFunction=ref.isFunction,unbundle=_dereq_("../util/unbundle_jsonlint");module.exports=function(e,t){var r=e.key,n=e.style,i=e.styleSpec,o=e.value,a=e.objectKey,u=i[t+"_"+e.layerType];if(!u)return[];var p=a.match(/^(.*)-transition$/);if("paint"===t&&p&&u[p[1]]&&u[p[1]].transition)return validate({key:r,value:o,valueSpec:i.transition,style:n,styleSpec:i});var l=e.valueSpec||u[a];if(!l)return[new ValidationError(r,o,'unknown property "'+a+'"')];var y;if("string"===getType(o)&&l["property-function"]&&!l.tokens&&(y=/^{([^}]+)}$/.exec(o)))return[new ValidationError(r,o,'"'+a+'" does not support interpolation syntax\nUse an identity property function instead: `{ "type": "identity", "property": '+JSON.stringify(y[1])+" }`.")];var s=[];return"symbol"===e.layerType&&("text-field"===a&&n&&!n.glyphs&&s.push(new ValidationError(r,o,'use of "text-field" requires a style "glyphs" property')),"text-font"===a&&isFunction(unbundle.deep(o))&&"identity"===unbundle(o.type)&&s.push(new ValidationError(r,o,'"text-font" does not support identity functions'))),s.concat(validate({key:e.key,value:o,valueSpec:l,style:n,styleSpec:i,expressionContext:"property",propertyKey:a}))};
},{"../error/validation_error":142,"../function":169,"../util/get_type":177,"../util/unbundle_jsonlint":181,"./validate":182}],199:[function(_dereq_,module,exports){
"use strict";var ValidationError=_dereq_("../error/validation_error"),unbundle=_dereq_("../util/unbundle_jsonlint"),validateObject=_dereq_("./validate_object"),validateEnum=_dereq_("./validate_enum");module.exports=function(e){var a=e.value,r=e.key,t=e.styleSpec,l=e.style;if(!a.type)return[new ValidationError(r,a,'"type" is required')];var u=unbundle(a.type),s=[];switch(u){case"vector":case"raster":case"raster-dem":if(s=s.concat(validateObject({key:r,value:a,valueSpec:t["source_"+u.replace("-","_")],style:e.style,styleSpec:t})),"url"in a)for(var c in a)["type","url","tileSize"].indexOf(c)<0&&s.push(new ValidationError(r+"."+c,a[c],'a source with a "url" property may not include a "'+c+'" property'));return s;case"geojson":return validateObject({key:r,value:a,valueSpec:t.source_geojson,style:l,styleSpec:t});case"video":return validateObject({key:r,value:a,valueSpec:t.source_video,style:l,styleSpec:t});case"image":return validateObject({key:r,value:a,valueSpec:t.source_image,style:l,styleSpec:t});case"canvas":return validateObject({key:r,value:a,valueSpec:t.source_canvas,style:l,styleSpec:t});default:return validateEnum({key:r+".type",value:a.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image","canvas"]},style:l,styleSpec:t})}};
},{"../error/validation_error":142,"../util/unbundle_jsonlint":181,"./validate_enum":187,"./validate_object":196}],200:[function(_dereq_,module,exports){
"use strict";var getType=_dereq_("../util/get_type"),ValidationError=_dereq_("../error/validation_error");module.exports=function(r){var e=r.value,t=r.key,i=getType(e);return"string"!==i?[new ValidationError(t,e,"string expected, "+i+" found")]:[]};
},{"../error/validation_error":142,"../util/get_type":177}],201:[function(_dereq_,module,exports){
"use strict";function validateStyleMin(e,a){a=a||latestStyleSpec;var t=[];return t=t.concat(validate({key:"",value:e,valueSpec:a.$root,styleSpec:a,style:e,objectElementValidators:{glyphs:validateGlyphsURL,"*":function(){return[]}}})),e.constants&&(t=t.concat(validateConstants({key:"constants",value:e.constants,style:e,styleSpec:a}))),sortErrors(t)}function sortErrors(e){return[].concat(e).sort(function(e,a){return e.line-a.line})}function wrapCleanErrors(e){return function(){return sortErrors(e.apply(this,arguments))}}var validateConstants=_dereq_("./validate/validate_constants"),validate=_dereq_("./validate/validate"),latestStyleSpec=_dereq_("./reference/latest"),validateGlyphsURL=_dereq_("./validate/validate_glyphs_url");validateStyleMin.source=wrapCleanErrors(_dereq_("./validate/validate_source")),validateStyleMin.light=wrapCleanErrors(_dereq_("./validate/validate_light")),validateStyleMin.layer=wrapCleanErrors(_dereq_("./validate/validate_layer")),validateStyleMin.filter=wrapCleanErrors(_dereq_("./validate/validate_filter")),validateStyleMin.paintProperty=wrapCleanErrors(_dereq_("./validate/validate_paint_property")),validateStyleMin.layoutProperty=wrapCleanErrors(_dereq_("./validate/validate_layout_property")),module.exports=validateStyleMin;
},{"./reference/latest":171,"./validate/validate":182,"./validate/validate_constants":186,"./validate/validate_filter":189,"./validate/validate_glyphs_url":191,"./validate/validate_layer":192,"./validate/validate_layout_property":193,"./validate/validate_light":194,"./validate/validate_paint_property":197,"./validate/validate_source":199}],202:[function(_dereq_,module,exports){
"use strict";var ZoomHistory=_dereq_("./zoom_history"),EvaluationParameters=function(t,o){this.zoom=t,o?(this.now=o.now,this.fadeDuration=o.fadeDuration,this.zoomHistory=o.zoomHistory,this.transition=o.transition):(this.now=0,this.fadeDuration=0,this.zoomHistory=new ZoomHistory,this.transition={})};EvaluationParameters.prototype.crossFadingFactor=function(){return 0===this.fadeDuration?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)},module.exports=EvaluationParameters;
},{"./zoom_history":244}],203:[function(_dereq_,module,exports){
"use strict";var styleSpec=_dereq_("../style-spec/reference/latest"),util=_dereq_("../util/util"),Evented=_dereq_("../util/evented").Evented,Event=_dereq_("../util/evented").Event,ErrorEvent=_dereq_("../util/evented").ErrorEvent,validateStyle=_dereq_("./validate_style"),ref=_dereq_("../util/util"),sphericalToCartesian=ref.sphericalToCartesian,Color=_dereq_("../style-spec/util/color"),interpolate=_dereq_("../style-spec/util/interpolate"),ref$1=_dereq_("./properties"),Properties=ref$1.Properties,Transitionable=ref$1.Transitionable,Transitioning=ref$1.Transitioning,PossiblyEvaluated=ref$1.PossiblyEvaluated,DataConstantProperty=ref$1.DataConstantProperty,LightPositionProperty=function(){this.specification=styleSpec.light.position};LightPositionProperty.prototype.possiblyEvaluate=function(t,e){return sphericalToCartesian(t.expression.evaluate(e))},LightPositionProperty.prototype.interpolate=function(t,e,i){return{x:interpolate.number(t.x,e.x,i),y:interpolate.number(t.y,e.y,i),z:interpolate.number(t.z,e.z,i)}};var properties=new Properties({anchor:new DataConstantProperty(styleSpec.light.anchor),position:new LightPositionProperty,color:new DataConstantProperty(styleSpec.light.color),intensity:new DataConstantProperty(styleSpec.light.intensity)}),TRANSITION_SUFFIX="-transition",Light=function(t){function e(e){t.call(this),this._transitionable=new Transitionable(properties),this.setLight(e),this._transitioning=this._transitionable.untransitioned()}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.getLight=function(){return this._transitionable.serialize()},e.prototype.setLight=function(t){var e=this;if(!this._validate(validateStyle.light,t))for(var i in t){var r=t[i];util.endsWith(i,TRANSITION_SUFFIX)?e._transitionable.setTransition(i.slice(0,-TRANSITION_SUFFIX.length),r):e._transitionable.setValue(i,r)}},e.prototype.updateTransitions=function(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)},e.prototype.hasTransition=function(){return this._transitioning.hasTransition()},e.prototype.recalculate=function(t){this.properties=this._transitioning.possiblyEvaluate(t)},e.prototype._validate=function(t,e){return validateStyle.emitErrors(this,t.call(validateStyle,util.extend({value:e,style:{glyphs:!0,sprite:!0},styleSpec:styleSpec})))},e}(Evented);module.exports=Light;
},{"../style-spec/reference/latest":171,"../style-spec/util/color":173,"../style-spec/util/interpolate":178,"../util/evented":295,"../util/util":315,"./properties":208,"./validate_style":243}],204:[function(_dereq_,module,exports){
"use strict";var ref=_dereq_("../util/minemap"),normalizeGlyphsURL=ref.normalizeGlyphsURL,ajax=_dereq_("../util/ajax"),parseGlyphPBF=_dereq_("./parse_glyph_pbf");module.exports=function(e,r,a,l,p){var i=256*r,s=i+255,n=l(normalizeGlyphsURL(a).replace("{fontstack}",e).replace("{range}",i+"-"+s),ajax.ResourceType.Glyphs);ajax.getArrayBuffer(n,function(e,r){if(e)p(e);else if(r){for(var a={},l=0,i=parseGlyphPBF(r.data);l<i.length;l+=1){var s=i[l];a[s.id]=s}p(null,a)}})};
},{"../util/ajax":285,"../util/minemap":304,"./parse_glyph_pbf":206}],205:[function(_dereq_,module,exports){
"use strict";var ajax=_dereq_("../util/ajax"),browser=_dereq_("../util/browser"),ref=_dereq_("../util/minemap"),normalizeSpriteURL=ref.normalizeSpriteURL,ref$1=_dereq_("../util/image"),RGBAImage=ref$1.RGBAImage;module.exports=function(e,i,r){function a(){if(n)r(n);else if(t&&o){var e=browser.getImageData(o),i={};for(var a in t){var u=t[a],g=u.width,l=u.height,m=u.x,p=u.y,x=u.sdf,f=u.pixelRatio,s=new RGBAImage({width:g,height:l});RGBAImage.copy(e,s,{x:m,y:p},{x:0,y:0},{width:g,height:l}),i[a]={data:s,pixelRatio:f,sdf:x}}r(null,i)}}var t,o,n,u=browser.devicePixelRatio>1?"@2x":"";ajax.getJSON(i(normalizeSpriteURL(e,u,".json"),ajax.ResourceType.SpriteJSON),function(e,i){n||(n=e,t=i,a())}),ajax.getImage(i(normalizeSpriteURL(e,u,".png"),ajax.ResourceType.SpriteImage),function(e,i){n||(n=e,o=i,a())})};
},{"../util/ajax":285,"../util/browser":286,"../util/image":298,"../util/minemap":304}],206:[function(_dereq_,module,exports){
"use strict";function readFontstacks(e,a,r){1===e&&r.readMessage(readFontstack,a)}function readFontstack(e,a,r){if(3===e){var t=r.readMessage(readGlyph,{}),d=t.id,i=t.bitmap,n=t.width,o=t.height,h=t.left,s=t.top,p=t.advance;a.push({id:d,bitmap:new AlphaImage({width:n+2*border,height:o+2*border},i),metrics:{width:n,height:o,left:h,top:s,advance:p}})}}function readGlyph(e,a,r){1===e?a.id=r.readVarint():2===e?a.bitmap=r.readBytes():3===e?a.width=r.readVarint():4===e?a.height=r.readVarint():5===e?a.left=r.readSVarint():6===e?a.top=r.readSVarint():7===e&&(a.advance=r.readVarint())}var ref=_dereq_("../util/image"),AlphaImage=ref.AlphaImage,Protobuf=_dereq_("pbf"),border=3;module.exports=function(e){return new Protobuf(e).readFields(readFontstacks,[])},module.exports.GLYPH_PBF_BORDER=border;
},{"../util/image":298,"pbf":10}],207:[function(_dereq_,module,exports){
"use strict";var browser=_dereq_("../util/browser"),Placement=_dereq_("../symbol/placement"),LayerPlacement=function(){this._currentTileIndex=0,this._seenCrossTileIDs={}};LayerPlacement.prototype.continuePlacement=function(e,n,t,r,o){for(var s=this;this._currentTileIndex<e.length;){var i=e[s._currentTileIndex];if(n.placeLayerTile(r,i,t,s._seenCrossTileIDs),s._currentTileIndex++,o())return!0}};var PauseablePlacement=function(e,n,t,r,o){this.placement=new Placement(e,o),this._currentPlacementIndex=n.length-1,this._forceFullPlacement=t,this._showCollisionBoxes=r,this._done=!1};PauseablePlacement.prototype.isDone=function(){return this._done},PauseablePlacement.prototype.continuePlacement=function(e,n,t){for(var r=this,o=(browser.now(),function(){browser.now();return!1});this._currentPlacementIndex>=0;){var s=e[r._currentPlacementIndex],i=n[s],a=r.placement.collisionIndex.transform.zoom;if(("symbol"===i.type||"symtracking"===i.type)&&(!i.minzoom||i.minzoom<=a)&&(!i.maxzoom||i.maxzoom>a)){r._inProgressLayer||(r._inProgressLayer=new LayerPlacement);if(r._inProgressLayer.continuePlacement(t[i.source],r.placement,r._showCollisionBoxes,i,o))return;delete r._inProgressLayer}r._currentPlacementIndex--}this._done=!0},PauseablePlacement.prototype.commit=function(e,n){return this.placement.commit(e,n),this.placement},module.exports=PauseablePlacement;
},{"../symbol/placement":255,"../util/browser":286}],208:[function(_dereq_,module,exports){
"use strict";var ref=_dereq_("../util/util"),clone=ref.clone,extend=ref.extend,easeCubicInOut=ref.easeCubicInOut,interpolate=_dereq_("../style-spec/util/interpolate"),ref$1=_dereq_("../style-spec/expression"),normalizePropertyExpression=ref$1.normalizePropertyExpression,Color=_dereq_("../style-spec/util/color"),ref$2=_dereq_("../util/web_worker_transfer"),register=ref$2.register,PropertyValue=function(t,e){this.property=t,this.value=e,this.expression=normalizePropertyExpression(void 0===e?t.specification.default:e,t.specification)};PropertyValue.prototype.isDataDriven=function(){return"source"===this.expression.kind||"composite"===this.expression.kind},PropertyValue.prototype.possiblyEvaluate=function(t){return this.property.possiblyEvaluate(this,t)};var TransitionablePropertyValue=function(t){this.property=t,this.value=new PropertyValue(t,void 0)};TransitionablePropertyValue.prototype.transitioned=function(t,e){return new TransitioningPropertyValue(this.property,this.value,e,extend({},t.transition,this.transition),t.now)},TransitionablePropertyValue.prototype.untransitioned=function(){return new TransitioningPropertyValue(this.property,this.value,null,{},0)};var Transitionable=function(t){this._properties=t,this._values=Object.create(t.defaultTransitionablePropertyValues)};Transitionable.prototype.getValue=function(t){return clone(this._values[t].value.value)},Transitionable.prototype.setValue=function(t,e){this._values.hasOwnProperty(t)||(this._values[t]=new TransitionablePropertyValue(this._values[t].property)),this._values[t].value=new PropertyValue(this._values[t].property,null===e?void 0:clone(e))},Transitionable.prototype.getTransition=function(t){return clone(this._values[t].transition)},Transitionable.prototype.setTransition=function(t,e){this._values.hasOwnProperty(t)||(this._values[t]=new TransitionablePropertyValue(this._values[t].property)),this._values[t].transition=clone(e)||void 0},Transitionable.prototype.serialize=function(){for(var t=this,e={},r=0,a=Object.keys(t._values);r<a.length;r+=1){var o=a[r],i=t.getValue(o);void 0!==i&&(e[o]=i);var n=t.getTransition(o);void 0!==n&&(e[o+"-transition"]=n)}return e},Transitionable.prototype.transitioned=function(t,e){for(var r=this,a=new Transitioning(this._properties),o=0,i=Object.keys(r._values);o<i.length;o+=1){var n=i[o];a._values[n]=r._values[n].transitioned(t,e._values[n])}return a},Transitionable.prototype.untransitioned=function(){for(var t=this,e=new Transitioning(this._properties),r=0,a=Object.keys(t._values);r<a.length;r+=1){var o=a[r];e._values[o]=t._values[o].untransitioned()}return e};var TransitioningPropertyValue=function(t,e,r,a,o){this.property=t,this.value=e,this.begin=o+a.delay||0,this.end=this.begin+a.duration||0,t.specification.transition&&(a.delay||a.duration)&&(this.prior=r)};TransitioningPropertyValue.prototype.possiblyEvaluate=function(t){var e=t.now||0,r=this.value.possiblyEvaluate(t),a=this.prior;if(a){if(e>this.end)return this.prior=null,r;if(this.value.isDataDriven())return this.prior=null,r;if(e<this.begin)return a.possiblyEvaluate(t);var o=(e-this.begin)/(this.end-this.begin);return this.property.interpolate(a.possiblyEvaluate(t),r,easeCubicInOut(o))}return r};var Transitioning=function(t){this._properties=t,this._values=Object.create(t.defaultTransitioningPropertyValues)};Transitioning.prototype.possiblyEvaluate=function(t){for(var e=this,r=new PossiblyEvaluated(this._properties),a=0,o=Object.keys(e._values);a<o.length;a+=1){var i=o[a];r._values[i]=e._values[i].possiblyEvaluate(t)}return r},Transitioning.prototype.hasTransition=function(){for(var t=this,e=0,r=Object.keys(t._values);e<r.length;e+=1){var a=r[e];if(t._values[a].prior)return!0}return!1};var Layout=function(t){this._properties=t,this._values=Object.create(t.defaultPropertyValues)};Layout.prototype.getValue=function(t){return clone(this._values[t].value)},Layout.prototype.setValue=function(t,e){this._values[t]=new PropertyValue(this._values[t].property,null===e?void 0:clone(e))},Layout.prototype.serialize=function(){for(var t=this,e={},r=0,a=Object.keys(t._values);r<a.length;r+=1){var o=a[r],i=t.getValue(o);void 0!==i&&(e[o]=i)}return e},Layout.prototype.possiblyEvaluate=function(t){for(var e=this,r=new PossiblyEvaluated(this._properties),a=0,o=Object.keys(e._values);a<o.length;a+=1){var i=o[a];r._values[i]=e._values[i].possiblyEvaluate(t)}return r};var PossiblyEvaluatedPropertyValue=function(t,e,r){this.property=t,this.value=e,this.globals=r};PossiblyEvaluatedPropertyValue.prototype.isConstant=function(){return"constant"===this.value.kind},PossiblyEvaluatedPropertyValue.prototype.constantOr=function(t){return"constant"===this.value.kind?this.value.value:t},PossiblyEvaluatedPropertyValue.prototype.evaluate=function(t){return this.property.evaluate(this.value,this.globals,t)};var PossiblyEvaluated=function(t){this._properties=t,this._values=Object.create(t.defaultPossiblyEvaluatedValues)};PossiblyEvaluated.prototype.get=function(t){return this._values[t]};var DataConstantProperty=function(t){this.specification=t};DataConstantProperty.prototype.possiblyEvaluate=function(t,e){return t.expression.evaluate(e)},DataConstantProperty.prototype.interpolate=function(t,e,r){var a=interpolate[this.specification.type];return a?a(t,e,r):t};var DataDrivenProperty=function(t){this.specification=t};DataDrivenProperty.prototype.possiblyEvaluate=function(t,e){return"constant"===t.expression.kind||"camera"===t.expression.kind?new PossiblyEvaluatedPropertyValue(this,{kind:"constant",value:t.expression.evaluate(e)},e):new PossiblyEvaluatedPropertyValue(this,t.expression,e)},DataDrivenProperty.prototype.interpolate=function(t,e,r){if("constant"!==t.value.kind||"constant"!==e.value.kind)return t;if(void 0===t.value.value||void 0===e.value.value)return new PossiblyEvaluatedPropertyValue(this,{kind:"constant",value:void 0},t.globals);var a=interpolate[this.specification.type];return a?new PossiblyEvaluatedPropertyValue(this,{kind:"constant",value:a(t.value.value,e.value.value,r)},t.globals):t},DataDrivenProperty.prototype.evaluate=function(t,e,r){return"constant"===t.kind?t.value:t.evaluate(e,r)};var CrossFadedProperty=function(t){this.specification=t};CrossFadedProperty.prototype.possiblyEvaluate=function(t,e){if(void 0!==t.value){if("constant"===t.expression.kind){var r=t.expression.evaluate(e);return this._calculate(r,r,r,e)}return this._calculate(t.expression.evaluate({zoom:e.zoom-1}),t.expression.evaluate({zoom:e.zoom}),t.expression.evaluate({zoom:e.zoom+1}),e)}},CrossFadedProperty.prototype._calculate=function(t,e,r,a){var o=a.zoom,i=o-Math.floor(o),n=a.crossFadingFactor();return o>a.zoomHistory.lastIntegerZoom?{from:t,to:e,fromScale:2,toScale:1,t:i+(1-i)*n}:{from:r,to:e,fromScale:.5,toScale:1,t:1-(1-n)*i}},CrossFadedProperty.prototype.interpolate=function(t){return t};var HeatmapColorProperty=function(t){this.specification=t};HeatmapColorProperty.prototype.possiblyEvaluate=function(){},HeatmapColorProperty.prototype.interpolate=function(){};var Properties=function(t){var e=this;this.properties=t,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={};for(var r in t){var a=t[r],o=e.defaultPropertyValues[r]=new PropertyValue(a,void 0),i=e.defaultTransitionablePropertyValues[r]=new TransitionablePropertyValue(a);e.defaultTransitioningPropertyValues[r]=i.untransitioned(),e.defaultPossiblyEvaluatedValues[r]=o.possiblyEvaluate({})}};register("DataDrivenProperty",DataDrivenProperty),register("DataConstantProperty",DataConstantProperty),register("CrossFadedProperty",CrossFadedProperty),register("HeatmapColorProperty",HeatmapColorProperty),module.exports={PropertyValue:PropertyValue,Transitionable:Transitionable,Transitioning:Transitioning,Layout:Layout,PossiblyEvaluatedPropertyValue:PossiblyEvaluatedPropertyValue,PossiblyEvaluated:PossiblyEvaluated,DataConstantProperty:DataConstantProperty,DataDrivenProperty:DataDrivenProperty,CrossFadedProperty:CrossFadedProperty,HeatmapColorProperty:HeatmapColorProperty,Properties:Properties};
},{"../style-spec/expression":159,"../style-spec/util/color":173,"../style-spec/util/interpolate":178,"../util/util":315,"../util/web_worker_transfer":318}],209:[function(_dereq_,module,exports){
"use strict";function getMaximumPaintValue(t,a,e){var n=a.paint.get(t).value;return"constant"===n.kind?n.value:e.programConfigurations.get(a.id).binders[t].statistics.max}function translateDistance(t){return Math.sqrt(t[0]*t[0]+t[1]*t[1])}function translate(t,a,e,n,r){if(!a[0]&&!a[1])return t;var i=Point.convert(a);"viewport"===e&&i._rotate(-n);for(var u=[],s=0;s<t.length;s++){for(var o=t[s],l=[],m=0;m<o.length;m++)l.push(o[m].sub(i._mult(r)));u.push(l)}return u}var Point=_dereq_("../_minemap_/point-geometry");module.exports={getMaximumPaintValue:getMaximumPaintValue,translateDistance:translateDistance,translate:translate};
},{"../_minemap_/point-geometry":29}],210:[function(_dereq_,module,exports){
"use strict";var Evented=_dereq_("../util/evented").Evented,Event=_dereq_("../util/evented").Event,ErrorEvent=_dereq_("../util/evented").ErrorEvent,StyleLayer=_dereq_("./style_layer"),loadSprite=_dereq_("./load_sprite"),ImageManager=_dereq_("../render/image_manager"),GlyphManager=_dereq_("../render/glyph_manager"),Light=_dereq_("./light"),LineAtlas=_dereq_("../render/line_atlas"),util=_dereq_("../util/util"),ajax=_dereq_("../util/ajax"),minemap=_dereq_("../util/minemap"),browser=_dereq_("../util/browser"),Dispatcher=_dereq_("../util/dispatcher"),validateStyle=_dereq_("./validate_style"),getSourceType=_dereq_("../source/source").getType,setSourceType=_dereq_("../source/source").setType,QueryFeatures=_dereq_("../source/query_features"),SourceCache=_dereq_("../source/source_cache"),GeoJSONSource=_dereq_("../source/geojson_source"),styleSpec=_dereq_("../style-spec/reference/latest"),getWorkerPool=_dereq_("../util/global_worker_pool"),deref=_dereq_("../style-spec/deref"),diff=_dereq_("../style-spec/diff"),PauseablePlacement=_dereq_("./pauseable_placement"),ZoomHistory=_dereq_("./zoom_history"),CrossTileSymbolIndex=_dereq_("../symbol/cross_tile_symbol_index"),supportedDiffOperations=util.pick(diff.operations,["addLayer","removeLayer","setPaintProperty","setLayoutProperty","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData"]),ignoredDiffOperations=util.pick(diff.operations,["setCenter","setZoom","setBearing","setPitch"]),Style=function(e){function t(t,r){var a=this;void 0===r&&(r={}),e.call(this),this.map=t,this.dispatcher=new Dispatcher(getWorkerPool(),this),this.imageManager=new ImageManager,this.glyphManager=new GlyphManager(t._transformRequest,r.localIdeographFontFamily),this.lineAtlas=new LineAtlas(256,512),this.crossTileSymbolIndex=new CrossTileSymbolIndex,this._layers={},this._order=[],this.sourceCaches={},this.zoomHistory=new ZoomHistory,this._loaded=!1,this._resetUpdates();this.on("data",function(e){if("source"===e.dataType&&"metadata"===e.sourceDataType){var t=a.sourceCaches[e.sourceId];if(t){var r=t.getSource();if(r&&r.vectorLayerIds)for(var i in a._layers){var s=a._layers[i];s.source===r.id&&a._validateLayer(s)}}}})}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.loadURL=function(e,t){var r=this;void 0===t&&(t={}),this.fire(new Event("dataloading",{dataType:"style"}));var a="boolean"==typeof t.validate?t.validate:!minemap.isMinemapURL(e);e=minemap.normalizeStyleURL(e,t.accessToken);var i=this.map._transformRequest(e,ajax.ResourceType.Style);ajax.getJSON(i,function(e,t){e?r.fire(new ErrorEvent(e)):t&&r._load(t,a)})},t.prototype.loadJSON=function(e,t){var r=this;void 0===t&&(t={}),this.fire(new Event("dataloading",{dataType:"style"})),browser.frame(function(){r._load(e,!1!==t.validate)})},t.prototype._load=function(e,t){var r=this;if(!t||!validateStyle.emitErrors(this,validateStyle(e))){this._loaded=!0,this.stylesheet=e;for(var a in e.sources)r.addSource(a,e.sources[a],{validate:!1});e.sprite?loadSprite(e.sprite,this.map._transformRequest,function(e,t){if(e)r.fire(new ErrorEvent(e));else if(t)for(var a in t)r.imageManager.addImage(a,t[a]);r.imageManager.setLoaded(!0),r.fire(new Event("data",{dataType:"style"}))}):this.imageManager.setLoaded(!0),this.glyphManager.setURL(e.glyphs);var i=deref(this.stylesheet.layers);this._order=i.map(function(e){return e.id}),this._layers={};for(var s=0,o=i;s<o.length;s+=1){var n=o[s];n=StyleLayer.create(n),n.setEventedParent(r,{layer:{id:n.id}}),r._layers[n.id]=n}this.dispatcher.broadcast("setLayers",this._serializeLayers(this._order)),this.light=new Light(this.stylesheet.light),this.fire(new Event("data",{dataType:"style"})),this.fire(new Event("style.load"))}},t.prototype._validateLayer=function(e){var t=this.sourceCaches[e.source];if(t){var r=e.sourceLayer;if(r){var a=t.getSource();("geojson"===a.type||a.vectorLayerIds&&-1===a.vectorLayerIds.indexOf(r))&&this.fire(new ErrorEvent(new Error('Source layer "'+r+'" does not exist on source "'+a.id+'" as specified by style layer "'+e.id+'"')))}}},t.prototype.loaded=function(){var e=this;if(!this._loaded)return!1;if(Object.keys(this._updatedSources).length)return!1;for(var t in e.sourceCaches)if(!e.sourceCaches[t].loaded())return!1;return!!this.imageManager.isLoaded()},t.prototype._serializeLayers=function(e){var t=this;return e.map(function(e){return t._layers[e].serialize()})},t.prototype.hasTransitions=function(){var e=this;if(this.light&&this.light.hasTransition())return!0;for(var t in e.sourceCaches)if(e.sourceCaches[t].hasTransition())return!0;for(var r in e._layers)if(e._layers[r].hasTransition())return!0;return!1},t.prototype._checkLoaded=function(){if(!this._loaded)throw new Error("Style is not done loading")},t.prototype.update=function(e){var t=this;if(this._loaded){if(this._changed){var r=Object.keys(this._updatedLayers),a=Object.keys(this._removedLayers);(r.length||a.length)&&this._updateWorkerLayers(r,a);for(var i in t._updatedSources){var s=t._updatedSources[i];"reload"===s?t._reloadSource(i):"clear"===s&&t._clearSource(i)}for(var o in t._updatedPaintProps)t._layers[o].updateTransitions(e);this.light.updateTransitions(e),this._resetUpdates(),this.fire(new Event("data",{dataType:"style"}))}for(var n in t.sourceCaches)t.sourceCaches[n].used=!1;for(var l=0,h=t._order;l<h.length;l+=1){var u=h[l],d=t._layers[u];d.recalculate(e),!d.isHidden(e.zoom)&&d.source&&(t.sourceCaches[d.source].used=!0)}this.light.recalculate(e),this.z=e.zoom}},t.prototype._updateWorkerLayers=function(e,t){this.dispatcher.broadcast("updateLayers",{layers:this._serializeLayers(e),removedIds:t})},t.prototype._resetUpdates=function(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={}},t.prototype.setState=function(e){var t=this;if(this._checkLoaded(),validateStyle.emitErrors(this,validateStyle(e)))return!1;e=util.clone(e),e.layers=deref(e.layers);var r=diff(this.serialize(),e).filter(function(e){return!(e.command in ignoredDiffOperations)});if(0===r.length)return!1;var a=r.filter(function(e){return!(e.command in supportedDiffOperations)});if(a.length>0)throw new Error("Unimplemented: "+a.map(function(e){return e.command}).join(", ")+".");return r.forEach(function(e){"setTransition"!==e.command&&t[e.command].apply(t,e.args)}),this.stylesheet=e,!0},t.prototype.addImage=function(e,t){if(this.getImage(e))return this.fire(new ErrorEvent(new Error("An image with this name already exists.")));this.imageManager.addImage(e,t),this.fire(new Event("data",{dataType:"style"}))},t.prototype.getImage=function(e){return this.imageManager.getImage(e)},t.prototype.removeImage=function(e){if(!this.getImage(e))return this.fire(new ErrorEvent(new Error("No image with this name exists.")));this.imageManager.removeImage(e),this.fire(new Event("data",{dataType:"style"}))},t.prototype.addSource=function(e,t,r){var a=this;if(this._checkLoaded(),void 0!==this.sourceCaches[e])throw new Error("There is already a source with this ID");if(!t.type)throw new Error("The type property must be defined, but the only the following properties were given: "+Object.keys(t).join(", ")+".");if(!(["vector","raster","geojson","video","image","canvas"].indexOf(t.type)>=0&&this._validate(validateStyle.source,"sources."+e,t,null,r))){this.map&&this.map._collectResourceTiming&&(t.collectResourceTiming=!0);var i=this.sourceCaches[e]=new SourceCache(e,t,this.dispatcher);i.style=this,i.setEventedParent(this,function(){return{isSourceLoaded:a.loaded(),source:i.serialize(),sourceId:e}}),i.onAdd(this.map),this._changed=!0}},t.prototype.removeSource=function(e){if(this._checkLoaded(),void 0===this.sourceCaches[e])throw new Error("There is no source with this ID");var t=this.sourceCaches[e];delete this.sourceCaches[e],delete this._updatedSources[e],t.fire(new Event("data",{sourceDataType:"metadata",dataType:"source",sourceId:e})),t.setEventedParent(null),t.clearTiles(),t.onRemove&&t.onRemove(this.map),this._changed=!0},t.prototype.setGeoJSONSourceData=function(e,t){this._checkLoaded(),this.sourceCaches[e].getSource().setData(t),this._changed=!0},t.prototype.getSource=function(e){return this.sourceCaches[e]&&this.sourceCaches[e].getSource()},t.prototype.addLayer=function(e,t,r){this._checkLoaded();var a=e.id;if("object"==typeof e.source&&(this.addSource(a,e.source),e=util.clone(e),e=util.extend(e,{source:a})),!this._validate(validateStyle.layer,"layers."+a,e,{arrayIndex:-1},r)){var i=StyleLayer.create(e);this._validateLayer(i),i.setEventedParent(this,{layer:{id:a}});var s=t?this._order.indexOf(t):this._order.length;if(t&&-1===s)return void this.fire(new ErrorEvent(new Error('Layer with id "'+t+'" does not exist on this map.')));if(this._order.splice(s,0,a),this._layerOrderChanged=!0,this._layers[a]=i,this._removedLayers[a]&&i.source){var o=this._removedLayers[a];delete this._removedLayers[a],o.type!==i.type?this._updatedSources[i.source]="clear":(this._updatedSources[i.source]="reload",this.sourceCaches[i.source].pause())}this._updateLayer(i)}},t.prototype.moveLayer=function(e,t){this._checkLoaded(),this._changed=!0;var r=(this._layers[e],this._order.indexOf(e));this._order.splice(r,1);var a=t?this._order.indexOf(t):this._order.length;if(t&&-1===a)return void this.fire(new ErrorEvent(new Error('Layer with id "'+t+'" does not exist on this map.')));this._order.splice(a,0,e),this._layerOrderChanged=!0},t.prototype.removeLayer=function(e){this._checkLoaded();var t=this._layers[e];if(!t)return void this.fire(new ErrorEvent(new Error("The layer '"+e+"' does not exist in the map's style and cannot be removed.")));t.setEventedParent(null);var r=this._order.indexOf(e);this._order.splice(r,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[e]=t,delete this._layers[e],delete this._updatedLayers[e],delete this._updatedPaintProps[e]},t.prototype.getLayer=function(e){return this._layers[e]},t.prototype.setLayerZoomRange=function(e,t,r){this._checkLoaded();var a=this.getLayer(e);if(!a)return void this.fire(new ErrorEvent(new Error("The layer '"+e+"' does not exist in the map's style and cannot have zoom extent.")));a.minzoom===t&&a.maxzoom===r||(null!=t&&(a.minzoom=t),null!=r&&(a.maxzoom=r),this._updateLayer(a))},t.prototype.setFilter=function(e,t){this._checkLoaded();var r=this.getLayer(e);if(!r)return void this.fire(new ErrorEvent(new Error("The layer '"+e+"' does not exist in the map's style and cannot be filtered.")));if(!util.deepEqual(r.filter,t))return null===t||void 0===t?(r.filter=void 0,void this._updateLayer(r)):void(this._validate(validateStyle.filter,"layers."+r.id+".filter",t)||(r.filter=util.clone(t),this._updateLayer(r)))},t.prototype.getFilter=function(e){return util.clone(this.getLayer(e).filter)},t.prototype.setLayoutProperty=function(e,t,r){this._checkLoaded();var a=this.getLayer(e);if(!a)return void this.fire(new ErrorEvent(new Error("The layer '"+e+"' does not exist in the map's style and cannot be styled.")));util.deepEqual(a.getLayoutProperty(t),r)||(a.setLayoutProperty(t,r),this._updateLayer(a))},t.prototype.getLayoutProperty=function(e,t){return this.getLayer(e).getLayoutProperty(t)},t.prototype.setPaintProperty=function(e,t,r){this._checkLoaded();var a=this.getLayer(e);if(!a)return void this.fire(new ErrorEvent(new Error("The layer '"+e+"' does not exist in the map's style and cannot be styled.")));if(!util.deepEqual(a.getPaintProperty(t),r)){var i=a._transitionablePaint._values[t].value.isDataDriven();a.setPaintProperty(t,r);(a._transitionablePaint._values[t].value.isDataDriven()||i)&&this._updateLayer(a),this._changed=!0,this._updatedPaintProps[e]=!0}},t.prototype.getPaintProperty=function(e,t){return this.getLayer(e).getPaintProperty(t)},t.prototype.getTransition=function(){return util.extend({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)},t.prototype.serialize=function(){var e=this;return util.filterObject({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,light:this.stylesheet.light,center:this.stylesheet.center,zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,sources:util.mapObject(this.sourceCaches,function(e){return e.serialize()}),layers:this._order.map(function(t){return e._layers[t].serialize()})},function(e){return void 0!==e})},t.prototype._updateLayer=function(e){this._updatedLayers[e.id]=!0,e.source&&!this._updatedSources[e.source]&&(this._updatedSources[e.source]="reload",this.sourceCaches[e.source].pause()),this._changed=!0},t.prototype._flattenRenderedFeatures=function(e){for(var t=this,r=[],a=this._order.length-1;a>=0;a--)for(var i=t._order[a],s=0,o=e;s<o.length;s+=1){var n=o[s],l=n[i];if(l)for(var h=0,u=l;h<u.length;h+=1){var d=u[h];r.push(d)}}return r},t.prototype.queryRenderedFeatures=function(e,t,r){var a=this;t&&t.filter&&this._validate(validateStyle.filter,"queryRenderedFeatures.filter",t.filter);var i={};if(t&&t.layers){if(!Array.isArray(t.layers))return this.fire(new ErrorEvent(new Error("parameters.layers must be an Array."))),[];for(var s=0,o=t.layers;s<o.length;s+=1){var n=o[s],l=a._layers[n];if(!l)return[];i[l.source]=!0}}var h=[];for(var u in a.sourceCaches)if(!t.layers||i[u]){var d=QueryFeatures.queryRenderedFeatures(a.sourceCaches[u],a._layers,e,t,r,a.placement?a.placement.collisionIndex:null);h.push(d)}return this._flattenRenderedFeatures(h)},t.prototype.querySourceFeatures=function(e,t){t&&t.filter&&this._validate(validateStyle.filter,"querySourceFeatures.filter",t.filter);var r=this.sourceCaches[e];return r?QueryFeatures.querySourceFeatures(r,t):[]},t.prototype.addSourceType=function(e,t,r){return getSourceType(e)?r(new Error('A source type called "'+e+'" already exists.')):(setSourceType(e,t),t.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:e,url:t.workerSourceURL},r):r(null,null))},t.prototype.getLight=function(){return this.light.getLight()},t.prototype.setLight=function(e){this._checkLoaded();var t=this.light.getLight(),r=!1;for(var a in e)if(!util.deepEqual(e[a],t[a])){r=!0;break}if(r){var i={now:browser.now(),transition:util.extend({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(e),this.light.updateTransitions(i)}},t.prototype._validate=function(e,t,r,a,i){return(!i||!1!==i.validate)&&validateStyle.emitErrors(this,e.call(validateStyle,util.extend({key:t,style:this.serialize(),value:r,styleSpec:styleSpec},a)))},t.prototype._remove=function(){var e=this;for(var t in e.sourceCaches)e.sourceCaches[t].clearTiles();this.dispatcher.remove()},t.prototype._clearSource=function(e){this.sourceCaches[e].clearTiles()},t.prototype._reloadSource=function(e){this.sourceCaches[e].resume(),this.sourceCaches[e].reload()},t.prototype._updateSources=function(e){var t=this;for(var r in t.sourceCaches)t.sourceCaches[r].update(e)},t.prototype._generateCollisionBoxes=function(){var e=this;for(var t in e.sourceCaches)e._reloadSource(t)},t.prototype._updatePlacement=function(e,t,r){for(var a=this,i=!1,s=!1,o={},n=0,l=a._order;n<l.length;n+=1){var h=l[n],u=a._layers[h];if("symbol"===u.type||"symtracking"===u.type){if(!o[u.source]){var d=a.sourceCaches[u.source];o[u.source]=d.getRenderableIds().map(function(e){return d.getTileByID(e)}).sort(function(e,t){return t.tileID.overscaledZ-e.tileID.overscaledZ||(e.tileID.isLessThan(t.tileID)?-1:1)})}var c=a.crossTileSymbolIndex.addLayer(u,o[u.source]);i=i||c}}this.crossTileSymbolIndex.pruneUnusedLayers(this._order);var y=this._layerOrderChanged;if((y||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(browser.now()))&&(this.pauseablePlacement=new PauseablePlacement(e,this._order,y,t,r),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,o),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(this.placement,browser.now()),s=!0),i&&this.pauseablePlacement.placement.setStale()),s||i)for(var p=0,f=a._order;p<f.length;p+=1){var v=f[p],m=a._layers[v];"symbol"!==m.type&&"symtracking"!==m.type||a.placement.updateLayerOpacities(m,o[m.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(browser.now())},t.prototype.getImages=function(e,t,r){this.imageManager.getImages(t.icons,r)},t.prototype.getGlyphs=function(e,t,r){this.glyphManager.getGlyphs(t.stacks,r)},t}(Evented);module.exports=Style;
},{"../render/glyph_manager":107,"../render/image_manager":109,"../render/line_atlas":110,"../source/geojson_source":120,"../source/query_features":126,"../source/source":130,"../source/source_cache":131,"../style-spec/deref":140,"../style-spec/diff":141,"../style-spec/reference/latest":171,"../symbol/cross_tile_symbol_index":250,"../util/ajax":285,"../util/browser":286,"../util/dispatcher":292,"../util/evented":295,"../util/global_worker_pool":297,"../util/minemap":304,"../util/util":315,"./light":203,"./load_sprite":205,"./pauseable_placement":207,"./style_layer":211,"./validate_style":243,"./zoom_history":244}],211:[function(_dereq_,module,exports){
"use strict";var util=_dereq_("../util/util"),styleSpec=_dereq_("../style-spec/reference/latest"),validateStyle=_dereq_("./validate_style"),Evented=_dereq_("../util/evented").Evented,Event=_dereq_("../util/evented").Event,ErrorEvent=_dereq_("../util/evented").ErrorEvent,ref=_dereq_("./properties"),Layout=ref.Layout,Transitionable=ref.Transitionable,Transitioning=ref.Transitioning,Properties=ref.Properties,TRANSITION_SUFFIX="-transition",StyleLayer=function(t){function e(e,i){var r=this;t.call(this),this.id=e.id,this.metadata=e.metadata,this.type=e.type,this.minzoom=e.minzoom,this.maxzoom=e.maxzoom,this.visibility="visible","background"!==e.type&&(this.source=e.source,this.sourceLayer=e["source-layer"],this.filter=e.filter),this._featureFilter=function(){return!0},i.layout&&(this._unevaluatedLayout=new Layout(i.layout)),this._transitionablePaint=new Transitionable(i.paint);for(var a in e.paint)r.setPaintProperty(a,e.paint[a],{validate:!1});for(var s in e.layout)r.setLayoutProperty(s,e.layout[s],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned()}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.getLayoutProperty=function(t){return"visibility"===t?this.visibility:this._unevaluatedLayout.getValue(t)},e.prototype.setLayoutProperty=function(t,e,i){if(null!==e&&void 0!==e){var r="layers."+this.id+".layout."+t;if(this._validate(validateStyle.layoutProperty,r,t,e,i))return}if("visibility"===t)return void(this.visibility="none"===e?e:"visible");this._unevaluatedLayout.setValue(t,e)},e.prototype.getPaintProperty=function(t){return util.endsWith(t,TRANSITION_SUFFIX)?this._transitionablePaint.getTransition(t.slice(0,-TRANSITION_SUFFIX.length)):this._transitionablePaint.getValue(t)},e.prototype.setPaintProperty=function(t,e,i){if(null!==e&&void 0!==e){var r="layers."+this.id+".paint."+t;if(this._validate(validateStyle.paintProperty,r,t,e,i))return}util.endsWith(t,TRANSITION_SUFFIX)?this._transitionablePaint.setTransition(t.slice(0,-TRANSITION_SUFFIX.length),e||void 0):this._transitionablePaint.setValue(t,e)},e.prototype.isHidden=function(t){return!!(this.minzoom&&t<this.minzoom)||(!!(this.maxzoom&&t>=this.maxzoom)||"none"===this.visibility)},e.prototype.updateTransitions=function(t){this._transitioningPaint=this._transitionablePaint.transitioned(t,this._transitioningPaint)},e.prototype.hasTransition=function(){return this._transitioningPaint.hasTransition()},e.prototype.recalculate=function(t){this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(t)),this.paint=this._transitioningPaint.possiblyEvaluate(t)},e.prototype.serialize=function(){var t={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return"none"===this.visibility&&(t.layout=t.layout||{},t.layout.visibility="none"),util.filterObject(t,function(t,e){return!(void 0===t||"layout"===e&&!Object.keys(t).length||"paint"===e&&!Object.keys(t).length)})},e.prototype._validate=function(t,e,i,r,a){return(!a||!1!==a.validate)&&validateStyle.emitErrors(this,t.call(validateStyle,{key:e,layerType:this.type,objectKey:i,value:r,styleSpec:styleSpec,style:{glyphs:!0,sprite:!0}}))},e.prototype.hasOffscreenPass=function(){return!1},e.prototype.resize=function(){},e}(Evented);module.exports=StyleLayer;var subclasses={circle:_dereq_("./style_layer/circle_style_layer"),heatmap:_dereq_("./style_layer/heatmap_style_layer"),hillshade:_dereq_("./style_layer/hillshade_style_layer"),fill:_dereq_("./style_layer/fill_style_layer"),extrusion:_dereq_("./style_layer/extrusion_style_layer"),line:_dereq_("./style_layer/line_style_layer"),symbol:_dereq_("./style_layer/symbol_style_layer"),background:_dereq_("./style_layer/background_style_layer"),raster:_dereq_("./style_layer/raster_style_layer"),sprite:_dereq_("./style_layer/sprite_style_layer"),histogram:_dereq_("./style_layer/histogram_style_layer"),symtracking:_dereq_("./style_layer/symtracking_style_layer"),tracking:_dereq_("./style_layer/tracking_style_layer"),dynamicLine:_dereq_("./style_layer/dynamic_line_style_layer"),airline:_dereq_("./style_layer/airline_style_layer")};StyleLayer.create=function(t){return new subclasses[t.type](t)};
},{"../style-spec/reference/latest":171,"../util/evented":295,"../util/util":315,"./properties":208,"./style_layer/airline_style_layer":212,"./style_layer/background_style_layer":214,"./style_layer/circle_style_layer":216,"./style_layer/dynamic_line_style_layer":219,"./style_layer/extrusion_style_layer":220,"./style_layer/fill_style_layer":222,"./style_layer/heatmap_style_layer":224,"./style_layer/hillshade_style_layer":226,"./style_layer/histogram_style_layer":228,"./style_layer/line_style_layer":230,"./style_layer/raster_style_layer":232,"./style_layer/sprite_style_layer":234,"./style_layer/symbol_style_layer":236,"./style_layer/symtracking_style_layer":238,"./style_layer/tracking_style_layer":240,"./validate_style":243}],212:[function(_dereq_,module,exports){
"use strict";function getLineWidth(e,t){return t>0?t+2*e:e}function offsetLine(e,t){for(var r=[],i=new Point(0,0),a=0;a<e.length;a++){for(var n=e[a],o=[],l=0;l<n.length;l++){var u=n[l-1],s=n[l],p=n[l+1],y=0===l?i:s.sub(u)._unit()._perp(),f=l===n.length-1?i:p.sub(s)._unit()._perp(),c=y._add(f)._unit(),h=c.x*f.x+c.y*f.y;c._mult(1/h),o.push(c._mult(t)._add(s))}r.push(o)}return r}var Point=_dereq_("../../_minemap_/point-geometry"),StyleLayer=_dereq_("../style_layer"),LineBucket=_dereq_("../../data/bucket/airline_bucket"),ref=_dereq_("../../util/intersection_tests"),multiPolygonIntersectsBufferedMultiLine=ref.multiPolygonIntersectsBufferedMultiLine,ref$1=_dereq_("../query_utils"),getMaximumPaintValue=ref$1.getMaximumPaintValue,translateDistance=ref$1.translateDistance,translate=ref$1.translate,properties=_dereq_("./airline_style_layer_properties"),ref$2=_dereq_("../../util/util"),extend=ref$2.extend,EvaluationParameters=_dereq_("../evaluation_parameters"),tileDrawHelper=_dereq_("../../gl/tile_draw_helper"),ref$3=_dereq_("../properties"),Transitionable=ref$3.Transitionable,Transitioning=ref$3.Transitioning,Layout=ref$3.Layout,PossiblyEvaluated=ref$3.PossiblyEvaluated,DataDrivenProperty=ref$3.DataDrivenProperty,LineFloorwidthProperty=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.possiblyEvaluate=function(t,r){return r=new EvaluationParameters(Math.floor(r.zoom),{now:r.now,fadeDuration:r.fadeDuration,zoomHistory:r.zoomHistory,transition:r.transition}),e.prototype.possiblyEvaluate.call(this,t,r)},t.prototype.evaluate=function(t,r,i){return r=extend({},r,{zoom:Math.floor(r.zoom)}),e.prototype.evaluate.call(this,t,r,i)},t}(DataDrivenProperty),lineFloorwidthProperty=new LineFloorwidthProperty(properties.paint.properties["airline-width"].specification);lineFloorwidthProperty.useIntegerZoom=!0;var LineStyleLayer=function(e){function t(t){e.call(this,t,properties)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.recalculate=function(t){e.prototype.recalculate.call(this,t),this.paint._values["airline-floorwidth"]=lineFloorwidthProperty.possiblyEvaluate(this._transitioningPaint._values["airline-width"].value,t)},t.prototype.createBucket=function(e){return new LineBucket(e)},t.prototype.queryRadius=function(e){var t=e,r=getLineWidth(getMaximumPaintValue("airline-width",this,t),getMaximumPaintValue("airline-gap-width",this,t)),i=getMaximumPaintValue("airline-offset",this,t);return r/2+Math.abs(i)+translateDistance(this.paint.get("airline-translate"))},t.prototype.queryIntersectsFeature=function(e,t,r,i,a,n){var o=translate(e,this.paint.get("airline-translate"),this.paint.get("airline-translate-anchor"),a.angle,n),l=n/2*getLineWidth(this.paint.get("airline-width").evaluate(t),this.paint.get("airline-gap-width").evaluate(t)),u=this.paint.get("airline-offset").evaluate(t);return u&&(r=offsetLine(r,u*n)),multiPolygonIntersectsBufferedMultiLine(o,r,l)},t.prototype.hasOffscreenPass=function(){return 0!==this.paint.get("airline-opacity")&&"none"!==this.visibility},t.prototype.resize=function(){tileDrawHelper.destroy(this)},t}(StyleLayer);module.exports=LineStyleLayer;
},{"../../_minemap_/point-geometry":29,"../../data/bucket/airline_bucket":44,"../../gl/tile_draw_helper":85,"../../util/intersection_tests":301,"../../util/util":315,"../evaluation_parameters":202,"../properties":208,"../query_utils":209,"../style_layer":211,"./airline_style_layer_properties":213}],213:[function(_dereq_,module,exports){
"use strict";var styleSpec=_dereq_("../../style-spec/reference/latest"),ref=_dereq_("../properties"),Properties=ref.Properties,DataConstantProperty=ref.DataConstantProperty,DataDrivenProperty=ref.DataDrivenProperty,CrossFadedProperty=ref.CrossFadedProperty,HeatmapColorProperty=ref.HeatmapColorProperty,layout=new Properties({"airline-cap":new DataConstantProperty(styleSpec.layout_airline["airline-cap"]),"airline-join":new DataDrivenProperty(styleSpec.layout_airline["airline-join"]),"airline-miter-limit":new DataConstantProperty(styleSpec.layout_airline["airline-miter-limit"]),"airline-round-limit":new DataConstantProperty(styleSpec.layout_airline["airline-round-limit"])}),paint=new Properties({"airline-opacity":new DataDrivenProperty(styleSpec.paint_airline["airline-opacity"]),"airline-color":new DataDrivenProperty(styleSpec.paint_airline["airline-color"]),"airline-translate":new DataConstantProperty(styleSpec.paint_airline["airline-translate"]),"airline-translate-anchor":new DataConstantProperty(styleSpec.paint_airline["airline-translate-anchor"]),"airline-width":new DataDrivenProperty(styleSpec.paint_airline["airline-width"]),"airline-gap-width":new DataDrivenProperty(styleSpec.paint_airline["airline-gap-width"]),"airline-offset":new DataDrivenProperty(styleSpec.paint_airline["airline-offset"]),"airline-blur":new DataDrivenProperty(styleSpec.paint_airline["airline-blur"]),"airline-dasharray":new DataConstantProperty(styleSpec.paint_airline["airline-dasharray"]),"airline-pattern":new CrossFadedProperty(styleSpec.paint_airline["airline-pattern"]),"airline-seg-count":new DataConstantProperty(styleSpec.paint_airline["airline-seg-count"]),"airline-seg-group":new DataConstantProperty(styleSpec.paint_airline["airline-seg-group"]),"airline-speed":new DataConstantProperty(styleSpec.paint_airline["airline-speed"]),"airline-speed-factor":new DataConstantProperty(styleSpec.paint_airline["airline-speed-factor"]),"airline-type":new DataConstantProperty(styleSpec.paint_airline["airline-type"])});module.exports={paint:paint,layout:layout};
},{"../../style-spec/reference/latest":171,"../properties":208}],214:[function(_dereq_,module,exports){
"use strict";var StyleLayer=_dereq_("../style_layer"),properties=_dereq_("./background_style_layer_properties"),ref=_dereq_("../properties"),Transitionable=ref.Transitionable,Transitioning=ref.Transitioning,PossiblyEvaluated=ref.PossiblyEvaluated,BackgroundStyleLayer=function(e){function r(r){e.call(this,r,properties)}return e&&(r.__proto__=e),r.prototype=Object.create(e&&e.prototype),r.prototype.constructor=r,r}(StyleLayer);module.exports=BackgroundStyleLayer;
},{"../properties":208,"../style_layer":211,"./background_style_layer_properties":215}],215:[function(_dereq_,module,exports){
"use strict";var styleSpec=_dereq_("../../style-spec/reference/latest"),ref=_dereq_("../properties"),Properties=ref.Properties,DataConstantProperty=ref.DataConstantProperty,DataDrivenProperty=ref.DataDrivenProperty,CrossFadedProperty=ref.CrossFadedProperty,HeatmapColorProperty=ref.HeatmapColorProperty,paint=new Properties({"background-color":new DataConstantProperty(styleSpec.paint_background["background-color"]),"background-pattern":new CrossFadedProperty(styleSpec.paint_background["background-pattern"]),"background-opacity":new DataConstantProperty(styleSpec.paint_background["background-opacity"])});module.exports={paint:paint};
},{"../../style-spec/reference/latest":171,"../properties":208}],216:[function(_dereq_,module,exports){
"use strict";var StyleLayer=_dereq_("../style_layer"),CircleBucket=_dereq_("../../data/bucket/circle_bucket"),ref=_dereq_("../../util/intersection_tests"),multiPolygonIntersectsBufferedMultiPoint=ref.multiPolygonIntersectsBufferedMultiPoint,ref$1=_dereq_("../query_utils"),getMaximumPaintValue=ref$1.getMaximumPaintValue,translateDistance=ref$1.translateDistance,translate=ref$1.translate,properties=_dereq_("./circle_style_layer_properties"),ref$2=_dereq_("../properties"),Transitionable=ref$2.Transitionable,Transitioning=ref$2.Transitioning,PossiblyEvaluated=ref$2.PossiblyEvaluated,CircleStyleLayer=function(e){function t(t){e.call(this,t,properties)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.createBucket=function(e){return new CircleBucket(e)},t.prototype.queryRadius=function(e){var t=e;return getMaximumPaintValue("circle-radius",this,t)+getMaximumPaintValue("circle-stroke-width",this,t)+translateDistance(this.paint.get("circle-translate"))},t.prototype.queryIntersectsFeature=function(e,t,r,i,a,n){var l=translate(e,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),a.angle,n),s=this.paint.get("circle-radius").evaluate(t)*n,u=this.paint.get("circle-stroke-width").evaluate(t)*n;return multiPolygonIntersectsBufferedMultiPoint(l,r,s+u)},t}(StyleLayer);module.exports=CircleStyleLayer;
},{"../../data/bucket/circle_bucket":46,"../../util/intersection_tests":301,"../properties":208,"../query_utils":209,"../style_layer":211,"./circle_style_layer_properties":217}],217:[function(_dereq_,module,exports){
"use strict";var styleSpec=_dereq_("../../style-spec/reference/latest"),ref=_dereq_("../properties"),Properties=ref.Properties,DataConstantProperty=ref.DataConstantProperty,DataDrivenProperty=ref.DataDrivenProperty,CrossFadedProperty=ref.CrossFadedProperty,HeatmapColorProperty=ref.HeatmapColorProperty,paint=new Properties({"circle-radius":new DataDrivenProperty(styleSpec.paint_circle["circle-radius"]),"circle-color":new DataDrivenProperty(styleSpec.paint_circle["circle-color"]),"circle-blur":new DataDrivenProperty(styleSpec.paint_circle["circle-blur"]),"circle-opacity":new DataDrivenProperty(styleSpec.paint_circle["circle-opacity"]),"circle-translate":new DataConstantProperty(styleSpec.paint_circle["circle-translate"]),"circle-translate-anchor":new DataConstantProperty(styleSpec.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new DataConstantProperty(styleSpec.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new DataConstantProperty(styleSpec.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new DataDrivenProperty(styleSpec.paint_circle["circle-stroke-width"]),"circle-stroke-color":new DataDrivenProperty(styleSpec.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new DataDrivenProperty(styleSpec.paint_circle["circle-stroke-opacity"])});module.exports={paint:paint};
},{"../../style-spec/reference/latest":171,"../properties":208}],218:[function(_dereq_,module,exports){
"use strict";var styleSpec=_dereq_("../../style-spec/reference/latest"),ref=_dereq_("../properties"),Properties=ref.Properties,DataConstantProperty=ref.DataConstantProperty,DataDrivenProperty=ref.DataDrivenProperty,CrossFadedProperty=ref.CrossFadedProperty,HeatmapColorProperty=ref.HeatmapColorProperty,layout=new Properties({"dynamicLine-cap":new DataConstantProperty(styleSpec.layout_dynamicLine["dynamicLine-cap"]),"dynamicLine-join":new DataDrivenProperty(styleSpec.layout_dynamicLine["dynamicLine-join"]),"dynamicLine-miter-limit":new DataConstantProperty(styleSpec.layout_dynamicLine["dynamicLine-miter-limit"]),"dynamicLine-round-limit":new DataConstantProperty(styleSpec.layout_dynamicLine["dynamicLine-round-limit"]),"dynamicLine-display-mode":new DataConstantProperty(styleSpec.layout_dynamicLine["dynamicLine-display-mode"])}),paint=new Properties({"dynamicLine-opacity":new DataDrivenProperty(styleSpec.paint_dynamicLine["dynamicLine-opacity"]),"dynamicLine-color":new DataDrivenProperty(styleSpec.paint_dynamicLine["dynamicLine-color"]),"dynamicLine-translate":new DataConstantProperty(styleSpec.paint_dynamicLine["dynamicLine-translate"]),"dynamicLine-translate-anchor":new DataConstantProperty(styleSpec.paint_dynamicLine["dynamicLine-translate-anchor"]),"dynamicLine-width":new DataDrivenProperty(styleSpec.paint_dynamicLine["dynamicLine-width"]),"dynamicLine-gap-width":new DataDrivenProperty(styleSpec.paint_dynamicLine["dynamicLine-gap-width"]),"dynamicLine-offset":new DataDrivenProperty(styleSpec.paint_dynamicLine["dynamicLine-offset"]),"dynamicLine-blur":new DataDrivenProperty(styleSpec.paint_dynamicLine["dynamicLine-blur"]),"dynamicLine-seg-count":new DataConstantProperty(styleSpec.paint_dynamicLine["dynamicLine-seg-count"]),"dynamicLine-seg-group":new DataConstantProperty(styleSpec.paint_dynamicLine["dynamicLine-seg-group"]),"dynamicLine-speed":new DataConstantProperty(styleSpec.paint_dynamicLine["dynamicLine-speed"]),"dynamicLine-speed-factor":new DataConstantProperty(styleSpec.paint_dynamicLine["dynamicLine-speed-factor"])});module.exports={paint:paint,layout:layout};
},{"../../style-spec/reference/latest":171,"../properties":208}],219:[function(_dereq_,module,exports){
"use strict";function getLineWidth(t,e){return e>0?e+2*t:t}function offsetLine(t,e){for(var i=[],r=new Point(0,0),n=0;n<t.length;n++){for(var a=t[n],o=[],u=0;u<a.length;u++){var l=a[u-1],s=a[u],p=a[u+1],y=0===u?r:s.sub(l)._unit()._perp(),c=u===a.length-1?r:p.sub(s)._unit()._perp(),f=y._add(c)._unit(),d=f.x*c.x+f.y*c.y;f._mult(1/d),o.push(f._mult(e)._add(s))}i.push(o)}return i}var Point=_dereq_("../../_minemap_/point-geometry"),StyleLayer=_dereq_("../style_layer"),LineBucket=_dereq_("../../data/bucket/dynamic_line_bucket"),ref=_dereq_("../../util/intersection_tests"),multiPolygonIntersectsBufferedMultiLine=ref.multiPolygonIntersectsBufferedMultiLine,ref$1=_dereq_("../query_utils"),getMaximumPaintValue=ref$1.getMaximumPaintValue,translateDistance=ref$1.translateDistance,translate=ref$1.translate,properties=_dereq_("./dynamicLine_style_layer_properties"),ref$2=_dereq_("../../util/util"),extend=ref$2.extend,EvaluationParameters=_dereq_("../evaluation_parameters"),ref$3=_dereq_("../properties"),Transitionable=ref$3.Transitionable,Transitioning=ref$3.Transitioning,Layout=ref$3.Layout,PossiblyEvaluated=ref$3.PossiblyEvaluated,DataDrivenProperty=ref$3.DataDrivenProperty,LineFloorwidthProperty=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.possiblyEvaluate=function(e,i){return i=new EvaluationParameters(Math.floor(i.zoom),{now:i.now,fadeDuration:i.fadeDuration,zoomHistory:i.zoomHistory,transition:i.transition}),t.prototype.possiblyEvaluate.call(this,e,i)},e.prototype.evaluate=function(e,i,r){return i=extend({},i,{zoom:Math.floor(i.zoom)}),t.prototype.evaluate.call(this,e,i,r)},e}(DataDrivenProperty),lineFloorwidthProperty=new LineFloorwidthProperty(properties.paint.properties["dynamicLine-width"].specification);lineFloorwidthProperty.useIntegerZoom=!0;var DynamicLineStyleLayer=function(t){function e(e){t.call(this,e,properties)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.recalculate=function(e){t.prototype.recalculate.call(this,e),this.paint._values["dynamicLine-floorwidth"]=lineFloorwidthProperty.possiblyEvaluate(this._transitioningPaint._values["dynamicLine-width"].value,e)},e.prototype.createBucket=function(t){return new LineBucket(t)},e.prototype.queryRadius=function(t){var e=t,i=getLineWidth(getMaximumPaintValue("dynamicLine-width",this,e),getMaximumPaintValue("dynamicLine-gap-width",this,e)),r=getMaximumPaintValue("dynamicLine-offset",this,e);return i/2+Math.abs(r)+translateDistance(this.paint.get("dynamicLine-translate"))},e.prototype.queryIntersectsFeature=function(t,e,i,r,n,a){var o=translate(t,this.paint.get("dynamicLine-translate"),this.paint.get("dynamicLine-translate-anchor"),n.angle,a),u=a/2*getLineWidth(this.paint.get("dynamicLine-width").evaluate(e),this.paint.get("dynamicLine-gap-width").evaluate(e)),l=this.paint.get("dynamicLine-offset").evaluate(e);return l&&(i=offsetLine(i,l*a)),multiPolygonIntersectsBufferedMultiLine(o,i,u)},e}(StyleLayer);module.exports=DynamicLineStyleLayer;
},{"../../_minemap_/point-geometry":29,"../../data/bucket/dynamic_line_bucket":48,"../../util/intersection_tests":301,"../../util/util":315,"../evaluation_parameters":202,"../properties":208,"../query_utils":209,"../style_layer":211,"./dynamicLine_style_layer_properties":218}],220:[function(_dereq_,module,exports){
"use strict";var StyleLayer=_dereq_("../style_layer"),FillExtrusionBucket=_dereq_("../../data/bucket/extrusion_bucket"),ref=_dereq_("../../util/intersection_tests"),multiPolygonIntersectsMultiPolygon=ref.multiPolygonIntersectsMultiPolygon,ref$1=_dereq_("../query_utils"),translateDistance=ref$1.translateDistance,translate=ref$1.translate,properties=_dereq_("./extrusion_style_layer_properties"),tileDrawHelper=_dereq_("../../gl/tile_draw_helper"),ref$2=_dereq_("../properties"),Transitionable=ref$2.Transitionable,Transitioning=ref$2.Transitioning,PossiblyEvaluated=ref$2.PossiblyEvaluated,FillExtrusionStyleLayer=function(t){function e(e){t.call(this,e,properties)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.createBucket=function(t){return new FillExtrusionBucket(t)},e.prototype.queryRadius=function(){return translateDistance(this.paint.get("extrusion-translate"))},e.prototype.queryIntersectsFeature=function(t,e,r,i,n,s){var o=translate(t,this.paint.get("extrusion-translate"),this.paint.get("extrusion-translate-anchor"),n.angle,s);return multiPolygonIntersectsMultiPolygon(o,r)},e.prototype.hasOffscreenPass=function(){return 0!==this.paint.get("extrusion-opacity")&&"none"!==this.visibility},e.prototype.resize=function(){tileDrawHelper.destroy(this)},e}(StyleLayer);module.exports=FillExtrusionStyleLayer;
},{"../../data/bucket/extrusion_bucket":50,"../../gl/tile_draw_helper":85,"../../util/intersection_tests":301,"../properties":208,"../query_utils":209,"../style_layer":211,"./extrusion_style_layer_properties":221}],221:[function(_dereq_,module,exports){
"use strict";var styleSpec=_dereq_("../../style-spec/reference/latest"),ref=_dereq_("../properties"),Properties=ref.Properties,DataConstantProperty=ref.DataConstantProperty,DataDrivenProperty=ref.DataDrivenProperty,CrossFadedProperty=ref.CrossFadedProperty,HeatmapColorProperty=ref.HeatmapColorProperty,paint=new Properties({"extrusion-opacity":new DataConstantProperty(styleSpec.paint_extrusion["extrusion-opacity"]),"extrusion-color":new DataDrivenProperty(styleSpec.paint_extrusion["extrusion-color"]),"extrusion-translate":new DataConstantProperty(styleSpec.paint_extrusion["extrusion-translate"]),"extrusion-translate-anchor":new DataConstantProperty(styleSpec.paint_extrusion["extrusion-translate-anchor"]),"extrusion-pattern":new CrossFadedProperty(styleSpec.paint_extrusion["extrusion-pattern"]),"extrusion-height":new DataDrivenProperty(styleSpec.paint_extrusion["extrusion-height"]),"extrusion-base":new DataDrivenProperty(styleSpec.paint_extrusion["extrusion-base"]),"render-road":new DataConstantProperty(styleSpec.paint_extrusion["render-road"])});module.exports={paint:paint};
},{"../../style-spec/reference/latest":171,"../properties":208}],222:[function(_dereq_,module,exports){
"use strict";var StyleLayer=_dereq_("../style_layer"),FillBucket=_dereq_("../../data/bucket/fill_bucket"),ref=_dereq_("../../util/intersection_tests"),multiPolygonIntersectsMultiPolygon=ref.multiPolygonIntersectsMultiPolygon,ref$1=_dereq_("../query_utils"),translateDistance=ref$1.translateDistance,translate=ref$1.translate,properties=_dereq_("./fill_style_layer_properties"),tileDrawHelper=_dereq_("../../gl/tile_draw_helper"),ref$2=_dereq_("../properties"),Transitionable=ref$2.Transitionable,Transitioning=ref$2.Transitioning,PossiblyEvaluated=ref$2.PossiblyEvaluated,FillStyleLayer=function(t){function e(e){t.call(this,e,properties)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.recalculate=function(t){this.paint=this._transitioningPaint.possiblyEvaluate(t),void 0===this._transitionablePaint.getValue("fill-outline-color")&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])},e.prototype.createBucket=function(t){return new FillBucket(t)},e.prototype.queryRadius=function(){return translateDistance(this.paint.get("fill-translate"))},e.prototype.queryIntersectsFeature=function(t,e,r,i,l,n){var a=translate(t,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),l.angle,n);return multiPolygonIntersectsMultiPolygon(a,r)},e.prototype.hasOffscreenPass=function(){return 0!==this.paint.get("fill-opacity")&&"none"!==this.visibility},e.prototype.resize=function(){tileDrawHelper.destroy(this)},e}(StyleLayer);module.exports=FillStyleLayer;
},{"../../data/bucket/fill_bucket":52,"../../gl/tile_draw_helper":85,"../../util/intersection_tests":301,"../properties":208,"../query_utils":209,"../style_layer":211,"./fill_style_layer_properties":223}],223:[function(_dereq_,module,exports){
"use strict";var styleSpec=_dereq_("../../style-spec/reference/latest"),ref=_dereq_("../properties"),Properties=ref.Properties,DataConstantProperty=ref.DataConstantProperty,DataDrivenProperty=ref.DataDrivenProperty,CrossFadedProperty=ref.CrossFadedProperty,HeatmapColorProperty=ref.HeatmapColorProperty,paint=new Properties({"fill-antialias":new DataConstantProperty(styleSpec.paint_fill["fill-antialias"]),"fill-opacity":new DataDrivenProperty(styleSpec.paint_fill["fill-opacity"]),"fill-color":new DataDrivenProperty(styleSpec.paint_fill["fill-color"]),"fill-outline-color":new DataDrivenProperty(styleSpec.paint_fill["fill-outline-color"]),"fill-translate":new DataConstantProperty(styleSpec.paint_fill["fill-translate"]),"fill-translate-anchor":new DataConstantProperty(styleSpec.paint_fill["fill-translate-anchor"]),"fill-pattern":new CrossFadedProperty(styleSpec.paint_fill["fill-pattern"]),"fill-water":new DataConstantProperty(styleSpec.paint_fill["fill-water"]),"render-3d":new DataConstantProperty(styleSpec.paint_fill["render-3d"])});module.exports={paint:paint};
},{"../../style-spec/reference/latest":171,"../properties":208}],224:[function(_dereq_,module,exports){
"use strict";var StyleLayer=_dereq_("../style_layer"),HeatmapBucket=_dereq_("../../data/bucket/heatmap_bucket"),RGBAImage=_dereq_("../../util/image").RGBAImage,properties=_dereq_("./heatmap_style_layer_properties"),tileDrawHelper=_dereq_("../../gl/tile_draw_helper"),ref=_dereq_("../properties"),Transitionable=ref.Transitionable,Transitioning=ref.Transitioning,PossiblyEvaluated=ref.PossiblyEvaluated,HeatmapStyleLayer=function(e){function t(t){e.call(this,t,properties),this._updateColorRamp()}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.createBucket=function(e){return new HeatmapBucket(e)},t.prototype.setPaintProperty=function(t,r,a){e.prototype.setPaintProperty.call(this,t,r,a),"heatmap-color"===t&&this._updateColorRamp()},t.prototype._updateColorRamp=function(){for(var e=this._transitionablePaint._values["heatmap-color"].value.expression,t=new Uint8Array(1024),r=t.length,a=4;a<r;a+=4){var o=e.evaluate({heatmapDensity:a/r});t[a+0]=Math.floor(255*o.r/o.a),t[a+1]=Math.floor(255*o.g/o.a),t[a+2]=Math.floor(255*o.b/o.a),t[a+3]=Math.floor(255*o.a)}this.colorRamp=new RGBAImage({width:256,height:1},t),this.colorRampTexture=null},t.prototype.resize=function(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)},t.prototype.queryRadius=function(){return 0},t.prototype.queryIntersectsFeature=function(){return!1},t.prototype.hasOffscreenPass=function(){return 0!==this.paint.get("heatmap-opacity")&&"none"!==this.visibility},t}(StyleLayer);module.exports=HeatmapStyleLayer;
},{"../../data/bucket/heatmap_bucket":53,"../../gl/tile_draw_helper":85,"../../util/image":298,"../properties":208,"../style_layer":211,"./heatmap_style_layer_properties":225}],225:[function(_dereq_,module,exports){
"use strict";var styleSpec=_dereq_("../../style-spec/reference/latest"),ref=_dereq_("../properties"),Properties=ref.Properties,DataConstantProperty=ref.DataConstantProperty,DataDrivenProperty=ref.DataDrivenProperty,CrossFadedProperty=ref.CrossFadedProperty,HeatmapColorProperty=ref.HeatmapColorProperty,paint=new Properties({"heatmap-radius":new DataDrivenProperty(styleSpec.paint_heatmap["heatmap-radius"]),"heatmap-weight":new DataDrivenProperty(styleSpec.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new DataConstantProperty(styleSpec.paint_heatmap["heatmap-intensity"]),"heatmap-color":new HeatmapColorProperty(styleSpec.paint_heatmap["heatmap-color"]),"heatmap-opacity":new DataConstantProperty(styleSpec.paint_heatmap["heatmap-opacity"])});module.exports={paint:paint};
},{"../../style-spec/reference/latest":171,"../properties":208}],226:[function(_dereq_,module,exports){
"use strict";var StyleLayer=_dereq_("../style_layer"),properties=_dereq_("./hillshade_style_layer_properties"),ref=_dereq_("../properties"),Transitionable=ref.Transitionable,Transitioning=ref.Transitioning,PossiblyEvaluated=ref.PossiblyEvaluated,HillshadeStyleLayer=function(e){function r(r){e.call(this,r,properties)}return e&&(r.__proto__=e),r.prototype=Object.create(e&&e.prototype),r.prototype.constructor=r,r.prototype.hasOffscreenPass=function(){return 0!==this.paint.get("hillshade-exaggeration")&&"none"!==this.visibility},r}(StyleLayer);module.exports=HillshadeStyleLayer;
},{"../properties":208,"../style_layer":211,"./hillshade_style_layer_properties":227}],227:[function(_dereq_,module,exports){
"use strict";var styleSpec=_dereq_("../../style-spec/reference/latest"),ref=_dereq_("../properties"),Properties=ref.Properties,DataConstantProperty=ref.DataConstantProperty,DataDrivenProperty=ref.DataDrivenProperty,CrossFadedProperty=ref.CrossFadedProperty,HeatmapColorProperty=ref.HeatmapColorProperty,paint=new Properties({"hillshade-illumination-direction":new DataConstantProperty(styleSpec.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new DataConstantProperty(styleSpec.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new DataConstantProperty(styleSpec.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new DataConstantProperty(styleSpec.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new DataConstantProperty(styleSpec.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new DataConstantProperty(styleSpec.paint_hillshade["hillshade-accent-color"])});module.exports={paint:paint};
},{"../../style-spec/reference/latest":171,"../properties":208}],228:[function(_dereq_,module,exports){
"use strict";var StyleLayer=_dereq_("../style_layer"),FillExtrusionBucket=_dereq_("../../data/bucket/histogram_bucket"),ref=_dereq_("../../util/intersection_tests"),multiPolygonIntersectsMultiPolygon=ref.multiPolygonIntersectsMultiPolygon,ref$1=_dereq_("../query_utils"),translateDistance=ref$1.translateDistance,translate=ref$1.translate,properties=_dereq_("./histogram_style_layer_properties"),tileDrawHelper=_dereq_("../../gl/tile_draw_helper"),ref$2=_dereq_("../properties"),Transitionable=ref$2.Transitionable,Transitioning=ref$2.Transitioning,PossiblyEvaluated=ref$2.PossiblyEvaluated,HistogramStyleLayer=function(t){function e(e){t.call(this,e,properties)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.createBucket=function(t){return new FillExtrusionBucket(t)},e.prototype.queryRadius=function(){return translateDistance(this.paint.get("histogram-translate"))},e.prototype.queryIntersectsFeature=function(t,e,r,i,s,a){var n=translate(t,this.paint.get("histogram-translate"),this.paint.get("histogram-translate-anchor"),s.angle,a);return multiPolygonIntersectsMultiPolygon(n,r)},e.prototype.hasOffscreenPass=function(){return 0!==this.paint.get("histogram-opacity")&&"none"!==this.visibility},e.prototype.resize=function(){tileDrawHelper.destroy(this)},e}(StyleLayer);module.exports=HistogramStyleLayer;
},{"../../data/bucket/histogram_bucket":55,"../../gl/tile_draw_helper":85,"../../util/intersection_tests":301,"../properties":208,"../query_utils":209,"../style_layer":211,"./histogram_style_layer_properties":229}],229:[function(_dereq_,module,exports){
"use strict";var styleSpec=_dereq_("../../style-spec/reference/latest"),ref=_dereq_("../properties"),Properties=ref.Properties,DataConstantProperty=ref.DataConstantProperty,DataDrivenProperty=ref.DataDrivenProperty,CrossFadedProperty=ref.CrossFadedProperty,HeatmapColorProperty=ref.HeatmapColorProperty,layout=new Properties({"histogram-color-render":new DataConstantProperty(styleSpec.layout_histogram["histogram-color-render"]),"histogram-max-height-render":new DataConstantProperty(styleSpec.layout_histogram["histogram-max-height-render"])}),paint=new Properties({"histogram-opacity":new DataConstantProperty(styleSpec.paint_histogram["histogram-opacity"]),"histogram-color":new DataDrivenProperty(styleSpec.paint_histogram["histogram-color"]),"histogram-translate":new DataConstantProperty(styleSpec.paint_histogram["histogram-translate"]),"histogram-translate-anchor":new DataConstantProperty(styleSpec.paint_histogram["histogram-translate-anchor"]),"histogram-pattern":new CrossFadedProperty(styleSpec.paint_histogram["histogram-pattern"]),"histogram-height":new DataDrivenProperty(styleSpec.paint_histogram["histogram-height"]),"histogram-base":new DataDrivenProperty(styleSpec.paint_histogram["histogram-base"]),"histogram-dynamic":new DataConstantProperty(styleSpec.paint_histogram["histogram-dynamic"]),"histogram-heightArr1":new DataDrivenProperty(styleSpec.paint_histogram["histogram-heightArr1"]),"histogram-heightArr2":new DataDrivenProperty(styleSpec.paint_histogram["histogram-heightArr2"]),"histogram-heightArr3":new DataDrivenProperty(styleSpec.paint_histogram["histogram-heightArr3"]),"histogram-time":new DataConstantProperty(styleSpec.paint_histogram["histogram-time"]),"histogram-count":new DataConstantProperty(styleSpec.paint_histogram["histogram-count"]),"histogram-colors":new DataConstantProperty(styleSpec.paint_histogram["histogram-colors"]),"histogram-max-height":new DataConstantProperty(styleSpec.paint_histogram["histogram-max-height"]),"histogram-fluorescent":new DataConstantProperty(styleSpec.paint_histogram["histogram-fluorescent"])});module.exports={paint:paint,layout:layout};
},{"../../style-spec/reference/latest":171,"../properties":208}],230:[function(_dereq_,module,exports){
"use strict";function getLineWidth(e,t){return t>0?t+2*e:e}function offsetLine(e,t){for(var r=[],i=new Point(0,0),n=0;n<e.length;n++){for(var a=e[n],o=[],l=0;l<a.length;l++){var u=a[l-1],s=a[l],p=a[l+1],y=0===l?i:s.sub(u)._unit()._perp(),f=l===a.length-1?i:p.sub(s)._unit()._perp(),c=y._add(f)._unit(),h=c.x*f.x+c.y*f.y;c._mult(1/h),o.push(c._mult(t)._add(s))}r.push(o)}return r}var Point=_dereq_("../../_minemap_/point-geometry"),StyleLayer=_dereq_("../style_layer"),LineBucket=_dereq_("../../data/bucket/line_bucket"),ref=_dereq_("../../util/intersection_tests"),multiPolygonIntersectsBufferedMultiLine=ref.multiPolygonIntersectsBufferedMultiLine,ref$1=_dereq_("../query_utils"),getMaximumPaintValue=ref$1.getMaximumPaintValue,translateDistance=ref$1.translateDistance,translate=ref$1.translate,properties=_dereq_("./line_style_layer_properties"),ref$2=_dereq_("../../util/util"),extend=ref$2.extend,EvaluationParameters=_dereq_("../evaluation_parameters"),tileDrawHelper=_dereq_("../../gl/tile_draw_helper"),ref$3=_dereq_("../properties"),Transitionable=ref$3.Transitionable,Transitioning=ref$3.Transitioning,Layout=ref$3.Layout,PossiblyEvaluated=ref$3.PossiblyEvaluated,DataDrivenProperty=ref$3.DataDrivenProperty,LineFloorwidthProperty=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.possiblyEvaluate=function(t,r){return r=new EvaluationParameters(Math.floor(r.zoom),{now:r.now,fadeDuration:r.fadeDuration,zoomHistory:r.zoomHistory,transition:r.transition}),e.prototype.possiblyEvaluate.call(this,t,r)},t.prototype.evaluate=function(t,r,i){return r=extend({},r,{zoom:Math.floor(r.zoom)}),e.prototype.evaluate.call(this,t,r,i)},t}(DataDrivenProperty),lineFloorwidthProperty=new LineFloorwidthProperty(properties.paint.properties["line-width"].specification);lineFloorwidthProperty.useIntegerZoom=!0;var LineStyleLayer=function(e){function t(t){e.call(this,t,properties)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.recalculate=function(t){e.prototype.recalculate.call(this,t),this.paint._values["line-floorwidth"]=lineFloorwidthProperty.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,t)},t.prototype.createBucket=function(e){return new LineBucket(e)},t.prototype.queryRadius=function(e){var t=e,r=getLineWidth(getMaximumPaintValue("line-width",this,t),getMaximumPaintValue("line-gap-width",this,t)),i=getMaximumPaintValue("line-offset",this,t);return r/2+Math.abs(i)+translateDistance(this.paint.get("line-translate"))},t.prototype.queryIntersectsFeature=function(e,t,r,i,n,a){var o=translate(e,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),n.angle,a),l=a/2*getLineWidth(this.paint.get("line-width").evaluate(t),this.paint.get("line-gap-width").evaluate(t)),u=this.paint.get("line-offset").evaluate(t);return u&&(r=offsetLine(r,u*a)),multiPolygonIntersectsBufferedMultiLine(o,r,l)},t.prototype.hasOffscreenPass=function(){return 0!==this.paint.get("line-opacity")&&"none"!==this.visibility},t.prototype.resize=function(){tileDrawHelper.destroy(this)},t}(StyleLayer);module.exports=LineStyleLayer;
},{"../../_minemap_/point-geometry":29,"../../data/bucket/line_bucket":57,"../../gl/tile_draw_helper":85,"../../util/intersection_tests":301,"../../util/util":315,"../evaluation_parameters":202,"../properties":208,"../query_utils":209,"../style_layer":211,"./line_style_layer_properties":231}],231:[function(_dereq_,module,exports){
"use strict";var styleSpec=_dereq_("../../style-spec/reference/latest"),ref=_dereq_("../properties"),Properties=ref.Properties,DataConstantProperty=ref.DataConstantProperty,DataDrivenProperty=ref.DataDrivenProperty,CrossFadedProperty=ref.CrossFadedProperty,HeatmapColorProperty=ref.HeatmapColorProperty,layout=new Properties({"line-cap":new DataConstantProperty(styleSpec.layout_line["line-cap"]),"line-join":new DataDrivenProperty(styleSpec.layout_line["line-join"]),"line-miter-limit":new DataConstantProperty(styleSpec.layout_line["line-miter-limit"]),"line-round-limit":new DataConstantProperty(styleSpec.layout_line["line-round-limit"])}),paint=new Properties({"line-opacity":new DataDrivenProperty(styleSpec.paint_line["line-opacity"]),"line-color":new DataDrivenProperty(styleSpec.paint_line["line-color"]),"line-translate":new DataConstantProperty(styleSpec.paint_line["line-translate"]),"line-translate-anchor":new DataConstantProperty(styleSpec.paint_line["line-translate-anchor"]),"line-width":new DataDrivenProperty(styleSpec.paint_line["line-width"]),"line-gap-width":new DataDrivenProperty(styleSpec.paint_line["line-gap-width"]),"line-offset":new DataDrivenProperty(styleSpec.paint_line["line-offset"]),"line-blur":new DataDrivenProperty(styleSpec.paint_line["line-blur"]),"line-dasharray":new CrossFadedProperty(styleSpec.paint_line["line-dasharray"]),"line-pattern":new CrossFadedProperty(styleSpec.paint_line["line-pattern"]),"render-3d":new DataConstantProperty(styleSpec.paint_line["render-3d"]),"line-contour-colors":new DataConstantProperty(styleSpec.paint_line["line-contour-colors"]),"line-max-contour-height":new DataConstantProperty(styleSpec.paint_line["line-max-contour-height"]),"line-is-contour":new DataConstantProperty(styleSpec.paint_line["line-is-contour"]),"line-interpolate":new DataConstantProperty(styleSpec.paint_line["line-interpolate"]),"line-status":new DataDrivenProperty(styleSpec.paint_line["line-status"]),"line-instatus":new DataDrivenProperty(styleSpec.paint_line["line-instatus"]),"line-height-offset":new DataConstantProperty(styleSpec.paint_line["line-height-offset"]),"half-render":new DataConstantProperty(styleSpec.paint_line["half-render"])});module.exports={paint:paint,layout:layout};
},{"../../style-spec/reference/latest":171,"../properties":208}],232:[function(_dereq_,module,exports){
"use strict";var StyleLayer=_dereq_("../style_layer"),properties=_dereq_("./raster_style_layer_properties"),ref=_dereq_("../properties"),Transitionable=ref.Transitionable,Transitioning=ref.Transitioning,PossiblyEvaluated=ref.PossiblyEvaluated,RasterStyleLayer=function(e){function r(r){e.call(this,r,properties)}return e&&(r.__proto__=e),r.prototype=Object.create(e&&e.prototype),r.prototype.constructor=r,r}(StyleLayer);module.exports=RasterStyleLayer;
},{"../properties":208,"../style_layer":211,"./raster_style_layer_properties":233}],233:[function(_dereq_,module,exports){
"use strict";var styleSpec=_dereq_("../../style-spec/reference/latest"),ref=_dereq_("../properties"),Properties=ref.Properties,DataConstantProperty=ref.DataConstantProperty,DataDrivenProperty=ref.DataDrivenProperty,CrossFadedProperty=ref.CrossFadedProperty,HeatmapColorProperty=ref.HeatmapColorProperty,paint=new Properties({"raster-opacity":new DataConstantProperty(styleSpec.paint_raster["raster-opacity"]),"raster-hue-rotate":new DataConstantProperty(styleSpec.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new DataConstantProperty(styleSpec.paint_raster["raster-brightness-min"]),"raster-brightness-max":new DataConstantProperty(styleSpec.paint_raster["raster-brightness-max"]),"raster-saturation":new DataConstantProperty(styleSpec.paint_raster["raster-saturation"]),"raster-contrast":new DataConstantProperty(styleSpec.paint_raster["raster-contrast"]),"raster-fade-duration":new DataConstantProperty(styleSpec.paint_raster["raster-fade-duration"])});module.exports={paint:paint};
},{"../../style-spec/reference/latest":171,"../properties":208}],234:[function(_dereq_,module,exports){
"use strict";function getLineWidth(t,e){return e>0?e+2*t:t}function offsetLine(t,e){for(var r=[],i=new Point(0,0),a=0;a<t.length;a++){for(var o=t[a],n=[],s=0;s<o.length;s++){var p=o[s-1],u=o[s],l=o[s+1],y=0===s?i:u.sub(p)._unit()._perp(),f=s===o.length-1?i:l.sub(u)._unit()._perp(),c=y._add(f)._unit(),h=c.x*f.x+c.y*f.y;c._mult(1/h),n.push(c._mult(e)._add(u))}r.push(n)}return r}var Point=_dereq_("../../_minemap_/point-geometry"),StyleLayer=_dereq_("../style_layer"),LineBucket=_dereq_("../../data/bucket/sprite_bucket"),ref=_dereq_("../../util/intersection_tests"),multiPolygonIntersectsBufferedMultiLine=ref.multiPolygonIntersectsBufferedMultiLine,ref$1=_dereq_("../query_utils"),getMaximumPaintValue=ref$1.getMaximumPaintValue,translateDistance=ref$1.translateDistance,translate=ref$1.translate,properties=_dereq_("./sprite_style_layer_properties"),ref$2=_dereq_("../../util/util"),extend=ref$2.extend,EvaluationParameters=_dereq_("../evaluation_parameters"),tileDrawHelper=_dereq_("../../gl/tile_draw_helper"),ref$3=_dereq_("../properties"),Transitionable=ref$3.Transitionable,Transitioning=ref$3.Transitioning,Layout=ref$3.Layout,PossiblyEvaluated=ref$3.PossiblyEvaluated,DataDrivenProperty=ref$3.DataDrivenProperty,LineFloorwidthProperty=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.possiblyEvaluate=function(e,r){return r=new EvaluationParameters(Math.floor(r.zoom),{now:r.now,fadeDuration:r.fadeDuration,zoomHistory:r.zoomHistory,transition:r.transition}),t.prototype.possiblyEvaluate.call(this,e,r)},e.prototype.evaluate=function(e,r,i){return r=extend({},r,{zoom:Math.floor(r.zoom)}),t.prototype.evaluate.call(this,e,r,i)},e}(DataDrivenProperty),lineFloorwidthProperty=new LineFloorwidthProperty(properties.paint.properties["sprite-width"].specification);lineFloorwidthProperty.useIntegerZoom=!0;var SpriteStyleLayer=function(t){function e(e){t.call(this,e,properties)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.recalculate=function(e){t.prototype.recalculate.call(this,e),this.paint._values["sprite-floorwidth"]=lineFloorwidthProperty.possiblyEvaluate(this._transitioningPaint._values["sprite-width"].value,e)},e.prototype.createBucket=function(t){return new LineBucket(t)},e.prototype.queryRadius=function(t){var e=t,r=getLineWidth(getMaximumPaintValue("sprite-width",this,e),getMaximumPaintValue("sprite-gap-width",this,e)),i=getMaximumPaintValue("sprite-offset",this,e);return r/2+Math.abs(i)+translateDistance(this.paint.get("sprite-translate"))},e.prototype.queryIntersectsFeature=function(t,e,r,i,a,o){var n=translate(t,this.paint.get("sprite-translate"),this.paint.get("sprite-translate-anchor"),a.angle,o),s=o/2*getLineWidth(this.paint.get("sprite-width").evaluate(e),this.paint.get("sprite-gap-width").evaluate(e)),p=this.paint.get("sprite-offset").evaluate(e);return p&&(r=offsetLine(r,p*o)),multiPolygonIntersectsBufferedMultiLine(n,r,s)},e.prototype.hasOffscreenPass=function(){return 0!==this.paint.get("sprite-opacity")&&"none"!==this.visibility},e.prototype.resize=function(){tileDrawHelper.destroy(this)},e}(StyleLayer);module.exports=SpriteStyleLayer;
},{"../../_minemap_/point-geometry":29,"../../data/bucket/sprite_bucket":59,"../../gl/tile_draw_helper":85,"../../util/intersection_tests":301,"../../util/util":315,"../evaluation_parameters":202,"../properties":208,"../query_utils":209,"../style_layer":211,"./sprite_style_layer_properties":235}],235:[function(_dereq_,module,exports){
"use strict";var styleSpec=_dereq_("../../style-spec/reference/latest"),ref=_dereq_("../properties"),Properties=ref.Properties,DataConstantProperty=ref.DataConstantProperty,DataDrivenProperty=ref.DataDrivenProperty,CrossFadedProperty=ref.CrossFadedProperty,HeatmapColorProperty=ref.HeatmapColorProperty,layout=new Properties({"sprite-cap":new DataConstantProperty(styleSpec.layout_sprite["sprite-cap"]),"sprite-join":new DataDrivenProperty(styleSpec.layout_sprite["sprite-join"]),"sprite-miter-limit":new DataConstantProperty(styleSpec.layout_sprite["sprite-miter-limit"]),"sprite-round-limit":new DataConstantProperty(styleSpec.layout_sprite["sprite-round-limit"])}),paint=new Properties({"sprite-opacity":new DataDrivenProperty(styleSpec.paint_sprite["sprite-opacity"]),"sprite-color":new DataDrivenProperty(styleSpec.paint_sprite["sprite-color"]),"sprite-translate":new DataConstantProperty(styleSpec.paint_sprite["sprite-translate"]),"sprite-translate-anchor":new DataConstantProperty(styleSpec.paint_sprite["sprite-translate-anchor"]),"sprite-width":new DataDrivenProperty(styleSpec.paint_sprite["sprite-width"]),"sprite-gap-width":new DataDrivenProperty(styleSpec.paint_sprite["sprite-gap-width"]),"sprite-offset":new DataDrivenProperty(styleSpec.paint_sprite["sprite-offset"]),"sprite-blur":new DataDrivenProperty(styleSpec.paint_sprite["sprite-blur"]),"sprite-dasharray":new DataConstantProperty(styleSpec.paint_sprite["sprite-dasharray"]),"sprite-pattern":new CrossFadedProperty(styleSpec.paint_sprite["sprite-pattern"]),"sprite-speed-factor":new DataConstantProperty(styleSpec.paint_sprite["sprite-speed-factor"]),"render-3d":new DataConstantProperty(styleSpec.paint_sprite["render-3d"]),"sprite-interpolate":new DataConstantProperty(styleSpec.paint_sprite["sprite-interpolate"]),"sprite-status":new DataDrivenProperty(styleSpec.paint_sprite["sprite-status"]),"sprite-instatus":new DataDrivenProperty(styleSpec.paint_sprite["sprite-instatus"]),"sprite-height-offset":new DataConstantProperty(styleSpec.paint_sprite["sprite-height-offset"])});module.exports={paint:paint,layout:layout};
},{"../../style-spec/reference/latest":171,"../properties":208}],236:[function(_dereq_,module,exports){
"use strict";var StyleLayer=_dereq_("../style_layer"),SymbolBucket=_dereq_("../../data/bucket/symbol_bucket"),resolveTokens=_dereq_("../../util/token"),ref=_dereq_("../../style-spec/expression"),isExpression=ref.isExpression,properties=_dereq_("./symbol_style_layer_properties"),tileDrawHelper=_dereq_("../../gl/tile_draw_helper"),ref$1=_dereq_("../properties"),Transitionable=ref$1.Transitionable,Transitioning=ref$1.Transitioning,Layout=ref$1.Layout,PossiblyEvaluated=ref$1.PossiblyEvaluated,SymbolStyleLayer=function(t){function e(e){t.call(this,e,properties)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.recalculate=function(e){t.prototype.recalculate.call(this,e),"auto"===this.layout.get("icon-rotation-alignment")&&("line"===this.layout.get("symbol-placement")?this.layout._values["icon-rotation-alignment"]="map":this.layout._values["icon-rotation-alignment"]="viewport"),"auto"===this.layout.get("text-rotation-alignment")&&("line"===this.layout.get("symbol-placement")?this.layout._values["text-rotation-alignment"]="map":this.layout._values["text-rotation-alignment"]="viewport"),"auto"===this.layout.get("text-pitch-alignment")&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),"auto"===this.layout.get("icon-pitch-alignment")&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"))},e.prototype.getValueAndResolveTokens=function(t,e){var o=this.layout.get(t).evaluate(e),i=this._unevaluatedLayout._values[t];return i.isDataDriven()||isExpression(i.value)?o:resolveTokens(e.properties,o)},e.prototype.createBucket=function(t){return new SymbolBucket(t)},e.prototype.queryRadius=function(){return 0},e.prototype.queryIntersectsFeature=function(){return!1},e.prototype.hasOffscreenPass=function(){return 0!==this.paint.get("icon-opacity")&&0!==this.paint.get("text-opacity")&&"none"!==this.visibility},e.prototype.resize=function(){tileDrawHelper.destroy(this)},e}(StyleLayer);module.exports=SymbolStyleLayer;
},{"../../data/bucket/symbol_bucket":61,"../../gl/tile_draw_helper":85,"../../style-spec/expression":159,"../../util/token":314,"../properties":208,"../style_layer":211,"./symbol_style_layer_properties":237}],237:[function(_dereq_,module,exports){
"use strict";var styleSpec=_dereq_("../../style-spec/reference/latest"),ref=_dereq_("../properties"),Properties=ref.Properties,DataConstantProperty=ref.DataConstantProperty,DataDrivenProperty=ref.DataDrivenProperty,CrossFadedProperty=ref.CrossFadedProperty,HeatmapColorProperty=ref.HeatmapColorProperty,layout=new Properties({"symbol-placement":new DataConstantProperty(styleSpec.layout_symbol["symbol-placement"]),"symbol-spacing":new DataConstantProperty(styleSpec.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new DataConstantProperty(styleSpec.layout_symbol["symbol-avoid-edges"]),"icon-allow-overlap":new DataConstantProperty(styleSpec.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new DataConstantProperty(styleSpec.layout_symbol["icon-ignore-placement"]),"icon-optional":new DataConstantProperty(styleSpec.layout_symbol["icon-optional"]),"icon-rotation-alignment":new DataConstantProperty(styleSpec.layout_symbol["icon-rotation-alignment"]),"icon-size":new DataDrivenProperty(styleSpec.layout_symbol["icon-size"]),"icon-text-fit":new DataConstantProperty(styleSpec.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new DataConstantProperty(styleSpec.layout_symbol["icon-text-fit-padding"]),"icon-image":new DataDrivenProperty(styleSpec.layout_symbol["icon-image"]),"icon-rotate":new DataDrivenProperty(styleSpec.layout_symbol["icon-rotate"]),"icon-padding":new DataConstantProperty(styleSpec.layout_symbol["icon-padding"]),"icon-keep-upright":new DataConstantProperty(styleSpec.layout_symbol["icon-keep-upright"]),"icon-offset":new DataDrivenProperty(styleSpec.layout_symbol["icon-offset"]),"icon-anchor":new DataDrivenProperty(styleSpec.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new DataConstantProperty(styleSpec.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new DataConstantProperty(styleSpec.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new DataConstantProperty(styleSpec.layout_symbol["text-rotation-alignment"]),"text-field":new DataDrivenProperty(styleSpec.layout_symbol["text-field"]),"text-font":new DataDrivenProperty(styleSpec.layout_symbol["text-font"]),"text-size":new DataDrivenProperty(styleSpec.layout_symbol["text-size"]),"text-max-width":new DataDrivenProperty(styleSpec.layout_symbol["text-max-width"]),"text-line-height":new DataConstantProperty(styleSpec.layout_symbol["text-line-height"]),"text-letter-spacing":new DataDrivenProperty(styleSpec.layout_symbol["text-letter-spacing"]),"text-justify":new DataDrivenProperty(styleSpec.layout_symbol["text-justify"]),"text-anchor":new DataDrivenProperty(styleSpec.layout_symbol["text-anchor"]),"text-max-angle":new DataConstantProperty(styleSpec.layout_symbol["text-max-angle"]),"text-rotate":new DataDrivenProperty(styleSpec.layout_symbol["text-rotate"]),"text-padding":new DataConstantProperty(styleSpec.layout_symbol["text-padding"]),"text-keep-upright":new DataConstantProperty(styleSpec.layout_symbol["text-keep-upright"]),"text-transform":new DataDrivenProperty(styleSpec.layout_symbol["text-transform"]),"text-offset":new DataDrivenProperty(styleSpec.layout_symbol["text-offset"]),"text-allow-overlap":new DataConstantProperty(styleSpec.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new DataConstantProperty(styleSpec.layout_symbol["text-ignore-placement"]),"text-optional":new DataConstantProperty(styleSpec.layout_symbol["text-optional"])}),paint=new Properties({"icon-opacity":new DataDrivenProperty(styleSpec.paint_symbol["icon-opacity"]),"icon-color":new DataDrivenProperty(styleSpec.paint_symbol["icon-color"]),"icon-halo-color":new DataDrivenProperty(styleSpec.paint_symbol["icon-halo-color"]),"icon-halo-width":new DataDrivenProperty(styleSpec.paint_symbol["icon-halo-width"]),"icon-halo-blur":new DataDrivenProperty(styleSpec.paint_symbol["icon-halo-blur"]),"icon-translate":new DataConstantProperty(styleSpec.paint_symbol["icon-translate"]),"icon-translate-anchor":new DataConstantProperty(styleSpec.paint_symbol["icon-translate-anchor"]),"text-opacity":new DataDrivenProperty(styleSpec.paint_symbol["text-opacity"]),"text-color":new DataDrivenProperty(styleSpec.paint_symbol["text-color"]),"text-halo-color":new DataDrivenProperty(styleSpec.paint_symbol["text-halo-color"]),"text-halo-width":new DataDrivenProperty(styleSpec.paint_symbol["text-halo-width"]),"text-halo-blur":new DataDrivenProperty(styleSpec.paint_symbol["text-halo-blur"]),"text-translate":new DataConstantProperty(styleSpec.paint_symbol["text-translate"]),"text-translate-anchor":new DataConstantProperty(styleSpec.paint_symbol["text-translate-anchor"]),"render-3d":new DataConstantProperty(styleSpec.paint_symbol["render-3d"]),"render-road-mark":new DataConstantProperty(styleSpec.paint_symbol["render-road-mark"]),"symbol-height-offset":new DataConstantProperty(styleSpec.paint_symbol["symbol-height-offset"])});module.exports={paint:paint,layout:layout};
},{"../../style-spec/reference/latest":171,"../properties":208}],238:[function(_dereq_,module,exports){
"use strict";var StyleLayer=_dereq_("../style_layer"),SymbolBucket=_dereq_("../../data/bucket/symtracking_bucket"),resolveTokens=_dereq_("../../util/token"),ref=_dereq_("../../style-spec/expression"),isExpression=ref.isExpression,properties=_dereq_("./symtracking_style_layer_properties"),tileDrawHelper=_dereq_("../../gl/tile_draw_helper"),ref$1=_dereq_("../properties"),Transitionable=ref$1.Transitionable,Transitioning=ref$1.Transitioning,Layout=ref$1.Layout,PossiblyEvaluated=ref$1.PossiblyEvaluated,SymbolStyleLayer=function(t){function e(e){t.call(this,e,properties)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.recalculate=function(e){t.prototype.recalculate.call(this,e),"auto"===this.layout.get("icon-rotation-alignment")&&("line"===this.layout.get("symbol-placement")?this.layout._values["icon-rotation-alignment"]="map":this.layout._values["icon-rotation-alignment"]="viewport"),"auto"===this.layout.get("text-rotation-alignment")&&("line"===this.layout.get("symbol-placement")?this.layout._values["text-rotation-alignment"]="map":this.layout._values["text-rotation-alignment"]="viewport"),"auto"===this.layout.get("text-pitch-alignment")&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),"auto"===this.layout.get("icon-pitch-alignment")&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"))},e.prototype.getValueAndResolveTokens=function(t,e){var i=this.layout.get(t).evaluate(e),o=this._unevaluatedLayout._values[t];return o.isDataDriven()||isExpression(o.value)?i:resolveTokens(e.properties,i)},e.prototype.createBucket=function(t){return new SymbolBucket(t)},e.prototype.queryRadius=function(){return 0},e.prototype.queryIntersectsFeature=function(){return!1},e.prototype.hasOffscreenPass=function(){return 0!==this.paint.get("icon-opacity")&&0!==this.paint.get("text-opacity")&&"none"!==this.visibility},e.prototype.resize=function(){tileDrawHelper.destroy(this)},e}(StyleLayer);module.exports=SymbolStyleLayer;
},{"../../data/bucket/symtracking_bucket":63,"../../gl/tile_draw_helper":85,"../../style-spec/expression":159,"../../util/token":314,"../properties":208,"../style_layer":211,"./symtracking_style_layer_properties":239}],239:[function(_dereq_,module,exports){
"use strict";var styleSpec=_dereq_("../../style-spec/reference/latest"),ref=_dereq_("../properties"),Properties=ref.Properties,DataConstantProperty=ref.DataConstantProperty,DataDrivenProperty=ref.DataDrivenProperty,CrossFadedProperty=ref.CrossFadedProperty,HeatmapColorProperty=ref.HeatmapColorProperty,layout=new Properties({"symbol-placement":new DataConstantProperty(styleSpec.layout_symtracking["symbol-placement"]),"symbol-spacing":new DataConstantProperty(styleSpec.layout_symtracking["symbol-spacing"]),"symbol-avoid-edges":new DataConstantProperty(styleSpec.layout_symtracking["symbol-avoid-edges"]),"icon-allow-overlap":new DataConstantProperty(styleSpec.layout_symtracking["icon-allow-overlap"]),"icon-ignore-placement":new DataConstantProperty(styleSpec.layout_symtracking["icon-ignore-placement"]),"icon-optional":new DataConstantProperty(styleSpec.layout_symtracking["icon-optional"]),"icon-rotation-alignment":new DataConstantProperty(styleSpec.layout_symtracking["icon-rotation-alignment"]),"icon-size":new DataDrivenProperty(styleSpec.layout_symtracking["icon-size"]),"icon-text-fit":new DataConstantProperty(styleSpec.layout_symtracking["icon-text-fit"]),"icon-text-fit-padding":new DataConstantProperty(styleSpec.layout_symtracking["icon-text-fit-padding"]),"icon-image":new DataDrivenProperty(styleSpec.layout_symtracking["icon-image"]),"icon-rotate":new DataDrivenProperty(styleSpec.layout_symtracking["icon-rotate"]),"icon-padding":new DataConstantProperty(styleSpec.layout_symtracking["icon-padding"]),"icon-keep-upright":new DataConstantProperty(styleSpec.layout_symtracking["icon-keep-upright"]),"icon-offset":new DataDrivenProperty(styleSpec.layout_symtracking["icon-offset"]),"icon-anchor":new DataDrivenProperty(styleSpec.layout_symtracking["icon-anchor"]),"icon-pitch-alignment":new DataConstantProperty(styleSpec.layout_symtracking["icon-pitch-alignment"]),"text-pitch-alignment":new DataConstantProperty(styleSpec.layout_symtracking["text-pitch-alignment"]),"text-rotation-alignment":new DataConstantProperty(styleSpec.layout_symtracking["text-rotation-alignment"]),"text-field":new DataDrivenProperty(styleSpec.layout_symtracking["text-field"]),"text-font":new DataDrivenProperty(styleSpec.layout_symtracking["text-font"]),"text-size":new DataDrivenProperty(styleSpec.layout_symtracking["text-size"]),"text-max-width":new DataDrivenProperty(styleSpec.layout_symtracking["text-max-width"]),"text-line-height":new DataConstantProperty(styleSpec.layout_symtracking["text-line-height"]),"text-letter-spacing":new DataDrivenProperty(styleSpec.layout_symtracking["text-letter-spacing"]),"text-justify":new DataDrivenProperty(styleSpec.layout_symtracking["text-justify"]),"text-anchor":new DataDrivenProperty(styleSpec.layout_symtracking["text-anchor"]),"text-max-angle":new DataConstantProperty(styleSpec.layout_symtracking["text-max-angle"]),"text-rotate":new DataDrivenProperty(styleSpec.layout_symtracking["text-rotate"]),"text-padding":new DataConstantProperty(styleSpec.layout_symtracking["text-padding"]),"text-keep-upright":new DataConstantProperty(styleSpec.layout_symtracking["text-keep-upright"]),"text-transform":new DataDrivenProperty(styleSpec.layout_symtracking["text-transform"]),"text-offset":new DataDrivenProperty(styleSpec.layout_symtracking["text-offset"]),"text-allow-overlap":new DataConstantProperty(styleSpec.layout_symtracking["text-allow-overlap"]),"text-ignore-placement":new DataConstantProperty(styleSpec.layout_symtracking["text-ignore-placement"]),"text-optional":new DataConstantProperty(styleSpec.layout_symtracking["text-optional"]),"symtracking-time-segment":new DataConstantProperty(styleSpec.layout_symtracking["symtracking-time-segment"]),"symtracking-fps":new DataConstantProperty(styleSpec.layout_symtracking["symtracking-fps"]),"compatible-mode":new DataConstantProperty(styleSpec.layout_symtracking["compatible-mode"])}),paint=new Properties({"icon-opacity":new DataDrivenProperty(styleSpec.paint_symtracking["icon-opacity"]),"icon-color":new DataDrivenProperty(styleSpec.paint_symtracking["icon-color"]),"icon-halo-color":new DataDrivenProperty(styleSpec.paint_symtracking["icon-halo-color"]),"icon-halo-width":new DataDrivenProperty(styleSpec.paint_symtracking["icon-halo-width"]),"icon-halo-blur":new DataDrivenProperty(styleSpec.paint_symtracking["icon-halo-blur"]),"icon-translate":new DataConstantProperty(styleSpec.paint_symtracking["icon-translate"]),"icon-translate-anchor":new DataConstantProperty(styleSpec.paint_symtracking["icon-translate-anchor"]),"text-opacity":new DataDrivenProperty(styleSpec.paint_symtracking["text-opacity"]),"text-color":new DataDrivenProperty(styleSpec.paint_symtracking["text-color"]),"text-halo-color":new DataDrivenProperty(styleSpec.paint_symtracking["text-halo-color"]),"text-halo-width":new DataDrivenProperty(styleSpec.paint_symtracking["text-halo-width"]),"text-halo-blur":new DataDrivenProperty(styleSpec.paint_symtracking["text-halo-blur"]),"text-translate":new DataConstantProperty(styleSpec.paint_symtracking["text-translate"]),"text-translate-anchor":new DataConstantProperty(styleSpec.paint_symtracking["text-translate-anchor"]),"symtracking-delay":new DataConstantProperty(styleSpec.paint_symtracking["symtracking-delay"]),"render-3d":new DataConstantProperty(styleSpec.paint_symtracking["render-3d"]),"symtracking-height-offset":new DataConstantProperty(styleSpec.paint_symtracking["symtracking-height-offset"])});module.exports={paint:paint,layout:layout};
},{"../../style-spec/reference/latest":171,"../properties":208}],240:[function(_dereq_,module,exports){
"use strict";function getLineWidth(t,e){return e>0?e+2*t:t}function offsetLine(t,e){for(var r=[],i=new Point(0,0),a=0;a<t.length;a++){for(var n=t[a],o=[],u=0;u<n.length;u++){var l=n[u-1],s=n[u],p=n[u+1],c=0===u?i:s.sub(l)._unit()._perp(),y=u===n.length-1?i:p.sub(s)._unit()._perp(),f=c._add(y)._unit(),g=f.x*y.x+f.y*y.y;f._mult(1/g),o.push(f._mult(e)._add(s))}r.push(o)}return r}var Point=_dereq_("../../_minemap_/point-geometry"),StyleLayer=_dereq_("../style_layer"),LineBucket=_dereq_("../../data/bucket/tracking_bucket"),ref=_dereq_("../../util/intersection_tests"),multiPolygonIntersectsBufferedMultiLine=ref.multiPolygonIntersectsBufferedMultiLine,ref$1=_dereq_("../query_utils"),getMaximumPaintValue=ref$1.getMaximumPaintValue,translateDistance=ref$1.translateDistance,translate=ref$1.translate,properties=_dereq_("./tracking_style_layer_properties"),ref$2=_dereq_("../../util/util"),extend=ref$2.extend,EvaluationParameters=_dereq_("../evaluation_parameters"),ref$3=_dereq_("../properties"),Transitionable=ref$3.Transitionable,Transitioning=ref$3.Transitioning,Layout=ref$3.Layout,PossiblyEvaluated=ref$3.PossiblyEvaluated,DataDrivenProperty=ref$3.DataDrivenProperty,LineFloorwidthProperty=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.possiblyEvaluate=function(e,r){return r=new EvaluationParameters(Math.floor(r.zoom),{now:r.now,fadeDuration:r.fadeDuration,zoomHistory:r.zoomHistory,transition:r.transition}),t.prototype.possiblyEvaluate.call(this,e,r)},e.prototype.evaluate=function(e,r,i){return r=extend({},r,{zoom:Math.floor(r.zoom)}),t.prototype.evaluate.call(this,e,r,i)},e}(DataDrivenProperty),lineFloorwidthProperty=new LineFloorwidthProperty(properties.paint.properties["tracking-width"].specification);lineFloorwidthProperty.useIntegerZoom=!0;var TrackingStyleLayer=function(t){function e(e){t.call(this,e,properties)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.recalculate=function(e){t.prototype.recalculate.call(this,e),this.paint._values["tracking-floorwidth"]=lineFloorwidthProperty.possiblyEvaluate(this._transitioningPaint._values["tracking-width"].value,e)},e.prototype.createBucket=function(t){return new LineBucket(t)},e.prototype.queryRadius=function(t){var e=t,r=getLineWidth(getMaximumPaintValue("tracking-width",this,e),getMaximumPaintValue("tracking-gap-width",this,e)),i=getMaximumPaintValue("tracking-offset",this,e);return r/2+Math.abs(i)+translateDistance(this.paint.get("tracking-translate"))},e.prototype.queryIntersectsFeature=function(t,e,r,i,a,n){var o=translate(t,this.paint.get("tracking-translate"),this.paint.get("tracking-translate-anchor"),a.angle,n),u=n/2*getLineWidth(this.paint.get("tracking-width").evaluate(e),this.paint.get("tracking-gap-width").evaluate(e)),l=this.paint.get("tracking-offset").evaluate(e);return l&&(r=offsetLine(r,l*n)),multiPolygonIntersectsBufferedMultiLine(o,r,u)},e}(StyleLayer);module.exports=TrackingStyleLayer;
},{"../../_minemap_/point-geometry":29,"../../data/bucket/tracking_bucket":65,"../../util/intersection_tests":301,"../../util/util":315,"../evaluation_parameters":202,"../properties":208,"../query_utils":209,"../style_layer":211,"./tracking_style_layer_properties":241}],241:[function(_dereq_,module,exports){
"use strict";var styleSpec=_dereq_("../../style-spec/reference/latest"),ref=_dereq_("../properties"),Properties=ref.Properties,DataConstantProperty=ref.DataConstantProperty,DataDrivenProperty=ref.DataDrivenProperty,CrossFadedProperty=ref.CrossFadedProperty,HeatmapColorProperty=ref.HeatmapColorProperty,layout=new Properties({"tracking-cap":new DataConstantProperty(styleSpec.layout_tracking["tracking-cap"]),"tracking-join":new DataDrivenProperty(styleSpec.layout_tracking["tracking-join"]),"tracking-miter-limit":new DataConstantProperty(styleSpec.layout_tracking["tracking-miter-limit"]),"tracking-round-limit":new DataConstantProperty(styleSpec.layout_tracking["tracking-round-limit"]),"tracking-display-mode":new DataConstantProperty(styleSpec.layout_tracking["tracking-display-mode"])}),paint=new Properties({"tracking-opacity":new DataDrivenProperty(styleSpec.paint_tracking["tracking-opacity"]),"tracking-color":new DataDrivenProperty(styleSpec.paint_tracking["tracking-color"]),"tracking-translate":new DataConstantProperty(styleSpec.paint_tracking["tracking-translate"]),"tracking-translate-anchor":new DataConstantProperty(styleSpec.paint_tracking["tracking-translate-anchor"]),"tracking-width":new DataDrivenProperty(styleSpec.paint_tracking["tracking-width"]),"tracking-gap-width":new DataDrivenProperty(styleSpec.paint_tracking["tracking-gap-width"]),"tracking-offset":new DataDrivenProperty(styleSpec.paint_tracking["tracking-offset"]),"tracking-blur":new DataDrivenProperty(styleSpec.paint_tracking["tracking-blur"]),"tracking-type":new DataConstantProperty(styleSpec.paint_tracking["tracking-type"]),"tracking-seg-count":new DataConstantProperty(styleSpec.paint_tracking["tracking-seg-count"]),"tracking-seg-group":new DataConstantProperty(styleSpec.paint_tracking["tracking-seg-group"]),"tracking-speed":new DataConstantProperty(styleSpec.paint_tracking["tracking-speed"]),"tracking-delay":new DataConstantProperty(styleSpec.paint_tracking["tracking-delay"]),"tracking-speed-factor":new DataConstantProperty(styleSpec.paint_tracking["tracking-speed-factor"])});module.exports={paint:paint,layout:layout};
},{"../../style-spec/reference/latest":171,"../properties":208}],242:[function(_dereq_,module,exports){
"use strict";var StyleLayer=_dereq_("./style_layer"),util=_dereq_("../util/util"),featureFilter=_dereq_("../style-spec/feature_filter"),groupByLayout=_dereq_("../style-spec/group_by_layout"),StyleLayerIndex=function(e){e&&this.replace(e)};StyleLayerIndex.prototype.replace=function(e){this._layerConfigs={},this._layers={},this.update(e,[])},StyleLayerIndex.prototype.update=function(e,r){for(var t=this,a=0,i=e;a<i.length;a+=1){var l=i[a];t._layerConfigs[l.id]=l;var y=t._layers[l.id]=StyleLayer.create(l);y._featureFilter=featureFilter(y.filter)}for(var u=0,s=r;u<s.length;u+=1){var o=s[u];delete t._layerConfigs[o],delete t._layers[o]}this.familiesBySource={};for(var n=groupByLayout(util.values(this._layerConfigs)),f=0,p=n;f<p.length;f+=1){var c=p[f],_=c.map(function(e){return t._layers[e.id]}),d=_[0];if("none"!==d.visibility){var v=d.source||"",g=t.familiesBySource[v];g||(g=t.familiesBySource[v]={});var h=d.sourceLayer||"_geojsonTileLayer",L=g[h];L||(L=g[h]=[]),L.push(_)}}},module.exports=StyleLayerIndex;
},{"../style-spec/feature_filter":168,"../style-spec/group_by_layout":170,"../util/util":315,"./style_layer":211}],243:[function(_dereq_,module,exports){
"use strict";module.exports=_dereq_("../style-spec/validate_style.min");var Evented=_dereq_("../util/evented").Evented,Event=_dereq_("../util/evented").Event,ErrorEvent=_dereq_("../util/evented").ErrorEvent;module.exports.emitErrors=function(e,r){if(r&&r.length){for(var t=0,n=r;t<n.length;t+=1){var i=n[t],v=i.message;e.fire(new ErrorEvent(new Error(v)))}return!0}return!1};
},{"../style-spec/validate_style.min":201,"../util/evented":295}],244:[function(_dereq_,module,exports){
"use strict";var ZoomHistory=function(){this.first=!0};ZoomHistory.prototype.update=function(o,t){var s=Math.floor(o);return this.first?(this.first=!1,this.lastIntegerZoom=s,this.lastIntegerZoomTime=0,this.lastZoom=o,this.lastFloorZoom=s,!0):(this.lastFloorZoom>s?(this.lastIntegerZoom=s+1,this.lastIntegerZoomTime=t):this.lastFloorZoom<s&&(this.lastIntegerZoom=s,this.lastIntegerZoomTime=t),o!==this.lastZoom&&(this.lastZoom=o,this.lastFloorZoom=s,!0))},module.exports=ZoomHistory;
},{}],245:[function(_dereq_,module,exports){
"use strict";var Point=_dereq_("../_minemap_/point-geometry"),ref=_dereq_("../util/web_worker_transfer"),register=ref.register,Anchor=function(t){function e(e,r,o,n){t.call(this,e,r),this.angle=o,void 0!==n&&(this.segment=n)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.clone=function(){return new e(this.x,this.y,this.angle,this.segment)},e}(Point);register("Anchor",Anchor),module.exports=Anchor;
},{"../_minemap_/point-geometry":29,"../util/web_worker_transfer":318}],246:[function(_dereq_,module,exports){
"use strict";function checkMaxAngle(e,t,a,r,n){if(void 0===t.segment)return!0;for(var i=t,s=t.segment+1,f=0;f>-a/2;){if(--s<0)return!1;f-=e[s].dist(i),i=e[s]}f+=e[s].dist(e[s+1]),s++;for(var l=[],o=0;f<a/2;){var u=e[s-1],c=e[s],g=e[s+1];if(!g)return!1;var h=u.angleTo(c)-c.angleTo(g);for(h=Math.abs((h+3*Math.PI)%(2*Math.PI)-Math.PI),l.push({distance:f,angleDelta:h}),o+=h;f-l[0].distance>r;)o-=l.shift().angleDelta;if(o>n)return!1;s++,f+=c.dist(g)}return!0}module.exports=checkMaxAngle;
},{}],247:[function(_dereq_,module,exports){
"use strict";function clipLine(n,x,y,o,e){for(var r=[],i=0;i<n.length;i++)for(var t=n[i],u=void 0,d=0;d<t.length-1;d++){var _=t[d],P=t[d+1];_.x<x&&P.x<x||(_.x<x?_=new Point(x,_.y+(P.y-_.y)*((x-_.x)/(P.x-_.x)))._round():P.x<x&&(P=new Point(x,_.y+(P.y-_.y)*((x-_.x)/(P.x-_.x)))._round()),_.y<y&&P.y<y||(_.y<y?_=new Point(_.x+(P.x-_.x)*((y-_.y)/(P.y-_.y)),y)._round():P.y<y&&(P=new Point(_.x+(P.x-_.x)*((y-_.y)/(P.y-_.y)),y)._round()),_.x>=o&&P.x>=o||(_.x>=o?_=new Point(o,_.y+(P.y-_.y)*((o-_.x)/(P.x-_.x)))._round():P.x>=o&&(P=new Point(o,_.y+(P.y-_.y)*((o-_.x)/(P.x-_.x)))._round()),_.y>=e&&P.y>=e||(_.y>=e?_=new Point(_.x+(P.x-_.x)*((e-_.y)/(P.y-_.y)),e)._round():P.y>=e&&(P=new Point(_.x+(P.x-_.x)*((e-_.y)/(P.y-_.y)),e)._round()),u&&_.equals(u[u.length-1])||(u=[_],r.push(u)),u.push(P)))))}return r}var Point=_dereq_("../_minemap_/point-geometry");module.exports=clipLine;
},{"../_minemap_/point-geometry":29}],248:[function(_dereq_,module,exports){
"use strict";var CollisionFeature=function(t,e,i,o,a,r,l,n,s,d,h){var u=l.top*n-s,f=l.bottom*n+s,c=l.left*n-s,x=l.right*n+s;if(this.boxStartIndex=t.length,d){var m=f-u,v=x-c;m>0&&(m=Math.max(10*n,m),this._addLineCollisionCircles(t,e,i,i.segment,v,m,o,a,r,h))}else t.emplaceBack(i.x,i.y,c,u,x,f,o,a,r,0,0);this.boxEndIndex=t.length};CollisionFeature.prototype._addLineCollisionCircles=function(t,e,i,o,a,r,l,n,s,d){var h=r/2,u=Math.floor(a/h),f=1+.4*Math.log(d)/Math.LN2,c=Math.floor(u*f/2),x=-r/2,m=i,v=o+1,C=x,b=-a/2,g=b-a/4;do{if(--v<0){if(C>b)return;v=0;break}C-=e[v].dist(m),m=e[v]}while(C>g);for(var p=e[v].dist(e[v+1]),M=-c;M<u+c;M++){var _=M*h,k=b+_;if(_<0&&(k+=_),_>a&&(k+=_-a),!(k<C)){for(;C+p<k;){if(C+=p,++v+1>=e.length)return;p=e[v].dist(e[v+1])}var y=k-C,F=e[v],L=e[v+1],B=L.sub(F)._unit()._mult(y)._add(F)._round(),I=Math.abs(k-x)<h?0:.8*(k-x);t.emplaceBack(B.x,B.y,-r/2,-r/2,r/2,r/2,l,n,s,r/2,I)}}},module.exports=CollisionFeature;
},{}],249:[function(_dereq_,module,exports){
"use strict";function markCollisionCircleUsed(i,e,t){i[e+4]=t?1:0}var Point=_dereq_("../_minemap_/point-geometry"),intersectionTests=_dereq_("../util/intersection_tests"),Grid=_dereq_("./grid_index"),glmatrix=_dereq_("../_minemap_/gl-matrix"),mat4=glmatrix.mat4,projection=_dereq_("../symbol/projection"),viewportPadding=100,CollisionIndex=function(i,e,t){void 0===e&&(e=new Grid(i.width+2*viewportPadding,i.height+2*viewportPadding,25)),void 0===t&&(t=new Grid(i.width+2*viewportPadding,i.height+2*viewportPadding,25)),this.transform=i,this.grid=e,this.ignoredGrid=t,this.pitchfactor=Math.cos(i._pitch)*i.cameraToCenterDistance,this.screenRightBoundary=i.width+viewportPadding,this.screenBottomBoundary=i.height+viewportPadding};CollisionIndex.prototype.placeCollisionBox=function(i,e,t,n){var r=this.projectAndGetPerspectiveRatio(n,i.anchorPointX,i.anchorPointY),o=t*r.perspectiveRatio,s=i.x1*o+r.point.x,a=i.y1*o+r.point.y,c=i.x2*o+r.point.x,p=i.y2*o+r.point.y;return!e&&this.grid.hitTest(s,a,c,p)?{box:[],offscreen:!1}:{box:[s,a,c,p],offscreen:this.isOffscreen(s,a,c,p)}},CollisionIndex.prototype.approximateTileDistance=function(i,e,t,n,r){var o=r?1:n/this.pitchfactor,s=i.lastSegmentViewportDistance*t;return i.prevTileDistance+s+(o-1)*s*Math.abs(Math.sin(e))},CollisionIndex.prototype.placeCollisionCircles=function(i,e,t,n,r,o,s,a,c,p,d,l,h){var f=this,g=[],x=this.projectAnchor(p,o.anchorX,o.anchorY),u={},v=c/24,y=o.lineOffsetX*c,m=o.lineOffsetY*c,I=new Point(o.anchorX,o.anchorY),P=projection.project(I,d).point,C=projection.placeFirstAndLastGlyph(v,a,y,m,!1,P,I,o,s,d,u,!0),w=!1,D=!0,j=x.perspectiveRatio*n,b=1/(n*t),T=0,k=0;C&&(T=this.approximateTileDistance(C.first.tileDistance,C.first.angle,b,x.cameraDistance,h),k=this.approximateTileDistance(C.last.tileDistance,C.last.angle,b,x.cameraDistance,h));for(var G=0;G<i.length;G+=5){var M=i[G],R=i[G+1],q=i[G+2],B=i[G+3];if(!C||B<-T||B>k)markCollisionCircleUsed(i,G,!1);else{var _=f.projectPoint(p,M,R),A=q*j;if(g.length>0){var O=_.x-g[g.length-4],U=_.y-g[g.length-3];if(A*A*2>O*O+U*U){if(G+8<i.length){var X=i[G+8];if(X>-T&&X<k){markCollisionCircleUsed(i,G,!1);continue}}}}var Y=G/5;if(g.push(_.x,_.y,A,Y),markCollisionCircleUsed(i,G,!0),D=D&&f.isOffscreen(_.x-A,_.y-A,_.x+A,_.y+A),!e&&f.grid.hitTestCircle(_.x,_.y,A)){if(!l)return{circles:[],offscreen:!1};w=!0}}}return{circles:w?[]:g,offscreen:D}},CollisionIndex.prototype.queryRenderedSymbols=function(i,e,t,n,r,o){var s=this,a={},c=[];if(0===i.length||0===this.grid.keysLength()&&0===this.ignoredGrid.keysLength())return c;for(var p=this.transform.calculatePosMatrix(e.toUnwrapped()),d=[],l=1/0,h=1/0,f=-1/0,g=-1/0,x=0;x<i.length;x++)for(var u=i[x],v=0;v<u.length;v++){var y=s.projectPoint(p,u[v].x,u[v].y);l=Math.min(l,y.x),h=Math.min(h,y.y),f=Math.max(f,y.x),g=Math.max(g,y.y),d.push(y)}for(var m=e.key,I=[],P=this.grid.query(l,h,f,g),C=0;C<P.length;C++)P[C].sourceID===r&&P[C].tileID===m&&o[P[C].bucketInstanceId]&&I.push(P[C].boxIndex);for(var w=this.ignoredGrid.query(l,h,f,g),D=0;D<w.length;D++)w[D].sourceID===r&&w[D].tileID===m&&o[w[D].bucketInstanceId]&&I.push(w[D].boxIndex);for(var j=0;j<I.length;j++){var b=n.get(I[j]),T=b.sourceLayerIndex,k=b.featureIndex,G=b.bucketIndex;if(void 0===a[T]&&(a[T]={}),void 0===a[T][k]&&(a[T][k]={}),!a[T][k][G]){var M=s.projectAndGetPerspectiveRatio(p,b.anchorPointX,b.anchorPointY),R=t*M.perspectiveRatio,q=b.x1*R+M.point.x,B=b.y1*R+M.point.y,_=b.x2*R+M.point.x,A=b.y2*R+M.point.y,O=[new Point(q,B),new Point(_,B),new Point(_,A),new Point(q,A)];intersectionTests.polygonIntersectsPolygon(d,O)&&(a[T][k][G]=!0,c.push(I[j]))}}return c},CollisionIndex.prototype.insertCollisionBox=function(i,e,t,n,r,o){var s=e?this.ignoredGrid:this.grid,a={tileID:t,sourceID:n,bucketInstanceId:r,boxIndex:o};s.insert(a,i[0],i[1],i[2],i[3])},CollisionIndex.prototype.insertCollisionCircles=function(i,e,t,n,r,o){for(var s=e?this.ignoredGrid:this.grid,a=0;a<i.length;a+=4){var c={tileID:t,sourceID:n,bucketInstanceId:r,boxIndex:o+i[a+3]};s.insertCircle(c,i[a],i[a+1],i[a+2])}},CollisionIndex.prototype.projectAnchor=function(i,e,t){var n=[e,t,0,1];return projection.xyTransformMat4(n,n,i),{perspectiveRatio:.5+this.transform.cameraToCenterDistance/n[3]*.5,cameraDistance:n[3]}},CollisionIndex.prototype.projectPoint=function(i,e,t){var n=[e,t,0,1];return projection.xyTransformMat4(n,n,i),new Point((n[0]/n[3]+1)/2*this.transform.width+viewportPadding,(-n[1]/n[3]+1)/2*this.transform.height+viewportPadding)},CollisionIndex.prototype.projectAndGetPerspectiveRatio=function(i,e,t){var n=[e,t,0,1];return projection.xyTransformMat4(n,n,i),{point:new Point((n[0]/n[3]+1)/2*this.transform.width+viewportPadding,(-n[1]/n[3]+1)/2*this.transform.height+viewportPadding),perspectiveRatio:.5+this.transform.cameraToCenterDistance/n[3]*.5}},CollisionIndex.prototype.isOffscreen=function(i,e,t,n){return t<viewportPadding||i>=this.screenRightBoundary||n<viewportPadding||e>this.screenBottomBoundary},module.exports=CollisionIndex;
},{"../_minemap_/gl-matrix":27,"../_minemap_/point-geometry":29,"../symbol/projection":256,"../util/intersection_tests":301,"./grid_index":252}],250:[function(_dereq_,module,exports){
"use strict";var EXTENT=_dereq_("../data/extent"),SymbolBucket=_dereq_("../data/bucket/symbol_bucket"),SymtrackingBucket=_dereq_("../data/bucket/symtracking_bucket"),roundingFactor=512/EXTENT/2,TileLayerIndex=function(e,s,r){var n=this;this.tileID=e,this.indexedSymbolInstances={},this.bucketInstanceId=r;for(var t=0,o=s;t<o.length;t+=1){var i=o[t],a=i.key;n.indexedSymbolInstances[a]||(n.indexedSymbolInstances[a]=[]),n.indexedSymbolInstances[a].push({crossTileID:i.crossTileID,coord:n.getScaledCoordinates(i,e)})}};TileLayerIndex.prototype.getScaledCoordinates=function(e,s){var r=s.canonical.z-this.tileID.canonical.z,n=roundingFactor/Math.pow(2,r),t=e.anchor;return{x:Math.floor((s.canonical.x*EXTENT+t.x)*n),y:Math.floor((s.canonical.y*EXTENT+t.y)*n)}},TileLayerIndex.prototype.findMatches=function(e,s,r){for(var n=this,t=this.tileID.canonical.z<s.canonical.z?1:Math.pow(2,this.tileID.canonical.z-s.canonical.z),o=0,i=e;o<i.length;o+=1){var a=i[o];if(!a.crossTileID){var c=n.indexedSymbolInstances[a.key];if(c)for(var l=n.getScaledCoordinates(a,s),d=0,I=c;d<I.length;d+=1){var y=I[d];if(Math.abs(y.coord.x-l.x)<=t&&Math.abs(y.coord.y-l.y)<=t&&!r[y.crossTileID]){r[y.crossTileID]=!0,a.crossTileID=y.crossTileID;break}}}}};var CrossTileIDs=function(){this.maxCrossTileID=0};CrossTileIDs.prototype.generate=function(){return++this.maxCrossTileID};var CrossTileSymbolLayerIndex=function(){this.indexes={},this.usedCrossTileIDs={}};CrossTileSymbolLayerIndex.prototype.addBucket=function(e,s,r){var n=this;if(this.indexes[e.overscaledZ]&&this.indexes[e.overscaledZ][e.key]){if(this.indexes[e.overscaledZ][e.key].bucketInstanceId===s.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(e.overscaledZ,this.indexes[e.overscaledZ][e.key])}for(var t=0,o=s.symbolInstances;t<o.length;t+=1){o[t].crossTileID=0}this.usedCrossTileIDs[e.overscaledZ]||(this.usedCrossTileIDs[e.overscaledZ]={});var i=this.usedCrossTileIDs[e.overscaledZ];for(var a in n.indexes){var c=n.indexes[a];if(Number(a)>e.overscaledZ)for(var l in c){var d=c[l];d.tileID.isChildOf(e)&&d.findMatches(s.symbolInstances,e,i)}else{var I=e.scaledTo(Number(a)),y=c[I.key];y&&y.findMatches(s.symbolInstances,e,i)}}for(var u=0,v=s.symbolInstances;u<v.length;u+=1){var h=v[u];h.crossTileID||(h.crossTileID=r.generate(),i[h.crossTileID]=!0)}return void 0===this.indexes[e.overscaledZ]&&(this.indexes[e.overscaledZ]={}),this.indexes[e.overscaledZ][e.key]=new TileLayerIndex(e,s.symbolInstances,s.bucketInstanceId),!0},CrossTileSymbolLayerIndex.prototype.removeBucketCrossTileIDs=function(e,s){var r=this;for(var n in s.indexedSymbolInstances)for(var t=0,o=s.indexedSymbolInstances[n];t<o.length;t+=1){var i=o[t];delete r.usedCrossTileIDs[e][i.crossTileID]}},CrossTileSymbolLayerIndex.prototype.removeStaleBuckets=function(e){var s=this,r=!1;for(var n in s.indexes){var t=s.indexes[n];for(var o in t)e[t[o].bucketInstanceId]||(s.removeBucketCrossTileIDs(n,t[o]),delete t[o],r=!0)}return r};var CrossTileSymbolIndex=function(){this.layerIndexes={},this.crossTileIDs=new CrossTileIDs,this.maxBucketInstanceId=0};CrossTileSymbolIndex.prototype.addLayer=function(e,s){var r=this,n=this.layerIndexes[e.id];void 0===n&&(n=this.layerIndexes[e.id]=new CrossTileSymbolLayerIndex);for(var t=!1,o={},i=0,a=s;i<a.length;i+=1){var c=a[i],l=c.getBucket(e);(l instanceof SymbolBucket||l instanceof SymtrackingBucket)&&(l&&(l.bucketInstanceId||(l.bucketInstanceId=++r.maxBucketInstanceId),n.addBucket(c.tileID,l,r.crossTileIDs)&&(t=!0),o[l.bucketInstanceId]=!0))}return n.removeStaleBuckets(o)&&(t=!0),t},CrossTileSymbolIndex.prototype.pruneUnusedLayers=function(e){var s=this,r={};e.forEach(function(e){r[e]=!0});for(var n in s.layerIndexes)r[n]||delete s.layerIndexes[n]},module.exports=CrossTileSymbolIndex;
},{"../data/bucket/symbol_bucket":61,"../data/bucket/symtracking_bucket":63,"../data/extent":67}],251:[function(_dereq_,module,exports){
"use strict";function getAnchors(e,r,t,n,a,l,o,i,c){var h=n?.6*l*o:0,s=Math.max(n?n.right-n.left:0,a?a.right-a.left:0),u=0===e[0].x||e[0].x===c||0===e[0].y||e[0].y===c;r-s*o<r/4&&(r=s*o+r/4);var g=2*l;return resample(e,u?r/2*i%r:(s/2+g)*o*i%r,r,h,t,s*o,u,!1,c)}function resample(e,r,t,n,a,l,o,i,c){for(var h=l/2,s=0,u=0;u<e.length-1;u++)s+=e[u].dist(e[u+1]);for(var g=0,p=r-t,x=[],f=0;f<e.length-1;f++){for(var m=e[f],v=e[f+1],y=m.dist(v),A=v.angleTo(m);p+t<g+y;){p+=t;var d=(p-g)/y,k=interpolate(m.x,v.x,d),q=interpolate(m.y,v.y,d);if(k>=0&&k<c&&q>=0&&q<c&&p-h>=0&&p+h<=s){var M=new Anchor(k,q,A,f);M._round(),n&&!checkMaxAngle(e,M,l,n,a)||x.push(M)}}g+=y}return i||x.length||o||(x=resample(e,g/2,t,n,a,l,o,!0,c)),x}var interpolate=_dereq_("../style-spec/util/interpolate").number,Anchor=_dereq_("../symbol/anchor"),checkMaxAngle=_dereq_("./check_max_angle");module.exports=getAnchors;
},{"../style-spec/util/interpolate":178,"../symbol/anchor":245,"./check_max_angle":246}],252:[function(_dereq_,module,exports){
"use strict";var GridIndex=function(e,t,i){var r=this.boxCells=[],s=this.circleCells=[];this.xCellCount=Math.ceil(e/i),this.yCellCount=Math.ceil(t/i);for(var l=0;l<this.xCellCount*this.yCellCount;l++)r.push([]),s.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=e,this.height=t,this.xScale=this.xCellCount/e,this.yScale=this.yCellCount/t,this.boxUid=0,this.circleUid=0};GridIndex.prototype.keysLength=function(){return this.boxKeys.length+this.circleKeys.length},GridIndex.prototype.insert=function(e,t,i,r,s){this._forEachCell(t,i,r,s,this._insertBoxCell,this.boxUid++),this.boxKeys.push(e),this.bboxes.push(t),this.bboxes.push(i),this.bboxes.push(r),this.bboxes.push(s)},GridIndex.prototype.insertCircle=function(e,t,i,r){this._forEachCell(t-r,i-r,t+r,i+r,this._insertCircleCell,this.circleUid++),this.circleKeys.push(e),this.circles.push(t),this.circles.push(i),this.circles.push(r)},GridIndex.prototype._insertBoxCell=function(e,t,i,r,s,l){this.boxCells[s].push(l)},GridIndex.prototype._insertCircleCell=function(e,t,i,r,s,l){this.circleCells[s].push(l)},GridIndex.prototype._query=function(e,t,i,r,s){if(i<0||e>this.width||r<0||t>this.height)return!s&&[];var l=[];if(e<=0&&t<=0&&this.width<=i&&this.height<=r)l=Array.prototype.slice.call(this.boxKeys).concat(this.circleKeys);else{var o={hitTest:s,seenUids:{box:{},circle:{}}};this._forEachCell(e,t,i,r,this._queryCell,l,o)}return s?l.length>0:l},GridIndex.prototype._queryCircle=function(e,t,i,r){var s=e-i,l=e+i,o=t-i,h=t+i;if(l<0||s>this.width||h<0||o>this.height)return!r&&[];var n=[],c={hitTest:r,circle:{x:e,y:t,radius:i},seenUids:{box:{},circle:{}}};return this._forEachCell(s,o,l,h,this._queryCellCircle,n,c),r?n.length>0:n},GridIndex.prototype.query=function(e,t,i,r){return this._query(e,t,i,r,!1)},GridIndex.prototype.hitTest=function(e,t,i,r){return this._query(e,t,i,r,!0)},GridIndex.prototype.hitTestCircle=function(e,t,i){return this._queryCircle(e,t,i,!0)},GridIndex.prototype._queryCell=function(e,t,i,r,s,l,o){var h=this,n=o.seenUids,c=this.boxCells[s];if(null!==c)for(var u=this.bboxes,d=0,C=c;d<C.length;d+=1){var a=C[d];if(!n.box[a]){n.box[a]=!0;var x=4*a;if(e<=u[x+2]&&t<=u[x+3]&&i>=u[x+0]&&r>=u[x+1]){if(o.hitTest)return l.push(!0),!0;l.push(h.boxKeys[a])}}}var p=this.circleCells[s];if(null!==p)for(var f=this.circles,y=0,v=p;y<v.length;y+=1){var b=v[y];if(!n.circle[b]){n.circle[b]=!0;var _=3*b;if(h._circleAndRectCollide(f[_],f[_+1],f[_+2],e,t,i,r)){if(o.hitTest)return l.push(!0),!0;l.push(h.circleKeys[b])}}}},GridIndex.prototype._queryCellCircle=function(e,t,i,r,s,l,o){var h=this,n=o.circle,c=o.seenUids,u=this.boxCells[s];if(null!==u)for(var d=this.bboxes,C=0,a=u;C<a.length;C+=1){var x=a[C];if(!c.box[x]){c.box[x]=!0;var p=4*x;if(h._circleAndRectCollide(n.x,n.y,n.radius,d[p+0],d[p+1],d[p+2],d[p+3]))return l.push(!0),!0}}var f=this.circleCells[s];if(null!==f)for(var y=this.circles,v=0,b=f;v<b.length;v+=1){var _=b[v];if(!c.circle[_]){c.circle[_]=!0;var G=3*_;if(h._circlesCollide(y[G],y[G+1],y[G+2],n.x,n.y,n.radius))return l.push(!0),!0}}},GridIndex.prototype._forEachCell=function(e,t,i,r,s,l,o){for(var h=this,n=this._convertToXCellCoord(e),c=this._convertToYCellCoord(t),u=this._convertToXCellCoord(i),d=this._convertToYCellCoord(r),C=n;C<=u;C++)for(var a=c;a<=d;a++){var x=h.xCellCount*a+C;if(s.call(h,e,t,i,r,x,l,o))return}},GridIndex.prototype._convertToXCellCoord=function(e){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(e*this.xScale)))},GridIndex.prototype._convertToYCellCoord=function(e){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(e*this.yScale)))},GridIndex.prototype._circlesCollide=function(e,t,i,r,s,l){var o=r-e,h=s-t,n=i+l;return n*n>o*o+h*h},GridIndex.prototype._circleAndRectCollide=function(e,t,i,r,s,l,o){var h=(l-r)/2,n=Math.abs(e-(r+h));if(n>h+i)return!1;var c=(o-s)/2,u=Math.abs(t-(s+c));if(u>c+i)return!1;if(n<=h||u<=c)return!0;var d=n-h,C=u-c;return d*d+C*C<=i*i},module.exports=GridIndex;
},{}],253:[function(_dereq_,module,exports){
"use strict";module.exports=function(e){function t(t){g.push(e[t]),l++}function r(e,t,r){var n=u[e];return delete u[e],u[t]=n,g[n].geometry[0].pop(),g[n].geometry[0]=g[n].geometry[0].concat(r[0]),n}function n(e,t,r){var n=i[t];return delete i[t],i[e]=n,g[n].geometry[0].shift(),g[n].geometry[0]=r[0].concat(g[n].geometry[0]),n}function o(e,t,r){var n=r?t[0][t[0].length-1]:t[0][0];return e+":"+n.x+":"+n.y}for(var i={},u={},g=[],l=0,m=0;m<e.length;m++){var y=e[m],c=y.geometry,f=y.text;if(f){var a=o(f,c),s=o(f,c,!0);if(a in u&&s in i&&u[a]!==i[s]){var v=n(a,s,c),d=r(a,s,g[v].geometry);delete i[a],delete u[s],u[o(f,g[d].geometry,!0)]=d,g[v].geometry=null}else a in u?r(a,s,c):s in i?n(a,s,c):(t(m),i[a]=l-1,u[s]=l-1)}else t(m)}return g.filter(function(e){return e.geometry})};
},{}],254:[function(_dereq_,module,exports){
"use strict";var ref=_dereq_("../util/web_worker_transfer"),register=ref.register,OpacityState=function(){this.opacity=0,this.targetOpacity=0,this.time=0};OpacityState.prototype.clone=function(){var t=new OpacityState;return t.opacity=this.opacity,t.targetOpacity=this.targetOpacity,t.time=this.time,t},register("OpacityState",OpacityState),module.exports=OpacityState;
},{"../util/web_worker_transfer":318}],255:[function(_dereq_,module,exports){
"use strict";function updateCollisionVertices(t,e,i){t.emplaceBack(e?1:0,i?1:0),t.emplaceBack(e?1:0,i?1:0),t.emplaceBack(e?1:0,i?1:0),t.emplaceBack(e?1:0,i?1:0)}function packOpacity(t){if(0===t.opacity&&!t.placed)return 0;if(1===t.opacity&&t.placed)return 4294967295;var e=t.placed?1:0,i=Math.floor(127*t.opacity);return i*shift25+e*shift24+i*shift17+e*shift16+i*shift9+e*shift8+i*shift1+e}var CollisionIndex=_dereq_("./collision_index"),EXTENT=_dereq_("../data/extent"),symbolSize=_dereq_("./symbol_size"),projection=_dereq_("./projection"),symbolLayoutProperties=_dereq_("../style/style_layer/symbol_style_layer_properties").layout,pixelsToTileUnits=_dereq_("../source/pixels_to_tile_units"),SymbolBucket=_dereq_("../data/bucket/symbol_bucket"),SymtrackingBucket=_dereq_("../data/bucket/symtracking_bucket"),OpacityState=function(t,e,i,o){this.opacity=t?Math.max(0,Math.min(1,t.opacity+(t.placed?e:-e))):o&&i?1:0,this.placed=i};OpacityState.prototype.isHidden=function(){return 0===this.opacity&&!this.placed};var JointOpacityState=function(t,e,i,o,a){this.text=new OpacityState(t?t.text:null,e,i,a),this.icon=new OpacityState(t?t.icon:null,e,o,a)};JointOpacityState.prototype.isHidden=function(){return this.text.isHidden()&&this.icon.isHidden()};var JointPlacement=function(t,e,i){this.text=t,this.icon=e,this.skipFade=i},Placement=function(t,e){this.transform=t.clone(),this.collisionIndex=new CollisionIndex(this.transform),this.placements={},this.opacities={},this.stale=!1,this.fadeDuration=0};Placement.prototype.placeLayerTile=function(t,e,i,o){var a=e.getBucket(t);if(a){var l=a.layers[0].layout,n=Math.pow(2,this.transform.zoom-e.tileID.overscaledZ),r=e.tileSize/EXTENT,c=this.transform.calculatePosMatrix(e.tileID.toUnwrapped()),s=projection.getLabelPlaneMatrix(c,"map"===l.get("text-pitch-alignment"),"map"===l.get("text-rotation-alignment"),this.transform,pixelsToTileUnits(e,1,this.transform.zoom)),p=projection.getLabelPlaneMatrix(c,"map"===l.get("icon-pitch-alignment"),"map"===l.get("icon-rotation-alignment"),this.transform,pixelsToTileUnits(e,1,this.transform.zoom));this.placeLayerBucket(a,c,s,p,n,r,i,o,e.collisionBoxArray,e.tileID.key,t.source)}},Placement.prototype.placeLayerBucket=function(t,e,i,o,a,l,n,r,c,s,p){var x=this;if(t instanceof SymbolBucket||t instanceof SymtrackingBucket){for(var y=t.layers[0].layout,m=symbolSize.evaluateSizeForZoom(t.textSizeData,this.transform.zoom,symbolLayoutProperties.properties["text-size"]),u=!t.hasTextData()||y.get("text-optional"),h=!t.hasIconData()||y.get("icon-optional"),d=0,f=t.symbolInstances;d<f.length;d+=1){var B=f[d];if(!r[B.crossTileID]){var g=void 0!==B.feature.text,I=void 0!==B.feature.icon,v=!0,C=null,D=null,S=null;B.collisionArrays||(B.collisionArrays=t.deserializeCollisionBoxes(c,B.textBoxStartIndex,B.textBoxEndIndex,B.iconBoxStartIndex,B.iconBoxEndIndex)),B.collisionArrays.textBox&&(C=x.collisionIndex.placeCollisionBox(B.collisionArrays.textBox,y.get("text-allow-overlap"),l,e),g=C.box.length>0,v=v&&C.offscreen);var T=B.collisionArrays.textCircles;if(T){var V=t.text.placedSymbolArray.get(B.placedTextSymbolIndices[0]),b=symbolSize.evaluateSizeForFeature(t.textSizeData,m,V);D=x.collisionIndex.placeCollisionCircles(T,y.get("text-allow-overlap"),a,l,B.key,V,t.lineVertexArray,t.glyphOffsetArray,b,e,i,n,"map"===y.get("text-pitch-alignment")),g=y.get("text-allow-overlap")||D.circles.length>0,v=v&&D.offscreen}B.collisionArrays.iconBox&&(S=x.collisionIndex.placeCollisionBox(B.collisionArrays.iconBox,y.get("icon-allow-overlap"),l,e),I=S.box.length>0,v=v&&S.offscreen),u||h?h?u||(I=I&&g):g=I&&g:I=g=I&&g,g&&C&&x.collisionIndex.insertCollisionBox(C.box,y.get("text-ignore-placement"),s,p,t.bucketInstanceId,B.textBoxStartIndex),I&&S&&x.collisionIndex.insertCollisionBox(S.box,y.get("icon-ignore-placement"),s,p,t.bucketInstanceId,B.iconBoxStartIndex),g&&D&&x.collisionIndex.insertCollisionCircles(D.circles,y.get("text-ignore-placement"),s,p,t.bucketInstanceId,B.textBoxStartIndex),x.placements[B.crossTileID]=new JointPlacement(g,I,v||t.justReloaded),r[B.crossTileID]=!0}}t.justReloaded=!1}},Placement.prototype.commit=function(t,e){var i=this;this.commitTime=e;var o=!1,a=t&&0!==this.fadeDuration?(this.commitTime-t.commitTime)/this.fadeDuration:1,l=t?t.opacities:{};for(var n in i.placements){var r=i.placements[n],c=l[n];c?(i.opacities[n]=new JointOpacityState(c,a,r.text,r.icon),o=o||r.text!==c.text.placed||r.icon!==c.icon.placed):(i.opacities[n]=new JointOpacityState(null,a,r.text,r.icon,r.skipFade),o=o||r.text||r.icon)}for(var s in l){var p=l[s];if(!i.opacities[s]){var x=new JointOpacityState(p,a,!1,!1);x.isHidden()||(i.opacities[s]=x,o=o||p.text.placed||p.icon.placed)}}o?this.lastPlacementChangeTime=e:"number"!=typeof this.lastPlacementChangeTime&&(this.lastPlacementChangeTime=t?t.lastPlacementChangeTime:e)},Placement.prototype.updateLayerOpacities=function(t,e){for(var i=this,o={},a=0,l=e;a<l.length;a+=1){var n=l[a],r=n.getBucket(t);r&&i.updateBucketOpacities(r,o,n.collisionBoxArray)}},Placement.prototype.updateBucketOpacities=function(t,e,i){var o=this;t.hasTextData()&&t.text.opacityVertexArray.clear(),t.hasIconData()&&t.icon.opacityVertexArray.clear(),t.hasCollisionBoxData()&&t.collisionBox.collisionVertexArray.clear(),t.hasCollisionCircleData()&&t.collisionCircle.collisionVertexArray.clear();for(var a=t.layers[0].layout,l=new JointOpacityState(null,0,!1,!1,!0),n=new JointOpacityState(null,0,a.get("text-allow-overlap"),a.get("icon-allow-overlap"),!0),r=0;r<t.symbolInstances.length;r++){var c=t.symbolInstances[r],s=e[c.crossTileID],p=o.opacities[c.crossTileID];s?p=l:p||(p=n,o.opacities[c.crossTileID]=p),e[c.crossTileID]=!0;var x=c.numGlyphVertices>0||c.numVerticalGlyphVertices>0,y=c.numIconVertices>0;if(x){for(var m=packOpacity(p.text),u=(c.numGlyphVertices+c.numVerticalGlyphVertices)/4,h=0;h<u;h++)t.text.opacityVertexArray.emplaceBack(m);for(var d=0,f=c.placedTextSymbolIndices;d<f.length;d+=1){var B=f[d];t.text.placedSymbolArray.get(B).hidden=p.text.isHidden()}}if(y){for(var g=packOpacity(p.icon),I=0;I<c.numIconVertices/4;I++)t.icon.opacityVertexArray.emplaceBack(g);t.icon.placedSymbolArray.get(r).hidden=p.icon.isHidden()}c.collisionArrays||(c.collisionArrays=t.deserializeCollisionBoxes(i,c.textBoxStartIndex,c.textBoxEndIndex,c.iconBoxStartIndex,c.iconBoxEndIndex));var v=c.collisionArrays;if(v){v.textBox&&t.hasCollisionBoxData()&&updateCollisionVertices(t.collisionBox.collisionVertexArray,p.text.placed,!1),v.iconBox&&t.hasCollisionBoxData()&&updateCollisionVertices(t.collisionBox.collisionVertexArray,p.icon.placed,!1);var C=v.textCircles;if(C&&t.hasCollisionCircleData())for(var D=0;D<C.length;D+=5){var S=s||0===C[D+4];updateCollisionVertices(t.collisionCircle.collisionVertexArray,p.text.placed,S)}}}t.sortFeatures(this.transform.angle),t.hasTextData()&&t.text.opacityVertexBuffer&&t.text.opacityVertexBuffer.updateData(t.text.opacityVertexArray),t.hasIconData()&&t.icon.opacityVertexBuffer&&t.icon.opacityVertexBuffer.updateData(t.icon.opacityVertexArray),t.hasCollisionBoxData()&&t.collisionBox.collisionVertexBuffer&&t.collisionBox.collisionVertexBuffer.updateData(t.collisionBox.collisionVertexArray),t.hasCollisionCircleData()&&t.collisionCircle.collisionVertexBuffer&&t.collisionCircle.collisionVertexBuffer.updateData(t.collisionCircle.collisionVertexArray)},Placement.prototype.symbolFadeChange=function(t){return 0===this.fadeDuration?1:(t-this.commitTime)/this.fadeDuration},Placement.prototype.hasTransitions=function(t){return this.stale||t-this.lastPlacementChangeTime<this.fadeDuration},Placement.prototype.stillRecent=function(t){return"undefined"!==this.commitTime&&this.commitTime+this.fadeDuration>t},Placement.prototype.setStale=function(){this.stale=!0};var shift25=Math.pow(2,25),shift24=Math.pow(2,24),shift17=Math.pow(2,17),shift16=Math.pow(2,16),shift9=Math.pow(2,9),shift8=Math.pow(2,8),shift1=Math.pow(2,1);module.exports=Placement;
},{"../data/bucket/symbol_bucket":61,"../data/bucket/symtracking_bucket":63,"../data/extent":67,"../source/pixels_to_tile_units":125,"../style/style_layer/symbol_style_layer_properties":237,"./collision_index":249,"./projection":256,"./symbol_size":260}],256:[function(_dereq_,module,exports){
"use strict";function getLabelPlaneMatrix(e,t,r,n,a){var i=mat4.identity(new Float32Array(16));return t?(mat4.identity(i),mat4.scale(i,i,[1/a,1/a,1]),r||mat4.rotateZ(i,i,n.angle)):(mat4.scale(i,i,[n.width/2,-n.height/2,1]),mat4.translate(i,i,[1,-1,0]),mat4.multiply(i,i,e)),i}function getGlCoordMatrix(e,t,r,n,a){var i=mat4.identity(new Float32Array(16));return t?(mat4.multiply(i,i,e),mat4.scale(i,i,[a,a,1]),r||mat4.rotateZ(i,i,-n.angle)):(mat4.scale(i,i,[1,-1,1]),mat4.translate(i,i,[-1,-1,0]),mat4.scale(i,i,[2/n.width,2/n.height,1])),i}function project(e,t){var r=[e.x,e.y,0,1];xyTransformMat4(r,r,t);var n=r[3];return{point:new Point(r[0]/n,r[1]/n),signedDistanceFromCamera:n}}function isVisible(e,t){var r=e[0]/e[3],n=e[1]/e[3];return r>=-t[0]&&r<=t[0]&&n>=-t[1]&&n<=t[1]}function updateLineLabels(e,t,r,n,a,i,o,l){if(e instanceof SymbolBucket||e instanceof SymtrackingBucket){var s=n?e.textSizeData:e.iconSizeData,u=symbolSize.evaluateSizeForZoom(s,r.transform.zoom,symbolLayoutProperties.properties[n?"text-size":"icon-size"]),p=[256/r.width*2+1,256/r.height*2+1],c=n?e.text.dynamicLayoutVertexArray:e.icon.dynamicLayoutVertexArray;c.clear();for(var y=e.lineVertexArray,m=n?e.text.placedSymbolArray:e.icon.placedSymbolArray,d=r.transform.width/r.transform.height,g=!1,h=0;h<m.length;h++){var f=m.get(h);if(f.hidden||f.writingMode===WritingMode.vertical&&!g)hideGlyphs(f.numGlyphs,c);else{g=!1;var x=[f.anchorX,f.anchorY,0,1];if(vec4.transformMat4(x,x,t),isVisible(x,p)){var v=x[3],b=.5+v/r.transform.cameraToCenterDistance*.5,L=symbolSize.evaluateSizeForFeature(s,u,f),S=o?L*b:L/b,A=new Point(f.anchorX,f.anchorY),G=project(A,a).point,M={},_=placeGlyphsAlongLine(f,S,!1,l,t,a,i,e.glyphOffsetArray,y,c,G,A,M,d);g=_.useVertical,(_.notEnoughRoom||g||_.needsFlipping&&placeGlyphsAlongLine(f,S,!0,l,t,a,i,e.glyphOffsetArray,y,c,G,A,M,d).notEnoughRoom)&&hideGlyphs(f.numGlyphs,c)}else hideGlyphs(f.numGlyphs,c)}}n?e.text.dynamicLayoutVertexBuffer.updateData(c):e.icon.dynamicLayoutVertexBuffer.updateData(c)}}function placeFirstAndLastGlyph(e,t,r,n,a,i,o,l,s,u,p,c){var y=l.glyphStartIndex+l.numGlyphs,m=l.lineStartIndex,d=l.lineStartIndex+l.lineLength,g=t.getoffsetX(l.glyphStartIndex),h=t.getoffsetX(y-1),f=placeGlyphAlongLine(e*g,r,n,a,i,o,l.segment,m,d,s,u,p,c);if(!f)return null;var x=placeGlyphAlongLine(e*h,r,n,a,i,o,l.segment,m,d,s,u,p,c);return x?{first:f,last:x}:null}function requiresOrientationChange(e,t,r,n){if(e===WritingMode.horizontal){if(Math.abs(r.y-t.y)>Math.abs(r.x-t.x)*n)return{useVertical:!0}}return(e===WritingMode.vertical?t.y<r.y:t.x>r.x)?{needsFlipping:!0}:null}function placeGlyphsAlongLine(e,t,r,n,a,i,o,l,s,u,p,c,y,m){var d,g=t/24,h=e.lineOffsetX*t,f=e.lineOffsetY*t;if(e.numGlyphs>1){var x=e.glyphStartIndex+e.numGlyphs,v=e.lineStartIndex,b=e.lineStartIndex+e.lineLength,L=placeFirstAndLastGlyph(g,l,h,f,r,p,c,e,s,i,y,!1);if(!L)return{notEnoughRoom:!0};var S=project(L.first.point,o).point,A=project(L.last.point,o).point;if(n&&!r){var G=requiresOrientationChange(e.writingMode,S,A,m);if(G)return G}d=[L.first];for(var M=e.glyphStartIndex+1;M<x-1;M++)d.push(placeGlyphAlongLine(g*l.getoffsetX(M),h,f,r,p,c,e.segment,v,b,s,i,y,!1));d.push(L.last)}else{if(n&&!r){var _=project(c,a).point,w=e.lineStartIndex+e.segment+1,F=new Point(s.getx(w),s.gety(w)),D=project(F,a),I=D.signedDistanceFromCamera>0?D.point:projectTruncatedLineSegment(c,F,_,1,a),j=requiresOrientationChange(e.writingMode,_,I,m);if(j)return j}var k=placeGlyphAlongLine(g*l.getoffsetX(e.glyphStartIndex),h,f,r,p,c,e.segment,e.lineStartIndex,e.lineStartIndex+e.lineLength,s,i,y,!1);if(!k)return{notEnoughRoom:!0};d=[k]}for(var z=0,P=d;z<P.length;z+=1){var q=P[z];addDynamicAttributes(u,q.point,q.angle)}return{}}function projectTruncatedLineSegment(e,t,r,n,a){var i=project(e.add(e.sub(t)._unit()),a).point,o=r.sub(i);return r.add(o._mult(n/o.mag()))}function placeGlyphAlongLine(e,t,r,n,a,i,o,l,s,u,p,c,y){var m=n?e-t:e+t,d=m>0?1:-1,g=0;n&&(d*=-1,g=Math.PI),d<0&&(g+=Math.PI);for(var h=d>0?l+o:l+o+1,f=h,x=a,v=a,b=0,L=0,S=Math.abs(m);b+L<=S;){if((h+=d)<l||h>=s)return null;if(v=x,void 0===(x=c[h])){var A=new Point(u.getx(h),u.gety(h)),G=project(A,p);if(G.signedDistanceFromCamera>0)x=c[h]=G.point;else{var M=h-d;x=projectTruncatedLineSegment(0===b?i:new Point(u.getx(M),u.gety(M)),A,v,S-b+1,p)}}b+=L,L=v.dist(x)}var _=(S-b)/L,w=x.sub(v),F=w.mult(_)._add(v);return F._add(w._unit()._perp()._mult(r*d)),{point:F,angle:g+Math.atan2(x.y-v.y,x.x-v.x),tileDistance:y?{prevTileDistance:h-d===f?0:u.gettileUnitDistanceFromAnchor(h-d),lastSegmentViewportDistance:S-b}:null}}function hideGlyphs(e,t){for(var r=0;r<e;r++){var n=t.length;t.resize(n+4),t.float32.set(hiddenGlyphAttributes,3*n)}}function xyTransformMat4(e,t,r){var n=t[0],a=t[1];return e[0]=r[0]*n+r[4]*a+r[12],e[1]=r[1]*n+r[5]*a+r[13],e[3]=r[3]*n+r[7]*a+r[15],e}var Point=_dereq_("../_minemap_/point-geometry"),ref=_dereq_("../_minemap_/gl-matrix"),mat4=ref.mat4,vec4=ref.vec4,symbolSize=_dereq_("./symbol_size"),ref$1=_dereq_("../data/bucket/symbol_bucket"),addDynamicAttributes=ref$1.addDynamicAttributes,symbolLayoutProperties=_dereq_("../style/style_layer/symbol_style_layer_properties").layout,SymbolBucket=_dereq_("../data/bucket/symbol_bucket"),SymtrackingBucket=_dereq_("../data/bucket/symtracking_bucket"),WritingMode=_dereq_("../symbol/shaping").WritingMode;module.exports={updateLineLabels:updateLineLabels,getLabelPlaneMatrix:getLabelPlaneMatrix,getGlCoordMatrix:getGlCoordMatrix,project:project,placeFirstAndLastGlyph:placeFirstAndLastGlyph,xyTransformMat4:xyTransformMat4};var hiddenGlyphAttributes=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);
},{"../_minemap_/gl-matrix":27,"../_minemap_/point-geometry":29,"../data/bucket/symbol_bucket":61,"../data/bucket/symtracking_bucket":63,"../style/style_layer/symbol_style_layer_properties":237,"../symbol/shaping":258,"./symbol_size":260}],257:[function(_dereq_,module,exports){
"use strict";function getIconQuads(t,e,i,o,n,a,r){var l,g,u,c,p=e.image,d=i.layout,s=e.top-1/p.pixelRatio,f=e.left-1/p.pixelRatio,h=e.bottom+1/p.pixelRatio,x=e.right+1/p.pixelRatio;if("none"!==d.get("icon-text-fit")&&n){var y=x-f,P=h-s,m=d.get("text-size").evaluate(r)/24,_=n.left*m,w=n.right*m,M=n.top*m,v=n.bottom*m,R=w-_,b=v-M,B=d.get("icon-text-fit-padding")[0],I=d.get("icon-text-fit-padding")[1],A=d.get("icon-text-fit-padding")[2],G=d.get("icon-text-fit-padding")[3],O="width"===d.get("icon-text-fit")?.5*(b-P):0,Q="height"===d.get("icon-text-fit")?.5*(R-y):0,k="width"===d.get("icon-text-fit")||"both"===d.get("icon-text-fit")?R:y,D="height"===d.get("icon-text-fit")||"both"===d.get("icon-text-fit")?b:P;l=new Point(_+Q-G,M+O-B),g=new Point(_+Q+I+k,M+O-B),u=new Point(_+Q+I+k,M+O+A+D),c=new Point(_+Q-G,M+O+A+D)}else l=new Point(f,s),g=new Point(x,s),u=new Point(x,h),c=new Point(f,h);var E;if(E="symtracking"!==i.type||i.layout.get("compatible-mode")?"symtracking"===i.type?calcAngleByProperties(r,0):"symbol"===i.type&&i.paint.get("render-road-mark")?calcAngleByProperties(r,Math.PI/2):i.layout.get("icon-rotate").evaluate(r)*Math.PI/180:r.properties.car_rotate*Math.PI/180){var F=Math.sin(E),H=Math.cos(E),L=[H,-F,F,H];l._matMult(L),g._matMult(L),c._matMult(L),u._matMult(L)}return[{tl:l,tr:g,bl:c,br:u,tex:{x:p.textureRect.x-1,y:p.textureRect.y-1,w:p.textureRect.w+2,h:p.textureRect.h+2},writingMode:void 0,glyphOffset:[0,0]}]}function getGlyphQuads(t,e,i,o,n,a,r){for(var l=i.layout.get("text-rotate").evaluate(a)*Math.PI/180,g=i.layout.get("text-offset").evaluate(a).map(function(t){return 24*t}),u=e.positionedGlyphs,c=[],p=0;p<u.length;p++){var d=u[p],s=r[d.glyph];if(s){var f=s.rect;if(f){var h=GLYPH_PBF_BORDER+1,x=s.metrics.advance/2,y=o?[d.x+x,d.y]:[0,0],P=o?[0,0]:[d.x+x+g[0],d.y+g[1]],m=s.metrics.left-h-x+P[0],_=-s.metrics.top-h+P[1],w=m+f.w,M=_+f.h,v=new Point(m,_),R=new Point(w,_),b=new Point(m,M),B=new Point(w,M);if(o&&d.vertical){var I=new Point(-x,x),A=-Math.PI/2,G=new Point(5,0);v._rotateAround(A,I)._add(G),R._rotateAround(A,I)._add(G),b._rotateAround(A,I)._add(G),B._rotateAround(A,I)._add(G)}if(l){var O=Math.sin(l),Q=Math.cos(l),k=[Q,-O,O,Q];v._matMult(k),R._matMult(k),b._matMult(k),B._matMult(k)}c.push({tl:v,tr:R,bl:b,br:B,tex:f,writingMode:e.writingMode,glyphOffset:y})}}}return c}function calcAngleByProperties(t,e){var i=t.geometry[0];return i.length>2&&(!t.properties.hasOwnProperty("name")||-1===t.properties.name.indexOf(""))?0:1===i.length?0:i[1].angleTo(i[0])+(e||0)}var Point=_dereq_("../_minemap_/point-geometry"),ref=_dereq_("../style/parse_glyph_pbf"),GLYPH_PBF_BORDER=ref.GLYPH_PBF_BORDER;module.exports={getIconQuads:getIconQuads,getGlyphQuads:getGlyphQuads};
},{"../_minemap_/point-geometry":29,"../style/parse_glyph_pbf":206}],258:[function(_dereq_,module,exports){
"use strict";function breakLines(e,t){for(var a=[],r=0,i=0,n=t;i<n.length;i+=1){var l=n[i];a.push(e.substring(r,l)),r=l}return r<e.length&&a.push(e.substring(r,e.length)),a}function shapeText(e,t,a,r,i,n,l,o,c,s){var h=e.trim();s===WritingMode.vertical&&(h=verticalizePunctuation(h));var g,u=[],p={positionedGlyphs:u,text:h,top:o[1],bottom:o[1],left:o[0],right:o[0],writingMode:s};return g=breakLines(h,determineLineBreaks(h,l,a,t)),shapeLines(p,t,g,r,i,n,s,l,c),!!u.length&&p}function determineAverageLineWidth(e,t,a,r){for(var i=0,n=0;n<e.length;n++){var l=r[e.charCodeAt(n)];l&&(i+=l.metrics.advance+t)}return i/Math.max(1,Math.ceil(i/a))}function calculateBadness(e,t,a,r){var i=Math.pow(e-t,2);return r?e<t?i/2:2*i:i+Math.abs(a)*a}function calculatePenalty(e,t){var a=0;return 10===e&&(a-=1e4),40!==e&&65288!==e||(a+=50),41!==t&&65289!==t||(a+=50),a}function evaluateBreak(e,t,a,r,i,n){for(var l=null,o=calculateBadness(t,a,i,n),c=0,s=r;c<s.length;c+=1){var h=s[c],g=t-h.x,u=calculateBadness(g,a,i,n)+h.badness;u<=o&&(l=h,o=u)}return{index:e,x:t,priorBreak:l,badness:o}}function leastBadBreaks(e){return e?leastBadBreaks(e.priorBreak).concat(e.index):[]}function determineLineBreaks(e,t,a,r){if(!a)return[];if(!e)return[];for(var i=[],n=determineAverageLineWidth(e,t,a,r),l=0,o=0;o<e.length;o++){var c=e.charCodeAt(o),s=r[c];s&&!whitespace[c]&&(l+=s.metrics.advance+t),o<e.length-1&&(breakable[c]||scriptDetection.charAllowsIdeographicBreaking(c))&&i.push(evaluateBreak(o+1,l,n,i,calculatePenalty(c,e.charCodeAt(o+1)),!1))}return leastBadBreaks(evaluateBreak(e.length,l,n,i,0,!0))}function getAnchorAlignment(e){var t=.5,a=.5;switch(e){case"right":case"top-right":case"bottom-right":t=1;break;case"left":case"top-left":case"bottom-left":t=0}switch(e){case"bottom":case"bottom-right":case"bottom-left":a=1;break;case"top":case"top-right":case"top-left":a=0}return{horizontalAlign:t,verticalAlign:a}}function shapeLines(e,t,a,r,i,n,l,o,c){for(var s=0,h=-17,g=0,u=e.positionedGlyphs,p="right"===n?1:"left"===n?0:.5,b=0,v=a;b<v.length;b+=1){var d=v[b];if(d=d.trim(),d.length){for(var f=u.length,k=0;k<d.length;k++){var m=d.charCodeAt(k),A=t[m];A&&(scriptDetection.charHasUprightVerticalOrientation(m)&&l!==WritingMode.horizontal?(u.push({glyph:m,x:s,y:0,vertical:!0}),s+=c+o):(u.push({glyph:m,x:s,y:h,vertical:!1}),s+=A.metrics.advance+o))}if(u.length!==f){var y=s-o;g=Math.max(y,g),justifyLine(u,t,f,u.length-1,p)}s=0,h+=r}else h+=r}var B=getAnchorAlignment(i),x=B.horizontalAlign,w=B.verticalAlign;align(u,p,x,w,g,r,a.length);var z=a.length*r;e.top+=-w*z,e.bottom=e.top+z,e.left+=-x*g,e.right=e.left+g}function justifyLine(e,t,a,r,i){if(i){var n=t[e[r].glyph];if(n)for(var l=n.metrics.advance,o=(e[r].x+l)*i,c=a;c<=r;c++)e[c].x-=o}}function align(e,t,a,r,i,n,l){for(var o=(t-a)*i,c=(-r*l+.5)*n,s=0;s<e.length;s++)e[s].x+=o,e[s].y+=c}function shapeIcon(e,t,a){var r=getAnchorAlignment(a),i=r.horizontalAlign,n=r.verticalAlign,l=t[0],o=t[1],c=l-e.displaySize[0]*i,s=c+e.displaySize[0],h=o-e.displaySize[1]*n;return{image:e,top:h,bottom:h+e.displaySize[1],left:c,right:s}}var scriptDetection=_dereq_("../util/script_detection"),verticalizePunctuation=_dereq_("../util/verticalize_punctuation"),WritingMode={horizontal:1,vertical:2,horizontalOnly:3};module.exports={shapeText:shapeText,shapeIcon:shapeIcon,WritingMode:WritingMode};var whitespace={};whitespace[9]=!0,whitespace[10]=!0,whitespace[11]=!0,whitespace[12]=!0,whitespace[13]=!0,whitespace[32]=!0;var breakable={};breakable[10]=!0,breakable[32]=!0,breakable[38]=!0,breakable[40]=!0,breakable[41]=!0,breakable[43]=!0,breakable[45]=!0,breakable[47]=!0,breakable[173]=!0,breakable[183]=!0,breakable[8203]=!0,breakable[8208]=!0,breakable[8211]=!0,breakable[8231]=!0;
},{"../util/script_detection":307,"../util/verticalize_punctuation":317}],259:[function(_dereq_,module,exports){
"use strict";function performSymbolLayout(e,t,a,i,o,n){e.createArrays(),e.symbolInstances=[];var r=512*e.overscaling;e.tilePixelRatio=EXTENT/r,e.compareText={},e.iconsNeedLinear=!1;var l=e.layers[0].layout,s=e.layers[0]._unevaluatedLayout._values,c={};if("composite"===e.textSizeData.functionType){var u=e.textSizeData.zoomRange,y=u.min,x=u.max;c.compositeTextSizes=[s["text-size"].possiblyEvaluate(new EvaluationParameters(y)),s["text-size"].possiblyEvaluate(new EvaluationParameters(x))]}if("composite"===e.iconSizeData.functionType){var g=e.iconSizeData.zoomRange,p=g.min,m=g.max;c.compositeIconSizes=[s["icon-size"].possiblyEvaluate(new EvaluationParameters(p)),s["icon-size"].possiblyEvaluate(new EvaluationParameters(m))]}c.layoutTextSize=s["text-size"].possiblyEvaluate(new EvaluationParameters(e.zoom+1)),c.layoutIconSize=s["icon-size"].possiblyEvaluate(new EvaluationParameters(e.zoom+1)),c.textMaxSize=s["text-size"].possiblyEvaluate(new EvaluationParameters(18));for(var d=24*l.get("text-line-height"),f="map"===l.get("text-rotation-alignment")&&"line"===l.get("symbol-placement"),v=l.get("text-keep-upright"),h=0,z=e.features;h<z.length;h+=1){var S=z[h],b=l.get("text-font").evaluate(S).join(","),T=t[b]||{},I=a[b]||{},E={},P=S.text;if(P){var w=l.get("text-offset").evaluate(S).map(function(e){return 24*e}),q=24*l.get("text-letter-spacing").evaluate(S),A=scriptDetection.allowsLetterSpacing(P)?q:0,L=l.get("text-anchor").evaluate(S),_=l.get("text-justify").evaluate(S),B="line"!==l.get("symbol-placement")?24*l.get("text-max-width").evaluate(S):0;E.horizontal=shapeText(P,T,B,d,L,_,A,w,24,WritingMode.horizontal),scriptDetection.allowsVerticalWritingMode(P)&&f&&v&&(E.vertical=shapeText(P,T,B,d,L,_,A,w,24,WritingMode.vertical))}var O=void 0;if(S.icon){var R=i[S.icon];R&&(O=shapeIcon(o[S.icon],l.get("icon-offset").evaluate(S),l.get("icon-anchor").evaluate(S)),void 0===e.sdfIcons?e.sdfIcons=R.sdf:(e.sdfIcons,R.sdf),R.pixelRatio!==e.pixelRatio?e.iconsNeedLinear=!0:0!==l.get("icon-rotate").constantOr(1)&&(e.iconsNeedLinear=!0))}(E.horizontal||O)&&addFeature(e,S,E,O,I,c)}n&&e.generateCollisionDebugBuffers()}function addFeature(e,t,a,i,o,n){var r=n.layoutTextSize.evaluate(t),l=n.layoutIconSize.evaluate(t),s=n.textMaxSize.evaluate(t);void 0===s&&(s=r);var c=e.layers[0].layout,u=c.get("text-offset").evaluate(t),y=c.get("icon-offset").evaluate(t),x=r/24,g=e.tilePixelRatio*x,p=e.tilePixelRatio*s/24,m=e.tilePixelRatio*l,d=e.tilePixelRatio*c.get("symbol-spacing"),f=c.get("text-padding")*e.tilePixelRatio,v=c.get("icon-padding")*e.tilePixelRatio,h=c.get("text-max-angle")/180*Math.PI,z=e instanceof SymbolBucket&&("map"===c.get("text-rotation-alignment")&&"line"===c.get("symbol-placement")),S=e instanceof SymbolBucket&&("map"===c.get("icon-rotation-alignment")&&"line"===c.get("symbol-placement")),b=e instanceof SymbolBucket?c.get("symbol-placement"):"point",T=d/2,I=function(r,l){l.x<0||l.x>=EXTENT||l.y<0||l.y>=EXTENT||e.symbolInstances.push(addSymbol(e,l,r,a,i,e.layers[0],e.collisionBoxArray,t.index,t.sourceLayerIndex,e.index,g,f,z,u,m,v,S,y,{zoom:e.zoom},t,o,n))};if("line"===b)for(var E=0,P=clipLine(t.geometry,0,0,EXTENT,EXTENT);E<P.length;E+=1)for(var w=P[E],q=getAnchors(w,d,h,a.vertical||a.horizontal,i,24,p,e.overscaling,EXTENT),A=0,L=q;A<L.length;A+=1){var _=L[A],B=a.horizontal;B&&anchorIsTooClose(e,B.text,T,_)||I(w,_)}else if("Polygon"===t.type)for(var O=0,R=classifyRings(t.geometry,0);O<R.length;O+=1){var D=R[O],M=findPoleOfInaccessibility(D,16);I(D[0],new Anchor(M.x,M.y,0))}else if("LineString"===t.type)for(var N=0,k=t.geometry;N<k.length;N+=1){var V=k[N];I(V,new Anchor(V[0].x,V[0].y,0))}else if("Point"===t.type)for(var W=0,X=t.geometry;W<X.length;W+=1)for(var C=X[W],G=0,Q=C;G<Q.length;G+=1){var F=Q[G];I([F],new Anchor(F.x,F.y,0))}}function addTextVertices(e,t,a,i,o,n,r,l,s,c,u,y,x){var g=getGlyphQuads(t,a,i,o,n,r,y),p=e.textSizeData,m=null;return"source"===p.functionType?m=[10*i.layout.get("text-size").evaluate(r)]:"composite"===p.functionType&&(m=[10*x.compositeTextSizes[0].evaluate(r),10*x.compositeTextSizes[1].evaluate(r)]),e.addSymbols(e.text,g,m,l,o,r,c,t,s.lineStartIndex,s.lineLength),u.push(e.text.placedSymbolArray.length-1),4*g.length}function addSymbol(e,t,a,i,o,n,r,l,s,c,u,y,x,g,p,m,d,f,v,h,z,S){var b,T,I=e.addToLineVertexArray(t,a),E=0,P=0,w=0,q=i.horizontal?i.horizontal.text:"",A=[];i.horizontal&&(b=new CollisionFeature(r,a,t,l,s,c,i.horizontal,u,y,x,e.overscaling),P+=addTextVertices(e,t,i.horizontal,n,x,v,h,g,I,i.vertical?WritingMode.horizontal:WritingMode.horizontalOnly,A,z,S),i.vertical&&(w+=addTextVertices(e,t,i.vertical,n,x,v,h,g,I,WritingMode.vertical,A,z,S)));var L=b?b.boxStartIndex:e.collisionBoxArray.length,_=b?b.boxEndIndex:e.collisionBoxArray.length;if(o){var B=getIconQuads(t,o,n,d,i.horizontal,v,h);T=new CollisionFeature(r,a,t,l,s,c,o,p,m,!1,e.overscaling),E=4*B.length;var O=e.iconSizeData,R=null;"source"===O.functionType?R=[10*n.layout.get("icon-size").evaluate(h)]:"composite"===O.functionType&&(R=[10*S.compositeIconSizes[0].evaluate(h),10*S.compositeIconSizes[1].evaluate(h)]),e.addSymbols(e.icon,B,R,f,d,h,!1,t,I.lineStartIndex,I.lineLength)}var D=T?T.boxStartIndex:e.collisionBoxArray.length,M=T?T.boxEndIndex:e.collisionBoxArray.length;return e.glyphOffsetArray.length>=SymbolBucket.MAX_GLYPHS&&util.warnOnce("."),{key:q,textBoxStartIndex:L,textBoxEndIndex:_,iconBoxStartIndex:D,iconBoxEndIndex:M,textOffset:g,iconOffset:f,anchor:t,line:a,featureIndex:l,feature:h,numGlyphVertices:P,numVerticalGlyphVertices:w,numIconVertices:E,textOpacityState:new OpacityState,iconOpacityState:new OpacityState,isDuplicate:!1,placedTextSymbolIndices:A,crossTileID:0}}function anchorIsTooClose(e,t,a,i){var o=e.compareText;if(t in o){for(var n=o[t],r=n.length-1;r>=0;r--)if(i.dist(n[r])<a)return!0}else o[t]=[];return o[t].push(i),!1}var Anchor=_dereq_("./anchor"),getAnchors=_dereq_("./get_anchors"),clipLine=_dereq_("./clip_line"),OpacityState=_dereq_("./opacity_state"),ref=_dereq_("./shaping"),shapeText=ref.shapeText,shapeIcon=ref.shapeIcon,WritingMode=ref.WritingMode,ref$1=_dereq_("./quads"),getGlyphQuads=ref$1.getGlyphQuads,getIconQuads=ref$1.getIconQuads,CollisionFeature=_dereq_("./collision_feature"),util=_dereq_("../util/util"),scriptDetection=_dereq_("../util/script_detection"),findPoleOfInaccessibility=_dereq_("../util/find_pole_of_inaccessibility"),classifyRings=_dereq_("../util/classify_rings"),EXTENT=_dereq_("../data/extent"),SymbolBucket=_dereq_("../data/bucket/symbol_bucket"),EvaluationParameters=_dereq_("../style/evaluation_parameters"),Point=_dereq_("../_minemap_/point-geometry");module.exports={performSymbolLayout:performSymbolLayout};
},{"../_minemap_/point-geometry":29,"../data/bucket/symbol_bucket":61,"../data/extent":67,"../style/evaluation_parameters":202,"../util/classify_rings":289,"../util/find_pole_of_inaccessibility":296,"../util/script_detection":307,"../util/util":315,"./anchor":245,"./clip_line":247,"./collision_feature":248,"./get_anchors":251,"./opacity_state":254,"./quads":257,"./shaping":258}],260:[function(_dereq_,module,exports){
"use strict";function getSizeData(e,o){var i=o.expression;if("constant"===i.kind)return{functionType:"constant",layoutSize:i.evaluate({zoom:e+1})};if("source"===i.kind)return{functionType:"source"};for(var t=i.zoomStops,r=0;r<t.length&&t[r]<=e;)r++;r=Math.max(0,r-1);for(var a=r;a<t.length&&t[a]<e+1;)a++;a=Math.min(t.length-1,a);var n={min:t[r],max:t[a]};return"composite"===i.kind?{functionType:"composite",zoomRange:n,propertyValue:o.value}:{functionType:"camera",layoutSize:i.evaluate({zoom:e+1}),zoomRange:n,sizeRange:{min:i.evaluate({zoom:n.min}),max:i.evaluate({zoom:n.max})},propertyValue:o.value}}function evaluateSizeForFeature(e,o,i){var t=o;return"source"===e.functionType?i.lowerSize/10:"composite"===e.functionType?interpolate.number(i.lowerSize/10,i.upperSize/10,t.uSizeT):t.uSize}function evaluateSizeForZoom(e,o,i){if("constant"===e.functionType)return{uSizeT:0,uSize:e.layoutSize};if("source"===e.functionType)return{uSizeT:0,uSize:0};if("camera"===e.functionType){var t=e.propertyValue,r=e.zoomRange,a=e.sizeRange,n=normalizePropertyExpression(t,i.specification),u=util.clamp(n.interpolationFactor(o,r.min,r.max),0,1);return{uSizeT:0,uSize:a.min+u*(a.max-a.min)}}var p=e.propertyValue,l=e.zoomRange,m=normalizePropertyExpression(p,i.specification);return{uSizeT:util.clamp(m.interpolationFactor(o,l.min,l.max),0,1),uSize:0}}var ref=_dereq_("../style-spec/expression"),normalizePropertyExpression=ref.normalizePropertyExpression,interpolate=_dereq_("../style-spec/util/interpolate"),util=_dereq_("../util/util");module.exports={getSizeData:getSizeData,evaluateSizeForFeature:evaluateSizeForFeature,evaluateSizeForZoom:evaluateSizeForZoom};
},{"../style-spec/expression":159,"../style-spec/util/interpolate":178,"../util/util":315}],261:[function(_dereq_,module,exports){
"use strict";module.exports=function(e,t,a){var o=t.layout.get("text-transform").evaluate(a);return"uppercase"===o?e=e.toLocaleUpperCase():"lowercase"===o&&(e=e.toLocaleLowerCase()),e};
},{}],262:[function(_dereq_,module,exports){
"use strict";var anchorTranslate={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)","center-bottom":"translate(0,-50%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};exports.anchorTranslate=anchorTranslate,exports.applyAnchorClass=function(t,a,r){var e=t.classList;for(var n in anchorTranslate)e.remove("minemap-"+r+"-anchor-"+n);e.add("minemap-"+r+"-anchor-"+a)};
},{}],263:[function(_dereq_,module,exports){
"use strict";var DOM=_dereq_("../util/dom"),Point=_dereq_("../_minemap_/point-geometry"),anchorTranslate=_dereq_("./anchor").anchorTranslate,applyAnchorClass=_dereq_("./anchor").applyAnchorClass,Evented=_dereq_("../util/evented").Evented,Event=_dereq_("../util/evented").Event,ErrorEvent=_dereq_("../util/evented").ErrorEvent,MapMouseEvent=_dereq_("../ui/events").MapMouseEvent,MapTouchEvent=_dereq_("../ui/events").MapTouchEvent,MapWheelEvent=_dereq_("../ui/events").MapWheelEvent,handlers={scrollZoom:_dereq_("./handler/scroll_zoom"),boxZoom:_dereq_("./handler/box_zoom"),dragRotate:_dereq_("./handler/drag_rotate"),dragPan:_dereq_("./handler/drag_pan"),keyboard:_dereq_("./handler/keyboard"),doubleClickZoom:_dereq_("./handler/dblclick_zoom"),touchZoomRotate:_dereq_("./handler/touch_zoom_rotate")};module.exports=function(e,t){function n(n){f=!0;var o=new MapMouseEvent("mousedown",e,n);e.fire(o),o.defaultPrevented||(t.interactive&&!e.doubleClickZoom.isActive()&&e.stop(),e.boxZoom.onMouseDown(n),e.boxZoom.isActive()||e.dragPan.isActive()||e.dragRotate.onMouseDown(n),e.boxZoom.isActive()||e.dragRotate.isActive()||e.dragPan.onMouseDown(n))}function o(t){var n=e.dragRotate.isActive();m&&!n&&e.fire(new MapMouseEvent("contextmenu",e,m)),m=null,f=!1,e.fire(new MapMouseEvent("mouseup",e,t))}function r(t){if(!e.dragPan.isActive()&&!e.dragRotate.isActive()){for(var n=t.toElement||t.target;n&&n!==h;)n=n.parentNode;n===h&&e.fire(new MapMouseEvent("mousemove",e,t))}}function a(t){for(var n=t.toElement||t.target;n&&n!==h;)n=n.parentNode;n===h&&e.fire(new MapMouseEvent("mouseover",e,t))}function i(t){e.fire(new MapMouseEvent("mouseout",e,t))}function u(n){var o=new MapTouchEvent("touchstart",e,n);e.fire(o),o.defaultPrevented||(t.interactive&&e.stop(),e.boxZoom.isActive()||e.dragRotate.isActive()||e.dragPan.onTouchStart(n),e.touchZoomRotate.onStart(n),e.doubleClickZoom.onTouchStart(o))}function v(t){e.fire(new MapTouchEvent("touchmove",e,t))}function d(t){e.fire(new MapTouchEvent("touchend",e,t))}function c(t){e.fire(new MapTouchEvent("touchcancel",e,t))}function s(t){var n=new MapMouseEvent("click",e,t);e.fire(n),n.defaultPrevented}function l(t){var n=new MapMouseEvent("dblclick",e,t);e.fire(n),n.defaultPrevented||e.doubleClickZoom.onDblClick(n)}function M(t){var n=e.dragRotate.isActive();f||n?f&&(m=t):e.fire(new MapMouseEvent("contextmenu",e,t)),t.preventDefault()}function E(t){var n=new MapWheelEvent("wheel",e,t);e.fire(n),n.defaultPrevented||e.scrollZoom.onWheel(t)}var h=e.getCanvasContainer(),m=null,f=!1;for(var p in handlers)e[p]=new handlers[p](e,t),t.interactive&&t[p]&&e[p].enable(t[p]);DOM.addEventListener(h,"mouseout",i),DOM.addEventListener(h,"mousedown",n),DOM.addEventListener(h,"mouseup",o),DOM.addEventListener(h,"mousemove",r),DOM.addEventListener(h,"mouseover",a),DOM.addEventListener(h,"touchstart",u,{passive:!1}),DOM.addEventListener(h,"touchmove",v,{passive:!0}),DOM.addEventListener(h,"touchend",d),DOM.addEventListener(h,"touchcancel",c),DOM.addEventListener(h,"click",s),DOM.addEventListener(h,"dblclick",l),DOM.addEventListener(h,"contextmenu",M),DOM.addEventListener(h,"wheel",E,{passive:!1})};
},{"../_minemap_/point-geometry":29,"../ui/events":271,"../util/dom":293,"../util/evented":295,"./anchor":262,"./handler/box_zoom":272,"./handler/dblclick_zoom":273,"./handler/drag_pan":274,"./handler/drag_rotate":275,"./handler/keyboard":276,"./handler/scroll_zoom":277,"./handler/touch_zoom_rotate":278}],264:[function(_dereq_,module,exports){
"use strict";var util=_dereq_("../util/util"),interpolate=_dereq_("../style-spec/util/interpolate").number,browser=_dereq_("../util/browser"),LngLat=_dereq_("../geo/lng_lat"),LngLatBounds=_dereq_("../geo/lng_lat_bounds"),Point=_dereq_("../_minemap_/point-geometry"),Evented=_dereq_("../util/evented").Evented,Event=_dereq_("../util/evented").Event,Camera=function(t){function e(e,n){t.call(this),this._moving=!1,this._zooming=!1,this.transform=e,this._bearingSnap=n.bearingSnap,util.bindAll(["_renderFrameCallback"],this)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.getCenter=function(){return this.transform.center},e.prototype.setCenter=function(t,e){return this.jumpTo({center:t},e)},e.prototype.panBy=function(t,e,n){if(e&&e.units){var i,o=this.transform.center.toArray(),r=this._lngLat2Mercator(o);i="kilometers"===e.units?[r[0]+1e3*t[0],r[1]+1e3*t[1]]:[r[0]+t[0],r[1]+t[1]];var a=this._mercator2LngLat(i);return this.panTo(LngLat.convert(a),e,n)}return this.panTo(this.transform.center,util.extend({offset:Point.convert(t).mult(-1)},e),n)},e.prototype._lngLat2Mercator=function(t){var e=[],n=20037508.34*t[0]/180,i=Math.log(Math.tan((90+t[1])*Math.PI/360))/(Math.PI/180);return i=20037508.34*i/180,e.push(n),e.push(i),e},e.prototype._mercator2LngLat=function(t){var e=[],n=t[0]/20037508.34*180,i=t[1]/20037508.34*180;return i=180/Math.PI*(2*Math.atan(Math.exp(i*Math.PI/180))-Math.PI/2),e.push(n),e.push(i),e},e.prototype.panTo=function(t,e,n){return this.easeTo(util.extend({center:t},e),n)},e.prototype.getZoom=function(){return this.transform.zoom},e.prototype.setZoom=function(t,e){return this.jumpTo({zoom:t},e),this},e.prototype.zoomTo=function(t,e,n){return this.easeTo(util.extend({zoom:t},e),n)},e.prototype.zoomIn=function(t,e){return this.zoomTo(this.getZoom()+1,t,e),this},e.prototype.zoomOut=function(t,e){return this.zoomTo(this.getZoom()-1,t,e),this},e.prototype.getBearing=function(){return this.transform.bearing},e.prototype.setBearing=function(t,e){return this.jumpTo({bearing:t},e),this},e.prototype.rotateTo=function(t,e,n){return this.easeTo(util.extend({bearing:t},e),n)},e.prototype.resetNorth=function(t,e){return this.rotateTo(0,util.extend({duration:1e3},t),e),this},e.prototype.snapToNorth=function(t,e){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(t,e):this},e.prototype.getPitch=function(){return this.transform.pitch},e.prototype.setPitch=function(t,e){return this.jumpTo({pitch:t},e),this},e.prototype.fitBounds=function(t,e,n){if(e=util.extend({padding:{top:0,bottom:0,right:0,left:0},offset:[0,0],maxZoom:this.transform.maxZoom},e),"number"==typeof e.padding){var i=e.padding;e.padding={top:i,bottom:i,right:i,left:i}}if(!util.deepEqual(Object.keys(e.padding).sort(function(t,e){return t<e?-1:t>e?1:0}),["bottom","left","right","top"]))return this;t=LngLatBounds.convert(t);var o=[(e.padding.left-e.padding.right)/2,(e.padding.top-e.padding.bottom)/2],r=Math.min(e.padding.right,e.padding.left),a=Math.min(e.padding.top,e.padding.bottom);e.offset=[e.offset[0]+o[0],e.offset[1]+o[1]];var s=Point.convert(e.offset),h=this.transform,p=h.project(t.getNorthWest()),u=h.project(t.getSouthEast()),m=u.sub(p),c=(h.width-2*r-2*Math.abs(s.x))/m.x,f=(h.height-2*a-2*Math.abs(s.y))/m.y;return f<0||c<0?this:(e.center=h.unproject(p.add(u).div(2)),e.zoom=Math.min(h.scaleZoom(h.scale*Math.min(c,f)),e.maxZoom),e.bearing=0,e.linear?this.easeTo(e,n):this.flyTo(e,n))},e.prototype.jumpTo=function(t,e){this.stop();var n=this.transform,i=!1,o=!1,r=!1;return"zoom"in t&&n.zoom!==+t.zoom&&(i=!0,n.zoom=+t.zoom),void 0!==t.center&&(n.center=LngLat.convert(t.center)),"bearing"in t&&n.bearing!==+t.bearing&&(o=!0,n.bearing=+t.bearing),"pitch"in t&&n.pitch!==+t.pitch&&(r=!0,n.pitch=+t.pitch),this.fire(new Event("movestart",e)).fire(new Event("move",e)),i&&this.fire(new Event("zoomstart",e)).fire(new Event("zoom",e)).fire(new Event("zoomend",e)),o&&this.fire(new Event("rotatestart",e)).fire(new Event("rotate",e)).fire(new Event("rotateend",e)),r&&this.fire(new Event("pitchstart",e)).fire(new Event("pitch",e)).fire(new Event("pitchend",e)),this.fire(new Event("moveend",e))},e.prototype.easeTo=function(t,e){var n=this;this.stop(),t=util.extend({offset:[0,0],duration:500,easing:util.ease},t),!1===t.animate&&(t.duration=0);var i=this.transform,o=this.getZoom(),r=this.getBearing(),a=this.getPitch(),s="zoom"in t?+t.zoom:o,h="bearing"in t?this._normalizeBearing(t.bearing,r):r,p="pitch"in t?+t.pitch:a,u=i.centerPoint.add(Point.convert(t.offset)),m=i.pointLocation(u),c=LngLat.convert(t.center||m);this._normalizeCenter(c);var f,g,d=i.project(m),l=i.project(c).sub(d),v=i.zoomScale(s-o);return t.around&&(f=LngLat.convert(t.around),g=i.locationPoint(f)),this._zooming=s!==o,this._rotating=r!==h,this._pitching=p!==a,this._prepareEase(e,t.noMoveStart),clearTimeout(this._easeEndTimeoutID),this._ease(function(t){if(n._zooming&&(i.zoom=interpolate(o,s,t)),n._rotating&&(i.bearing=interpolate(r,h,t)),n._pitching&&(i.pitch=interpolate(a,p,t)),f)i.setLocationAtPoint(f,g);else{var m=i.zoomScale(i.zoom-o),c=s>o?Math.min(2,v):Math.max(.5,v),_=Math.pow(c,1-t),E=i.unproject(d.add(l.mult(t*_)).mult(m));i.setLocationAtPoint(i.renderWorldCopies?E.wrap():E,u)}n._fireMoveEvents(e)},function(){t.delayEndEvents?n._easeEndTimeoutID=setTimeout(function(){return n._afterEase(e)},t.delayEndEvents):n._afterEase(e)},t),this},e.prototype._prepareEase=function(t,e){this._moving=!0,e||this.fire(new Event("movestart",t)),this._zooming&&this.fire(new Event("zoomstart",t)),this._rotating&&this.fire(new Event("rotatestart",t)),this._pitching&&this.fire(new Event("pitchstart",t))},e.prototype._fireMoveEvents=function(t){this.fire(new Event("move",t)),this._zooming&&this.fire(new Event("zoom",t)),this._rotating&&this.fire(new Event("rotate",t)),this._pitching&&this.fire(new Event("pitch",t))},e.prototype._afterEase=function(t){var e=this._zooming,n=this._rotating,i=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,e&&this.fire(new Event("zoomend",t)),n&&this.fire(new Event("rotateend",t)),i&&this.fire(new Event("pitchend",t)),this.fire(new Event("moveend",t))},e.prototype.flyTo=function(t,e){function n(t){var e=(z*z-y*y+(t?-1:1)*x*x*M*M)/(2*(t?z:y)*x*M);return Math.log(Math.sqrt(e*e+1)-e)}function i(t){return(Math.exp(t)-Math.exp(-t))/2}function o(t){return(Math.exp(t)+Math.exp(-t))/2}function r(t){return i(t)/o(t)}var a=this;this.stop(),t=util.extend({offset:[0,0],speed:1.2,curve:1.42,easing:util.ease},t);var s=this.transform,h=this.getZoom(),p=this.getBearing(),u=this.getPitch(),m="zoom"in t?util.clamp(+t.zoom,s.minZoom,s.maxZoom):h,c="bearing"in t?this._normalizeBearing(t.bearing,p):p,f="pitch"in t?+t.pitch:u,g=s.zoomScale(m-h),d=s.centerPoint.add(Point.convert(t.offset)),l=s.pointLocation(d),v=LngLat.convert(t.center||l);this._normalizeCenter(v);var _=s.project(l),E=s.project(v).sub(_),b=t.curve,y=Math.max(s.width,s.height),z=y/g,M=E.mag();if("minZoom"in t){var w=util.clamp(Math.min(t.minZoom,h,m),s.minZoom,s.maxZoom),L=y/s.zoomScale(w-h);b=Math.sqrt(L/M*2)}var x=b*b,T=n(0),P=function(t){return o(T)/o(T+b*t)},F=function(t){return y*((o(T)*r(T+b*t)-i(T))/x)/M},Z=(n(1)-T)/b;if(Math.abs(M)<1e-6||!isFinite(Z)){if(Math.abs(y-z)<1e-6)return this.easeTo(t,e);var j=z<y?-1:1;Z=Math.abs(Math.log(z/y))/b,F=function(){return 0},P=function(t){return Math.exp(j*b*t)}}if("duration"in t)t.duration=+t.duration;else{var q="screenSpeed"in t?+t.screenSpeed/b:+t.speed;t.duration=1e3*Z/q}return t.maxDuration&&t.duration>t.maxDuration&&(t.duration=0),this._zooming=!0,this._rotating=p!==c,this._pitching=f!==u,this._prepareEase(e,!1),this._ease(function(t){var n=t*Z,i=1/P(n);s.zoom=h+s.scaleZoom(i),a._rotating&&(s.bearing=interpolate(p,c,t)),a._pitching&&(s.pitch=interpolate(u,f,t));var o=s.unproject(_.add(E.mult(F(n))).mult(i));s.setLocationAtPoint(s.renderWorldCopies?o.wrap():o,d),a._fireMoveEvents(e)},function(){return a._afterEase(e)},t),this},e.prototype.isEasing=function(){return!!this._easeFrameId},e.prototype.stop=function(){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){var t=this._onEaseEnd;delete this._onEaseEnd,t.call(this)}return this},e.prototype._ease=function(t,e,n){!1===n.animate||0===n.duration?(t(1),e()):(this._easeStart=browser.now(),this._easeOptions=n,this._onEaseFrame=t,this._onEaseEnd=e,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))},e.prototype._renderFrameCallback=function(){var t=Math.min((browser.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(t)),t<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()},e.prototype._normalizeBearing=function(t,e){t=util.wrap(t,-180,180);var n=Math.abs(t-e);return Math.abs(t-360-e)<n&&(t-=360),Math.abs(t+360-e)<n&&(t+=360),t},e.prototype._normalizeCenter=function(t){var e=this.transform;if(e.renderWorldCopies&&!e.lngRange){var n=t.lng-e.center.lng;t.lng+=n>180?-360:n<-180?360:0}},e.prototype._smoothOutEasing=function(t){var e=util.ease;if(this._prevEase){var n=this._prevEase,i=(browser.now()-n.start)/n.duration,o=n.easing(i+.01)-n.easing(i),r=.27/Math.sqrt(o*o+1e-4)*.01,a=Math.sqrt(.0729-r*r);e=util.bezier(r,a,.25,1)}return this._prevEase={start:browser.now(),duration:t,easing:e},e},e}(Evented);module.exports=Camera;
},{"../_minemap_/point-geometry":29,"../geo/lng_lat":76,"../geo/lng_lat_bounds":77,"../style-spec/util/interpolate":178,"../util/browser":286,"../util/evented":295,"../util/util":315}],265:[function(_dereq_,module,exports){
"use strict";var DOM=_dereq_("../../util/dom"),util=_dereq_("../../util/util"),config=_dereq_("../../util/config"),AttributionControl=function(t){this.options=t,util.bindAll(["_updateEditLink","_updateData","_updateCompact"],this)};AttributionControl.prototype.getDefaultPosition=function(){return"bottom-right"},AttributionControl.prototype.onAdd=function(t){var i=this.options&&this.options.compact;return this._map=t,this._container=DOM.create("div","minemap-ctrl minemap-ctrl-attrib"),i&&this._container.classList.add("minemap-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),void 0===i&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container},AttributionControl.prototype.onRemove=function(){DOM.remove(this._container),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0},AttributionControl.prototype._updateEditLink=function(){var t=this._editLink;t||(t=this._editLink=this._container.querySelector(".minemap-improve-map"));var i=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:config.ACCESS_TOKEN}];if(t){var e=i.reduce(function(t,e,o){return e.value&&(t+=e.key+"="+e.value+(o<i.length-1?"&":"")),t},"?");t.href="https://www.minedata.cn/feedback/"+e+(this._map._hash?this._map._hash.getHashString(!0):"")}},AttributionControl.prototype._updateData=function(t){t&&"metadata"===t.sourceDataType&&(this._updateAttributions(),this._updateEditLink())},AttributionControl.prototype._updateAttributions=function(){if(this._map.style){var t=[];if(this._map.style.stylesheet){var i=this._map.style.stylesheet;this.styleOwner=i.owner,this.styleId=i.id}var e=this._map.style.sourceCaches;for(var o in e){var n=e[o].getSource();n.attribution&&t.indexOf(n.attribution)<0&&t.push(n.attribution)}t.sort(function(t,i){return t.length-i.length}),t=t.filter(function(i,e){for(var o=e+1;o<t.length;o++)if(t[o].indexOf(i)>=0)return!1;return!0}),this._container.innerHTML=t.join(" | "),this._editLink=null}},AttributionControl.prototype._updateCompact=function(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("minemap-compact"):this._container.classList.remove("minemap-compact")},module.exports=AttributionControl;
},{"../../util/config":290,"../../util/dom":293,"../../util/util":315}],266:[function(_dereq_,module,exports){
"use strict";var DOM=_dereq_("../../util/dom"),util=_dereq_("../../util/util"),window=_dereq_("../../util/window"),FullscreenControl=function(){this._fullscreen=!1,util.bindAll(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in window.document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in window.document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in window.document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in window.document&&(this._fullscreenchange="MSFullscreenChange"),this._className="minemap-ctrl"};FullscreenControl.prototype.onAdd=function(e){return this._map=e,this._mapContainer=this._map.getContainer(),this._container=DOM.create("div",this._className+" minemap-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._container.style.display="none",util.warnOnce("This device does not support fullscreen mode.")),this._container},FullscreenControl.prototype.onRemove=function(){DOM.remove(this._container),this._map=null,window.document.removeEventListener(this._fullscreenchange,this._changeIcon)},FullscreenControl.prototype._checkFullscreenSupport=function(){return!!(window.document.fullscreenEnabled||window.document.mozFullScreenEnabled||window.document.msFullscreenEnabled||window.document.webkitFullscreenEnabled)},FullscreenControl.prototype._setupUI=function(){var e=this._fullscreenButton=DOM.create("button",this._className+"-icon "+this._className+"-fullscreen",this._container);e.setAttribute("aria-label","Toggle fullscreen"),e.type="button",this._fullscreenButton.addEventListener("click",this._onClickFullscreen),window.document.addEventListener(this._fullscreenchange,this._changeIcon)},FullscreenControl.prototype._isFullscreen=function(){return this._fullscreen},FullscreenControl.prototype._changeIcon=function(){(window.document.fullscreenElement||window.document.mozFullScreenElement||window.document.webkitFullscreenElement||window.document.msFullscreenElement)===this._mapContainer!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle(this._className+"-shrink"),this._fullscreenButton.classList.toggle(this._className+"-fullscreen"))},FullscreenControl.prototype._onClickFullscreen=function(){this._isFullscreen()?window.document.exitFullscreen?window.document.exitFullscreen():window.document.mozCancelFullScreen?window.document.mozCancelFullScreen():window.document.msExitFullscreen?window.document.msExitFullscreen():window.document.webkitCancelFullScreen&&window.document.webkitCancelFullScreen():this._mapContainer.requestFullscreen?this._mapContainer.requestFullscreen():this._mapContainer.mozRequestFullScreen?this._mapContainer.mozRequestFullScreen():this._mapContainer.msRequestFullscreen?this._mapContainer.msRequestFullscreen():this._mapContainer.webkitRequestFullscreen&&this._mapContainer.webkitRequestFullscreen()},module.exports=FullscreenControl;
},{"../../util/dom":293,"../../util/util":315,"../../util/window":288}],267:[function(_dereq_,module,exports){
"use strict";function checkGeolocationSupport(t){void 0!==supportsGeolocation?t(supportsGeolocation):void 0!==window.navigator.permissions?window.navigator.permissions.query({name:"geolocation"}).then(function(o){supportsGeolocation="denied"!==o.state,t(supportsGeolocation)}):(supportsGeolocation=!!window.navigator.geolocation,t(supportsGeolocation))}var Evented=_dereq_("../../util/evented").Evented,Event=_dereq_("../../util/evented").Event,ErrorEvent=_dereq_("../../util/evented").ErrorEvent,DOM=_dereq_("../../util/dom"),window=_dereq_("../../util/window"),util=_dereq_("../../util/util"),LngLat=_dereq_("../../geo/lng_lat"),Marker=_dereq_("../marker"),defaultOptions={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showUserLocation:!0},className="minemap-ctrl",supportsGeolocation,GeolocateControl=function(t){function o(o){t.call(this),this.options=util.extend({},defaultOptions,o),util.bindAll(["_onSuccess","_onError","_finish","_setupUI","_updateCamera","_updateMarker","_onClickGeolocate"],this)}return t&&(o.__proto__=t),o.prototype=Object.create(t&&t.prototype),o.prototype.constructor=o,o.prototype.onAdd=function(t){return this._map=t,this._container=DOM.create("div",className+" "+className+"-group"),checkGeolocationSupport(this._setupUI),this._container},o.prototype.onRemove=function(){void 0!==this._geolocationWatchID&&(window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker.remove(),DOM.remove(this._container),this._map=void 0},o.prototype._onSuccess=function(t){if(this.options.trackUserLocation)switch(this._lastKnownPosition=t,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("minemap-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("minemap-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("minemap-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("minemap-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("minemap-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("minemap-ctrl-geolocate-background")}this.options.showUserLocation&&"OFF"!==this._watchState&&this._updateMarker(t),this.options.trackUserLocation&&"ACTIVE_LOCK"!==this._watchState||this._updateCamera(t),this.options.showUserLocation&&this._dotElement.classList.remove("minemap-user-location-dot-stale"),this.fire(new Event("geolocate",t)),this._finish()},o.prototype._updateCamera=function(t){var o=new LngLat(t.coords.longitude,t.coords.latitude),e=t.coords.accuracy;this._map.fitBounds(o.toBounds(e),this.options.fitBoundsOptions,{geolocateSource:!0})},o.prototype._updateMarker=function(t){t?this._userLocationDotMarker.setLngLat([t.coords.longitude,t.coords.latitude]).addTo(this._map):this._userLocationDotMarker.remove()},o.prototype._onError=function(t){if(this.options.trackUserLocation)if(1===t.code)this._watchState="OFF",this._geolocateButton.classList.remove("minemap-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("minemap-ctrl-geolocate-active"),this._geolocateButton.classList.remove("minemap-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("minemap-ctrl-geolocate-background"),this._geolocateButton.classList.remove("minemap-ctrl-geolocate-background-error"),void 0!==this._geolocationWatchID&&this._clearWatch();else switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("minemap-ctrl-geolocate-active"),this._geolocateButton.classList.add("minemap-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("minemap-ctrl-geolocate-active"),this._geolocateButton.classList.add("minemap-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("minemap-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("minemap-ctrl-geolocate-background"),this._geolocateButton.classList.add("minemap-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("minemap-ctrl-geolocate-waiting")}"OFF"!==this._watchState&&this.options.showUserLocation&&this._dotElement.classList.add("minemap-user-location-dot-stale"),this.fire(new Event("error",t)),this._finish()},o.prototype._finish=function(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0},o.prototype._setupUI=function(t){var o=this;!1!==t&&(this._container.addEventListener("contextmenu",function(t){return t.preventDefault()}),this._geolocateButton=DOM.create("button",className+"-icon "+className+"-geolocate",this._container),this._geolocateButton.type="button",this._geolocateButton.setAttribute("aria-label","Geolocate"),this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=DOM.create("div","minemap-user-location-dot"),this._userLocationDotMarker=new Marker(this._dotElement),this.options.trackUserLocation&&(this._watchState="OFF")),this._geolocateButton.addEventListener("click",this._onClickGeolocate.bind(this)),this.options.trackUserLocation&&this._map.on("movestart",function(t){t.geolocateSource||"ACTIVE_LOCK"!==o._watchState||(o._watchState="BACKGROUND",o._geolocateButton.classList.add("minemap-ctrl-geolocate-background"),o._geolocateButton.classList.remove("minemap-ctrl-geolocate-active"),o.fire(new Event("trackuserlocationend")))}))},o.prototype._onClickGeolocate=function(){if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new Event("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":this._watchState="OFF",this._geolocateButton.classList.remove("minemap-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("minemap-ctrl-geolocate-active"),this._geolocateButton.classList.remove("minemap-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("minemap-ctrl-geolocate-background"),this._geolocateButton.classList.remove("minemap-ctrl-geolocate-background-error"),this.fire(new Event("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("minemap-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new Event("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("minemap-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("minemap-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("minemap-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("minemap-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("minemap-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("minemap-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("minemap-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("minemap-ctrl-geolocate-background-error")}"OFF"===this._watchState&&void 0!==this._geolocationWatchID?this._clearWatch():void 0===this._geolocationWatchID&&(this._geolocateButton.classList.add("minemap-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),this._geolocationWatchID=window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,this.options.positionOptions))}else window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4)},o.prototype._clearWatch=function(){window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("minemap-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)},o}(Evented);module.exports=GeolocateControl;
},{"../../geo/lng_lat":76,"../../util/dom":293,"../../util/evented":295,"../../util/util":315,"../../util/window":288,"../marker":282}],268:[function(_dereq_,module,exports){
"use strict";var DOM=_dereq_("../../util/dom"),util=_dereq_("../../util/util"),LogoControl=function(){util.bindAll(["_updateLogo"],this)};LogoControl.prototype.onAdd=function(o){this._map=o,this._container=DOM.create("div","minemap-ctrl");var t=DOM.create("a","minemap-ctrl-logo");return t.target="_blank",t.href="https://www.minedata.cn/",t.setAttribute("aria-label","Minemap logo"),this._container.appendChild(t),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._container},LogoControl.prototype.onRemove=function(){DOM.remove(this._container),this._map.off("sourcedata",this._updateLogo)},LogoControl.prototype.getDefaultPosition=function(){return"bottom-left"},LogoControl.prototype._updateLogo=function(o){o&&"metadata"!==o.sourceDataType||(this._container.style.display=this._logoRequired()?"block":"none")},LogoControl.prototype._logoRequired=function(){if(this._map.style)return!0},module.exports=LogoControl;
},{"../../util/dom":293,"../../util/util":315}],269:[function(_dereq_,module,exports){
"use strict";var DOM=_dereq_("../../util/dom"),util=_dereq_("../../util/util"),DragRotateHandler=_dereq_("../handler/drag_rotate"),defaultOptions={showCompass:!0,showZoom:!0},NavigationControl=function(t){var o=this;this.options=util.extend({},defaultOptions,t),this._container=DOM.create("div","minemap-ctrl minemap-ctrl-group"),this._container.addEventListener("contextmenu",function(t){return t.preventDefault()}),this.options.showZoom&&(this._zoomInButton=this._createButton("minemap-ctrl-icon minemap-ctrl-zoom-in","Zoom In",function(){return o._map.zoomIn()}),this._zoomOutButton=this._createButton("minemap-ctrl-icon minemap-ctrl-zoom-out","Zoom Out",function(){return o._map.zoomOut()})),this.options.showCompass&&(util.bindAll(["_rotateCompassArrow"],this),this._compass=this._createButton("minemap-ctrl-icon minemap-ctrl-compass","Reset North",function(){return o._map.resetNorth()}),this._compassArrow=DOM.create("span","minemap-ctrl-compass-arrow",this._compass))};NavigationControl.prototype._rotateCompassArrow=function(){var t="rotate("+this._map.transform.angle*(180/Math.PI)+"deg)";this._compassArrow.style.transform=t},NavigationControl.prototype.onAdd=function(t){return this._map=t,this.options.showCompass&&(this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new DragRotateHandler(t,{button:"left",element:this._compass}),this._handler.enable()),this._container},NavigationControl.prototype.onRemove=function(){DOM.remove(this._container),this.options.showCompass&&(this._map.off("rotate",this._rotateCompassArrow),this._handler.disable(),delete this._handler),delete this._map},NavigationControl.prototype._createButton=function(t,o,e){var n=DOM.create("button",t,this._container);return n.type="button",n.setAttribute("aria-label",o),n.addEventListener("click",e),n},module.exports=NavigationControl;
},{"../../util/dom":293,"../../util/util":315,"../handler/drag_rotate":275}],270:[function(_dereq_,module,exports){
"use strict";function updateScale(t,e,n,i){var o=i&&i.maxWidth||100,a=t._container.clientHeight/2,r=getDistance(t.unproject([0,a]),t.unproject([o,a]));if(i&&"imperial"===i.unit){var c=3.2808*r;if(c>5280){setScale(e,n,o,c/5280,"mi")}else setScale(e,n,o,c,"ft")}else setScale(e,n,o,r,"m")}function setScale(t,e,n,i,o){var a=getRoundNum(i),r=a/i;"m"===o&&a>=1e3&&(a/=1e3,o="km"),t.style.width=n*r+"px",e.innerHTML=a+o}function getDistance(t,e){var n=Math.PI/180,i=t.lat*n,o=e.lat*n,a=Math.sin(i)*Math.sin(o)+Math.cos(i)*Math.cos(o)*Math.cos((e.lng-t.lng)*n);return 6371e3*Math.acos(Math.min(a,1))}function getRoundNum(t){var e=Math.pow(10,(""+Math.floor(t)).length-1),n=t/e;return n=n>=10?10:n>=5?5:n>=3?3:n>=2?2:1,e*n}var DOM=_dereq_("../../util/dom"),util=_dereq_("../../util/util"),ScaleControl=function(t){this.options=t,util.bindAll(["_onMove"],this)};ScaleControl.prototype.getDefaultPosition=function(){return"bottom-left"},ScaleControl.prototype._onMove=function(){updateScale(this._map,this._container,this._content,this.options)},ScaleControl.prototype.onAdd=function(t){this._map=t,this._container=DOM.create("div","minemap-ctrl minemap-ctrl-scale",t.getContainer()),this._content=DOM.create("div","minemap-ctrl-scale-text",this._container),this._container.appendChild(this._content);var e=DOM.create("div","minemap-ctrl-scale-left-bar",this._container),n=DOM.create("div","minemap-ctrl-scale-right-bar",this._container),i=DOM.create("div","minemap-ctrl-scale-bottom-bar",this._container);return this._container.appendChild(e),this._container.appendChild(n),this._container.appendChild(i),this._map.on("move",this._onMove),this._onMove(),this._container},ScaleControl.prototype.onRemove=function(){this._container.parentNode.removeChild(this._container),this._map.off("move",this._onMove),this._map=void 0},module.exports=ScaleControl;
},{"../../util/dom":293,"../../util/util":315}],271:[function(_dereq_,module,exports){
"use strict";var Event=_dereq_("../util/evented").Event,DOM=_dereq_("../util/dom"),util=_dereq_("../util/util"),MapMouseEvent=function(e){function t(t,n,r,o){void 0===o&&(o={});var u=DOM.mousePos(n.getCanvasContainer(),r),p=n.unproject(u);e.call(this,t,util.extend({point:u,lngLat:p,originalEvent:r},o)),this._defaultPrevented=!1}e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t;var n={defaultPrevented:{}};return t.prototype.preventDefault=function(){this._defaultPrevented=!0},n.defaultPrevented.get=function(){return this._defaultPrevented},Object.defineProperties(t.prototype,n),t}(Event);exports.MapMouseEvent=MapMouseEvent;var MapTouchEvent=function(e){function t(t,n,r){var o=DOM.touchPos(n.getCanvasContainer(),r),u=o.map(function(e){return n.unproject(e)}),p=o.reduce(function(e,t,n,r){return e.add(t.div(r.length))},new Point(0,0)),i=n.unproject(p);e.call(this,t,{points:o,point:p,lngLats:u,lngLat:i,originalEvent:r}),this._defaultPrevented=!1}e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t;var n={defaultPrevented:{}};return t.prototype.preventDefault=function(){this._defaultPrevented=!0},n.defaultPrevented.get=function(){return this._defaultPrevented},Object.defineProperties(t.prototype,n),t}(Event);exports.MapTouchEvent=MapTouchEvent;var MapWheelEvent=function(e){function t(t,n,r){e.call(this,t,{originalEvent:r}),this._defaultPrevented=!1}e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t;var n={defaultPrevented:{}};return t.prototype.preventDefault=function(){this._defaultPrevented=!0},n.defaultPrevented.get=function(){return this._defaultPrevented},Object.defineProperties(t.prototype,n),t}(Event);exports.MapWheelEvent=MapWheelEvent;
},{"../util/dom":293,"../util/evented":295,"../util/util":315}],272:[function(_dereq_,module,exports){
"use strict";var DOM=_dereq_("../../util/dom"),LngLatBounds=_dereq_("../../geo/lng_lat_bounds"),util=_dereq_("../../util/util"),window=_dereq_("../../util/window"),Event=_dereq_("../../util/evented").Event,BoxZoomHandler=function(o){this._map=o,this._el=o.getCanvasContainer(),this._container=o.getContainer(),util.bindAll(["_onMouseMove","_onMouseUp","_onKeyDown"],this)};BoxZoomHandler.prototype.isEnabled=function(){return!!this._enabled},BoxZoomHandler.prototype.isActive=function(){return!!this._active},BoxZoomHandler.prototype.enable=function(){this.isEnabled()||(this._enabled=!0)},BoxZoomHandler.prototype.disable=function(){this.isEnabled()&&(this._enabled=!1)},BoxZoomHandler.prototype.onMouseDown=function(o){this.isEnabled()&&o.shiftKey&&0===o.button&&(window.document.addEventListener("mousemove",this._onMouseMove,!1),window.document.addEventListener("keydown",this._onKeyDown,!1),window.document.addEventListener("mouseup",this._onMouseUp,!1),DOM.disableDrag(),this._startPos=DOM.mousePos(this._el,o),this._active=!0)},BoxZoomHandler.prototype._onMouseMove=function(o){var e=this._startPos,t=DOM.mousePos(this._el,o);this._box||(this._box=DOM.create("div","minemap-boxzoom",this._container),this._container.classList.add("minemap-crosshair"),this._fireEvent("boxzoomstart",o));var n=Math.min(e.x,t.x),i=Math.max(e.x,t.x),s=Math.min(e.y,t.y),r=Math.max(e.y,t.y);DOM.setTransform(this._box,"translate("+n+"px,"+s+"px)"),this._box.style.width=i-n+"px",this._box.style.height=r-s+"px"},BoxZoomHandler.prototype._onMouseUp=function(o){if(0===o.button){var e=this._startPos,t=DOM.mousePos(this._el,o),n=(new LngLatBounds).extend(this._map.unproject(e)).extend(this._map.unproject(t));this._finish(),DOM.suppressClick(),e.x===t.x&&e.y===t.y?this._fireEvent("boxzoomcancel",o):this._map.fitBounds(n,{linear:!0}).fire(new Event("boxzoomend",{originalEvent:o,boxZoomBounds:n}))}},BoxZoomHandler.prototype._onKeyDown=function(o){27===o.keyCode&&(this._finish(),this._fireEvent("boxzoomcancel",o))},BoxZoomHandler.prototype._finish=function(){this._active=!1,window.document.removeEventListener("mousemove",this._onMouseMove,!1),window.document.removeEventListener("keydown",this._onKeyDown,!1),window.document.removeEventListener("mouseup",this._onMouseUp,!1),this._container.classList.remove("minemap-crosshair"),this._box&&(DOM.remove(this._box),this._box=null),DOM.enableDrag()},BoxZoomHandler.prototype._fireEvent=function(o,e){return this._map.fire(new Event(o,{originalEvent:e}))},module.exports=BoxZoomHandler;
},{"../../geo/lng_lat_bounds":77,"../../util/dom":293,"../../util/evented":295,"../../util/util":315,"../../util/window":288}],273:[function(_dereq_,module,exports){
"use strict";var util=_dereq_("../../util/util"),DoubleClickZoomHandler=function(o){this._map=o,util.bindAll(["_onDblClick","_onZoomEnd"],this)};DoubleClickZoomHandler.prototype.isEnabled=function(){return!!this._enabled},DoubleClickZoomHandler.prototype.isActive=function(){return!!this._active},DoubleClickZoomHandler.prototype.enable=function(){this.isEnabled()||(this._enabled=!0)},DoubleClickZoomHandler.prototype.disable=function(){this.isEnabled()&&(this._enabled=!1)},DoubleClickZoomHandler.prototype.onTouchStart=function(o){var t=this;this.isEnabled()&&(o.points.length>1||(this._tapped?(clearTimeout(this._tapped),this._tapped=null,this._zoom(o)):this._tapped=setTimeout(function(){t._tapped=null},300)))},DoubleClickZoomHandler.prototype.onDblClick=function(o){this.isEnabled()&&(o.originalEvent.preventDefault(),this._zoom(o))},DoubleClickZoomHandler.prototype._zoom=function(o){this._active=!0,this._map.on("zoomend",this._onZoomEnd),this._map.zoomTo(this._map.getZoom()+(o.originalEvent.shiftKey?-1:1),{around:o.lngLat},o)},DoubleClickZoomHandler.prototype._onZoomEnd=function(){this._active=!1,this._map.off("zoomend",this._onZoomEnd)},module.exports=DoubleClickZoomHandler;
},{"../../util/util":315}],274:[function(_dereq_,module,exports){
"use strict";var DOM=_dereq_("../../util/dom"),util=_dereq_("../../util/util"),window=_dereq_("../../util/window"),browser=_dereq_("../../util/browser"),Event=_dereq_("../../util/evented").Event,inertiaLinearity=.3,inertiaEasing=util.bezier(0,0,inertiaLinearity,1),inertiaMaxSpeed=1400,inertiaDeceleration=2500,DragPanHandler=function(e){this._map=e,this._el=e.getCanvasContainer(),this._state="disabled",util.bindAll(["_onMove","_onMouseUp","_onTouchEnd","_onBlur","_onDragFrame"],this)};DragPanHandler.prototype.isEnabled=function(){return"disabled"!==this._state},DragPanHandler.prototype.isActive=function(){return"active"===this._state},DragPanHandler.prototype.enable=function(){this.isEnabled()||(this._el.classList.add("minemap-touch-drag-pan"),this._state="enabled")},DragPanHandler.prototype.disable=function(){if(this.isEnabled())switch(this._el.classList.remove("minemap-touch-drag-pan"),this._state){case"active":this._state="disabled",this._unbind(),this._deactivate(),this._fireEvent("dragend"),this._fireEvent("moveend");break;case"pending":this._state="disabled",this._unbind();break;default:this._state="disabled"}},DragPanHandler.prototype.onMouseDown=function(e){"enabled"===this._state&&(e.ctrlKey||0!==DOM.mouseButton(e)||(DOM.addEventListener(window.document,"mousemove",this._onMove,{capture:!0}),DOM.addEventListener(window.document,"mouseup",this._onMouseUp),this._start(e)))},DragPanHandler.prototype.onTouchStart=function(e){"enabled"===this._state&&(e.touches.length>1||(DOM.addEventListener(window.document,"touchmove",this._onMove,{capture:!0,passive:!1}),DOM.addEventListener(window.document,"touchend",this._onTouchEnd),this._start(e)))},DragPanHandler.prototype._start=function(e){window.addEventListener("blur",this._onBlur),this._state="pending",this._previousPos=DOM.mousePos(this._el,e),this._inertia=[[browser.now(),this._previousPos]]},DragPanHandler.prototype._onMove=function(e){this._lastMoveEvent=e,e.preventDefault(),this._pos=DOM.mousePos(this._el,e),this._drainInertiaBuffer(),this._inertia.push([browser.now(),this._pos]),"pending"===this._state&&(this._state="active",this._fireEvent("dragstart",e),this._fireEvent("movestart",e)),this._frameId||(this._frameId=this._map._requestRenderFrame(this._onDragFrame))},DragPanHandler.prototype._onDragFrame=function(){this._frameId=null;var e=this._lastMoveEvent;if(e){var t=this._map.transform;t.setLocationAtPoint(t.pointLocation(this._previousPos),this._pos),this._fireEvent("drag",e),this._fireEvent("move",e),this._previousPos=this._pos,delete this._lastMoveEvent}},DragPanHandler.prototype._onMouseUp=function(e){if(0===DOM.mouseButton(e))switch(this._state){case"active":this._state="enabled",DOM.suppressClick(),this._unbind(),this._deactivate(),this._inertialPan(e);break;case"pending":this._state="enabled",this._unbind()}},DragPanHandler.prototype._onTouchEnd=function(e){switch(this._state){case"active":this._state="enabled",this._unbind(),this._deactivate(),this._inertialPan(e);break;case"pending":this._state="enabled",this._unbind()}},DragPanHandler.prototype._onBlur=function(e){switch(this._state){case"active":this._state="enabled",this._unbind(),this._deactivate(),this._fireEvent("dragend",e),this._fireEvent("moveend",e);break;case"pending":this._state="enabled",this._unbind()}},DragPanHandler.prototype._unbind=function(){DOM.removeEventListener(window.document,"touchmove",this._onMove,{capture:!0,passive:!1}),DOM.removeEventListener(window.document,"touchend",this._onTouchEnd),DOM.removeEventListener(window.document,"mousemove",this._onMove,{capture:!0}),DOM.removeEventListener(window.document,"mouseup",this._onMouseUp),DOM.removeEventListener(window,"blur",this._onBlur)},DragPanHandler.prototype._deactivate=function(){this._frameId&&(this._map._cancelRenderFrame(this._frameId),this._frameId=null),delete this._lastMoveEvent,delete this._previousPos,delete this._pos},DragPanHandler.prototype._inertialPan=function(e){this._fireEvent("dragend",e),this._drainInertiaBuffer();var t=this._inertia;if(t.length<2)return void this._fireEvent("moveend",e);var i=t[t.length-1],n=t[0],a=i[1].sub(n[1]),s=(i[0]-n[0])/1e3;if(0===s||i[1].equals(n[1]))return void this._fireEvent("moveend",e);var r=a.mult(inertiaLinearity/s),o=r.mag();o>inertiaMaxSpeed&&(o=inertiaMaxSpeed,r._unit()._mult(o));var d=o/(inertiaDeceleration*inertiaLinearity),h=r.mult(-d/2);this._map.panBy(h,{duration:1e3*d,easing:inertiaEasing,noMoveStart:!0},{originalEvent:e})},DragPanHandler.prototype._fireEvent=function(e,t){return this._map.fire(new Event(e,t?{originalEvent:t}:{}))},DragPanHandler.prototype._drainInertiaBuffer=function(){for(var e=this._inertia,t=browser.now();e.length>0&&t-e[0][0]>160;)e.shift()},module.exports=DragPanHandler;
},{"../../util/browser":286,"../../util/dom":293,"../../util/evented":295,"../../util/util":315,"../../util/window":288}],275:[function(_dereq_,module,exports){
"use strict";var DOM=_dereq_("../../util/dom"),util=_dereq_("../../util/util"),window=_dereq_("../../util/window"),browser=_dereq_("../../util/browser"),Event=_dereq_("../../util/evented").Event,inertiaLinearity=.25,inertiaEasing=util.bezier(0,0,inertiaLinearity,1),inertiaMaxSpeed=180,inertiaDeceleration=720,DragRotateHandler=function(t,e){this._map=t,this._el=e.element||t.getCanvasContainer(),this._state="disabled",this._button=e.button||"right",this._bearingSnap=e.bearingSnap||0,this._pitchWithRotate=!1!==e.pitchWithRotate,util.bindAll(["_onMouseMove","_onMouseUp","_onBlur","_onDragFrame"],this)};DragRotateHandler.prototype.isEnabled=function(){return"disabled"!==this._state},DragRotateHandler.prototype.isActive=function(){return"active"===this._state},DragRotateHandler.prototype.enable=function(){this.isEnabled()||(this._state="enabled")},DragRotateHandler.prototype.disable=function(){if(this.isEnabled())switch(this._state){case"active":this._state="disabled",this._unbind(),this._deactivate(),this._fireEvent("rotateend"),this._pitchWithRotate&&this._fireEvent("pitchend"),this._fireEvent("moveend");break;case"pending":this._state="disabled",this._unbind();break;default:this._state="disabled"}},DragRotateHandler.prototype.onMouseDown=function(t){if("enabled"===this._state){if("right"===this._button){if(this._eventButton=DOM.mouseButton(t),this._eventButton!==(t.ctrlKey?0:2))return}else{if(t.ctrlKey||0!==DOM.mouseButton(t))return;this._eventButton=0}DOM.disableDrag(),window.document.addEventListener("mousemove",this._onMouseMove,{capture:!0}),window.document.addEventListener("mouseup",this._onMouseUp),window.addEventListener("blur",this._onBlur),this._state="pending",this._inertia=[[browser.now(),this._map.getBearing()]],this._previousPos=DOM.mousePos(this._el,t),this._center=this._map.transform.centerPoint,t.preventDefault()}},DragRotateHandler.prototype._onMouseMove=function(t){this._lastMoveEvent=t,this._pos=DOM.mousePos(this._el,t),"pending"===this._state&&(this._state="active",this._fireEvent("rotatestart",t),this._fireEvent("movestart",t),this._pitchWithRotate&&this._fireEvent("pitchstart",t)),this._frameId||(this._frameId=this._map._requestRenderFrame(this._onDragFrame))},DragRotateHandler.prototype._onDragFrame=function(){this._frameId=null;var t=this._lastMoveEvent;if(t){var e=this._map.transform,i=this._previousPos,n=this._pos,a=.8*(i.x-n.x),r=-.5*(i.y-n.y),s=e.bearing-a,o=e.pitch-r,h=this._inertia,_=h[h.length-1];this._drainInertiaBuffer(),h.push([browser.now(),this._map._normalizeBearing(s,_[1])]),e.bearing=s,this._pitchWithRotate&&(this._fireEvent("pitch",t),e.pitch=o),this._fireEvent("rotate",t),this._fireEvent("move",t),delete this._lastMoveEvent,this._previousPos=this._pos}},DragRotateHandler.prototype._onMouseUp=function(t){if(DOM.mouseButton(t)===this._eventButton)switch(this._state){case"active":this._state="enabled",DOM.suppressClick(),this._unbind(),this._deactivate(),this._inertialRotate(t);break;case"pending":this._state="enabled",this._unbind()}},DragRotateHandler.prototype._onBlur=function(t){switch(this._state){case"active":this._state="enabled",this._unbind(),this._deactivate(),this._fireEvent("rotateend",t),this._pitchWithRotate&&this._fireEvent("pitchend",t),this._fireEvent("moveend",t);break;case"pending":this._state="enabled",this._unbind()}},DragRotateHandler.prototype._unbind=function(){window.document.removeEventListener("mousemove",this._onMouseMove,{capture:!0}),window.document.removeEventListener("mouseup",this._onMouseUp),window.removeEventListener("blur",this._onBlur),DOM.enableDrag()},DragRotateHandler.prototype._deactivate=function(){this._frameId&&(this._map._cancelRenderFrame(this._frameId),this._frameId=null),delete this._lastMoveEvent,delete this._previousPos},DragRotateHandler.prototype._inertialRotate=function(t){var e=this;this._fireEvent("rotateend",t),this._drainInertiaBuffer();var i=this._map,n=i.getBearing(),a=this._inertia,r=function(){Math.abs(n)<e._bearingSnap?i.resetNorth({noMoveStart:!0},{originalEvent:t}):e._fireEvent("moveend",t),e._pitchWithRotate&&e._fireEvent("pitchend",t)};if(a.length<2)return void r();var s=a[0],o=a[a.length-1],h=a[a.length-2],_=i._normalizeBearing(n,h[1]),d=o[1]-s[1],u=d<0?-1:1,l=(o[0]-s[0])/1e3;if(0===d||0===l)return void r();var v=Math.abs(d*(inertiaLinearity/l));v>inertiaMaxSpeed&&(v=inertiaMaxSpeed);var p=v/(inertiaDeceleration*inertiaLinearity);_+=u*v*(p/2),Math.abs(i._normalizeBearing(_,0))<this._bearingSnap&&(_=i._normalizeBearing(0,_)),i.rotateTo(_,{duration:1e3*p,easing:inertiaEasing,noMoveStart:!0},{originalEvent:t})},DragRotateHandler.prototype._fireEvent=function(t,e){return this._map.fire(new Event(t,e?{originalEvent:e}:{}))},DragRotateHandler.prototype._drainInertiaBuffer=function(){for(var t=this._inertia,e=browser.now();t.length>0&&e-t[0][0]>160;)t.shift()},module.exports=DragRotateHandler;
},{"../../util/browser":286,"../../util/dom":293,"../../util/evented":295,"../../util/util":315,"../../util/window":288}],276:[function(_dereq_,module,exports){
"use strict";function easeOut(e){return e*(2-e)}var util=_dereq_("../../util/util"),panStep=100,bearingStep=15,pitchStep=10,KeyboardHandler=function(e){this._map=e,this._el=e.getCanvasContainer(),util.bindAll(["_onKeyDown"],this)};KeyboardHandler.prototype.isEnabled=function(){return!!this._enabled},KeyboardHandler.prototype.enable=function(){this.isEnabled()||(this._el.addEventListener("keydown",this._onKeyDown,!1),this._enabled=!0)},KeyboardHandler.prototype.disable=function(){this.isEnabled()&&(this._el.removeEventListener("keydown",this._onKeyDown),this._enabled=!1)},KeyboardHandler.prototype._onKeyDown=function(e){if(!(e.altKey||e.ctrlKey||e.metaKey)){var t=0,a=0,n=0,r=0,i=0;switch(e.keyCode){case 61:case 107:case 171:case 187:t=1;break;case 189:case 109:case 173:t=-1;break;case 37:e.shiftKey?a=-1:(e.preventDefault(),r=-1);break;case 39:e.shiftKey?a=1:(e.preventDefault(),r=1);break;case 38:e.shiftKey?n=1:(e.preventDefault(),i=-1);break;case 40:e.shiftKey?n=-1:(i=1,e.preventDefault());break;default:return}var s=this._map,o=s.getZoom(),l={duration:300,delayEndEvents:500,easing:easeOut,zoom:t?Math.round(o)+t*(e.shiftKey?2:1):o,bearing:s.getBearing()+a*bearingStep,pitch:s.getPitch()+n*pitchStep,offset:[-r*panStep,-i*panStep],center:s.getCenter()};s.easeTo(l,{originalEvent:e})}},module.exports=KeyboardHandler;
},{"../../util/util":315}],277:[function(_dereq_,module,exports){
"use strict";var DOM=_dereq_("../../util/dom"),util=_dereq_("../../util/util"),browser=_dereq_("../../util/browser"),window=_dereq_("../../util/window"),Event=_dereq_("../../util/evented").Event,LngLat=_dereq_("../../geo/lng_lat"),interpolate=_dereq_("../../style-spec/util/interpolate").number,wheelZoomDelta=4.000244140625,defaultZoomRate=.01,wheelZoomRate=1/450,maxScalePerFrame=2,ScrollZoomHandler=function(t){this._map=t,this._el=t.getCanvasContainer(),this._delta=0,util.bindAll(["_onWheel","_onTimeout","_onScrollFrame","_onScrollFinished"],this)};ScrollZoomHandler.prototype.isEnabled=function(){return!!this._enabled},ScrollZoomHandler.prototype.isActive=function(){return!!this._active},ScrollZoomHandler.prototype.enable=function(t){this.isEnabled()||(this._enabled=!0,this._aroundCenter=t&&"center"===t.around)},ScrollZoomHandler.prototype.disable=function(){this.isEnabled()&&(this._enabled=!1)},ScrollZoomHandler.prototype.onWheel=function(t){if(this.isEnabled()){var e=t.deltaMode===window.WheelEvent.DOM_DELTA_LINE?40*t.deltaY:t.deltaY,i=browser.now(),o=i-(this._lastWheelEventTime||0);this._lastWheelEventTime=i,0!==e&&e%wheelZoomDelta==0?this._type="wheel":0!==e&&Math.abs(e)<4?this._type="trackpad":o>400?(this._type=null,this._lastValue=e,this._timeout=setTimeout(this._onTimeout,40,t)):this._type||(this._type=Math.abs(o*e)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,e+=this._lastValue)),t.shiftKey&&e&&(e/=4),this._type&&(this._lastWheelEvent=t,this._delta-=e,this.isActive()||this._start(t)),t.preventDefault()}},ScrollZoomHandler.prototype._onTimeout=function(t){this._type="wheel",this._delta-=this._lastValue,this.isActive()||this._start(t)},ScrollZoomHandler.prototype._start=function(t){if(this._delta){this._frameId&&(this._map._cancelRenderFrame(this._frameId),this._frameId=null),this._active=!0,this._map.fire(new Event("movestart",{originalEvent:t})),this._map.fire(new Event("zoomstart",{originalEvent:t})),this._finishTimeout&&clearTimeout(this._finishTimeout);var e=DOM.mousePos(this._el,t);this._around=LngLat.convert(this._aroundCenter?this._map.getCenter():this._map.unproject(e)),this._aroundPoint=this._map.transform.locationPoint(this._around),this._frameId||(this._frameId=this._map._requestRenderFrame(this._onScrollFrame))}},ScrollZoomHandler.prototype._onScrollFrame=function(){var t=this;if(this._frameId=null,this.isActive()){var e=this._map.transform;if(0!==this._delta){var i="wheel"===this._type&&Math.abs(this._delta)>wheelZoomDelta?wheelZoomRate:defaultZoomRate,o=maxScalePerFrame/(1+Math.exp(-Math.abs(this._delta*i)));this._delta<0&&0!==o&&(o=1/o);var a="number"==typeof this._targetZoom?e.zoomScale(this._targetZoom):e.scale;this._targetZoom=Math.min(e.maxZoom,Math.max(e.minZoom,e.scaleZoom(a*o))),"wheel"===this._type&&(this._startZoom=e.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}var s=!1;if("wheel"===this._type){var r=Math.min((browser.now()-this._lastWheelEventTime)/200,1),n=this._easing(r);e.zoom=interpolate(this._startZoom,this._targetZoom,n),r<1?this._frameId||(this._frameId=this._map._requestRenderFrame(this._onScrollFrame)):s=!0}else e.zoom=this._targetZoom,s=!0;e.setLocationAtPoint(this._around,this._aroundPoint),this._map.fire(new Event("move",{originalEvent:this._lastWheelEvent})),this._map.fire(new Event("zoom",{originalEvent:this._lastWheelEvent})),s&&(this._active=!1,this._finishTimeout=setTimeout(function(){t._map.fire(new Event("zoomend",{originalEvent:t._lastWheelEvent})),t._map.fire(new Event("moveend",{originalEvent:t._lastWheelEvent})),delete t._targetZoom},200))}},ScrollZoomHandler.prototype._smoothOutEasing=function(t){var e=util.ease;if(this._prevEase){var i=this._prevEase,o=(browser.now()-i.start)/i.duration,a=i.easing(o+.01)-i.easing(o),s=.27/Math.sqrt(a*a+1e-4)*.01,r=Math.sqrt(.0729-s*s);e=util.bezier(s,r,.25,1)}return this._prevEase={start:browser.now(),duration:t,easing:e},e},module.exports=ScrollZoomHandler;
},{"../../geo/lng_lat":76,"../../style-spec/util/interpolate":178,"../../util/browser":286,"../../util/dom":293,"../../util/evented":295,"../../util/util":315,"../../util/window":288}],278:[function(_dereq_,module,exports){
"use strict";var DOM=_dereq_("../../util/dom"),util=_dereq_("../../util/util"),window=_dereq_("../../util/window"),browser=_dereq_("../../util/browser"),Event=_dereq_("../../util/evented").Event,inertiaLinearity=.15,inertiaEasing=util.bezier(0,0,inertiaLinearity,1),inertiaDeceleration=12,inertiaMaxSpeed=2.5,significantScaleThreshold=.15,significantRotateThreshold=10,TouchZoomRotateHandler=function(t){this._map=t,this._el=t.getCanvasContainer(),util.bindAll(["_onMove","_onEnd","_onTouchFrame"],this)};TouchZoomRotateHandler.prototype.isEnabled=function(){return!!this._enabled},TouchZoomRotateHandler.prototype.enable=function(t){this.isEnabled()||(this._el.classList.add("minemap-touch-zoom-rotate"),this._enabled=!0,this._aroundCenter=!!t&&"center"===t.around)},TouchZoomRotateHandler.prototype.disable=function(){this.isEnabled()&&(this._el.classList.remove("minemap-touch-zoom-rotate"),this._enabled=!1)},TouchZoomRotateHandler.prototype.disableRotation=function(){this._rotationDisabled=!0},TouchZoomRotateHandler.prototype.enableRotation=function(){this._rotationDisabled=!1},TouchZoomRotateHandler.prototype.onStart=function(t){if(this.isEnabled()&&2===t.touches.length){var e=DOM.mousePos(this._el,t.touches[0]),i=DOM.mousePos(this._el,t.touches[1]);this._startVec=e.sub(i),this._gestureIntent=void 0,this._inertia=[],DOM.addEventListener(window.document,"touchmove",this._onMove,{passive:!1}),DOM.addEventListener(window.document,"touchend",this._onEnd)}},TouchZoomRotateHandler.prototype._getTouchEventData=function(t){var e=DOM.mousePos(this._el,t.touches[0]),i=DOM.mousePos(this._el,t.touches[1]),n=e.sub(i);return{vec:n,center:e.add(i).div(2),scale:n.mag()/this._startVec.mag(),bearing:this._rotationDisabled?0:180*n.angleWith(this._startVec)/Math.PI}},TouchZoomRotateHandler.prototype._onMove=function(t){if(2===t.touches.length){var e=this._getTouchEventData(t),i=e.vec,n=e.scale,o=e.bearing;if(!this._gestureIntent){var a=Math.abs(1-n)>significantScaleThreshold;Math.abs(o)>significantRotateThreshold?this._gestureIntent="rotate":a&&(this._gestureIntent="zoom"),this._gestureIntent&&(this._map.fire(new Event(this._gestureIntent+"start",{originalEvent:t})),this._map.fire(new Event("movestart",{originalEvent:t})),this._startVec=i)}this._lastTouchEvent=t,this._frameId||(this._frameId=this._map._requestRenderFrame(this._onTouchFrame)),t.preventDefault()}},TouchZoomRotateHandler.prototype._onTouchFrame=function(){this._frameId=null;var t=this._gestureIntent;if(t){var e=this._map.transform;this._startScale||(this._startScale=e.scale,this._startBearing=e.bearing);var i=this._getTouchEventData(this._lastTouchEvent),n=i.center,o=i.bearing,a=i.scale,r=e.pointLocation(n),s=e.locationPoint(r);"rotate"===t&&(e.bearing=this._startBearing+o),e.zoom=e.scaleZoom(this._startScale*a),e.setLocationAtPoint(r,s),this._map.fire(new Event(t,{originalEvent:this._lastTouchEvent})),this._map.fire(new Event("move",{originalEvent:this._lastTouchEvent})),this._drainInertiaBuffer(),this._inertia.push([browser.now(),a,n])}},TouchZoomRotateHandler.prototype._onEnd=function(t){DOM.removeEventListener(window.document,"touchmove",this._onMove,{passive:!1}),DOM.removeEventListener(window.document,"touchend",this._onEnd);var e=this._gestureIntent,i=this._startScale;if(this._frameId&&(this._map._cancelRenderFrame(this._frameId),this._frameId=null),delete this._gestureIntent,delete this._startScale,delete this._startBearing,delete this._lastTouchEvent,e){this._map.fire(new Event(e+"end",{originalEvent:t})),this._drainInertiaBuffer();var n=this._inertia,o=this._map;if(n.length<2)return void o.snapToNorth({},{originalEvent:t});var a=n[n.length-1],r=n[0],s=o.transform.scaleZoom(i*a[1]),h=o.transform.scaleZoom(i*r[1]),u=s-h,l=(a[0]-r[0])/1e3,c=a[2];if(0===l||s===h)return void o.snapToNorth({},{originalEvent:t});var d=u*inertiaLinearity/l;Math.abs(d)>inertiaMaxSpeed&&(d=d>0?inertiaMaxSpeed:-inertiaMaxSpeed);var _=1e3*Math.abs(d/(inertiaDeceleration*inertiaLinearity)),m=s+d*_/2e3;m<0&&(m=0),o.easeTo({zoom:m,duration:_,easing:inertiaEasing,around:this._aroundCenter?o.getCenter():o.unproject(c),noMoveStart:!0},{originalEvent:t})}},TouchZoomRotateHandler.prototype._drainInertiaBuffer=function(){for(var t=this._inertia,e=browser.now();t.length>2&&e-t[0][0]>160;)t.shift()},module.exports=TouchZoomRotateHandler;
},{"../../util/browser":286,"../../util/dom":293,"../../util/evented":295,"../../util/util":315,"../../util/window":288}],279:[function(_dereq_,module,exports){
"use strict";var util=_dereq_("../util/util"),window=_dereq_("../util/window"),throttle=_dereq_("../util/throttle"),Hash=function(){util.bindAll(["_onHashChange","_updateHash"],this),this._updateHash=throttle(this._updateHashUnthrottled.bind(this),300)};Hash.prototype.addTo=function(t){return this._map=t,window.addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this},Hash.prototype.remove=function(){return window.removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),delete this._map,this},Hash.prototype.getHashString=function(t){var e=this._map.getCenter(),h=Math.round(100*this._map.getZoom())/100,a=Math.ceil((h*Math.LN2+Math.log(512/360/.5))/Math.LN10),i=Math.pow(10,a),n=Math.round(e.lng*i)/i,o=Math.round(e.lat*i)/i,s=this._map.getBearing(),r=this._map.getPitch(),u="";return u+=t?"#/"+n+"/"+o+"/"+h:"#"+h+"/"+o+"/"+n,(s||r)&&(u+="/"+Math.round(10*s)/10),r&&(u+="/"+Math.round(r)),u},Hash.prototype._onHashChange=function(){var t=window.location.hash.replace("#","").split("/");return t.length>=3&&(this._map.jumpTo({center:[+t[2],+t[1]],zoom:+t[0],bearing:+(t[3]||0),pitch:+(t[4]||0)}),!0)},Hash.prototype._updateHashUnthrottled=function(){var t=this.getHashString();window.history.replaceState(window.history.state,"",t)},module.exports=Hash;
},{"../util/throttle":312,"../util/util":315,"../util/window":288}],280:[function(_dereq_,module,exports){
"use strict";var util=_dereq_("../util/util"),DOM=_dereq_("../util/dom"),defaultOptions={imageUrl:"",imageSize:[40,40],imgOffset:[-20,-20]},Icon=function(t){this.options=util.extend({},defaultOptions,t),this.domList=[]};Icon.prototype.setImageUrl=function(t){var i=this;this.options.imageUrl=t;for(var e=0;e<this.domList.length;e++)i.domList[e].img.src=t},Icon.prototype.setImageSize=function(t){var i=this;this.options.imageSize=t;for(var e=0;e<this.domList.length;e++)i.domList[e].img.style.width=t[0]+"px",i.domList[e].img.style.height=t[1]+"px"},Icon.prototype.setImageOffset=function(t){this.options.imgOffset=t},Icon.prototype.getImageOffset=function(){return this.options.imgOffset},Icon.prototype._getElement=function(){var t=DOM.create("div"),i=DOM.create("img");return i.src=this.options.imageUrl,t.classList.add("minemap-icon"),t.appendChild(i),t.style.width=this.options.imageSize[0]+"px",t.style.height=this.options.imageSize[1]+"px",i.style.width=this.options.imageSize[0]+"px",i.style.height=this.options.imageSize[1]+"px",this.domList.push({img:i,wrap:t}),t},module.exports=Icon;
},{"../util/dom":293,"../util/util":315}],281:[function(_dereq_,module,exports){
"use strict";function removeNode(t){t.parentNode&&t.parentNode.removeChild(t)}function contains(t,e){for(var r=t.length;r--;)if(t[r]===e)return!0;return!1}function getElementOffset(t){for(var e=t.offsetTop,r=t.offsetLeft,o=t.offsetWidth,i=t.offsetHeight;t=t.offsetParent;)e+=t.offsetTop,r+=t.offsetLeft;return{top:e,left:r,width:o,height:i}}var util=_dereq_("../util/util"),browser=_dereq_("../util/browser"),window=_dereq_("../util/window"),ref=_dereq_("../util/window"),HTMLImageElement=ref.HTMLImageElement,HTMLElement=ref.HTMLElement,DOM=_dereq_("../util/dom"),ajax=_dereq_("../util/ajax"),Marker=_dereq_("./marker"),Style=_dereq_("../style/style"),EvaluationParameters=_dereq_("../style/evaluation_parameters"),Painter=_dereq_("../render/painter"),Transform=_dereq_("../geo/transform"),Hash=_dereq_("./hash"),bindHandlers=_dereq_("./bind_handlers"),Camera=_dereq_("./camera"),LngLat=_dereq_("../geo/lng_lat"),LngLatBounds=_dereq_("../geo/lng_lat_bounds"),Point=_dereq_("../_minemap_/point-geometry"),AttributionControl=_dereq_("./control/attribution_control"),LogoControl=_dereq_("./control/logo_control"),isSupported=_dereq_("../_minemap_/minemap-supported"),ref$1=_dereq_("../util/image"),RGBAImage=ref$1.RGBAImage,Event=_dereq_("../util/evented").Event,ErrorEvent=_dereq_("../util/evented").ErrorEvent;_dereq_("./events");var Drag=_dereq_("../util/drag"),TaskQueue=_dereq_("../util/task_queue"),tileDrawHelper=_dereq_("../gl/tile_draw_helper"),defaultMinZoom=0,defaultMaxZoom=22,defaultOptions={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:defaultMinZoom,maxZoom:defaultMaxZoom,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,bearingSnap:7,hash:!1,logoControl:!0,attributionControl:!0,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,maxTileCacheSize:null,transformRequest:null,fadeDuration:300,localIdeographFontFamily:"PingFang SC,Microsoft YaHei,,Arial,sans-serif,",defaultCursor:null},Map=function(t){function e(e){if(e=util.extend({},defaultOptions,e),null!=e.minZoom&&null!=e.maxZoom&&e.minZoom>e.maxZoom)throw new Error("maxZoom must be greater than minZoom");var r=new Transform(e.minZoom,e.maxZoom,e.renderWorldCopies);t.call(this,r,e),this._interactive=e.interactive,this._maxTileCacheSize=e.maxTileCacheSize,this._failIfMajorPerformanceCaveat=e.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=e.preserveDrawingBuffer,this._trackResize=e.trackResize,this._bearingSnap=e.bearingSnap,this._refreshExpiredTiles=e.refreshExpiredTiles,this._fadeDuration=e.fadeDuration,this._crossFadingFactor=1,this._collectResourceTiming=e.collectResourceTiming,this._renderTaskQueue=new TaskQueue;var o=e.transformRequest;if(this._transformRequest=o?function(t,e){return o(t,e)||{url:t}}:function(t){return{url:t}},this.__sourceList=[],this.__layersList=[],this.__markerList=[],this.__overlayList=[],"string"==typeof e.container){var i=window.document.getElementById(e.container);if(!i)throw new Error("Container '"+e.container+"' not found.");this._container=i}else{if(!(e.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=e.container}e.maxBounds&&this.setMaxBounds(e.maxBounds),this.__markerList=[],util.bindAll(["_onWindowOnline","_onWindowResize","_contextLost","_contextRestored","_update","_render","_onData","_onDataLoading"],this),this._setupContainer(),this._setupPainter(),this.on("move",this._update.bind(this,!1)),this.on("zoom",this._update.bind(this,!0)),void 0!==window&&(window.addEventListener("online",this._onWindowOnline,!1),window.addEventListener("resize",this._onWindowResize,!1)),bindHandlers(this,e),this._hash=e.hash&&(new Hash).addTo(this),this._hash&&this._hash._onHashChange()||this.jumpTo({center:e.center,zoom:e.zoom,bearing:e.bearing,pitch:e.pitch}),this.resize(),e.style&&this.setStyle(e.style,{localIdeographFontFamily:e.localIdeographFontFamily}),e.attributionControl&&this.addControl(new AttributionControl),e.logoControl&&this.addControl(new LogoControl,e.logoPosition),this.on("style.load",function(){this.transform.unmodified&&this.jumpTo(this.style.stylesheet)}),this.on("data",this._onData),this.on("dataloading",this._onDataLoading),this._overviewMapOptions=e,e.overviewMap?(this._overviewMap=!0,this.addOverviewMap()):this._overviewMap=!1,this.setDefaultCursor(e.defaultCursor)}t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e;var r={overviewMap:{},showTileBoundaries:{},showCollisionBoxes:{},showOverdrawInspector:{},repaint:{},vertices:{}};return e.prototype.__onMove=function(t){this.overviewMapInstance.setCenter(this.getCenter()),this.overviewMapInstance.setBearing(this.getBearing()),this.overviewMapInstance.setZoom(this.getZoom()<6?3:this.getZoom()-4)},e.prototype.disableDrag=function(){this.dragPan.disable()},e.prototype.enableDrag=function(){this.dragPan.enable()},e.prototype.getMapCursor=function(){return this.getCanvas().style.cursor},e.prototype.setMapCursor=function(t){this.getCanvas().style.cursor=t},e.prototype.addOverviewMap=function(){var t=this;this._overviewMapElement=window.document.createElement("div"),this._overviewMapElement.id="overviewMap_"+Math.random(),this._overviewMapElement.style.position="absolute",this._overviewMapElement.style.width="160px",this._overviewMapElement.style.height="160px",this._overviewMapElement.style.bottom="0px",this._overviewMapElement.style.right="0px",this._overviewMapElement.style.zIndex=200,this._overviewMapElement.style.boxSizing="border-box",this._overviewMapElement.style.border="2px solid rgba(187,187,187,0.5)",this._overviewMapElement.style.borderRadius="2px";var r=this.getContainer().parentNode.parentNode;getElementOffset(r);r.appendChild(this._overviewMapElement),this.overviewMapInstance=new e({container:this._overviewMapElement,style:this._overviewMapOptions.style,center:this.getCenter(),zoom:this.getZoom()<7?3:this.getZoom()-4,pitch:0,dragPan:!1,doubleClickZoom:!1,scrollZoom:!1,dragRotate:!1,maxZoom:17,minZoom:3,logoControl:!1,preserveDrawingBuffer:!0}),this.on("moveend",this.__onMove),setTimeout(function(){var e=window.document.createElement("div");t.overviewMapInstance.getCanvas().style.cursor="";var r=t.getBounds(),o=t.overviewMapInstance.project(r.getSouthWest()),i=t.overviewMapInstance.project(r.getNorthEast());i.y<=45&&(i=new Point(i.x,45)),o.x<=45&&(o=new Point(45,o.y)),e.style.top=Math.round(i.y)+"px",e.style.left=Math.round(o.x)+"px",e.style.width=Math.round(160-2*o.x)+"px",e.style.height=Math.round(160-2*i.y)+"px",e.style.border="2px solid red",e.style.position="absolute",t._overviewMapElement.appendChild(e),Drag.init({handler:t._overviewMapElement,root:e,restrictX:2*Math.round(o.x),restrictY:2*Math.round(i.y),cb:function(r,n){if(r-Math.round(o.x)!=0||n-Math.round(i.y)!=0){var s=t.overviewMapInstance.unproject([r-Math.round(o.x)+80,n-Math.round(i.y)+80]);t.flyTo({center:s,bearing:t.overviewMapInstance.getBearing()}),e.style.top=Math.round(i.y)+"px",e.style.left=Math.round(o.x)+"px"}}})},1e3)},r.overviewMap.set=function(t){this._overviewMap=t,this.overviewMapInstance?this._overviewMapElement.style.display=t?"block":"none":t&&this.addOverviewMap()},r.overviewMap.get=function(){return this._overviewMap},e.prototype.addControl=function(t,e){void 0===e&&t.getDefaultPosition&&(e=t.getDefaultPosition()),void 0===e&&(e="top-right");var r=t.onAdd(this),o=this._controlPositions[e];return-1!==e.indexOf("bottom")?o.insertBefore(r,o.firstChild):o.appendChild(r),this},e.prototype.removeControl=function(t){return t.onRemove(this),this},e.prototype.resize=function(t){var e=this._containerDimensions(),r=e[0],o=e[1];return this._resizeCanvas(r,o),this.transform.resize(r,o),this.painter.resize(r,o),this.fire(new Event("movestart",t)).fire(new Event("move",t)).fire(new Event("resize",t)).fire(new Event("moveend",t))},e.prototype.getBounds=function(){var t=new LngLatBounds(this.transform.pointLocation(new Point(0,this.transform.height)),this.transform.pointLocation(new Point(this.transform.width,0)));return(this.transform.angle||this.transform.pitch)&&(t.extend(this.transform.pointLocation(new Point(this.transform.size.x,0))),t.extend(this.transform.pointLocation(new Point(0,this.transform.size.y)))),t},e.prototype.getMaxBounds=function(){return this.transform.latRange&&2===this.transform.latRange.length&&this.transform.lngRange&&2===this.transform.lngRange.length?new LngLatBounds([this.transform.lngRange[0],this.transform.latRange[0]],[this.transform.lngRange[1],this.transform.latRange[1]]):null},e.prototype.setMaxBounds=function(t){if(t){var e=LngLatBounds.convert(t);this.transform.lngRange=[e.getWest(),e.getEast()],this.transform.latRange=[e.getSouth(),e.getNorth()],this.transform._constrain(),this._update()}else null!==t&&void 0!==t||(this.transform.lngRange=null,this.transform.latRange=null,this._update());return this},e.prototype.setMinZoom=function(t){if((t=null===t||void 0===t?defaultMinZoom:t)>=defaultMinZoom&&t<=this.transform.maxZoom)return this.transform.minZoom=t,this._update(),this.getZoom()<t&&this.setZoom(t),this;throw new Error("minZoom must be between "+defaultMinZoom+" and the current maxZoom, inclusive")},e.prototype.getMinZoom=function(){return this.transform.minZoom},e.prototype.setMaxZoom=function(t){if((t=null===t||void 0===t?defaultMaxZoom:t)>=this.transform.minZoom)return this.transform.maxZoom=t,this._update(),this.getZoom()>t&&this.setZoom(t),this;throw new Error("maxZoom must be greater than the current minZoom")},e.prototype.getRenderWorldCopies=function(){return this.transform.renderWorldCopies},e.prototype.setRenderWorldCopies=function(t){return this.transform.renderWorldCopies=t,this._update(),this},e.prototype.getMaxZoom=function(){return this.transform.maxZoom},e.prototype.project=function(t){return this.transform.locationPoint(LngLat.convert(t))},e.prototype.unproject=function(t){return this.transform.pointLocation(Point.convert(t))},e.prototype.isMoving=function(){return this._moving||this.dragPan.isActive()||this.dragRotate.isActive()||this.scrollZoom.isActive()},e.prototype.isZooming=function(){return this._zooming||this.scrollZoom.isActive()},e.prototype.isRotating=function(){return this._rotating||this.dragRotate.isActive()},e.prototype.on=function(e,r,o){var i=this;if(void 0===o)return t.prototype.on.call(this,e,r);var n=function(){if("mouseenter"===e||"mouseover"===e){var t=!1;return{layer:r,listener:o,delegates:{mousemove:function(n){var s=i.getLayer(r)?i.queryRenderedFeatures(n.point,{layers:[r]}):[];s.length?t||(t=!0,o.call(i,new MapMouseEvent(e,i,n.originalEvent,{features:s}))):t=!1},mouseout:function(){t=!1}}}}if("mouseleave"===e||"mouseout"===e){var n=!1;return{layer:r,listener:o,delegates:{mousemove:function(t){(i.getLayer(r)?i.queryRenderedFeatures(t.point,{layers:[r]}):[]).length?n=!0:n&&(n=!1,o.call(i,new MapMouseEvent(e,i,t.originalEvent)))},mouseout:function(t){n&&(n=!1,o.call(i,new MapMouseEvent(e,i,t.originalEvent)))}}}}var s=function(t){var e=i.getLayer(r)?i.queryRenderedFeatures(t.point,{layers:[r]}):[];e.length&&(t.features=e,o.call(i,t),delete t.features)};return{layer:r,listener:o,delegates:(a={},a[e]=s,a)};var a}();this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[e]=this._delegatedListeners[e]||[],this._delegatedListeners[e].push(n);for(var s in n.delegates)i.on(s,n.delegates[s]);return this},e.prototype.off=function(e,r,o){var i=this;if(void 0===o)return t.prototype.off.call(this,e,r);if(this._delegatedListeners&&this._delegatedListeners[e])for(var n=this._delegatedListeners[e],s=0;s<n.length;s++){var a=n[s];if(a.layer===r&&a.listener===o){for(var h in a.delegates)i.off(h,a.delegates[h]);return n.splice(s,1),i}}return this},e.prototype.queryRenderedFeatures=function(t,e){return 2===arguments.length?(t=arguments[0],e=arguments[1]):1===arguments.length&&function(t){return t instanceof Point||Array.isArray(t)}(arguments[0])?(t=arguments[0],e={}):1===arguments.length?(t=void 0,e=arguments[0]):(t=void 0,e={}),this.style?this.style.queryRenderedFeatures(this._makeQueryGeometry(t),e,this.transform):[]},e.prototype._makeQueryGeometry=function(t){var e=this;void 0===t&&(t=[Point.convert([0,0]),Point.convert([this.transform.width,this.transform.height])]);var r;if(t instanceof Point||"number"==typeof t[0]){r=[Point.convert(t)]}else{var o=[Point.convert(t[0]),Point.convert(t[1])];r=[o[0],new Point(o[1].x,o[0].y),o[1],new Point(o[0].x,o[1].y),o[0]]}return r=r.map(function(t){return e.transform.pointCoordinate(t)})},e.prototype.querySourceFeatures=function(t,e){return this.style.querySourceFeatures(t,e)},e.prototype.setStyle=function(t,e){if((!e||!1!==e.diff&&!e.localIdeographFontFamily)&&this.style&&t&&"object"==typeof t)try{return this.style.setState(t)&&this._update(!0),this}catch(t){}return this.style&&(this.style.setEventedParent(null),this.style._remove()),t?(this.style=new Style(this,e||{}),this.style.setEventedParent(this,{style:this.style}),"string"==typeof t?this.style.loadURL(t):this.style.loadJSON(t),this):(delete this.style,this)},e.prototype.getStyle=function(){if(this.style)return this.style.serialize()},e.prototype.isStyleLoaded=function(){return this.style?this.style.loaded():util.warnOnce("There is no style added to the map.")},e.prototype.addSource=function(t,e){return this.style.addSource(t,e),this._update(!0),this},e.prototype.isSourceLoaded=function(t){var e=this.style&&this.style.sourceCaches[t];return void 0===e?void this.fire(new ErrorEvent(new Error("There is no source with ID '"+t+"'"))):e.loaded()},e.prototype.areTilesLoaded=function(){var t=this.style&&this.style.sourceCaches;for(var e in t){var r=t[e],o=r._tiles;for(var i in o){var n=o[i];if("loaded"!==n.state&&"errored"!==n.state)return!1}}return!0},e.prototype.addSourceType=function(t,e,r){return this.style.addSourceType(t,e,r)},e.prototype.removeSource=function(t){return this.style.removeSource(t),this._update(!0),this},e.prototype.getMapPoisByPoint=function(t){for(var e=this.queryRenderedFeatures(t),r=[],o=0;o<e.length;o++)"Point"===e[o].geometry.type&&r.push(e[o]);return r},e.prototype.removeAllOverlay=function(t){var e=this;!t||t&&"all"===t.type?(this.__layersList.map(function(t){e.removeLayer(t)}),this.__layersList=[],this.__sourceList.map(function(t){e.removeSource(t)}),this.__sourceList=[],this.removeMarkers(),this.fire("deletealltheoverlays")):"layer"===t.type?(this.__layersList.map(function(t){e.removeLayer(t)}),this.__layersList=[],this.__sourceList.map(function(t){e.removeSource(t)}),this.__sourceList=[],this.fire("deletealltheoverlays-layer")):"marker"===t.type&&(this.removeMarkers(),this.fire("deletealltheoverlays-marker"))},e.prototype.getSource=function(t){return this.style.getSource(t)},e.prototype.addImage=function(t,e,r){void 0===r&&(r={});var o=r.pixelRatio;void 0===o&&(o=1);var i=r.sdf;if(void 0===i&&(i=!1),e instanceof HTMLImageElement){var n=browser.getImageData(e),s=n.width,a=n.height,h=n.data;this.style.addImage(t,{data:new RGBAImage({width:s,height:a},h),pixelRatio:o,sdf:i})}else{if(void 0===e.width||void 0===e.height)return this.fire(new ErrorEvent(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));var l=e.width,u=e.height,p=e.data;this.style.addImage(t,{data:new RGBAImage({width:l,height:u},p.slice(0)),pixelRatio:o,sdf:i})}},e.prototype.hasImage=function(t){return t?!!this.style.getImage(t):(this.fire(new ErrorEvent(new Error("Missing required image id"))),!1)},e.prototype.removeImage=function(t){this.style.removeImage(t)},e.prototype.loadImage=function(t,e){ajax.getImage(this._transformRequest(t,ajax.ResourceType.Image),e)},e.prototype.addLayer=function(t,e){return this.style.addLayer(t,e),this._update(!0),this},e.prototype.moveLayer=function(t,e){return this.style.moveLayer(t,e),this._update(!0),this},e.prototype.removeLayer=function(t){return this.style.removeLayer(t),this._update(!0),this},e.prototype.getLayer=function(t){return this.style.getLayer(t)},e.prototype.setFilter=function(t,e){return this.style.setFilter(t,e),this._update(!0),this},e.prototype.setLayerZoomRange=function(t,e,r){return this.style.setLayerZoomRange(t,e,r),this._update(!0),this},e.prototype.getAllMarkers=function(){return this.__markerList},e.prototype._addToOverlayList=function(t){contains(this.__overlayList,t)||this.__overlayList.push(t)},e.prototype._removeFromOverlayList=function(t){for(var e=this,r=0;r<this.__overlayList.length;r++)if(t===e.__overlayList[r]){e.__overlayList.splice(r,1);break}},e.prototype.getAllOverlay=function(){return this.__overlayList},e.prototype.addMarker=function(t){!contains(this.__markerList,t)&&t instanceof Marker&&(this.__markerList.push(t),t.addTo(this))},e.prototype.addMarkers=function(t){for(var e=this,r=0;r<t.length;r++)e.addMarker(t[r])},e.prototype.removeMarker=function(t){t instanceof Marker&&t.remove()},e.prototype.removeMarkers=function(t){var e=this;if(t)for(var r=0;r<t.length;r++){e.removeMarker(t[r]);for(var o=0;o<this.__markerList.length;o++)t[r]===e.__markerList[o]&&e.__markerList.splice(o,1)}else{for(var i=0;i<this.__markerList.length;i++)e.removeMarker(e.__markerList[i]);this.__markerList=[]}},e.prototype.getFilter=function(t){return this.style.getFilter(t)},e.prototype.setPaintProperty=function(t,e,r){return this.style.setPaintProperty(t,e,r),this._update(!0),this},e.prototype.getPaintProperty=function(t,e){return this.style.getPaintProperty(t,e)},e.prototype.setLayoutProperty=function(t,e,r){return this.style.setLayoutProperty(t,e,r),this._update(!0),this},e.prototype.getLayoutProperty=function(t,e){return this.style.getLayoutProperty(t,e)},e.prototype.setLight=function(t){return this.style.setLight(t),this._update(!0),this},e.prototype.getLight=function(){return this.style.getLight()},e.prototype.getContainer=function(){return this._container},e.prototype.getCanvasContainer=function(){return this._canvasContainer},e.prototype.getCanvas=function(){return this._canvas},e.prototype._containerDimensions=function(){var t=0,e=0;return this._container&&(t=this._container.offsetWidth||400,e=this._container.offsetHeight||300),[t,e]},e.prototype._setupContainer=function(){var t=this._container;t.classList.add("minemap-map"),(this._missingCSSContainer=DOM.create("div","minemap-missing-css",t)).innerHTML="minemap.css";var e=this._canvasContainer=DOM.create("div","minemap-canvas-container",t);this._interactive&&e.classList.add("minemap-interactive"),this._canvas=DOM.create("canvas","minemap-canvas",e),this._canvas.style.position="absolute",this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label","Map");var r=this._containerDimensions();this._resizeCanvas(r[0],r[1]);var o=this._controlContainer=DOM.create("div","minemap-control-container",t),i=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(function(t){i[t]=DOM.create("div","minemap-ctrl-"+t,o)})},e.prototype._resizeCanvas=function(t,e){var r=window.devicePixelRatio||1;this._canvas.width=r*t,this._canvas.height=r*e,this._canvas.style.width=t+"px",this._canvas.style.height=e+"px"},e.prototype._setupPainter=function(){var t=util.extend({failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer},isSupported.webGLContextAttributes),e=this._canvas.getContext("webgl",t)||this._canvas.getContext("experimental-webgl",t);if(!e)return void this.fire(new ErrorEvent(new Error("Failed to initialize WebGL")));this.painter=new Painter(e,this.transform)},e.prototype._contextLost=function(t){t.preventDefault(),this._frameId&&(browser.cancelFrame(this._frameId),this._frameId=null),this.fire(new Event("webglcontextlost",{originalEvent:t}))},e.prototype._contextRestored=function(t){this._setupPainter(),this.resize(),this._update(),this.fire(new Event("webglcontextrestored",{originalEvent:t}))},e.prototype.loaded=function(){return!this._styleDirty&&!this._sourcesDirty&&!(!this.style||!this.style.loaded())},e.prototype._update=function(t){this.style&&(this._styleDirty=this._styleDirty||t,this._sourcesDirty=!0,this._rerender())},e.prototype._requestRenderFrame=function(t){return this._update(),this._renderTaskQueue.add(t)},e.prototype._cancelRenderFrame=function(t){this._renderTaskQueue.remove(t)},e.prototype._render=function(){this._renderTaskQueue.run();var t=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;var e=this.transform.zoom,r=browser.now();this.style.zoomHistory.update(e,r);var o=new EvaluationParameters(e,{now:r,fadeDuration:this._fadeDuration,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),i=o.crossFadingFactor();1===i&&i===this._crossFadingFactor||(t=!0,this._crossFadingFactor=i),this.style.update(o)}return this.style&&this._sourcesDirty&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,this._fadeDuration),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),fadeDuration:this._fadeDuration}),this.fire(new Event("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,this.fire(new Event("load"))),this.style&&(this.style.hasTransitions()||t)&&(this._styleDirty=!0),(this._sourcesDirty||this._repaint||this._styleDirty||this._placementDirty)&&this._rerender(),this},e.prototype.remove=function(){this._hash&&this._hash.remove(),browser.cancelFrame(this._frameId),this._renderTaskQueue.clear(),this._frameId=null,this.setStyle(null),void 0!==window&&(window.removeEventListener("resize",this._onWindowResize,!1),window.removeEventListener("online",this._onWindowOnline,!1));var t=this.painter.context.gl.getExtension("WEBGL_lose_context");t&&t.loseContext(),removeNode(this._canvasContainer),removeNode(this._controlContainer),removeNode(this._missingCSSContainer),this._container.classList.remove("minemap-map"),this.fire(new Event("remove")),tileDrawHelper.destroy(),this.overviewMapInstance&&(this.off("moveend",this.__onMove),this.overviewMapInstance.remove())},e.prototype._rerender=function(){var t=this;this.style&&!this._frameId&&(this._frameId=browser.frame(function(){t._frameId=null,t._render()}))},e.prototype._onWindowOnline=function(){this._update()},e.prototype._onWindowResize=function(){this._trackResize&&this.stop().resize()._update()},r.showTileBoundaries.get=function(){return!!this._showTileBoundaries},r.showTileBoundaries.set=function(t){this._showTileBoundaries!==t&&(this._showTileBoundaries=t,this._update())},r.showCollisionBoxes.get=function(){return!!this._showCollisionBoxes},r.showCollisionBoxes.set=function(t){this._showCollisionBoxes!==t&&(this._showCollisionBoxes=t,t?this.style._generateCollisionBoxes():this._update())},r.showOverdrawInspector.get=function(){return!!this._showOverdrawInspector},r.showOverdrawInspector.set=function(t){this._showOverdrawInspector!==t&&(this._showOverdrawInspector=t,this._update())},r.repaint.get=function(){return!!this._repaint},r.repaint.set=function(t){this._repaint=t,this._update()},r.vertices.get=function(){return!!this._vertices},r.vertices.set=function(t){this._vertices=t,this._update()},e.prototype._onData=function(t){this._update("style"===t.dataType),this.fire(new Event(t.dataType+"data",t))},e.prototype._onDataLoading=function(t){this.fire(new Event(t.dataType+"dataloading",t))},e.prototype.setCursor=function(t){this._canvas.style.cursor=t||""},e.prototype.setDefaultCursor=function(t){this._canvas.style.cursor=t||""},e.prototype.setZoomAndCenter=function(t,e){this.setZoom(t),this.setCenter(e)},Object.defineProperties(e.prototype,r),e}(Camera);module.exports=Map;
},{"../_minemap_/minemap-supported":28,"../_minemap_/point-geometry":29,"../geo/lng_lat":76,"../geo/lng_lat_bounds":77,"../geo/transform":78,"../gl/tile_draw_helper":85,"../render/painter":111,"../style/evaluation_parameters":202,"../style/style":210,"../util/ajax":285,"../util/browser":286,"../util/dom":293,"../util/drag":294,"../util/evented":295,"../util/image":298,"../util/task_queue":311,"../util/util":315,"../util/window":288,"./bind_handlers":263,"./camera":264,"./control/attribution_control":265,"./control/logo_control":268,"./events":271,"./hash":279,"./marker":282}],282:[function(_dereq_,module,exports){
"use strict";var DOM=_dereq_("../util/dom"),LngLat=_dereq_("../geo/lng_lat"),Point=_dereq_("../_minemap_/point-geometry"),Draggable=_dereq_("@telerik/kendo-draggable").Draggable,Icon=_dereq_("./icon"),autoBind=_dereq_("../_minemap_/auto-bind"),Marker=function(t,e){this._offset=Point.convert(e&&e.offset||[0,0]),this._title=e&&e.title||"",this._titleColor=e&&e.titleColor||"black",this._titleFontSize=e&&e.titleFontSize||10,this._titleOffset=e&&e.titleOffset||[0,0],this._titleLabel=DOM.create("span"),this._titleLabel.style.display="block",this._titleLabel.style.position="absolute",this._titleLabel.style.padding="0px 2px",this._titleLabel.style.width="100px",this._titleLabel.added=!1,this._titleLabel.style.color=this._titleColor,this._titleLabel.style["font-size"]=this._titleFontSize,this._icon=null,this._element=DOM.create("div"),this._eventList={},t instanceof Icon?(this._offset=Point.convert(t.getImageOffset()),this._draggingControl=null,this._inner=t._getElement(),this._icon=t):(t||(t=DOM.create("div")),this._inner=t),this._element.appendChild(this._inner),this._element.appendChild(this._titleLabel),this._titleLabel.style.left=this._titleOffset[0]+"px",this._titleLabel.style.top=this._titleOffset[1]-15+"px",this._titleLabel.innerText=this._title,this._element.classList.add("minemap-marker"),this._popup=null,this._element.style.cursor="pointer",autoBind(this)};Marker.prototype.addTo=function(t){var e=this;return this.remove(),this._map=t,t.getCanvasContainer().appendChild(this._element),t.on("move",this._update),t.on("moveend",this._update),t.once("deletealltheoverlays",function(t){e&&e.remove()}),t.once("deletealltheoverlays-marker",function(t){e&&e.remove()}),this._update(),this._map.on("click",this._onMapClick),t.addMarker(this),t._addToOverlayList(this),this},Marker.prototype.remove=function(){var t=this;this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map._removeFromOverlayList(this),this._map=null),this.disableDragging(),DOM.remove(this._element),this._draggingControl&&this._draggingControl.destroy();for(var e in t._eventList)"dragstart"!==e&&"dragging"!==e&&"dragend"!==e&&t._element.removeEventListener(e,t["_"+e+"Handler"]);return this._eventList={},this._element.ondragstart=null,this._element.ondrag=null,this._element.ondragend=null,this._popup&&this._popup.remove(),this},Marker.prototype.getLngLat=function(){return this._lngLat},Marker.prototype.setLngLat=function(t){return this._lngLat=LngLat.convert(t),this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this},Marker.prototype.getElement=function(){return this._element},Marker.prototype.setOffset=function(t){this._offset=Point.convert(t||[0,0]),this._update()},Marker.prototype.getOffset=function(){return[this._offset.x,this._offset.y]},Marker.prototype.setPopup=function(t){return this._popup&&(this._popup.remove(),this._popup=null),t&&(this._popup=t,this._popup.setLngLat(this._lngLat)),this},Marker.prototype._onMapClick=function(t){var e=t.originalEvent.target,i=this._element;this._popup&&(e===i||i.contains(e))&&this.togglePopup()},Marker.prototype.getPopup=function(){return this._popup},Marker.prototype.togglePopup=function(){var t=this._popup;t&&(t.isOpen()?t.remove():t.addTo(this._map))},Marker.prototype._update=function(t){if(this._map){var e=this._map.project(this._map.transform.renderWorldCopies?this._lngLat.wrapToBestWorld(this._map.getCenter()):this._lngLat)._add(this._offset);t&&"moveend"!==t.type||(e=e.round()),DOM.setTransform(this._element,"translate("+e.x+"px, "+e.y+"px)")}},Marker.prototype.enableDargging=function(){this._draggingFlag=!0,this._draggingControl||this._initDragControl()},Marker.prototype.disableDragging=function(){this._draggingControl&&(this._draggingControl.destroy(),this._draggingControl=null)},Marker.prototype.setZIndex=function(t){this._element.style["z-index"]=t},Marker.prototype.getIcon=function(){return this._icon},Marker.prototype.setIcon=function(t){this._icon=t,DOM.remove(this._inner),this._inner=this._icon._getElement(),this._element.appendChild(this._inner)},Marker.prototype.getMap=function(){return this._map},Marker.prototype.setTitle=function(t){this._title=t,"string"==typeof t&&(this._titleLabel.innerText=this._title)},Marker.prototype.getTitle=function(){return this._title},Marker.prototype.setTitleFontSize=function(t){this._titleLabel.style["font-size"]=t+"px"},Marker.prototype.setTitleColor=function(t){this._titleLabel.style.color=t},Marker.prototype.setTitlePosition=function(t){this._titleOffset=t,this._titleLabel.style.left=t[0]+"px",this._titleLabel.style.top=t[1]-15+"px"},Marker.prototype._initDragControl=function(){var t=this;this._draggingControl=new Draggable({press:function(e){t._map.disableDrag(),t._runFuncs("dragstart",e),t._element.style.cursor="grab"},drag:function(e){t._runFuncs("dragging",e),t.setLngLat(t._map.unproject([e.pageX,e.pageY])),t._element.style.cursor="grabbing"},release:function(e){t._map.enableDrag(),t.setLngLat(t._map.unproject([e.pageX,e.pageY])),t._runFuncs("dragend",e)}}),this._element.ondragstart=function(t){t.preventDefault()},this._element.ondrag=function(t){t.preventDefault()},this._element.ondragend=function(t){t.preventDefault()},this._draggingControl.bindTo(this._element)},Marker.prototype._runFuncs=function(t,e){var i=this._eventList&&this._eventList[t];if(i)for(var n=0;n<i.length;n++)i[n].call(null,e)},Marker.prototype._clickHandler=function(t){this._runFuncs("click",t)},Marker.prototype._dblclickHandler=function(t){this._runFuncs("dblclick",t)},Marker.prototype._mousedownHandler=function(t){this._runFuncs("mousedown",t)},Marker.prototype._mouseupHandler=function(t){this._runFuncs("mouseup",t)},Marker.prototype._mouseoutHandler=function(t){this._runFuncs("mouseout",t)},Marker.prototype._mouseoverHandler=function(t){this._runFuncs("mouseover",t)},Marker.prototype.on=function(t,e){this._eventList.hasOwnProperty(t)?this._eventList[t].push(e):this._eventList[t]=[e],"dragstart"===t||"dragging"===t||"dragend"===t?this._draggingControl||this._initDragControl():this._element.addEventListener(t,this["_"+t+"Handler"])},Marker.prototype.off=function(t,e){var i=this;if(this._eventList[t])for(var n=0;n<this._eventList[t].length;n++)if(e===i._eventList[t][n]){i._eventList[t].splice(n,1);break}},module.exports=Marker;
},{"../_minemap_/auto-bind":16,"../_minemap_/point-geometry":29,"../geo/lng_lat":76,"../util/dom":293,"./icon":280,"@telerik/kendo-draggable":1}],283:[function(_dereq_,module,exports){
"use strict";function normalizeOffset(t){if(t){if("number"==typeof t){var e=Math.round(Math.sqrt(.5*Math.pow(t,2)));return{top:new Point(0,t),"top-left":new Point(e,e),"top-right":new Point(-e,e),bottom:new Point(0,-t),"bottom-left":new Point(e,-e),"bottom-right":new Point(-e,-e),left:new Point(t,0),right:new Point(-t,0)}}if(isPointLike(t)){var o=Point.convert(t);return{top:o,"top-left":o,"top-right":o,bottom:o,"bottom-left":o,"bottom-right":o,left:o,right:o}}return{top:Point.convert(t.top||[0,0]),"top-left":Point.convert(t["top-left"]||[0,0]),"top-right":Point.convert(t["top-right"]||[0,0]),bottom:Point.convert(t.bottom||[0,0]),"bottom-left":Point.convert(t["bottom-left"]||[0,0]),"bottom-right":Point.convert(t["bottom-right"]||[0,0]),left:Point.convert(t.left||[0,0]),right:Point.convert(t.right||[0,0])}}return normalizeOffset(new Point(0,0))}function isPointLike(t){return t instanceof Point||Array.isArray(t)}var util=_dereq_("../util/util"),DOM=_dereq_("../util/dom"),LngLat=_dereq_("../geo/lng_lat"),Point=_dereq_("../_minemap_/point-geometry"),window=_dereq_("../util/window"),smartWrap=_dereq_("../util/smart_wrap"),anchorTranslate=_dereq_("./anchor").anchorTranslate,applyAnchorClass=_dereq_("./anchor").applyAnchorClass,Evented=_dereq_("../util/evented").Evented,Event=_dereq_("../util/evented").Event,ErrorEvent=_dereq_("../util/evented").ErrorEvent,defaultOptions={closeButton:!0,closeOnClick:!0},Popup=function(t){function e(e){t.call(this),this.options=util.extend(Object.create(defaultOptions),e),util.bindAll(["_update","_onClickClose"],this)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.addTo=function(t){return this._map=t,this._map.on("move",this._update),this.options.closeOnClick&&this._map.on("click",this._onClickClose),this._update(),this.fire(new Event("open")),this},e.prototype.isOpen=function(){return!!this._map},e.prototype.remove=function(){return this._content&&DOM.remove(this._content),this._container&&(DOM.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("click",this._onClickClose),delete this._map),this.fire(new Event("close")),this},e.prototype.getLngLat=function(){return this._lngLat},e.prototype.setLngLat=function(t){return this._lngLat=LngLat.convert(t),this._pos=null,this._update(),this},e.prototype.setText=function(t){return this.setDOMContent(window.document.createTextNode(t))},e.prototype.setHTML=function(t){var e,o=window.document.createDocumentFragment(),n=window.document.createElement("body");for(n.innerHTML=t;;){if(!(e=n.firstChild))break;o.appendChild(e)}return this.setDOMContent(o)},e.prototype.setDOMContent=function(t){return this._createContent(),this._content.appendChild(t),this._update(),this},e.prototype._createContent=function(){this._content&&DOM.remove(this._content),this._content=DOM.create("div","minemap-popup-content",this._container),this.options.closeButton&&(this._closeButton=DOM.create("button","minemap-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.setAttribute("aria-label","Close popup"),this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClickClose))},e.prototype._update=function(){if(this._map&&this._lngLat&&this._content){this._container||(this._container=DOM.create("div","minemap-popup",this._map.getContainer()),this._tip=DOM.create("div","minemap-popup-tip",this._container),this._container.appendChild(this._content));var t=this.options.anchor,e=normalizeOffset(this.options.offset),o=this._map.project(this._map.transform.renderWorldCopies?this._lngLat.wrapToBestWorld(this._map.getCenter()):this._lngLat).round();if(!t){var n=this._container.offsetWidth,i=this._container.offsetHeight;t=o.y+e.bottom.y<i?["top"]:o.y>this._map.transform.height-i?["bottom"]:[],o.x<n/2?t.push("left"):o.x>this._map.transform.width-n/2&&t.push("right"),t=0===t.length?"bottom":t.join("-")}var r=o.add(e[t]),s={top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"},a=this._container.classList;for(var p in s)a.remove("minemap-popup-anchor-"+p);a.add("minemap-popup-anchor-"+t),DOM.setTransform(this._container,s[t]+" translate("+r.x+"px,"+r.y+"px)")}},e.prototype._onClickClose=function(){this.remove()},e}(Evented);module.exports=Popup;
},{"../_minemap_/point-geometry":29,"../geo/lng_lat":76,"../util/dom":293,"../util/evented":295,"../util/smart_wrap":309,"../util/util":315,"../util/window":288,"./anchor":262}],284:[function(_dereq_,module,exports){
"use strict";var util=_dereq_("./util"),ref=_dereq_("./web_worker_transfer"),serialize=ref.serialize,deserialize=ref.deserialize,Actor=function(e,t,r){this.target=e,this.parent=t,this.mapId=r,this.callbacks={},this.callbackID=0,util.bindAll(["receive"],this),this.target.addEventListener("message",this.receive,!1)};Actor.prototype.send=function(e,t,r,i){var a=r?this.mapId+":"+this.callbackID++:null;r&&(this.callbacks[a]=r);var s=[];this.target.postMessage({targetMapId:i,sourceMapId:this.mapId,type:e,id:String(a),data:serialize(t,s)},s)},Actor.prototype.receive=function(e){var t,r=this,i=e.data,a=i.id;if(!i.targetMapId||this.mapId===i.targetMapId){var s=function(e,t){var i=[];r.target.postMessage({sourceMapId:r.mapId,type:"<response>",id:String(a),error:e?serialize(e):null,data:serialize(t,i)},i)};if("<response>"===i.type)t=this.callbacks[i.id],delete this.callbacks[i.id],t&&i.error?t(deserialize(i.error)):t&&t(null,deserialize(i.data));else if(void 0!==i.id&&this.parent[i.type])this.parent[i.type](i.sourceMapId,deserialize(i.data),s);else if(void 0!==i.id&&this.parent.getWorkerSource){var d=i.type.split("."),l=this.parent.getWorkerSource(i.sourceMapId,d[0],d[1]);l[d[2]](deserialize(i.data),s)}else this.parent[i.type](deserialize(i.data))}},Actor.prototype.remove=function(){this.target.removeEventListener("message",this.receive,!1)},module.exports=Actor;
},{"./util":315,"./web_worker_transfer":318}],285:[function(_dereq_,module,exports){
"use strict";function makeRequest(e){var r=new window.XMLHttpRequest;r.open("GET",e.url,!0);for(var t in e.headers)r.setRequestHeader(t,e.headers[t]);return r.withCredentials="include"===e.credentials,r}function sameOrigin(e){var r=window.document.createElement("a");return r.href=e,r.protocol===window.document.location.protocol&&r.host===window.document.location.host}var window=_dereq_("./window"),decoderTilePbf=_dereq_("./pbf_decoder").decoderTilePbf,ResourceType={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image"};exports.ResourceType=ResourceType,"function"==typeof Object.freeze&&Object.freeze(ResourceType);var AJAXError=function(e){function r(r,t){e.call(this,r),this.status=t}return e&&(r.__proto__=e),r.prototype=Object.create(e&&e.prototype),r.prototype.constructor=r,r}(Error);exports.getJSON=function(e,r){var t=makeRequest("string"==typeof e?{url:e}:e);return t.setRequestHeader("Accept","application/json"),t.onerror=function(){r(new Error(t.statusText))},t.onload=function(){if(t.status>=200&&t.status<300&&t.response){var e;try{e=JSON.parse(t.response)}catch(e){return r(e)}r(null,e)}else r(new AJAXError(t.statusText,t.status))},t.send(),t},exports.getArrayBuffer=function(e,r){var t=makeRequest(e);return t.responseType="arraybuffer",t.onerror=function(){r(new Error(t.statusText))},t.onload=function(){var e=t.response;if(0===e.byteLength&&200===t.status&&r(null,{data:e,cacheControl:t.getResponseHeader("Cache-Control"),expires:t.getResponseHeader("Expires")}),t.status>=200&&t.status<300&&t.response){var n=decoderTilePbf(t);r(null,{data:n,cacheControl:t.getResponseHeader("Cache-Control"),expires:t.getResponseHeader("Expires")})}else r(new AJAXError(t.statusText,t.status))},t.send(),t},exports.getTrafficArrayBuffer=function(e,r){var t=makeRequest(e);return t.responseType="arraybuffer",t.onerror=function(){r(new Error(t.statusText))},t.onload=function(){var e=t.response;if(0===e.byteLength&&200===t.status&&r(null,{data:e,cacheControl:t.getResponseHeader("Cache-Control"),expires:t.getResponseHeader("Expires")}),t.status>=200&&t.status<300&&t.response){var n=decoderTilePbf(t);r(null,{data:n,cacheControl:t.getResponseHeader("Cache-Control"),expires:t.getResponseHeader("Expires"),eTag:t.getResponseHeader("ETag")})}else r(new AJAXError(t.statusText,t.status))},t.send(),t};var transparentPngUrl="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";exports.getImage=function(e,r){return exports.getArrayBuffer(e,function(e,t){if(e)r(e);else if(t){var n=new window.Image,o=window.URL||window.webkitURL;n.onload=function(){r(null,n),o.revokeObjectURL(n.src)};var s=new window.Blob([new Uint8Array(t.data)],{type:"image/png"});n.cacheControl=t.cacheControl,n.expires=t.expires,n.src=t.data.byteLength?o.createObjectURL(s):transparentPngUrl}})},exports.getVideo=function(e,r){var t=window.document.createElement("video");t.onloadstart=function(){r(null,t)};for(var n=0;n<e.length;n++){var o=window.document.createElement("source");sameOrigin(e[n])||(t.crossOrigin="Anonymous"),o.src=e[n],t.appendChild(o)}return t};
},{"./pbf_decoder":305,"./window":288}],286:[function(_dereq_,module,exports){
"use strict";var window=_dereq_("./window"),now=window.performance&&window.performance.now?window.performance.now.bind(window.performance):Date.now.bind(Date),frame=window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||window.msRequestAnimationFrame,cancel=window.cancelAnimationFrame||window.mozCancelAnimationFrame||window.webkitCancelAnimationFrame||window.msCancelAnimationFrame;module.exports={now:now,frame:function(e){return frame(e)},cancelFrame:function(e){return cancel(e)},getImageData:function(e){var n=window.document.createElement("canvas"),t=n.getContext("2d");if(!t)throw new Error("failed to create canvas 2d context");return n.width=e.width,n.height=e.height,t.drawImage(e,0,0,e.width,e.height),t.getImageData(0,0,e.width,e.height)},hardwareConcurrency:window.navigator.hardwareConcurrency||4,get devicePixelRatio(){return window.devicePixelRatio},supportsWebp:!1};var webpImgTest=window.document.createElement("img");webpImgTest.onload=function(){module.exports.supportsWebp=!0},webpImgTest.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=";
},{"./window":288}],287:[function(_dereq_,module,exports){
"use strict";var WebWorkify=_dereq_("webworkify"),window=_dereq_("../window"),workerURL=window.URL.createObjectURL(new WebWorkify(_dereq_("../../source/worker"),{bare:!0}));module.exports=function(){return new window.Worker(workerURL)};
},{"../../source/worker":138,"../window":288,"webworkify":13}],288:[function(_dereq_,module,exports){
"use strict";module.exports=self;
},{}],289:[function(_dereq_,module,exports){
"use strict";function compareAreas(e,r){return r.area-e.area}var quickselect=_dereq_("quickselect"),calculateSignedArea=_dereq_("./util").calculateSignedArea;module.exports=function(e,r){var a=e.length;if(a<=1)return[e];for(var t,u,c=[],i=0;i<a;i++){var l=calculateSignedArea(e[i]);0!==l&&(e[i].area=Math.abs(l),void 0===u&&(u=l<0),u===l<0?(t&&c.push(t),t=[e[i]]):t.push(e[i]))}if(t&&c.push(t),r>1)for(var n=0;n<c.length;n++)c[n].length<=r||(quickselect(c[n],r,1,c[n].length-1,compareAreas),c[n]=c[n].slice(0,r));return c};
},{"./util":315,"quickselect":11}],290:[function(_dereq_,module,exports){
"use strict";var config={DOMAIN:"//minedata.cn",DATA_DOMAIN:"//datahive.minedata.cn",API_BASE:"/data/",API_URL:"//datahive.minedata.cn/data/",DYN_BASE:"/dynamicdata/",DYN_URL:"//datahive.minedata.cn/dynamicdata/",MERGE_BASE:"/mergeddata/",MERGE_URL:"//datahive.minedata.cn/mergeddata/",OTHER_BASE:"/otherdata/",OTHER_URL:"//datahive.minedata.cn/otherdata/",SRC_BASE:"/minemapapi/v1.4/",SRC_URL:"//minedata.cn/minemapapi/v1.4/",SERVICE_BASE:"/service",SERVICE_URL:"//minedata.cn/service",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null};module.exports=config;
},{}],291:[function(_dereq_,module,exports){
"use strict";var DictionaryCoder=function(r){var t=this;this._stringToNumber={},this._numberToString=[];for(var o=0;o<r.length;o++){var i=r[o];t._stringToNumber[i]=o,t._numberToString[o]=i}};DictionaryCoder.prototype.encode=function(r){return this._stringToNumber[r]},DictionaryCoder.prototype.decode=function(r){return this._numberToString[r]},module.exports=DictionaryCoder;
},{}],292:[function(_dereq_,module,exports){
"use strict";var util=_dereq_("./util"),Actor=_dereq_("./actor"),Dispatcher=function(t,r){var o=this;this.workerPool=t,this.actors=[],this.currentActor=0,this.id=util.uniqueId();for(var i=this.workerPool.acquire(this.id),e=0;e<i.length;e++){var s=i[e],c=new Actor(s,r,o.id);c.name="Worker "+e,o.actors.push(c)}};Dispatcher.prototype.broadcast=function(t,r,o){o=o||function(){},util.asyncAll(this.actors,function(o,i){o.send(t,r,i)},o)},Dispatcher.prototype.send=function(t,r,o,i){return("number"!=typeof i||isNaN(i))&&(i=this.currentActor=(this.currentActor+1)%this.actors.length),this.actors[i].send(t,r,o),i},Dispatcher.prototype.remove=function(){this.actors.forEach(function(t){t.remove()}),this.actors=[],this.workerPool.release(this.id)},module.exports=Dispatcher;
},{"./actor":284,"./util":315}],293:[function(_dereq_,module,exports){
"use strict";function testProp(e){if(!docStyle)return null;for(var t=0;t<e.length;t++)if(e[t]in docStyle)return e[t];return e[0]}var Point=_dereq_("../_minemap_/point-geometry"),window=_dereq_("./window"),DOM={};DOM.create=function(e,t,n){var o=window.document.createElement(e);return t&&(o.className=t),n&&n.appendChild(o),o},DOM.createNS=function(e,t){return window.document.createElementNS(e,t)};var docStyle=window.document?window.document.documentElement.style:null,selectProp=testProp(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]),userSelect;DOM.disableDrag=function(){docStyle&&selectProp&&(userSelect=docStyle[selectProp],docStyle[selectProp]="none")},DOM.enableDrag=function(){docStyle&&selectProp&&(docStyle[selectProp]=userSelect)};var transformProp=testProp(["transform","WebkitTransform"]);DOM.setTransform=function(e,t){e.style[transformProp]=t};var passiveSupported=!1;try{var options$1=Object.defineProperty({},"passive",{get:function(){passiveSupported=!0}});window.addEventListener("test",options$1,options$1),window.removeEventListener("test",options$1,options$1)}catch(e){passiveSupported=!1}DOM.addEventListener=function(e,t,n,o){void 0===o&&(o={}),"passive"in o&&passiveSupported?e.addEventListener(t,n,o):e.addEventListener(t,n,o.capture)},DOM.removeEventListener=function(e,t,n,o){void 0===o&&(o={}),"passive"in o&&passiveSupported?e.removeEventListener(t,n,o):e.removeEventListener(t,n,o.capture)};var suppressClick=function(e){e.preventDefault(),e.stopPropagation(),window.removeEventListener("click",suppressClick,!0)};DOM.suppressClick=function(){window.addEventListener("click",suppressClick,!0),window.setTimeout(function(){window.removeEventListener("click",suppressClick,!0)},0)},DOM.mousePos=function(e,t){var n=e.getBoundingClientRect();return t=t.touches?t.touches[0]:t,new Point(t.clientX-n.left-e.clientLeft,t.clientY-n.top-e.clientTop)},DOM.touchPos=function(e,t){for(var n=e.getBoundingClientRect(),o=[],r="touchend"===t.type?t.changedTouches:t.touches,i=0;i<r.length;i++)o.push(new Point(r[i].clientX-n.left-e.clientLeft,r[i].clientY-n.top-e.clientTop));return o},DOM.mouseButton=function(e){return void 0!==window.InstallTrigger&&2===e.button&&e.ctrlKey&&window.navigator.platform.toUpperCase().indexOf("MAC")>=0?0:e.button},DOM.remove=function(e){e.parentNode&&e.parentNode.removeChild(e)},module.exports=DOM;
},{"../_minemap_/point-geometry":29,"./window":288}],294:[function(_dereq_,module,exports){
"use strict";var window=_dereq_("../util/window"),cb=null,restrictX=0,restrictY=0,Drag={obj:null,init:function(t){cb=t.cb,restrictX=t.restrictX,restrictY=t.restrictY,t.handler.onmousedown=this.start,t.handler.root=t.root||t.handler;var o=t.handler.root;o.onDragStart=t.dragStart||new Function,o.onDrag=t.onDrag||new Function,o.onDragEnd=t.onDragEnd||new Function},start:function(t){var o=Drag.obj=this;o.style.cursor="move",t=t||Drag.fixEvent(window.event);var r=t.pageX,e=t.pageY;o.lastMouseX=r,o.lastMouseY=e;var n=o.root.offsetLeft,a=o.root.offsetTop;o.root.style.left=n+"px",o.root.style.top=a+"px",window.document.onmouseup=Drag.end,window.document.onmousemove=Drag.drag,o.root.onDragStart(n,a)},drag:function(t){t=t||Drag.fixEvent(window.event);var o=t.pageX,r=t.pageY,e=Drag.obj.root,n=e.style.left?parseInt(e.style.left):0,a=e.style.top?parseInt(e.style.top):0;n<=-1&&(n=-1),a<=-1&&(a=-1),n>=restrictX&&(n=restrictX),a>=restrictY&&(a=restrictY);var s=o-Drag.obj.lastMouseX+n,l=r-Drag.obj.lastMouseY+a;e.style.left=s+"px",e.style.top=l+"px",Drag.obj.root.onDrag(s,l),Drag.obj.lastMouseX=o,Drag.obj.lastMouseY=r},end:function(t){var o=Drag.obj.root.style.left?parseInt(Drag.obj.root.style.left):0,r=Drag.obj.root.style.top?parseInt(Drag.obj.root.style.top):0;Drag.obj.root.onDragEnd(o,r),window.setTimeout(function(){cb(o,r)},100),window.document.onmousemove=null,window.document.onmouseup=null,Drag.obj=null},fixEvent:function(t){return t.pageX=t.clientX+window.document.documentElement.scrollLeft,t.pageY=t.clientY+window.document.documentElement.scrollTop,t}};module.exports=Drag;
},{"../util/window":288}],295:[function(_dereq_,module,exports){
"use strict";function _addEventListener(e,t,n){n[e]=n[e]||[],n[e].push(t)}function _removeEventListener(e,t,n){if(n&&n[e]){var r=n[e].indexOf(t);-1!==r&&n[e].splice(r,1)}}var util=_dereq_("./util"),extend=util.extend,endsWith=util.endsWith,Event=function(e,t){void 0===t&&(t={}),extend(this,t),this.type=e};exports.Event=Event;var ErrorEvent=function(e){function t(t,n){void 0===n&&(n={}),e.call(this,"error",extend({error:t},n))}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t}(Event);exports.ErrorEvent=ErrorEvent;var Evented=function(){};Evented.prototype.on=function(e,t){return this._listeners=this._listeners||{},_addEventListener(e,t,this._listeners),this},Evented.prototype.off=function(e,t){return _removeEventListener(e,t,this._listeners),_removeEventListener(e,t,this._oneTimeListeners),this},Evented.prototype.once=function(e,t){return this._oneTimeListeners=this._oneTimeListeners||{},_addEventListener(e,t,this._oneTimeListeners),this},Evented.prototype.fire=function(e,t){var n=this,r=null;r=e instanceof Event?e:new Event(e,t);var i=r.type;if(this.listens(i)){r.target=this;for(var s=this._listeners&&this._listeners[i]?this._listeners[i].slice():[],o=0,v=s;o<v.length;o+=1){v[o].call(n,r)}for(var h=this._oneTimeListeners&&this._oneTimeListeners[i]?this._oneTimeListeners[i].slice():[],_=0,a=h;_<a.length;_+=1){var d=a[_];_removeEventListener(i,d,n._oneTimeListeners),d.call(n,r)}var l=this._eventedParent;l&&(extend(r,"function"==typeof this._eventedParentData?this._eventedParentData():this._eventedParentData),l.fire(r))}else endsWith(i,"error")&&console.error(r&&r.error||r||"Empty error event");return this},Evented.prototype.listens=function(e){return this._listeners&&this._listeners[e]&&this._listeners[e].length>0||this._oneTimeListeners&&this._oneTimeListeners[e]&&this._oneTimeListeners[e].length>0||this._eventedParent&&this._eventedParent.listens(e)},Evented.prototype.setEventedParent=function(e,t){return this._eventedParent=e,this._eventedParentData=t,this},exports.Evented=Evented;
},{"./util":315}],296:[function(_dereq_,module,exports){
"use strict";function compareMax(e,t){return t.max-e.max}function Cell(e,t,n,r){this.p=new Point(e,t),this.h=n,this.d=pointToPolygonDist(this.p,r),this.max=this.d+this.h*Math.SQRT2}function pointToPolygonDist(e,t){for(var n=!1,r=1/0,o=0;o<t.length;o++)for(var i=t[o],l=0,u=i.length,a=u-1;l<u;a=l++){var s=i[l],p=i[a];s.y>e.y!=p.y>e.y&&e.x<(p.x-s.x)*(e.y-s.y)/(p.y-s.y)+s.x&&(n=!n),r=Math.min(r,distToSegmentSquared(e,s,p))}return(n?1:-1)*Math.sqrt(r)}function getCentroidCell(e){for(var t=0,n=0,r=0,o=e[0],i=0,l=o.length,u=l-1;i<l;u=i++){var a=o[i],s=o[u],p=a.x*s.y-s.x*a.y;n+=(a.x+s.x)*p,r+=(a.y+s.y)*p,t+=3*p}return new Cell(n/t,r/t,0,e)}var Queue=_dereq_("tinyqueue"),Point=_dereq_("../_minemap_/point-geometry"),distToSegmentSquared=_dereq_("./intersection_tests").distToSegmentSquared;module.exports=function(e,t,n){void 0===t&&(t=1),void 0===n&&(n=!1);for(var r=1/0,o=1/0,i=-1/0,l=-1/0,u=e[0],a=0;a<u.length;a++){var s=u[a];(!a||s.x<r)&&(r=s.x),(!a||s.y<o)&&(o=s.y),(!a||s.x>i)&&(i=s.x),(!a||s.y>l)&&(l=s.y)}var p=i-r,h=l-o,d=Math.min(p,h),y=d/2,x=new Queue(null,compareMax);if(0===d)return new Point(r,o);for(var g=r;g<i;g+=d)for(var m=o;m<l;m+=d)x.push(new Cell(g+y,m+y,y,e));for(var f=getCentroidCell(e),v=x.length;x.length;){var c=x.pop();(c.d>f.d||!f.d)&&(f=c,n&&console.log("found best %d after %d probes",Math.round(1e4*c.d)/1e4,v)),c.max-f.d<=t||(y=c.h/2,x.push(new Cell(c.p.x-y,c.p.y-y,y,e)),x.push(new Cell(c.p.x+y,c.p.y-y,y,e)),x.push(new Cell(c.p.x-y,c.p.y+y,y,e)),x.push(new Cell(c.p.x+y,c.p.y+y,y,e)),v+=4)}return n&&(console.log("num probes: "+v),console.log("best distance: "+f.d)),f.p};
},{"../_minemap_/point-geometry":29,"./intersection_tests":301,"tinyqueue":12}],297:[function(_dereq_,module,exports){
"use strict";var WorkerPool=_dereq_("./worker_pool"),globalWorkerPool;module.exports=function(){return globalWorkerPool||(globalWorkerPool=new WorkerPool),globalWorkerPool};
},{"./worker_pool":319}],298:[function(_dereq_,module,exports){
"use strict";function createImage(e,t,i,h){var a=t.width,r=t.height;if(h){if(h.length!==a*r*i)throw new RangeError("mismatched image size")}else h=new Uint8Array(a*r*i);return e.width=a,e.height=r,e.data=h,e}function resizeImage(e,t,i){var h=t.width,a=t.height;if(h!==e.width||a!==e.height){var r=createImage({},{width:h,height:a},i);copyImage(e,r,{x:0,y:0},{x:0,y:0},{width:Math.min(e.width,h),height:Math.min(e.height,a)},i),e.width=h,e.height=a,e.data=r.data}}function copyImage(e,t,i,h,a,r){if(0===a.width||0===a.height)return t;if(a.width>e.width||a.height>e.height||i.x>e.width-a.width||i.y>e.height-a.height)throw new RangeError("out of range source coordinates for image copy");if(a.width>t.width||a.height>t.height||h.x>t.width-a.width||h.y>t.height-a.height)throw new RangeError("out of range destination coordinates for image copy");for(var g=e.data,n=t.data,o=0;o<a.height;o++)for(var m=((i.y+o)*e.width+i.x)*r,w=((h.y+o)*t.width+h.x)*r,d=0;d<a.width*r;d++)n[w+d]=g[m+d];return t}var ref=_dereq_("./web_worker_transfer"),register=ref.register,AlphaImage=function(e,t){createImage(this,e,1,t)};AlphaImage.prototype.resize=function(e){resizeImage(this,e,1)},AlphaImage.prototype.clone=function(){return new AlphaImage({width:this.width,height:this.height},new Uint8Array(this.data))},AlphaImage.copy=function(e,t,i,h,a){copyImage(e,t,i,h,a,1)};var RGBAImage=function(e,t){createImage(this,e,4,t)};RGBAImage.prototype.resize=function(e){resizeImage(this,e,4)},RGBAImage.prototype.clone=function(){return new RGBAImage({width:this.width,height:this.height},new Uint8Array(this.data))},RGBAImage.copy=function(e,t,i,h,a){copyImage(e,t,i,h,a,4)},register("AlphaImage",AlphaImage),register("RGBAImage",RGBAImage),module.exports={AlphaImage:AlphaImage,RGBAImage:RGBAImage};
},{"./web_worker_transfer":318}],299:[function(_dereq_,module,exports){
"use strict";var Polygon=exports.Polygon={};Polygon.read=function(e,n){return e.readFields(Polygon._readField,{lon:[],lat:[],index:[],multi:[]},n)},Polygon._readField=function(e,n,r){1===e?r.readPackedVarint(n.lon,!0):2===e?r.readPackedVarint(n.lat,!0):3===e?r.readPackedVarint(n.index,!0):4===e&&r.readPackedVarint(n.multi,!0)},Polygon.write=function(e,n){e.lon&&n.writePackedVarint(1,e.lon),e.lat&&n.writePackedVarint(2,e.lat),e.index&&n.writePackedVarint(3,e.index),e.multi&&n.writePackedVarint(4,e.multi)};var Building=exports.Building={};Building.read=function(e,n){return e.readFields(Building._readField,{polygon:null,num:0,name:"",type:""},n)},Building._readField=function(e,n,r){1===e?n.polygon=Polygon.read(r,r.readVarint()+r.pos):2===e?n.num=r.readVarint(!0):3===e?n.name=r.readString():4===e&&(n.type=r.readString())},Building.write=function(e,n){e.polygon&&n.writeMessage(1,Polygon.write,e.polygon),e.num&&n.writeVarintField(2,e.num),e.name&&n.writeStringField(3,e.name),e.type&&n.writeStringField(4,e.type)};var Center=exports.Center={};Center.read=function(e,n){return e.readFields(Center._readField,{point:null,num:0,name:"",type:""},n)},Center._readField=function(e,n,r){1===e?n.point=Point.read(r,r.readVarint()+r.pos):3===e?n.num=r.readVarint(!0):4===e?n.name=r.readString():5===e&&(n.type=r.readString())},Center.write=function(e,n){e.point&&n.writeMessage(1,Point.write,e.point),e.num&&n.writeVarintField(3,e.num),e.name&&n.writeStringField(4,e.name),e.type&&n.writeStringField(5,e.type)};var MultiPolygon=exports.MultiPolygon={};MultiPolygon.read=function(e,n){return e.readFields(MultiPolygon._readField,{polygon:[]},n)},MultiPolygon._readField=function(e,n,r){1===e&&n.polygon.push(Polygon.read(r,r.readVarint()+r.pos))},MultiPolygon.write=function(e,n){if(e.polygon)for(var r=0;r<e.polygon.length;r++)n.writeMessage(1,Polygon.write,e.polygon[r])};var Point=exports.Point={};Point.read=function(e,n){return e.readFields(Point._readField,{lon:[],lat:[]},n)},Point._readField=function(e,n,r){1===e?r.readPackedVarint(n.lon,!0):2===e&&r.readPackedVarint(n.lat,!0)},Point.write=function(e,n){e.lon&&n.writePackedVarint(1,e.lon),e.lat&&n.writePackedVarint(2,e.lat)};var Floor=exports.Floor={};Floor.read=function(e,n){return e.readFields(Floor._readField,{ppoint:[],ptype:[],pname:[],sface:[],stype:[],sname:[],fface:null,fname:""},n)},Floor._readField=function(e,n,r){1===e?n.ppoint.push(Point.read(r,r.readVarint()+r.pos)):3===e?r.readPackedVarint(n.ptype,!0):4===e?n.pname.push(r.readString()):5===e?n.sface.push(Polygon.read(r,r.readVarint()+r.pos)):6===e?r.readPackedVarint(n.stype,!0):7===e?n.sname.push(r.readString()):8===e?n.fface=Polygon.read(r,r.readVarint()+r.pos):9===e&&(n.fname=r.readString())},Floor.write=function(e,n){if(e.ppoint)for(var r=0;r<e.ppoint.length;r++)n.writeMessage(1,Point.write,e.ppoint[r]);if(e.ptype&&n.writePackedVarint(3,e.ptype),e.pname)for(r=0;r<e.pname.length;r++)n.writeStringField(4,e.pname[r]);if(e.sface)for(r=0;r<e.sface.length;r++)n.writeMessage(5,Polygon.write,e.sface[r]);if(e.stype&&n.writePackedVarint(6,e.stype),e.sname)for(r=0;r<e.sname.length;r++)n.writeStringField(7,e.sname[r]);e.fface&&n.writeMessage(8,Polygon.write,e.fface),e.fname&&n.writeStringField(9,e.fname)};var IndoorPbf=exports.IndoorPbf={};IndoorPbf.read=function(e,n){return e.readFields(IndoorPbf._readField,{building:null,default:"",center:null,indexes:[],floor:[],lonoffset:0,latoffset:0,num:0},n)},IndoorPbf._readField=function(e,n,r){1===e?n.building=Building.read(r,r.readVarint()+r.pos):2===e?n.default=r.readString():3===e?n.center=Center.read(r,r.readVarint()+r.pos):4===e?n.indexes.push(r.readString()):5===e?n.floor.push(Floor.read(r,r.readVarint()+r.pos)):6===e?n.lonoffset=r.readVarint(!0):7===e?n.latoffset=r.readVarint(!0):8===e&&(n.num=r.readVarint(!0))},IndoorPbf.write=function(e,n){if(e.building&&n.writeMessage(1,Building.write,e.building),e.default&&n.writeStringField(2,e.default),e.center&&n.writeMessage(3,Center.write,e.center),e.indexes)for(var r=0;r<e.indexes.length;r++)n.writeStringField(4,e.indexes[r]);if(e.floor)for(r=0;r<e.floor.length;r++)n.writeMessage(5,Floor.write,e.floor[r]);e.lonoffset&&n.writeVarintField(6,e.lonoffset),e.latoffset&&n.writeVarintField(7,e.latoffset),e.num&&n.writeVarintField(8,e.num)};
},{}],300:[function(_dereq_,module,exports){
"use strict";function parseMessage(e){var t=e.lonoffset,o=e.latoffset,r=Math.pow(10,e.num);return{building:getBuildingData(t,o,r,e),building_name:getBuildingNameData(t,o,r,e),default_:e.default||"",indexes:e.indexes||[],floors:getFloorsData(t,o,r,e)}}function getBuildingData(e,t,o,r){var n=r.building;return{geometry:getPolygonGeometry(e,t,o,n.polygon),type:"Feature",properties:{build_num:n.num,build_name:n.name,build_type:n.type}}}function getBuildingNameData(e,t,o,r){var n=r.center,a=n.point;return{geometry:{type:"Point",coordinates:convertLonLat(e,t,o,a.lon[0],a.lat[0])},type:"Feature",properties:{build_num:n.num,build_name:n.name,build_type:n.type}}}function getFloorsData(e,t,o,r){return(r.floor||[]).map(function(r){return{ix_poi:{type:"FeatureCollection",features:getIxPoiDataArr(e,t,o,r)},space_face:{type:"FeatureCollection",features:getSpaceFaceDataArr(e,t,o,r)},floor:getFloorData(e,t,o,r)}})}function getIxPoiDataArr(e,t,o,r){var n=r.ppoint||[],a=r.pname||[],i=r.ptype||[];return n.map(function(r,n){return{geometry:{type:"Point",coordinates:convertLonLat(e,t,o,r.lon[0],r.lat[0])},type:"Feature",properties:{poi_type:i[n],poi_name:a[n]}}})}function getSpaceFaceDataArr(e,t,o,r){var n=r.sface||[],a=r.sname||[],i=r.stype||[];return n.map(function(r,u){return{geometry:getPolygonGeometry(e,t,o,n[u]),type:"Feature",properties:{space_type:i[u],space_name:a[u]}}})}function getFloorData(e,t,o,r){return{geometry:getPolygonGeometry(e,t,o,r.fface||{}),type:"Feature",properties:{floor_name:r.fname}}}function convertLonLat(e,t,o,r,n){return[(r+e)/o,(n+t)/o]}function getPolygonGeometry(e,t,o,r){for(var n=r.lon,a=r.lat,i=r.index,u=r.multi,p=[],l=0,f=0;f<u.length;f++){for(var g=[],s=0,y=l,c=y+u[f],m=y;m<c;m++){for(var d=[],b=s;b<s+i[m];b++)d.push(convertLonLat(e,t,o,n[b],a[b]));s+=i[m],g.push(d)}l=+u[f],p.push(g)}var P=[],_="Polygon";return u.length>1?(P=p,_="MultiPolygon"):(P=p[0],_="Polygon"),{type:_,coordinates:P}}var Protobuf=_dereq_("pbf"),IndoorPbf=_dereq_("./indoor_pbf").IndoorPbf,IndoorMap=function(e){var t=IndoorPbf.read(new Protobuf(e));this.indoormap=parseMessage(t)};IndoorMap.prototype.getData=function(){return this.indoormap},module.exports=IndoorMap;
},{"./indoor_pbf":299,"pbf":10}],301:[function(_dereq_,module,exports){
"use strict";function polygonIntersectsPolygon(n,t){for(var e=0;e<n.length;e++)if(polygonContainsPoint(t,n[e]))return!0;for(var r=0;r<t.length;r++)if(polygonContainsPoint(n,t[r]))return!0;return!!lineIntersectsLine(n,t)}function multiPolygonIntersectsBufferedMultiPoint(n,t,e){for(var r=0;r<n.length;r++)for(var o=n[r],i=0;i<t.length;i++)for(var l=t[i],u=0;u<l.length;u++){var s=l[u];if(polygonContainsPoint(o,s))return!0;if(pointIntersectsBufferedLine(s,o,e))return!0}return!1}function multiPolygonIntersectsMultiPolygon(n,t){if(1===n.length&&1===n[0].length)return multiPolygonContainsPoint(t,n[0][0]);for(var e=0;e<t.length;e++)for(var r=t[e],o=0;o<r.length;o++)if(multiPolygonContainsPoint(n,r[o]))return!0;for(var i=0;i<n.length;i++){for(var l=n[i],u=0;u<l.length;u++)if(multiPolygonContainsPoint(t,l[u]))return!0;for(var s=0;s<t.length;s++)if(lineIntersectsLine(l,t[s]))return!0}return!1}function multiPolygonIntersectsBufferedMultiLine(n,t,e){for(var r=0;r<t.length;r++)for(var o=t[r],i=0;i<n.length;i++){var l=n[i];if(l.length>=3)for(var u=0;u<o.length;u++)if(polygonContainsPoint(l,o[u]))return!0;if(lineIntersectsBufferedLine(l,o,e))return!0}return!1}function lineIntersectsBufferedLine(n,t,e){if(n.length>1){if(lineIntersectsLine(n,t))return!0;for(var r=0;r<t.length;r++)if(pointIntersectsBufferedLine(t[r],n,e))return!0}for(var o=0;o<n.length;o++)if(pointIntersectsBufferedLine(n[o],t,e))return!0;return!1}function lineIntersectsLine(n,t){if(0===n.length||0===t.length)return!1;for(var e=0;e<n.length-1;e++)for(var r=n[e],o=n[e+1],i=0;i<t.length-1;i++){var l=t[i],u=t[i+1];if(lineSegmentIntersectsLineSegment(r,o,l,u))return!0}return!1}function lineSegmentIntersectsLineSegment(n,t,e,r){return isCounterClockwise(n,e,r)!==isCounterClockwise(t,e,r)&&isCounterClockwise(n,t,e)!==isCounterClockwise(n,t,r)}function pointIntersectsBufferedLine(n,t,e){var r=e*e;if(1===t.length)return n.distSqr(t[0])<r;for(var o=1;o<t.length;o++){if(distToSegmentSquared(n,t[o-1],t[o])<r)return!0}return!1}function distToSegmentSquared(n,t,e){var r=t.distSqr(e);if(0===r)return n.distSqr(t);var o=((n.x-t.x)*(e.x-t.x)+(n.y-t.y)*(e.y-t.y))/r;return o<0?n.distSqr(t):o>1?n.distSqr(e):n.distSqr(e.sub(t)._mult(o)._add(t))}function multiPolygonContainsPoint(n,t){for(var e,r,o,i=!1,l=0;l<n.length;l++){e=n[l];for(var u=0,s=e.length-1;u<e.length;s=u++)r=e[u],o=e[s],r.y>t.y!=o.y>t.y&&t.x<(o.x-r.x)*(t.y-r.y)/(o.y-r.y)+r.x&&(i=!i)}return i}function polygonContainsPoint(n,t){for(var e=!1,r=0,o=n.length-1;r<n.length;o=r++){var i=n[r],l=n[o];i.y>t.y!=l.y>t.y&&t.x<(l.x-i.x)*(t.y-i.y)/(l.y-i.y)+i.x&&(e=!e)}return e}var ref=_dereq_("./util"),isCounterClockwise=ref.isCounterClockwise;module.exports={multiPolygonIntersectsBufferedMultiPoint:multiPolygonIntersectsBufferedMultiPoint,multiPolygonIntersectsMultiPolygon:multiPolygonIntersectsMultiPolygon,multiPolygonIntersectsBufferedMultiLine:multiPolygonIntersectsBufferedMultiLine,polygonIntersectsPolygon:polygonIntersectsPolygon,distToSegmentSquared:distToSegmentSquared};
},{"./util":315}],302:[function(_dereq_,module,exports){
"use strict";var unicodeBlockLookup={"Latin-1 Supplement":function(n){return n>=128&&n<=255},Arabic:function(n){return n>=1536&&n<=1791},"Arabic Supplement":function(n){return n>=1872&&n<=1919},"Arabic Extended-A":function(n){return n>=2208&&n<=2303},"Hangul Jamo":function(n){return n>=4352&&n<=4607},"Unified Canadian Aboriginal Syllabics":function(n){return n>=5120&&n<=5759},"Unified Canadian Aboriginal Syllabics Extended":function(n){return n>=6320&&n<=6399},"General Punctuation":function(n){return n>=8192&&n<=8303},"Letterlike Symbols":function(n){return n>=8448&&n<=8527},"Number Forms":function(n){return n>=8528&&n<=8591},"Miscellaneous Technical":function(n){return n>=8960&&n<=9215},"Control Pictures":function(n){return n>=9216&&n<=9279},"Optical Character Recognition":function(n){return n>=9280&&n<=9311},"Enclosed Alphanumerics":function(n){return n>=9312&&n<=9471},"Geometric Shapes":function(n){return n>=9632&&n<=9727},"Miscellaneous Symbols":function(n){return n>=9728&&n<=9983},"Miscellaneous Symbols and Arrows":function(n){return n>=11008&&n<=11263},"CJK Radicals Supplement":function(n){return n>=11904&&n<=12031},"Kangxi Radicals":function(n){return n>=12032&&n<=12255},"Ideographic Description Characters":function(n){return n>=12272&&n<=12287},"CJK Symbols and Punctuation":function(n){return n>=12288&&n<=12351},Hiragana:function(n){return n>=12352&&n<=12447},Katakana:function(n){return n>=12448&&n<=12543},Bopomofo:function(n){return n>=12544&&n<=12591},"Hangul Compatibility Jamo":function(n){return n>=12592&&n<=12687},Kanbun:function(n){return n>=12688&&n<=12703},"Bopomofo Extended":function(n){return n>=12704&&n<=12735},"CJK Strokes":function(n){return n>=12736&&n<=12783},"Katakana Phonetic Extensions":function(n){return n>=12784&&n<=12799},"Enclosed CJK Letters and Months":function(n){return n>=12800&&n<=13055},"CJK Compatibility":function(n){return n>=13056&&n<=13311},"CJK Unified Ideographs Extension A":function(n){return n>=13312&&n<=19903},"Yijing Hexagram Symbols":function(n){return n>=19904&&n<=19967},"CJK Unified Ideographs":function(n){return n>=19968&&n<=40959},"Yi Syllables":function(n){return n>=40960&&n<=42127},"Yi Radicals":function(n){return n>=42128&&n<=42191},"Hangul Jamo Extended-A":function(n){return n>=43360&&n<=43391},"Hangul Syllables":function(n){return n>=44032&&n<=55215},"Hangul Jamo Extended-B":function(n){return n>=55216&&n<=55295},"Private Use Area":function(n){return n>=57344&&n<=63743},"CJK Compatibility Ideographs":function(n){return n>=63744&&n<=64255},"Arabic Presentation Forms-A":function(n){return n>=64336&&n<=65023},"Vertical Forms":function(n){return n>=65040&&n<=65055},"CJK Compatibility Forms":function(n){return n>=65072&&n<=65103},"Small Form Variants":function(n){return n>=65104&&n<=65135},"Arabic Presentation Forms-B":function(n){return n>=65136&&n<=65279},"Halfwidth and Fullwidth Forms":function(n){return n>=65280&&n<=65519}};module.exports=unicodeBlockLookup;
},{}],303:[function(_dereq_,module,exports){
"use strict";var LRUCache=function(t,e){this.max=t,this.onRemove=e,this.reset()};LRUCache.prototype.reset=function(){var t=this;for(var e in t.data)t.onRemove(t.data[e]);return this.data={},this.order=[],this},LRUCache.prototype.add=function(t,e){if(this.has(t))this.order.splice(this.order.indexOf(t),1),this.data[t]=e,this.order.push(t);else if(this.data[t]=e,this.order.push(t),this.order.length>this.max){var r=this.getAndRemove(this.order[0]);r&&this.onRemove(r)}return this},LRUCache.prototype.has=function(t){return t in this.data},LRUCache.prototype.keys=function(){return this.order},LRUCache.prototype.getAndRemove=function(t){if(!this.has(t))return null;var e=this.data[t];return delete this.data[t],this.order.splice(this.order.indexOf(t),1),e},LRUCache.prototype.get=function(t){return this.has(t)?this.data[t]:null},LRUCache.prototype.remove=function(t){if(!this.has(t))return this;var e=this.data[t];return delete this.data[t],this.onRemove(e),this.order.splice(this.order.indexOf(t),1),this},LRUCache.prototype.setMaxSize=function(t){var e=this;for(this.max=t;this.order.length>this.max;){var r=e.getAndRemove(e.order[0]);r&&e.onRemove(r)}return this},module.exports=LRUCache;
},{}],304:[function(_dereq_,module,exports){
"use strict";function makeAPIURL(r,t,a,o){switch(r.protocol){case"minemap":var e=parseUrl(config.SRC_URL);r.protocol=e.protocol,r.authority=e.authority;break;case"minemapdata":var i=parseUrl(config.API_URL);r.path=i.path+r.authority+r.path,r.protocol=i.protocol,r.authority=i.authority;break;case"minemapdatad":var n=parseUrl(config.DYN_URL);r.path=n.path+r.authority+r.path,r.protocol=n.protocol,r.authority=n.authority;break;case"minemapdatam":var p=parseUrl(config.MERGE_URL);r.path=p.path+r.authority+r.path,r.protocol=p.protocol,r.authority=p.authority;break;case"minemapdatao":var s=parseUrl(config.OTHER_URL);r.path=s.path+r.authority+r.path,r.protocol=s.protocol,r.authority=s.authority}if(!config.REQUIRE_ACCESS_TOKEN)return formatUrl(r);if(t=t||config.ACCESS_TOKEN,a=a||config.SOLU,o=o||config.DATA_VERSION,!t)throw new Error("accessToken. "+help);return r.params.push("token="+t),r.params.push("solu="+a),o&&r.params.push("version="+o),formatUrl(r)}function isMinemapURL(r){return 0===r.indexOf("minemap:")||0===r.indexOf("minemapdata:")||0===r.indexOf("minemapdatad:")||0===r.indexOf("minemapdatam:")||0===r.indexOf("minemapdatao:")}function getVersion(){return"v"+version.substr(version.indexOf(".")+1)}function replaceTempAccessToken(r){for(var t=0;t<r.length;t++)0===r[t].indexOf("access_token=tk.")&&(r[t]="access_token="+(config.ACCESS_TOKEN||""))}function parseUrl(r){var t=r.match(urlRe);if(!t){var a=/^\/\/([^\/?]+)(\/[^?]+)?\??(.+)?/,o=r.match(a);if(!o)throw new Error("Unable to parse URL object");return{protocol:"",authority:o[1],path:o[2]||"/",params:o[3]?o[3].split("&"):[]}}return{protocol:t[1],authority:t[2],path:t[3]||"/",params:t[4]?t[4].split("&"):[]}}function formatUrl(r){var t=r.params.length?"?"+r.params.join("&"):"";return r.protocol&&r.protocol.length>0?r.protocol+"://"+r.authority+r.path+t:window.document.location.protocol+"//"+r.authority+r.path+t}var config=_dereq_("./config"),browser=_dereq_("./browser"),version=_dereq_("../../package.json").version,spriteVersion=_dereq_("../../package.json").spriteVersion,help="minedata.cn";exports.isMinemapURL=isMinemapURL,exports.normalizeStyleURL=function(r,t){if(!isMinemapURL(r))return r;var a=parseUrl(r);return a.path="/styles/v1"+a.path,makeAPIURL(a,t)},exports.normalizeGlyphsURL=function(r,t){if(!isMinemapURL(r)&&!config.fontsUrl)return r;var a=parseUrl(r);return config.fontsUrl&&config.fontsUrl+"/{fontstack}"+a.path.substr(a.path.lastIndexOf("/"))+".pbf"||config.SRC_URL+"fonts/{fontstack}/"+a.path.substr(a.path.lastIndexOf("/"))+".pbf"},exports.normalizeSourceURL=function(r,t){if(!isMinemapURL(r))return r;var a=parseUrl(r);return a.path="/v4/"+a.authority+".json",a.params.push("secure"),makeAPIURL(a,t)},exports.normalizeSpriteURL=function(r,t,a,o){if(!isMinemapURL(r)&&!config.spriteUrl){return r+""+t+a}var e=parseUrl(r);return e.path=config.SRC_URL+"sprite/sprite"+t+a,config.spriteUrl&&config.spriteUrl+""+t+a||e.path};var imageExtensionRe=/(\.(png|jpg)\d*)(?=$)/;exports.normalizeTileURL=function(r,t,a){if(!r||!isMinemapURL(r))return r.startsWith("//")?""+window.document.location.protocol+r:r;var o=parseUrl(r),e=browser.devicePixelRatio>=2||512===a?"@2x":"",i=browser.supportsWebp?".webp":"$1";return o.path=o.path.replace(imageExtensionRe,""+e+i),replaceTempAccessToken(o.params),makeAPIURL(o)};var urlRe=/^(\w+):\/\/([^\/?]+)(\/[^?]+)?\??(.+)?/;
},{"../../package.json":15,"./browser":286,"./config":290}],305:[function(_dereq_,module,exports){
"use strict";function readUtf8(r,e,n){for(var t="",a=e;a<n;){var o=r[a],i=null,u=o>239?4:o>223?3:o>191?2:1;if(a+u>n)break;var f=void 0,l=void 0,v=void 0;1===u?o<128&&(i=o):2===u?128==(192&(f=r[a+1]))&&(i=(31&o)<<6|63&f)<=127&&(i=null):3===u?(f=r[a+1],l=r[a+2],128==(192&f)&&128==(192&l)&&((i=(15&o)<<12|(63&f)<<6|63&l)<=2047||i>=55296&&i<=57343)&&(i=null)):4===u&&(f=r[a+1],l=r[a+2],v=r[a+3],128==(192&f)&&128==(192&l)&&128==(192&v)&&((i=(15&o)<<18|(63&f)<<12|(63&l)<<6|63&v)<=65535||i>=1114112)&&(i=null)),null===i?(i=65533,u=1):i>65535&&(i-=65536,t+=String.fromCharCode(i>>>10&1023|55296),i=56320|1023&i),t+=String.fromCharCode(i),a+=u}return t}function getDecoderRange(r){for(var e=0,n=r.length,t=0;t<n;t++)e+=r.charCodeAt(t);return Number.parseInt(e/n)}function convertBytes(r,e){var n=r.length-8;if(n<=e)for(var t=0;t<n/2;t++){var a=r[t];r[t]=r[n-t-1],r[n-t-1]=a}else for(var o=parseInt(n/e),i=parseInt(e/2),u=0;u<o;u++)for(var f=u*e,l=(u+1)*e-1,v=f,s=0;v<f+i;v++,s++){var c=v,g=l-s,d=r[c];r[c]=r[g],r[g]=d}}function getQueryString(r,e){if(e&&-1!=e.indexOf("?")){var n=e.split("?")[1],t=new RegExp("(^|&)"+r+"=([^&]*)(&|$)"),a=n.match(t);if(null!=a)return unescape(a[2])}return null}exports.decoderTilePbf=function(r){var e=r.responseURL,n=r.response,t=n.byteLength,a=getQueryString("token",e)||"";if(a.length>0&&t>8){var o=new Uint8Array(n);if("minedata"==readUtf8(o,t-8,t).toLowerCase())return convertBytes(o,getDecoderRange(a)),n.slice(0,t-8)}return n};
},{}],306:[function(_dereq_,module,exports){
"use strict";var exported={getEntriesByName:function(e){return!(!performance||!performance.getEntriesByName)&&performance.getEntriesByName(e)}};module.exports=exported;
},{}],307:[function(_dereq_,module,exports){
"use strict";var isChar=_dereq_("./is_char_in_unicode_block");module.exports.allowsIdeographicBreaking=function(a){for(var i=0,r=a;i<r.length;i+=1){var s=r[i];if(!exports.charAllowsIdeographicBreaking(s.charCodeAt(0)))return!1}return!0},module.exports.allowsVerticalWritingMode=function(a){for(var i=0,r=a;i<r.length;i+=1){var s=r[i];if(exports.charHasUprightVerticalOrientation(s.charCodeAt(0)))return!0}return!1},module.exports.allowsLetterSpacing=function(a){for(var i=0,r=a;i<r.length;i+=1){var s=r[i];if(!exports.charAllowsLetterSpacing(s.charCodeAt(0)))return!1}return!0},module.exports.charAllowsLetterSpacing=function(a){return!isChar.Arabic(a)&&(!isChar["Arabic Supplement"](a)&&(!isChar["Arabic Extended-A"](a)&&(!isChar["Arabic Presentation Forms-A"](a)&&!isChar["Arabic Presentation Forms-B"](a))))},module.exports.charAllowsIdeographicBreaking=function(a){return!(a<11904)&&(!!isChar["Bopomofo Extended"](a)||(!!isChar.Bopomofo(a)||(!!isChar["CJK Compatibility Forms"](a)||(!!isChar["CJK Compatibility Ideographs"](a)||(!!isChar["CJK Compatibility"](a)||(!!isChar["CJK Radicals Supplement"](a)||(!!isChar["CJK Strokes"](a)||(!!isChar["CJK Symbols and Punctuation"](a)||(!!isChar["CJK Unified Ideographs Extension A"](a)||(!!isChar["CJK Unified Ideographs"](a)||(!!isChar["Enclosed CJK Letters and Months"](a)||(!!isChar["Halfwidth and Fullwidth Forms"](a)||(!!isChar.Hiragana(a)||(!!isChar["Ideographic Description Characters"](a)||(!!isChar["Kangxi Radicals"](a)||(!!isChar["Katakana Phonetic Extensions"](a)||(!!isChar.Katakana(a)||(!!isChar["Vertical Forms"](a)||(!!isChar["Yi Radicals"](a)||!!isChar["Yi Syllables"](a))))))))))))))))))))},exports.charHasUprightVerticalOrientation=function(a){return 746===a||747===a||!(a<4352)&&(!!isChar["Bopomofo Extended"](a)||(!!isChar.Bopomofo(a)||(!(!isChar["CJK Compatibility Forms"](a)||a>=65097&&a<=65103)||(!!isChar["CJK Compatibility Ideographs"](a)||(!!isChar["CJK Compatibility"](a)||(!!isChar["CJK Radicals Supplement"](a)||(!!isChar["CJK Strokes"](a)||(!(!isChar["CJK Symbols and Punctuation"](a)||a>=12296&&a<=12305||a>=12308&&a<=12319||12336===a)||(!!isChar["CJK Unified Ideographs Extension A"](a)||(!!isChar["CJK Unified Ideographs"](a)||(!!isChar["Enclosed CJK Letters and Months"](a)||(!!isChar["Hangul Compatibility Jamo"](a)||(!!isChar["Hangul Jamo Extended-A"](a)||(!!isChar["Hangul Jamo Extended-B"](a)||(!!isChar["Hangul Jamo"](a)||(!!isChar["Hangul Syllables"](a)||(!!isChar.Hiragana(a)||(!!isChar["Ideographic Description Characters"](a)||(!!isChar.Kanbun(a)||(!!isChar["Kangxi Radicals"](a)||(!!isChar["Katakana Phonetic Extensions"](a)||(!(!isChar.Katakana(a)||12540===a)||(!(!isChar["Halfwidth and Fullwidth Forms"](a)||65288===a||65289===a||65293===a||a>=65306&&a<=65310||65339===a||65341===a||65343===a||a>=65371&&a<=65503||65507===a||a>=65512&&a<=65519)||(!(!isChar["Small Form Variants"](a)||a>=65112&&a<=65118||a>=65123&&a<=65126)||(!!isChar["Unified Canadian Aboriginal Syllabics"](a)||(!!isChar["Unified Canadian Aboriginal Syllabics Extended"](a)||(!!isChar["Vertical Forms"](a)||(!!isChar["Yijing Hexagram Symbols"](a)||(!!isChar["Yi Syllables"](a)||!!isChar["Yi Radicals"](a))))))))))))))))))))))))))))))},exports.charHasNeutralVerticalOrientation=function(a){return!(!isChar["Latin-1 Supplement"](a)||167!==a&&169!==a&&174!==a&&177!==a&&188!==a&&189!==a&&190!==a&&215!==a&&247!==a)||(!(!isChar["General Punctuation"](a)||8214!==a&&8224!==a&&8225!==a&&8240!==a&&8241!==a&&8251!==a&&8252!==a&&8258!==a&&8263!==a&&8264!==a&&8265!==a&&8273!==a)||(!!isChar["Letterlike Symbols"](a)||(!!isChar["Number Forms"](a)||(!(!isChar["Miscellaneous Technical"](a)||!(a>=8960&&a<=8967||a>=8972&&a<=8991||a>=8996&&a<=9e3||9003===a||a>=9085&&a<=9114||a>=9150&&a<=9165||9167===a||a>=9169&&a<=9179||a>=9186&&a<=9215))||(!(!isChar["Control Pictures"](a)||9251===a)||(!!isChar["Optical Character Recognition"](a)||(!!isChar["Enclosed Alphanumerics"](a)||(!!isChar["Geometric Shapes"](a)||(!(!isChar["Miscellaneous Symbols"](a)||a>=9754&&a<=9759)||(!(!isChar["Miscellaneous Symbols and Arrows"](a)||!(a>=11026&&a<=11055||a>=11088&&a<=11097||a>=11192&&a<=11243))||(!!isChar["CJK Symbols and Punctuation"](a)||(!!isChar.Katakana(a)||(!!isChar["Private Use Area"](a)||(!!isChar["CJK Compatibility Forms"](a)||(!!isChar["Small Form Variants"](a)||(!!isChar["Halfwidth and Fullwidth Forms"](a)||(8734===a||8756===a||8757===a||a>=9984&&a<=10087||a>=10102&&a<=10131||65532===a||65533===a)))))))))))))))))},exports.charHasRotatedVerticalOrientation=function(a){return!(exports.charHasUprightVerticalOrientation(a)||exports.charHasNeutralVerticalOrientation(a))};
},{"./is_char_in_unicode_block":302}],308:[function(_dereq_,module,exports){
"use strict";var ajax=_dereq_("./ajax"),config=_dereq_("./config"),TOKEN_VALUE="25cc55a69ea7422182d00d6b7c0ffa93",util=_dereq_("./util"),joinParamToUrl=function(e){var r="";return e&&Object.keys(e).map(function(o){var t=e[o];"string"!=typeof t&&(t=JSON.stringify(t)),r+=o+"="+t+"&"}),util.endsWith(r,"&")&&(r=r.substr(0,r.length-1)),r};exports.querySearchResultByType=function(e,r,o,t,a,n){var u={token:TOKEN_VALUE,adCode:e,searchType:o||"all",key:r,pageNumber:t||1,pageCount:a||10,source:3},i=config.SERVICE_URL+"/search/keyword?"+joinParamToUrl(u);return ajax.getJSON(i,n)},exports.queryAllSearchResult=function(e,r,o,t,a){return exports.querySearchResultByType(e,r,"all",o,t,a)},exports.queryPoiSearchResult=function(e,r,o,t,a){return exports.querySearchResultByType(e,r,"poi",o,t,a)},exports.queryPoiSearchResultByDataType=function(e,r,o,t,a,n){var u={token:TOKEN_VALUE,adCode:e,searchType:"poi",key:r,pageNumber:o||1,pageCount:t||10,source:3,dataType:a},i=config.SERVICE_URL+"/search/keyword?"+joinParamToUrl(u);return ajax.getJSON(i,n)},exports.queryRoadSearchResult=function(e,r,o,t,a){return exports.querySearchResultByType(e,r,"road",o,t,a)},exports.querySearchSurroundResult=function(e,r,o,t,a,n,u,i,s,c){var l={token:TOKEN_VALUE,adCode:e,searchType:o||"all",key:r,location:t,inRadius:1,spatialFuntion:a||"geofilt",radius:n||500,seq:u||0,source:3,pageNumber:i||1,pageCount:s||10},g=config.SERVICE_URL+"/search/surround?"+joinParamToUrl(l);return ajax.getJSON(g,c)},exports.querySearchBboxResult=function(e,r,o,t,a,n,u,i){var s={token:TOKEN_VALUE,adCode:e,searchType:o||"all",key:r,bounds:t,seq:a||0,source:3,pageNumber:n||1,pageCount:u||10},c=config.SERVICE_URL+"/search/bbox?"+joinParamToUrl(s);return ajax.getJSON(c,i)},exports.querySearchAroundResult=function(e,r,o,t,a){var n={token:TOKEN_VALUE,location:e,type:r||"poi",radius:o||1e3,count:t||5},u=config.SERVICE_URL+"/search/around?"+joinParamToUrl(n);return ajax.getJSON(u,a)},exports.queryRouteDrivingResult=function(e,r,o,t,a,n,u,i,s){var c={token:TOKEN_VALUE,sPoint:e,ePoint:r,wayPoints:o||null,shpFlag:t||0,costModel:a||16,numAlt:n||1,criteria:u||0,traffic:i||0,source:1},l=config.SERVICE_URL+"/route/driving?"+joinParamToUrl(c);return ajax.getJSON(l,s)},exports.queryRouteDrivingResult2=function(e,r,o,t,a,n,u,i,s){var c={token:TOKEN_VALUE,sPoint:e,ePoint:r,wayPoints:o||null,shpFlag:t||0,costModel:a||16,numAlt:n||1,criteria:u||0,traffic:i||0,source:3},l=config.SERVICE_URL+"/route/driving?"+joinParamToUrl(c);return ajax.getJSON(l,s)},exports.queryRouteDrivingResult3=function(e,r,o,t,a,n){var u={token:TOKEN_VALUE,sPoint:e,ePoint:r,wayPoints:o||"",st:t,avoidArea:a||"",source:3},i=config.SERVICE_URL+"/route/driving2?"+joinParamToUrl(u);return ajax.getJSON(i,n)},exports.queryRouteBusResult=function(e,r,o,t,a,n,u){var i={token:TOKEN_VALUE,adCode:e,sPoint:r,ePoint:o,strategy:t||0,shpInfoFlag:a||0,showWalkInfo:n||0,source:1},s=config.SERVICE_URL+"/route/busTransfer?"+joinParamToUrl(i);return ajax.getJSON(s,u)},exports.queryRouteBusResult2=function(e,r,o,t,a,n,u){var i={token:TOKEN_VALUE,adCode:e,sPoint:r,ePoint:o,strategy:t||0,shpInfoFlag:a||0,showWalkInfo:n||0,source:3},s=config.SERVICE_URL+"/route/busTransfer?"+joinParamToUrl(i);return ajax.getJSON(s,u)},exports.queryAdminResultByPoint=function(e,r,o){var t={token:TOKEN_VALUE,location:e,geometry:r||0,source:3},a=config.SERVICE_URL+"/search/adminByPoint?"+joinParamToUrl(t);return ajax.getJSON(a,o)},exports.queryGeoCodingResult=function(e,r,o){var t={token:TOKEN_VALUE,adCode:e,address:r,source:3},a=config.SERVICE_URL+"/coder/geocoding?"+joinParamToUrl(t);return ajax.getJSON(a,o)},exports.queryGeoCodingScoreResult=function(e,r,o){var t={token:TOKEN_VALUE,adCode:e,address:r},a=config.SERVICE_URL+"/coder/geocoding/score?"+joinParamToUrl(t);return ajax.getJSON(a,o)},exports.queryReverseGeoCodingResult=function(e,r,o,t,a,n){var u={token:TOKEN_VALUE,location:e,type:r||1,radius:o||300,roadRadius:t||300,kind:a||0,source:3},i=config.SERVICE_URL+"/coder/reverseGeocoding?"+joinParamToUrl(u);return ajax.getJSON(i,n)},exports.querySmartTipsResult=function(e,r,o,t,a){var n={token:TOKEN_VALUE,adCode:e,input:r,searchType:o||"all",pageCount:t||10},u=config.SERVICE_URL+"/tips/smartTips?"+joinParamToUrl(n);return ajax.getJSON(u,a)},exports.querySearchSuggestResult=function(e,r,o){var t={token:TOKEN_VALUE,city:e,keywords:r},a=config.SERVICE_URL+"/search/suggest?"+joinParamToUrl(t);return ajax.getJSON(a,o)},exports.queryBusRouteResultByKeyword=function(e,r,o){var t={adCode:e,keyword:r},a=config.SERVICE_URL+"/route/busRoute?"+joinParamToUrl(t);return ajax.getJSON(a,o)},exports.queryBusStationResultByKeyword=function(e,r,o){var t={adCode:e,keyword:r},a=config.SERVICE_URL+"/route/busStation?"+joinParamToUrl(t);return ajax.getJSON(a,o)};
},{"./ajax":285,"./config":290,"./util":315}],309:[function(_dereq_,module,exports){
"use strict";var LngLat=_dereq_("../geo/lng_lat");module.exports=function(n,t,l){if(n=new LngLat(n.lng,n.lat),t){var a=new LngLat(n.lng-360,n.lat),i=new LngLat(n.lng+360,n.lat),o=l.locationPoint(n).distSqr(t);l.locationPoint(a).distSqr(t)<o?n=a:l.locationPoint(i).distSqr(t)<o&&(n=i)}for(;Math.abs(n.lng-l.center.lng)>180;){var e=l.locationPoint(n);if(e.x>=0&&e.y>=0&&e.x<=l.width&&e.y<=l.height)break;n.lng>l.center.lng?n.lng-=360:n.lng+=360}return n};
},{"../geo/lng_lat":76}],310:[function(_dereq_,module,exports){
"use strict";function createLayout(t,r){void 0===r&&(r=1);var e=0,i=0;return{members:t.map(function(t){var a=sizeOf(t.type),s=e=align(e,Math.max(r,a)),n=t.components||1;return i=Math.max(i,a),e+=a*n,{name:t.name,type:t.type,components:n,offset:s}}),size:align(e,Math.max(i,r)),alignment:r}}function sizeOf(t){return viewTypes[t].BYTES_PER_ELEMENT}function align(t,r){return Math.ceil(t/r)*r}var viewTypes={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array},Struct=function(t,r){this._structArray=t,this._pos1=r*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8},DEFAULT_CAPACITY=128,RESIZE_MULTIPLIER=5,StructArray=function(){this.isTransferred=!1,this.capacity=-1,this.resize(0)};StructArray.serialize=function(t,r){return t._trim(),r&&(t.isTransferred=!0,r.push(t.arrayBuffer)),{length:t.length,arrayBuffer:t.arrayBuffer}},StructArray.deserialize=function(t){var r=Object.create(this.prototype);return r.arrayBuffer=t.arrayBuffer,r.length=t.length,r.capacity=t.arrayBuffer.byteLength/r.bytesPerElement,r._refreshViews(),r},StructArray.prototype._trim=function(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())},StructArray.prototype.clear=function(){this.length=0},StructArray.prototype.resize=function(t){this.reserve(t),this.length=t},StructArray.prototype.reserve=function(t){if(t>this.capacity){this.capacity=Math.max(t,Math.floor(this.capacity*RESIZE_MULTIPLIER),DEFAULT_CAPACITY),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);var r=this.uint8;this._refreshViews(),r&&this.uint8.set(r)}},StructArray.prototype._refreshViews=function(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")},module.exports.StructArray=StructArray,module.exports.Struct=Struct,module.exports.viewTypes=viewTypes,module.exports.createLayout=createLayout;
},{}],311:[function(_dereq_,module,exports){
"use strict";var TaskQueue=function(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1};TaskQueue.prototype.add=function(e){var u=++this._id;return this._queue.push({callback:e,id:u,cancelled:!1}),u},TaskQueue.prototype.remove=function(e){for(var u=this._currentlyRunning,t=u?this._queue.concat(u):this._queue,n=0,r=t;n<r.length;n+=1){var i=r[n];if(i.id===e)return void(i.cancelled=!0)}},TaskQueue.prototype.run=function(){var e=this,u=this._currentlyRunning=this._queue;this._queue=[];for(var t=0,n=u;t<n.length;t+=1){var r=n[t];if(!r.cancelled&&(r.callback(),e._cleared))break}this._cleared=!1,this._currentlyRunning=!1},TaskQueue.prototype.clear=function(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]},module.exports=TaskQueue;
},{}],312:[function(_dereq_,module,exports){
"use strict";module.exports=function(t,n){var u=!1,e=0,r=function(){e=0,u&&(t(),e=setTimeout(r,n),u=!1)};return function(){return u=!0,e||r(),e}};
},{}],313:[function(_dereq_,module,exports){
"use strict";function tileCover(e,r,a,n){function d(r,d,t){var y,c,l,x;if(t>=0&&t<=o)for(y=r;y<d;y++)c=Math.floor(y/o),l=(y%o+o)%o,0!==c&&!0!==n||(x=new OverscaledTileID(a,c,e,l,t),i[x.key]=x)}void 0===n&&(n=!0);var o=1<<e,i={};return scanTriangle(r[0],r[1],r[2],0,o,d),scanTriangle(r[2],r[3],r[0],0,o,d),Object.keys(i).map(function(e){return i[e]})}function edge(e,r){if(e.row>r.row){var a=e;e=r,r=a}return{x0:e.column,y0:e.row,x1:r.column,y1:r.row,dx:r.column-e.column,dy:r.row-e.row}}function scanSpans(e,r,a,n,d){var o=Math.max(a,Math.floor(r.y0)),i=Math.min(n,Math.ceil(r.y1));if(e.x0===r.x0&&e.y0===r.y0?e.x0+r.dy/e.dy*e.dx<r.x1:e.x1-r.dy/e.dy*e.dx<r.x0){var t=e;e=r,r=t}for(var y=e.dx/e.dy,c=r.dx/r.dy,l=e.dx>0,x=r.dx<0,u=o;u<i;u++){var s=y*Math.max(0,Math.min(e.dy,u+l-e.y0))+e.x0,f=c*Math.max(0,Math.min(r.dy,u+x-r.y0))+r.x0;d(Math.floor(f),Math.ceil(s),u)}}function scanTriangle(e,r,a,n,d,o){var i,t=edge(e,r),y=edge(r,a),c=edge(a,e);t.dy>y.dy&&(i=t,t=y,y=i),t.dy>c.dy&&(i=t,t=c,c=i),y.dy>c.dy&&(i=y,y=c,c=i),t.dy&&scanSpans(c,t,n,d,o),y.dy&&scanSpans(c,y,n,d,o)}var Coordinate=_dereq_("../geo/coordinate"),ref=_dereq_("../source/tile_id"),OverscaledTileID=ref.OverscaledTileID;module.exports=tileCover;
},{"../geo/coordinate":75,"../source/tile_id":134}],314:[function(_dereq_,module,exports){
"use strict";function resolveTokens(e,n){return n.replace(/{([^{}]+)}/g,function(n,r){return r in e?String(e[r]):""})}module.exports=resolveTokens;
},{}],315:[function(_dereq_,module,exports){
"use strict";var UnitBezier=_dereq_("../_minemap_/unitbezier"),Coordinate=_dereq_("../geo/coordinate"),Point=_dereq_("../_minemap_/point-geometry");exports.easeCubicInOut=function(r){if(r<=0)return 0;if(r>=1)return 1;var e=r*r,t=e*r;return 4*(r<.5?t:3*(r-e)+t-.75)},exports.bezier=function(r,e,t,n){var o=new UnitBezier(r,e,t,n);return function(r){return o.solve(r)}},exports.ease=exports.bezier(.25,.1,.25,1),exports.clamp=function(r,e,t){return Math.min(t,Math.max(e,r))},exports.wrap=function(r,e,t){var n=t-e,o=((r-e)%n+n)%n+e;return o===e?t:o},exports.asyncAll=function(r,e,t){if(!r.length)return t(null,[]);var n=r.length,o=new Array(r.length),a=null;r.forEach(function(r,i){e(r,function(r,e){r&&(a=r),o[i]=e,0==--n&&t(a,o)})})},exports.values=function(r){var e=[];for(var t in r)e.push(r[t]);return e},exports.keysDifference=function(r,e){var t=[];for(var n in r)n in e||t.push(n);return t},exports.extend=function(r){for(var e=[],t=arguments.length-1;t-- >0;)e[t]=arguments[t+1];for(var n=0,o=e;n<o.length;n+=1){var a=o[n];for(var i in a)r[i]=a[i]}return r},exports.pick=function(r,e){for(var t={},n=0;n<e.length;n++){var o=e[n];o in r&&(t[o]=r[o])}return t};var id=1;exports.uniqueId=function(){return id++},exports.bindAll=function(r,e){r.forEach(function(r){e[r]&&(e[r]=e[r].bind(e))})},exports.getCoordinatesCenter=function(r){for(var e=1/0,t=1/0,n=-1/0,o=-1/0,a=0;a<r.length;a++)e=Math.min(e,r[a].column),t=Math.min(t,r[a].row),n=Math.max(n,r[a].column),o=Math.max(o,r[a].row);var i=n-e,u=o-t,s=Math.max(i,u),c=Math.max(0,Math.floor(-Math.log(s)/Math.LN2));return new Coordinate((e+n)/2,(t+o)/2,0).zoomTo(c)},exports.endsWith=function(r,e){return!(!r||!e)&&-1!==r.indexOf(e,r.length-e.length)},exports.mapObject=function(r,e,t){var n=this,o={};for(var a in r)o[a]=e.call(t||n,r[a],a,r);return o},exports.filterObject=function(r,e,t){var n=this,o={};for(var a in r)e.call(t||n,r[a],a,r)&&(o[a]=r[a]);return o},exports.deepEqual=_dereq_("../style-spec/util/deep_equal"),exports.clone=function(r){return Array.isArray(r)?r.map(exports.clone):"object"==typeof r&&r?exports.mapObject(r,exports.clone):r},exports.arraysIntersect=function(r,e){for(var t=0;t<r.length;t++)if(e.indexOf(r[t])>=0)return!0;return!1};var warnOnceHistory={};exports.warnOnce=function(r){warnOnceHistory[r]||(warnOnceHistory[r]=!0)},exports.isCounterClockwise=function(r,e,t){return(t.y-r.y)*(e.x-r.x)>(e.y-r.y)*(t.x-r.x)},exports.calculateSignedArea=function(r){for(var e=0,t=0,n=r.length,o=n-1,a=void 0,i=void 0;t<n;o=t++)a=r[t],i=r[o],e+=(i.x-a.x)*(a.y+i.y);return e},exports.isClosedPolygon=function(r){if(r.length<4)return!1;var e=r[0],t=r[r.length-1];return!(Math.abs(e.x-t.x)>0||Math.abs(e.y-t.y)>0)&&Math.abs(exports.calculateSignedArea(r))>.01},exports.sphericalToCartesian=function(r){var e=r[0],t=r[1],n=r[2];return t+=90,t*=Math.PI/180,n*=Math.PI/180,{x:e*Math.cos(t)*Math.sin(n),y:e*Math.sin(t)*Math.sin(n),z:e*Math.cos(n)}},exports.parseCacheControl=function(r){var e=/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,t={};if(r.replace(e,function(r,e,n,o){var a=n||o;return t[e]=!a||a.toLowerCase(),""}),t["max-age"]){var n=parseInt(t["max-age"],10);isNaN(n)?delete t["max-age"]:t["max-age"]=n}return t};
},{"../_minemap_/point-geometry":29,"../_minemap_/unitbezier":33,"../geo/coordinate":75,"../style-spec/util/deep_equal":175}],316:[function(_dereq_,module,exports){
"use strict";var Feature=function(e,t,r,o){this.type="Feature",this._vectorTileFeature=e,e._z=t,e._x=r,e._y=o,this.properties=e.properties,null!=e.id&&(this.id=e.id)},prototypeAccessors={geometry:{}};prototypeAccessors.geometry.get=function(){return void 0===this._geometry&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry},prototypeAccessors.geometry.set=function(e){this._geometry=e},Feature.prototype.toJSON=function(){var e=this,t={geometry:this.geometry};for(var r in e)"_geometry"!==r&&"_vectorTileFeature"!==r&&(t[r]=e[r]);return t},Object.defineProperties(Feature.prototype,prototypeAccessors),module.exports=Feature;
},{}],317:[function(_dereq_,module,exports){
"use strict";var scriptDetection=_dereq_("./script_detection");module.exports=function(t){for(var o="",e=0;e<t.length;e++){var r=t.charCodeAt(e+1)||null,l=t.charCodeAt(e-1)||null;(!r||!scriptDetection.charHasRotatedVerticalOrientation(r)||module.exports.lookup[t[e+1]])&&(!l||!scriptDetection.charHasRotatedVerticalOrientation(l)||module.exports.lookup[t[e-1]])&&module.exports.lookup[t[e]]?o+=module.exports.lookup[t[e]]:o+=t[e]}return o},module.exports.lookup={"!":"","#":"",$:"","%":"","&":"","(":"",")":"","*":"","+":"",",":"","-":"",".":"","/":"",":":"",";":"","<":"","=":"",">":"","?":"","@":"","[":"","\\":"","]":"","^":"",_:"","`":"","{":"","|":"","}":"","~":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":""};
},{"./script_detection":307}],318:[function(_dereq_,module,exports){
"use strict";function register(e,r,i){void 0===i&&(i={}),Object.defineProperty(r,"_classRegistryKey",{value:e,writeable:!1}),registry[e]={klass:r,omit:i.omit||[],shallow:i.shallow||[]}}function serialize(e,r){if(null===e||void 0===e||"boolean"==typeof e||"number"==typeof e||"string"==typeof e||e instanceof Boolean||e instanceof Number||e instanceof String||e instanceof Date||e instanceof RegExp)return e;if(e instanceof ArrayBuffer)return r&&r.push(e),e;if(ArrayBuffer.isView(e)){var i=e;return r&&r.push(i.buffer),i}if(e instanceof ImageData)return r&&r.push(e.data.buffer),e;if(Array.isArray(e)){for(var s=[],o=0,t=e;o<t.length;o+=1){var n=t[o];s.push(serialize(n,r))}return s}if("object"==typeof e){var a=e.constructor,f=a._classRegistryKey;if(!f)throw new Error("can't serialize object of unregistered class");var l={};if(a.serialize)l._serialized=a.serialize(e,r);else{for(var p in e)if(e.hasOwnProperty(p)&&!(registry[f].omit.indexOf(p)>=0)){var u=e[p];l[p]=registry[f].shallow.indexOf(p)>=0?u:serialize(u,r)}e instanceof Error&&(l.message=e.message)}return{name:f,properties:l}}throw new Error("can't serialize object of type "+typeof e)}function deserialize(e){if(null===e||void 0===e||"boolean"==typeof e||"number"==typeof e||"string"==typeof e||e instanceof Boolean||e instanceof Number||e instanceof String||e instanceof Date||e instanceof RegExp||e instanceof ArrayBuffer||ArrayBuffer.isView(e)||e instanceof ImageData)return e;if(Array.isArray(e))return e.map(function(e){return deserialize(e)});if("object"==typeof e){var r=e,i=r.name,s=r.properties;if(!i)throw new Error("can't deserialize object of anonymous class");var o=registry[i],t=o.klass;if(!t)throw new Error("can't deserialize unregistered class "+i);if(t.deserialize)return t.deserialize(s._serialized);for(var n=Object.create(t.prototype),a=0,f=Object.keys(s);a<f.length;a+=1){var l=f[a];n[l]=registry[i].shallow.indexOf(l)>=0?s[l]:deserialize(s[l])}return n}throw new Error("can't deserialize object of type "+typeof e)}var Grid=_dereq_("grid-index"),Color=_dereq_("../style-spec/util/color"),ref=_dereq_("../style-spec/expression"),StylePropertyFunction=ref.StylePropertyFunction,StyleExpression=ref.StyleExpression,StyleExpressionWithErrorHandling=ref.StyleExpressionWithErrorHandling,ZoomDependentExpression=ref.ZoomDependentExpression,ZoomConstantExpression=ref.ZoomConstantExpression,ref$1=_dereq_("../style-spec/expression/compound_expression"),CompoundExpression=ref$1.CompoundExpression,expressions=_dereq_("../style-spec/expression/definitions"),ref$2=_dereq_("./window"),ImageData=ref$2.ImageData,registry={};register("Object",Object),Grid.serialize=function(e,r){var i=e.toArrayBuffer();return r&&r.push(i),i},Grid.deserialize=function(e){return new Grid(e)},register("Grid",Grid),register("Color",Color),register("Error",Error),register("StylePropertyFunction",StylePropertyFunction),register("StyleExpression",StyleExpression,{omit:["_evaluator"]}),register("ZoomDependentExpression",ZoomDependentExpression),register("ZoomConstantExpression",ZoomConstantExpression),register("CompoundExpression",CompoundExpression,{omit:["_evaluate"]});for(var name in expressions)expressions[name]._classRegistryKey||register("Expression_"+name,expressions[name]);module.exports={register:register,serialize:serialize,deserialize:deserialize};
},{"../style-spec/expression":159,"../style-spec/expression/compound_expression":143,"../style-spec/expression/definitions":151,"../style-spec/util/color":173,"./window":288,"grid-index":4}],319:[function(_dereq_,module,exports){
"use strict";var WebWorker=_dereq_("./web_worker"),WorkerPool=function(){this.active={}};WorkerPool.prototype.acquire=function(r){var e=this;if(!this.workers){var o=_dereq_("../").workerCount;for(this.workers=[];this.workers.length<o;)e.workers.push(new WebWorker)}return this.active[r]=!0,this.workers.slice()},WorkerPool.prototype.release=function(r){delete this.active[r],0===Object.keys(this.active).length&&(this.workers.forEach(function(r){r.terminate()}),this.workers=null)},module.exports=WorkerPool;
},{"../":88,"./web_worker":287}]},{},[88])(88)
});

